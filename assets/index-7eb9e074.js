var Uy=Object.defineProperty;var Ly=(n,t,e)=>t in n?Uy(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var x=(n,t,e)=>(Ly(n,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const f of a.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&i(f)}).observe(document,{childList:!0,subtree:!0});function e(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(r){if(r.ep)return;r.ep=!0;const a=e(r);fetch(r.href,a)}})();var di="top",Di="bottom",Pi="right",pi="left",Cc="auto",Pa=[di,Di,Pi,pi],ss="start",ma="end",Kv="clippingParents",Xf="viewport",$s="popper",Xv="reference",Hu=Pa.reduce(function(n,t){return n.concat([t+"-"+ss,t+"-"+ma])},[]),jf=[].concat(Pa,[Cc]).reduce(function(n,t){return n.concat([t,t+"-"+ss,t+"-"+ma])},[]),jv="beforeRead",Yv="read",qv="afterRead",$v="beforeMain",Jv="main",Zv="afterMain",t0="beforeWrite",e0="write",i0="afterWrite",n0=[jv,Yv,qv,$v,Jv,Zv,t0,e0,i0];function yn(n){return n?(n.nodeName||"").toLowerCase():null}function Oi(n){if(n==null)return window;if(n.toString()!=="[object Window]"){var t=n.ownerDocument;return t&&t.defaultView||window}return n}function as(n){var t=Oi(n).Element;return n instanceof t||n instanceof Element}function Yi(n){var t=Oi(n).HTMLElement;return n instanceof t||n instanceof HTMLElement}function Yf(n){if(typeof ShadowRoot>"u")return!1;var t=Oi(n).ShadowRoot;return n instanceof t||n instanceof ShadowRoot}function Iy(n){var t=n.state;Object.keys(t.elements).forEach(function(e){var i=t.styles[e]||{},r=t.attributes[e]||{},a=t.elements[e];!Yi(a)||!yn(a)||(Object.assign(a.style,i),Object.keys(r).forEach(function(f){var o=r[f];o===!1?a.removeAttribute(f):a.setAttribute(f,o===!0?"":o)}))})}function Dy(n){var t=n.state,e={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,e.popper),t.styles=e,t.elements.arrow&&Object.assign(t.elements.arrow.style,e.arrow),function(){Object.keys(t.elements).forEach(function(i){var r=t.elements[i],a=t.attributes[i]||{},f=Object.keys(t.styles.hasOwnProperty(i)?t.styles[i]:e[i]),o=f.reduce(function(s,l){return s[l]="",s},{});!Yi(r)||!yn(r)||(Object.assign(r.style,o),Object.keys(a).forEach(function(s){r.removeAttribute(s)}))})}}const qf={name:"applyStyles",enabled:!0,phase:"write",fn:Iy,effect:Dy,requires:["computeStyles"]};function wn(n){return n.split("-")[0]}var Jr=Math.max,Zl=Math.min,va=Math.round;function ku(){var n=navigator.userAgentData;return n!=null&&n.brands&&Array.isArray(n.brands)?n.brands.map(function(t){return t.brand+"/"+t.version}).join(" "):navigator.userAgent}function r0(){return!/^((?!chrome|android).)*safari/i.test(ku())}function wa(n,t,e){t===void 0&&(t=!1),e===void 0&&(e=!1);var i=n.getBoundingClientRect(),r=1,a=1;t&&Yi(n)&&(r=n.offsetWidth>0&&va(i.width)/n.offsetWidth||1,a=n.offsetHeight>0&&va(i.height)/n.offsetHeight||1);var f=as(n)?Oi(n):window,o=f.visualViewport,s=!r0()&&e,l=(i.left+(s&&o?o.offsetLeft:0))/r,u=(i.top+(s&&o?o.offsetTop:0))/a,A=i.width/r,c=i.height/a;return{width:A,height:c,top:u,right:l+A,bottom:u+c,left:l,x:l,y:u}}function $f(n){var t=wa(n),e=n.offsetWidth,i=n.offsetHeight;return Math.abs(t.width-e)<=1&&(e=t.width),Math.abs(t.height-i)<=1&&(i=t.height),{x:n.offsetLeft,y:n.offsetTop,width:e,height:i}}function s0(n,t){var e=t.getRootNode&&t.getRootNode();if(n.contains(t))return!0;if(e&&Yf(e)){var i=t;do{if(i&&n.isSameNode(i))return!0;i=i.parentNode||i.host}while(i)}return!1}function Gn(n){return Oi(n).getComputedStyle(n)}function Py(n){return["table","td","th"].indexOf(yn(n))>=0}function Er(n){return((as(n)?n.ownerDocument:n.document)||window.document).documentElement}function bc(n){return yn(n)==="html"?n:n.assignedSlot||n.parentNode||(Yf(n)?n.host:null)||Er(n)}function Jd(n){return!Yi(n)||Gn(n).position==="fixed"?null:n.offsetParent}function Oy(n){var t=/firefox/i.test(ku()),e=/Trident/i.test(ku());if(e&&Yi(n)){var i=Gn(n);if(i.position==="fixed")return null}var r=bc(n);for(Yf(r)&&(r=r.host);Yi(r)&&["html","body"].indexOf(yn(r))<0;){var a=Gn(r);if(a.transform!=="none"||a.perspective!=="none"||a.contain==="paint"||["transform","perspective"].indexOf(a.willChange)!==-1||t&&a.willChange==="filter"||t&&a.filter&&a.filter!=="none")return r;r=r.parentNode}return null}function nA(n){for(var t=Oi(n),e=Jd(n);e&&Py(e)&&Gn(e).position==="static";)e=Jd(e);return e&&(yn(e)==="html"||yn(e)==="body"&&Gn(e).position==="static")?t:e||Oy(n)||t}function Jf(n){return["top","bottom"].indexOf(n)>=0?"x":"y"}function Lo(n,t,e){return Jr(n,Zl(t,e))}function Qy(n,t,e){var i=Lo(n,t,e);return i>e?e:i}function a0(){return{top:0,right:0,bottom:0,left:0}}function o0(n){return Object.assign({},a0(),n)}function A0(n,t){return t.reduce(function(e,i){return e[i]=n,e},{})}var Ry=function(t,e){return t=typeof t=="function"?t(Object.assign({},e.rects,{placement:e.placement})):t,o0(typeof t!="number"?t:A0(t,Pa))};function Hy(n){var t,e=n.state,i=n.name,r=n.options,a=e.elements.arrow,f=e.modifiersData.popperOffsets,o=wn(e.placement),s=Jf(o),l=[pi,Pi].indexOf(o)>=0,u=l?"height":"width";if(!(!a||!f)){var A=Ry(r.padding,e),c=$f(a),h=s==="y"?di:pi,p=s==="y"?Di:Pi,m=e.rects.reference[u]+e.rects.reference[s]-f[s]-e.rects.popper[u],d=f[s]-e.rects.reference[s],g=nA(a),v=g?s==="y"?g.clientHeight||0:g.clientWidth||0:0,w=m/2-d/2,_=A[h],y=v-c[u]-A[p],C=v/2-c[u]/2+w,b=Lo(_,C,y),S=s;e.modifiersData[i]=(t={},t[S]=b,t.centerOffset=b-C,t)}}function ky(n){var t=n.state,e=n.options,i=e.element,r=i===void 0?"[data-popper-arrow]":i;r!=null&&(typeof r=="string"&&(r=t.elements.popper.querySelector(r),!r)||s0(t.elements.popper,r)&&(t.elements.arrow=r))}const l0={name:"arrow",enabled:!0,phase:"main",fn:Hy,effect:ky,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function _a(n){return n.split("-")[1]}var Ny={top:"auto",right:"auto",bottom:"auto",left:"auto"};function Vy(n,t){var e=n.x,i=n.y,r=t.devicePixelRatio||1;return{x:va(e*r)/r||0,y:va(i*r)/r||0}}function Zd(n){var t,e=n.popper,i=n.popperRect,r=n.placement,a=n.variation,f=n.offsets,o=n.position,s=n.gpuAcceleration,l=n.adaptive,u=n.roundOffsets,A=n.isFixed,c=f.x,h=c===void 0?0:c,p=f.y,m=p===void 0?0:p,d=typeof u=="function"?u({x:h,y:m}):{x:h,y:m};h=d.x,m=d.y;var g=f.hasOwnProperty("x"),v=f.hasOwnProperty("y"),w=pi,_=di,y=window;if(l){var C=nA(e),b="clientHeight",S="clientWidth";if(C===Oi(e)&&(C=Er(e),Gn(C).position!=="static"&&o==="absolute"&&(b="scrollHeight",S="scrollWidth")),C=C,r===di||(r===pi||r===Pi)&&a===ma){_=Di;var B=A&&C===y&&y.visualViewport?y.visualViewport.height:C[b];m-=B-i.height,m*=s?1:-1}if(r===pi||(r===di||r===Di)&&a===ma){w=Pi;var M=A&&C===y&&y.visualViewport?y.visualViewport.width:C[S];h-=M-i.width,h*=s?1:-1}}var z=Object.assign({position:o},l&&Ny),G=u===!0?Vy({x:h,y:m},Oi(e)):{x:h,y:m};if(h=G.x,m=G.y,s){var P;return Object.assign({},z,(P={},P[_]=v?"0":"",P[w]=g?"0":"",P.transform=(y.devicePixelRatio||1)<=1?"translate("+h+"px, "+m+"px)":"translate3d("+h+"px, "+m+"px, 0)",P))}return Object.assign({},z,(t={},t[_]=v?m+"px":"",t[w]=g?h+"px":"",t.transform="",t))}function zy(n){var t=n.state,e=n.options,i=e.gpuAcceleration,r=i===void 0?!0:i,a=e.adaptive,f=a===void 0?!0:a,o=e.roundOffsets,s=o===void 0?!0:o,l={placement:wn(t.placement),variation:_a(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:r,isFixed:t.options.strategy==="fixed"};t.modifiersData.popperOffsets!=null&&(t.styles.popper=Object.assign({},t.styles.popper,Zd(Object.assign({},l,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:f,roundOffsets:s})))),t.modifiersData.arrow!=null&&(t.styles.arrow=Object.assign({},t.styles.arrow,Zd(Object.assign({},l,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:s})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})}const Zf={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:zy,data:{}};var CA={passive:!0};function Gy(n){var t=n.state,e=n.instance,i=n.options,r=i.scroll,a=r===void 0?!0:r,f=i.resize,o=f===void 0?!0:f,s=Oi(t.elements.popper),l=[].concat(t.scrollParents.reference,t.scrollParents.popper);return a&&l.forEach(function(u){u.addEventListener("scroll",e.update,CA)}),o&&s.addEventListener("resize",e.update,CA),function(){a&&l.forEach(function(u){u.removeEventListener("scroll",e.update,CA)}),o&&s.removeEventListener("resize",e.update,CA)}}const td={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:Gy,data:{}};var Wy={left:"right",right:"left",bottom:"top",top:"bottom"};function Vl(n){return n.replace(/left|right|bottom|top/g,function(t){return Wy[t]})}var Ky={start:"end",end:"start"};function tp(n){return n.replace(/start|end/g,function(t){return Ky[t]})}function ed(n){var t=Oi(n),e=t.pageXOffset,i=t.pageYOffset;return{scrollLeft:e,scrollTop:i}}function id(n){return wa(Er(n)).left+ed(n).scrollLeft}function Xy(n,t){var e=Oi(n),i=Er(n),r=e.visualViewport,a=i.clientWidth,f=i.clientHeight,o=0,s=0;if(r){a=r.width,f=r.height;var l=r0();(l||!l&&t==="fixed")&&(o=r.offsetLeft,s=r.offsetTop)}return{width:a,height:f,x:o+id(n),y:s}}function jy(n){var t,e=Er(n),i=ed(n),r=(t=n.ownerDocument)==null?void 0:t.body,a=Jr(e.scrollWidth,e.clientWidth,r?r.scrollWidth:0,r?r.clientWidth:0),f=Jr(e.scrollHeight,e.clientHeight,r?r.scrollHeight:0,r?r.clientHeight:0),o=-i.scrollLeft+id(n),s=-i.scrollTop;return Gn(r||e).direction==="rtl"&&(o+=Jr(e.clientWidth,r?r.clientWidth:0)-a),{width:a,height:f,x:o,y:s}}function nd(n){var t=Gn(n),e=t.overflow,i=t.overflowX,r=t.overflowY;return/auto|scroll|overlay|hidden/.test(e+r+i)}function c0(n){return["html","body","#document"].indexOf(yn(n))>=0?n.ownerDocument.body:Yi(n)&&nd(n)?n:c0(bc(n))}function Io(n,t){var e;t===void 0&&(t=[]);var i=c0(n),r=i===((e=n.ownerDocument)==null?void 0:e.body),a=Oi(i),f=r?[a].concat(a.visualViewport||[],nd(i)?i:[]):i,o=t.concat(f);return r?o:o.concat(Io(bc(f)))}function Nu(n){return Object.assign({},n,{left:n.x,top:n.y,right:n.x+n.width,bottom:n.y+n.height})}function Yy(n,t){var e=wa(n,!1,t==="fixed");return e.top=e.top+n.clientTop,e.left=e.left+n.clientLeft,e.bottom=e.top+n.clientHeight,e.right=e.left+n.clientWidth,e.width=n.clientWidth,e.height=n.clientHeight,e.x=e.left,e.y=e.top,e}function ep(n,t,e){return t===Xf?Nu(Xy(n,e)):as(t)?Yy(t,e):Nu(jy(Er(n)))}function qy(n){var t=Io(bc(n)),e=["absolute","fixed"].indexOf(Gn(n).position)>=0,i=e&&Yi(n)?nA(n):n;return as(i)?t.filter(function(r){return as(r)&&s0(r,i)&&yn(r)!=="body"}):[]}function $y(n,t,e,i){var r=t==="clippingParents"?qy(n):[].concat(t),a=[].concat(r,[e]),f=a[0],o=a.reduce(function(s,l){var u=ep(n,l,i);return s.top=Jr(u.top,s.top),s.right=Zl(u.right,s.right),s.bottom=Zl(u.bottom,s.bottom),s.left=Jr(u.left,s.left),s},ep(n,f,i));return o.width=o.right-o.left,o.height=o.bottom-o.top,o.x=o.left,o.y=o.top,o}function h0(n){var t=n.reference,e=n.element,i=n.placement,r=i?wn(i):null,a=i?_a(i):null,f=t.x+t.width/2-e.width/2,o=t.y+t.height/2-e.height/2,s;switch(r){case di:s={x:f,y:t.y-e.height};break;case Di:s={x:f,y:t.y+t.height};break;case Pi:s={x:t.x+t.width,y:o};break;case pi:s={x:t.x-e.width,y:o};break;default:s={x:t.x,y:t.y}}var l=r?Jf(r):null;if(l!=null){var u=l==="y"?"height":"width";switch(a){case ss:s[l]=s[l]-(t[u]/2-e[u]/2);break;case ma:s[l]=s[l]+(t[u]/2-e[u]/2);break}}return s}function ya(n,t){t===void 0&&(t={});var e=t,i=e.placement,r=i===void 0?n.placement:i,a=e.strategy,f=a===void 0?n.strategy:a,o=e.boundary,s=o===void 0?Kv:o,l=e.rootBoundary,u=l===void 0?Xf:l,A=e.elementContext,c=A===void 0?$s:A,h=e.altBoundary,p=h===void 0?!1:h,m=e.padding,d=m===void 0?0:m,g=o0(typeof d!="number"?d:A0(d,Pa)),v=c===$s?Xv:$s,w=n.rects.popper,_=n.elements[p?v:c],y=$y(as(_)?_:_.contextElement||Er(n.elements.popper),s,u,f),C=wa(n.elements.reference),b=h0({reference:C,element:w,strategy:"absolute",placement:r}),S=Nu(Object.assign({},w,b)),B=c===$s?S:C,M={top:y.top-B.top+g.top,bottom:B.bottom-y.bottom+g.bottom,left:y.left-B.left+g.left,right:B.right-y.right+g.right},z=n.modifiersData.offset;if(c===$s&&z){var G=z[r];Object.keys(M).forEach(function(P){var R=[Pi,Di].indexOf(P)>=0?1:-1,W=[di,Di].indexOf(P)>=0?"y":"x";M[P]+=G[W]*R})}return M}function Jy(n,t){t===void 0&&(t={});var e=t,i=e.placement,r=e.boundary,a=e.rootBoundary,f=e.padding,o=e.flipVariations,s=e.allowedAutoPlacements,l=s===void 0?jf:s,u=_a(i),A=u?o?Hu:Hu.filter(function(p){return _a(p)===u}):Pa,c=A.filter(function(p){return l.indexOf(p)>=0});c.length===0&&(c=A);var h=c.reduce(function(p,m){return p[m]=ya(n,{placement:m,boundary:r,rootBoundary:a,padding:f})[wn(m)],p},{});return Object.keys(h).sort(function(p,m){return h[p]-h[m]})}function Zy(n){if(wn(n)===Cc)return[];var t=Vl(n);return[tp(n),t,tp(t)]}function tx(n){var t=n.state,e=n.options,i=n.name;if(!t.modifiersData[i]._skip){for(var r=e.mainAxis,a=r===void 0?!0:r,f=e.altAxis,o=f===void 0?!0:f,s=e.fallbackPlacements,l=e.padding,u=e.boundary,A=e.rootBoundary,c=e.altBoundary,h=e.flipVariations,p=h===void 0?!0:h,m=e.allowedAutoPlacements,d=t.options.placement,g=wn(d),v=g===d,w=s||(v||!p?[Vl(d)]:Zy(d)),_=[d].concat(w).reduce(function(U,T){return U.concat(wn(T)===Cc?Jy(t,{placement:T,boundary:u,rootBoundary:A,padding:l,flipVariations:p,allowedAutoPlacements:m}):T)},[]),y=t.rects.reference,C=t.rects.popper,b=new Map,S=!0,B=_[0],M=0;M<_.length;M++){var z=_[M],G=wn(z),P=_a(z)===ss,R=[di,Di].indexOf(G)>=0,W=R?"width":"height",K=ya(t,{placement:z,boundary:u,rootBoundary:A,altBoundary:c,padding:l}),tt=R?P?Pi:pi:P?Di:di;y[W]>C[W]&&(tt=Vl(tt));var j=Vl(tt),E=[];if(a&&E.push(K[G]<=0),o&&E.push(K[tt]<=0,K[j]<=0),E.every(function(U){return U})){B=z,S=!1;break}b.set(z,E)}if(S)for(var I=p?3:1,Q=function(T){var V=_.find(function(O){var et=b.get(O);if(et)return et.slice(0,T).every(function(q){return q})});if(V)return B=V,"break"},D=I;D>0;D--){var k=Q(D);if(k==="break")break}t.placement!==B&&(t.modifiersData[i]._skip=!0,t.placement=B,t.reset=!0)}}const u0={name:"flip",enabled:!0,phase:"main",fn:tx,requiresIfExists:["offset"],data:{_skip:!1}};function ip(n,t,e){return e===void 0&&(e={x:0,y:0}),{top:n.top-t.height-e.y,right:n.right-t.width+e.x,bottom:n.bottom-t.height+e.y,left:n.left-t.width-e.x}}function np(n){return[di,Pi,Di,pi].some(function(t){return n[t]>=0})}function ex(n){var t=n.state,e=n.name,i=t.rects.reference,r=t.rects.popper,a=t.modifiersData.preventOverflow,f=ya(t,{elementContext:"reference"}),o=ya(t,{altBoundary:!0}),s=ip(f,i),l=ip(o,r,a),u=np(s),A=np(l);t.modifiersData[e]={referenceClippingOffsets:s,popperEscapeOffsets:l,isReferenceHidden:u,hasPopperEscaped:A},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":u,"data-popper-escaped":A})}const f0={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:ex};function ix(n,t,e){var i=wn(n),r=[pi,di].indexOf(i)>=0?-1:1,a=typeof e=="function"?e(Object.assign({},t,{placement:n})):e,f=a[0],o=a[1];return f=f||0,o=(o||0)*r,[pi,Pi].indexOf(i)>=0?{x:o,y:f}:{x:f,y:o}}function nx(n){var t=n.state,e=n.options,i=n.name,r=e.offset,a=r===void 0?[0,0]:r,f=jf.reduce(function(u,A){return u[A]=ix(A,t.rects,a),u},{}),o=f[t.placement],s=o.x,l=o.y;t.modifiersData.popperOffsets!=null&&(t.modifiersData.popperOffsets.x+=s,t.modifiersData.popperOffsets.y+=l),t.modifiersData[i]=f}const d0={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:nx};function rx(n){var t=n.state,e=n.name;t.modifiersData[e]=h0({reference:t.rects.reference,element:t.rects.popper,strategy:"absolute",placement:t.placement})}const rd={name:"popperOffsets",enabled:!0,phase:"read",fn:rx,data:{}};function sx(n){return n==="x"?"y":"x"}function ax(n){var t=n.state,e=n.options,i=n.name,r=e.mainAxis,a=r===void 0?!0:r,f=e.altAxis,o=f===void 0?!1:f,s=e.boundary,l=e.rootBoundary,u=e.altBoundary,A=e.padding,c=e.tether,h=c===void 0?!0:c,p=e.tetherOffset,m=p===void 0?0:p,d=ya(t,{boundary:s,rootBoundary:l,padding:A,altBoundary:u}),g=wn(t.placement),v=_a(t.placement),w=!v,_=Jf(g),y=sx(_),C=t.modifiersData.popperOffsets,b=t.rects.reference,S=t.rects.popper,B=typeof m=="function"?m(Object.assign({},t.rects,{placement:t.placement})):m,M=typeof B=="number"?{mainAxis:B,altAxis:B}:Object.assign({mainAxis:0,altAxis:0},B),z=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,G={x:0,y:0};if(C){if(a){var P,R=_==="y"?di:pi,W=_==="y"?Di:Pi,K=_==="y"?"height":"width",tt=C[_],j=tt+d[R],E=tt-d[W],I=h?-S[K]/2:0,Q=v===ss?b[K]:S[K],D=v===ss?-S[K]:-b[K],k=t.elements.arrow,U=h&&k?$f(k):{width:0,height:0},T=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:a0(),V=T[R],O=T[W],et=Lo(0,b[K],U[K]),q=w?b[K]/2-I-et-V-M.mainAxis:Q-et-V-M.mainAxis,J=w?-b[K]/2+I+et+O+M.mainAxis:D+et+O+M.mainAxis,st=t.elements.arrow&&nA(t.elements.arrow),gt=st?_==="y"?st.clientTop||0:st.clientLeft||0:0,Y=(P=z==null?void 0:z[_])!=null?P:0,X=tt+q-Y-gt,ot=tt+J-Y,At=Lo(h?Zl(j,X):j,tt,h?Jr(E,ot):E);C[_]=At,G[_]=At-tt}if(o){var rt,lt=_==="x"?di:pi,mt=_==="x"?Di:Pi,St=C[y],bt=y==="y"?"height":"width",F=St+d[lt],L=St-d[mt],it=[di,pi].indexOf(g)!==-1,ct=(rt=z==null?void 0:z[y])!=null?rt:0,dt=it?F:St-b[bt]-S[bt]-ct+M.altAxis,vt=it?St+b[bt]+S[bt]-ct-M.altAxis:L,Ut=h&&it?Qy(dt,St,vt):Lo(h?dt:F,St,h?vt:L);C[y]=Ut,G[y]=Ut-St}t.modifiersData[i]=G}}const p0={name:"preventOverflow",enabled:!0,phase:"main",fn:ax,requiresIfExists:["offset"]};function ox(n){return{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}}function Ax(n){return n===Oi(n)||!Yi(n)?ed(n):ox(n)}function lx(n){var t=n.getBoundingClientRect(),e=va(t.width)/n.offsetWidth||1,i=va(t.height)/n.offsetHeight||1;return e!==1||i!==1}function cx(n,t,e){e===void 0&&(e=!1);var i=Yi(t),r=Yi(t)&&lx(t),a=Er(t),f=wa(n,r,e),o={scrollLeft:0,scrollTop:0},s={x:0,y:0};return(i||!i&&!e)&&((yn(t)!=="body"||nd(a))&&(o=Ax(t)),Yi(t)?(s=wa(t,!0),s.x+=t.clientLeft,s.y+=t.clientTop):a&&(s.x=id(a))),{x:f.left+o.scrollLeft-s.x,y:f.top+o.scrollTop-s.y,width:f.width,height:f.height}}function hx(n){var t=new Map,e=new Set,i=[];n.forEach(function(a){t.set(a.name,a)});function r(a){e.add(a.name);var f=[].concat(a.requires||[],a.requiresIfExists||[]);f.forEach(function(o){if(!e.has(o)){var s=t.get(o);s&&r(s)}}),i.push(a)}return n.forEach(function(a){e.has(a.name)||r(a)}),i}function ux(n){var t=hx(n);return n0.reduce(function(e,i){return e.concat(t.filter(function(r){return r.phase===i}))},[])}function fx(n){var t;return function(){return t||(t=new Promise(function(e){Promise.resolve().then(function(){t=void 0,e(n())})})),t}}function dx(n){var t=n.reduce(function(e,i){var r=e[i.name];return e[i.name]=r?Object.assign({},r,i,{options:Object.assign({},r.options,i.options),data:Object.assign({},r.data,i.data)}):i,e},{});return Object.keys(t).map(function(e){return t[e]})}var rp={placement:"bottom",modifiers:[],strategy:"absolute"};function sp(){for(var n=arguments.length,t=new Array(n),e=0;e<n;e++)t[e]=arguments[e];return!t.some(function(i){return!(i&&typeof i.getBoundingClientRect=="function")})}function Bc(n){n===void 0&&(n={});var t=n,e=t.defaultModifiers,i=e===void 0?[]:e,r=t.defaultOptions,a=r===void 0?rp:r;return function(o,s,l){l===void 0&&(l=a);var u={placement:"bottom",orderedModifiers:[],options:Object.assign({},rp,a),modifiersData:{},elements:{reference:o,popper:s},attributes:{},styles:{}},A=[],c=!1,h={state:u,setOptions:function(g){var v=typeof g=="function"?g(u.options):g;m(),u.options=Object.assign({},a,u.options,v),u.scrollParents={reference:as(o)?Io(o):o.contextElement?Io(o.contextElement):[],popper:Io(s)};var w=ux(dx([].concat(i,u.options.modifiers)));return u.orderedModifiers=w.filter(function(_){return _.enabled}),p(),h.update()},forceUpdate:function(){if(!c){var g=u.elements,v=g.reference,w=g.popper;if(sp(v,w)){u.rects={reference:cx(v,nA(w),u.options.strategy==="fixed"),popper:$f(w)},u.reset=!1,u.placement=u.options.placement,u.orderedModifiers.forEach(function(M){return u.modifiersData[M.name]=Object.assign({},M.data)});for(var _=0;_<u.orderedModifiers.length;_++){if(u.reset===!0){u.reset=!1,_=-1;continue}var y=u.orderedModifiers[_],C=y.fn,b=y.options,S=b===void 0?{}:b,B=y.name;typeof C=="function"&&(u=C({state:u,options:S,name:B,instance:h})||u)}}}},update:fx(function(){return new Promise(function(d){h.forceUpdate(),d(u)})}),destroy:function(){m(),c=!0}};if(!sp(o,s))return h;h.setOptions(l).then(function(d){!c&&l.onFirstUpdate&&l.onFirstUpdate(d)});function p(){u.orderedModifiers.forEach(function(d){var g=d.name,v=d.options,w=v===void 0?{}:v,_=d.effect;if(typeof _=="function"){var y=_({state:u,name:g,instance:h,options:w}),C=function(){};A.push(y||C)}})}function m(){A.forEach(function(d){return d()}),A=[]}return h}}var px=Bc(),gx=[td,rd,Zf,qf],mx=Bc({defaultModifiers:gx}),vx=[td,rd,Zf,qf,d0,u0,p0,l0,f0],sd=Bc({defaultModifiers:vx});const g0=Object.freeze(Object.defineProperty({__proto__:null,afterMain:Zv,afterRead:qv,afterWrite:i0,applyStyles:qf,arrow:l0,auto:Cc,basePlacements:Pa,beforeMain:$v,beforeRead:jv,beforeWrite:t0,bottom:Di,clippingParents:Kv,computeStyles:Zf,createPopper:sd,createPopperBase:px,createPopperLite:mx,detectOverflow:ya,end:ma,eventListeners:td,flip:u0,hide:f0,left:pi,main:Jv,modifierPhases:n0,offset:d0,placements:jf,popper:$s,popperGenerator:Bc,popperOffsets:rd,preventOverflow:p0,read:Yv,reference:Xv,right:Pi,start:ss,top:di,variationPlacements:Hu,viewport:Xf,write:e0},Symbol.toStringTag,{value:"Module"}));/*!
  * Bootstrap v5.3.0 (https://getbootstrap.com/)
  * Copyright 2011-2023 The Bootstrap Authors (https://github.com/twbs/bootstrap/graphs/contributors)
  * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)
  */const $n=new Map,ah={set(n,t,e){$n.has(n)||$n.set(n,new Map);const i=$n.get(n);if(!i.has(t)&&i.size!==0){console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(i.keys())[0]}.`);return}i.set(t,e)},get(n,t){return $n.has(n)&&$n.get(n).get(t)||null},remove(n,t){if(!$n.has(n))return;const e=$n.get(n);e.delete(t),e.size===0&&$n.delete(n)}},wx=1e6,_x=1e3,Vu="transitionend",m0=n=>(n&&window.CSS&&window.CSS.escape&&(n=n.replace(/#([^\s"#']+)/g,(t,e)=>`#${CSS.escape(e)}`)),n),yx=n=>n==null?`${n}`:Object.prototype.toString.call(n).match(/\s([a-z]+)/i)[1].toLowerCase(),xx=n=>{do n+=Math.floor(Math.random()*wx);while(document.getElementById(n));return n},Cx=n=>{if(!n)return 0;let{transitionDuration:t,transitionDelay:e}=window.getComputedStyle(n);const i=Number.parseFloat(t),r=Number.parseFloat(e);return!i&&!r?0:(t=t.split(",")[0],e=e.split(",")[0],(Number.parseFloat(t)+Number.parseFloat(e))*_x)},v0=n=>{n.dispatchEvent(new Event(Vu))},kn=n=>!n||typeof n!="object"?!1:(typeof n.jquery<"u"&&(n=n[0]),typeof n.nodeType<"u"),wr=n=>kn(n)?n.jquery?n[0]:n:typeof n=="string"&&n.length>0?document.querySelector(m0(n)):null,Oa=n=>{if(!kn(n)||n.getClientRects().length===0)return!1;const t=getComputedStyle(n).getPropertyValue("visibility")==="visible",e=n.closest("details:not([open])");if(!e)return t;if(e!==n){const i=n.closest("summary");if(i&&i.parentNode!==e||i===null)return!1}return t},_r=n=>!n||n.nodeType!==Node.ELEMENT_NODE||n.classList.contains("disabled")?!0:typeof n.disabled<"u"?n.disabled:n.hasAttribute("disabled")&&n.getAttribute("disabled")!=="false",w0=n=>{if(!document.documentElement.attachShadow)return null;if(typeof n.getRootNode=="function"){const t=n.getRootNode();return t instanceof ShadowRoot?t:null}return n instanceof ShadowRoot?n:n.parentNode?w0(n.parentNode):null},tc=()=>{},rA=n=>{n.offsetHeight},_0=()=>window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery")?window.jQuery:null,oh=[],bx=n=>{document.readyState==="loading"?(oh.length||document.addEventListener("DOMContentLoaded",()=>{for(const t of oh)t()}),oh.push(n)):n()},qi=()=>document.documentElement.dir==="rtl",Ji=n=>{bx(()=>{const t=_0();if(t){const e=n.NAME,i=t.fn[e];t.fn[e]=n.jQueryInterface,t.fn[e].Constructor=n,t.fn[e].noConflict=()=>(t.fn[e]=i,n.jQueryInterface)}})},wi=(n,t=[],e=n)=>typeof n=="function"?n(...t):e,y0=(n,t,e=!0)=>{if(!e){wi(n);return}const i=5,r=Cx(t)+i;let a=!1;const f=({target:o})=>{o===t&&(a=!0,t.removeEventListener(Vu,f),wi(n))};t.addEventListener(Vu,f),setTimeout(()=>{a||v0(t)},r)},ad=(n,t,e,i)=>{const r=n.length;let a=n.indexOf(t);return a===-1?!e&&i?n[r-1]:n[0]:(a+=e?1:-1,i&&(a=(a+r)%r),n[Math.max(0,Math.min(a,r-1))])},Bx=/[^.]*(?=\..*)\.|.*/,Sx=/\..*/,Ex=/::\d+$/,Ah={};let ap=1;const x0={mouseenter:"mouseover",mouseleave:"mouseout"},Mx=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function C0(n,t){return t&&`${t}::${ap++}`||n.uidEvent||ap++}function b0(n){const t=C0(n);return n.uidEvent=t,Ah[t]=Ah[t]||{},Ah[t]}function Tx(n,t){return function e(i){return od(i,{delegateTarget:n}),e.oneOff&&wt.off(n,i.type,t),t.apply(n,[i])}}function Fx(n,t,e){return function i(r){const a=n.querySelectorAll(t);for(let{target:f}=r;f&&f!==this;f=f.parentNode)for(const o of a)if(o===f)return od(r,{delegateTarget:f}),i.oneOff&&wt.off(n,r.type,t,e),e.apply(f,[r])}}function B0(n,t,e=null){return Object.values(n).find(i=>i.callable===t&&i.delegationSelector===e)}function S0(n,t,e){const i=typeof t=="string",r=i?e:t||e;let a=E0(n);return Mx.has(a)||(a=n),[i,r,a]}function op(n,t,e,i,r){if(typeof t!="string"||!n)return;let[a,f,o]=S0(t,e,i);t in x0&&(f=(p=>function(m){if(!m.relatedTarget||m.relatedTarget!==m.delegateTarget&&!m.delegateTarget.contains(m.relatedTarget))return p.call(this,m)})(f));const s=b0(n),l=s[o]||(s[o]={}),u=B0(l,f,a?e:null);if(u){u.oneOff=u.oneOff&&r;return}const A=C0(f,t.replace(Bx,"")),c=a?Fx(n,e,f):Tx(n,f);c.delegationSelector=a?e:null,c.callable=f,c.oneOff=r,c.uidEvent=A,l[A]=c,n.addEventListener(o,c,a)}function zu(n,t,e,i,r){const a=B0(t[e],i,r);a&&(n.removeEventListener(e,a,!!r),delete t[e][a.uidEvent])}function Ux(n,t,e,i){const r=t[e]||{};for(const[a,f]of Object.entries(r))a.includes(i)&&zu(n,t,e,f.callable,f.delegationSelector)}function E0(n){return n=n.replace(Sx,""),x0[n]||n}const wt={on(n,t,e,i){op(n,t,e,i,!1)},one(n,t,e,i){op(n,t,e,i,!0)},off(n,t,e,i){if(typeof t!="string"||!n)return;const[r,a,f]=S0(t,e,i),o=f!==t,s=b0(n),l=s[f]||{},u=t.startsWith(".");if(typeof a<"u"){if(!Object.keys(l).length)return;zu(n,s,f,a,r?e:null);return}if(u)for(const A of Object.keys(s))Ux(n,s,A,t.slice(1));for(const[A,c]of Object.entries(l)){const h=A.replace(Ex,"");(!o||t.includes(h))&&zu(n,s,f,c.callable,c.delegationSelector)}},trigger(n,t,e){if(typeof t!="string"||!n)return null;const i=_0(),r=E0(t),a=t!==r;let f=null,o=!0,s=!0,l=!1;a&&i&&(f=i.Event(t,e),i(n).trigger(f),o=!f.isPropagationStopped(),s=!f.isImmediatePropagationStopped(),l=f.isDefaultPrevented());const u=od(new Event(t,{bubbles:o,cancelable:!0}),e);return l&&u.preventDefault(),s&&n.dispatchEvent(u),u.defaultPrevented&&f&&f.preventDefault(),u}};function od(n,t={}){for(const[e,i]of Object.entries(t))try{n[e]=i}catch{Object.defineProperty(n,e,{configurable:!0,get(){return i}})}return n}function Ap(n){if(n==="true")return!0;if(n==="false")return!1;if(n===Number(n).toString())return Number(n);if(n===""||n==="null")return null;if(typeof n!="string")return n;try{return JSON.parse(decodeURIComponent(n))}catch{return n}}function lh(n){return n.replace(/[A-Z]/g,t=>`-${t.toLowerCase()}`)}const Nn={setDataAttribute(n,t,e){n.setAttribute(`data-bs-${lh(t)}`,e)},removeDataAttribute(n,t){n.removeAttribute(`data-bs-${lh(t)}`)},getDataAttributes(n){if(!n)return{};const t={},e=Object.keys(n.dataset).filter(i=>i.startsWith("bs")&&!i.startsWith("bsConfig"));for(const i of e){let r=i.replace(/^bs/,"");r=r.charAt(0).toLowerCase()+r.slice(1,r.length),t[r]=Ap(n.dataset[i])}return t},getDataAttribute(n,t){return Ap(n.getAttribute(`data-bs-${lh(t)}`))}};class sA{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}_getConfig(t){return t=this._mergeConfigObj(t),t=this._configAfterMerge(t),this._typeCheckConfig(t),t}_configAfterMerge(t){return t}_mergeConfigObj(t,e){const i=kn(e)?Nn.getDataAttribute(e,"config"):{};return{...this.constructor.Default,...typeof i=="object"?i:{},...kn(e)?Nn.getDataAttributes(e):{},...typeof t=="object"?t:{}}}_typeCheckConfig(t,e=this.constructor.DefaultType){for(const[i,r]of Object.entries(e)){const a=t[i],f=kn(a)?"element":yx(a);if(!new RegExp(r).test(f))throw new TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${i}" provided type "${f}" but expected type "${r}".`)}}}const Lx="5.3.0";class ln extends sA{constructor(t,e){super(),t=wr(t),t&&(this._element=t,this._config=this._getConfig(e),ah.set(this._element,this.constructor.DATA_KEY,this))}dispose(){ah.remove(this._element,this.constructor.DATA_KEY),wt.off(this._element,this.constructor.EVENT_KEY);for(const t of Object.getOwnPropertyNames(this))this[t]=null}_queueCallback(t,e,i=!0){y0(t,e,i)}_getConfig(t){return t=this._mergeConfigObj(t,this._element),t=this._configAfterMerge(t),this._typeCheckConfig(t),t}static getInstance(t){return ah.get(wr(t),this.DATA_KEY)}static getOrCreateInstance(t,e={}){return this.getInstance(t)||new this(t,typeof e=="object"?e:null)}static get VERSION(){return Lx}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}static eventName(t){return`${t}${this.EVENT_KEY}`}}const ch=n=>{let t=n.getAttribute("data-bs-target");if(!t||t==="#"){let e=n.getAttribute("href");if(!e||!e.includes("#")&&!e.startsWith("."))return null;e.includes("#")&&!e.startsWith("#")&&(e=`#${e.split("#")[1]}`),t=e&&e!=="#"?e.trim():null}return m0(t)},Qt={find(n,t=document.documentElement){return[].concat(...Element.prototype.querySelectorAll.call(t,n))},findOne(n,t=document.documentElement){return Element.prototype.querySelector.call(t,n)},children(n,t){return[].concat(...n.children).filter(e=>e.matches(t))},parents(n,t){const e=[];let i=n.parentNode.closest(t);for(;i;)e.push(i),i=i.parentNode.closest(t);return e},prev(n,t){let e=n.previousElementSibling;for(;e;){if(e.matches(t))return[e];e=e.previousElementSibling}return[]},next(n,t){let e=n.nextElementSibling;for(;e;){if(e.matches(t))return[e];e=e.nextElementSibling}return[]},focusableChildren(n){const t=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map(e=>`${e}:not([tabindex^="-"])`).join(",");return this.find(t,n).filter(e=>!_r(e)&&Oa(e))},getSelectorFromElement(n){const t=ch(n);return t&&Qt.findOne(t)?t:null},getElementFromSelector(n){const t=ch(n);return t?Qt.findOne(t):null},getMultipleElementsFromSelector(n){const t=ch(n);return t?Qt.find(t):[]}},Sc=(n,t="hide")=>{const e=`click.dismiss${n.EVENT_KEY}`,i=n.NAME;wt.on(document,e,`[data-bs-dismiss="${i}"]`,function(r){if(["A","AREA"].includes(this.tagName)&&r.preventDefault(),_r(this))return;const a=Qt.getElementFromSelector(this)||this.closest(`.${i}`);n.getOrCreateInstance(a)[t]()})},Ix="alert",Dx="bs.alert",M0=`.${Dx}`,Px=`close${M0}`,Ox=`closed${M0}`,Qx="fade",Rx="show";class Ec extends ln{static get NAME(){return Ix}close(){if(wt.trigger(this._element,Px).defaultPrevented)return;this._element.classList.remove(Rx);const e=this._element.classList.contains(Qx);this._queueCallback(()=>this._destroyElement(),this._element,e)}_destroyElement(){this._element.remove(),wt.trigger(this._element,Ox),this.dispose()}static jQueryInterface(t){return this.each(function(){const e=Ec.getOrCreateInstance(this);if(typeof t=="string"){if(e[t]===void 0||t.startsWith("_")||t==="constructor")throw new TypeError(`No method named "${t}"`);e[t](this)}})}}Sc(Ec,"close");Ji(Ec);const Hx="button",kx="bs.button",Nx=`.${kx}`,Vx=".data-api",zx="active",lp='[data-bs-toggle="button"]',Gx=`click${Nx}${Vx}`;class Mc extends ln{static get NAME(){return Hx}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle(zx))}static jQueryInterface(t){return this.each(function(){const e=Mc.getOrCreateInstance(this);t==="toggle"&&e[t]()})}}wt.on(document,Gx,lp,n=>{n.preventDefault();const t=n.target.closest(lp);Mc.getOrCreateInstance(t).toggle()});Ji(Mc);const Wx="swipe",Qa=".bs.swipe",Kx=`touchstart${Qa}`,Xx=`touchmove${Qa}`,jx=`touchend${Qa}`,Yx=`pointerdown${Qa}`,qx=`pointerup${Qa}`,$x="touch",Jx="pen",Zx="pointer-event",tC=40,eC={endCallback:null,leftCallback:null,rightCallback:null},iC={endCallback:"(function|null)",leftCallback:"(function|null)",rightCallback:"(function|null)"};class ec extends sA{constructor(t,e){super(),this._element=t,!(!t||!ec.isSupported())&&(this._config=this._getConfig(e),this._deltaX=0,this._supportPointerEvents=!!window.PointerEvent,this._initEvents())}static get Default(){return eC}static get DefaultType(){return iC}static get NAME(){return Wx}dispose(){wt.off(this._element,Qa)}_start(t){if(!this._supportPointerEvents){this._deltaX=t.touches[0].clientX;return}this._eventIsPointerPenTouch(t)&&(this._deltaX=t.clientX)}_end(t){this._eventIsPointerPenTouch(t)&&(this._deltaX=t.clientX-this._deltaX),this._handleSwipe(),wi(this._config.endCallback)}_move(t){this._deltaX=t.touches&&t.touches.length>1?0:t.touches[0].clientX-this._deltaX}_handleSwipe(){const t=Math.abs(this._deltaX);if(t<=tC)return;const e=t/this._deltaX;this._deltaX=0,e&&wi(e>0?this._config.rightCallback:this._config.leftCallback)}_initEvents(){this._supportPointerEvents?(wt.on(this._element,Yx,t=>this._start(t)),wt.on(this._element,qx,t=>this._end(t)),this._element.classList.add(Zx)):(wt.on(this._element,Kx,t=>this._start(t)),wt.on(this._element,Xx,t=>this._move(t)),wt.on(this._element,jx,t=>this._end(t)))}_eventIsPointerPenTouch(t){return this._supportPointerEvents&&(t.pointerType===Jx||t.pointerType===$x)}static isSupported(){return"ontouchstart"in document.documentElement||navigator.maxTouchPoints>0}}const nC="carousel",rC="bs.carousel",Mr=`.${rC}`,T0=".data-api",sC="ArrowLeft",aC="ArrowRight",oC=500,ja="next",ms="prev",Js="left",zl="right",AC=`slide${Mr}`,hh=`slid${Mr}`,lC=`keydown${Mr}`,cC=`mouseenter${Mr}`,hC=`mouseleave${Mr}`,uC=`dragstart${Mr}`,fC=`load${Mr}${T0}`,dC=`click${Mr}${T0}`,F0="carousel",bA="active",pC="slide",gC="carousel-item-end",mC="carousel-item-start",vC="carousel-item-next",wC="carousel-item-prev",U0=".active",L0=".carousel-item",_C=U0+L0,yC=".carousel-item img",xC=".carousel-indicators",CC="[data-bs-slide], [data-bs-slide-to]",bC='[data-bs-ride="carousel"]',BC={[sC]:zl,[aC]:Js},SC={interval:5e3,keyboard:!0,pause:"hover",ride:!1,touch:!0,wrap:!0},EC={interval:"(number|boolean)",keyboard:"boolean",pause:"(string|boolean)",ride:"(boolean|string)",touch:"boolean",wrap:"boolean"};class aA extends ln{constructor(t,e){super(t,e),this._interval=null,this._activeElement=null,this._isSliding=!1,this.touchTimeout=null,this._swipeHelper=null,this._indicatorsElement=Qt.findOne(xC,this._element),this._addEventListeners(),this._config.ride===F0&&this.cycle()}static get Default(){return SC}static get DefaultType(){return EC}static get NAME(){return nC}next(){this._slide(ja)}nextWhenVisible(){!document.hidden&&Oa(this._element)&&this.next()}prev(){this._slide(ms)}pause(){this._isSliding&&v0(this._element),this._clearInterval()}cycle(){this._clearInterval(),this._updateInterval(),this._interval=setInterval(()=>this.nextWhenVisible(),this._config.interval)}_maybeEnableCycle(){if(this._config.ride){if(this._isSliding){wt.one(this._element,hh,()=>this.cycle());return}this.cycle()}}to(t){const e=this._getItems();if(t>e.length-1||t<0)return;if(this._isSliding){wt.one(this._element,hh,()=>this.to(t));return}const i=this._getItemIndex(this._getActive());if(i===t)return;const r=t>i?ja:ms;this._slide(r,e[t])}dispose(){this._swipeHelper&&this._swipeHelper.dispose(),super.dispose()}_configAfterMerge(t){return t.defaultInterval=t.interval,t}_addEventListeners(){this._config.keyboard&&wt.on(this._element,lC,t=>this._keydown(t)),this._config.pause==="hover"&&(wt.on(this._element,cC,()=>this.pause()),wt.on(this._element,hC,()=>this._maybeEnableCycle())),this._config.touch&&ec.isSupported()&&this._addTouchEventListeners()}_addTouchEventListeners(){for(const i of Qt.find(yC,this._element))wt.on(i,uC,r=>r.preventDefault());const e={leftCallback:()=>this._slide(this._directionToOrder(Js)),rightCallback:()=>this._slide(this._directionToOrder(zl)),endCallback:()=>{this._config.pause==="hover"&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout(()=>this._maybeEnableCycle(),oC+this._config.interval))}};this._swipeHelper=new ec(this._element,e)}_keydown(t){if(/input|textarea/i.test(t.target.tagName))return;const e=BC[t.key];e&&(t.preventDefault(),this._slide(this._directionToOrder(e)))}_getItemIndex(t){return this._getItems().indexOf(t)}_setActiveIndicatorElement(t){if(!this._indicatorsElement)return;const e=Qt.findOne(U0,this._indicatorsElement);e.classList.remove(bA),e.removeAttribute("aria-current");const i=Qt.findOne(`[data-bs-slide-to="${t}"]`,this._indicatorsElement);i&&(i.classList.add(bA),i.setAttribute("aria-current","true"))}_updateInterval(){const t=this._activeElement||this._getActive();if(!t)return;const e=Number.parseInt(t.getAttribute("data-bs-interval"),10);this._config.interval=e||this._config.defaultInterval}_slide(t,e=null){if(this._isSliding)return;const i=this._getActive(),r=t===ja,a=e||ad(this._getItems(),i,r,this._config.wrap);if(a===i)return;const f=this._getItemIndex(a),o=h=>wt.trigger(this._element,h,{relatedTarget:a,direction:this._orderToDirection(t),from:this._getItemIndex(i),to:f});if(o(AC).defaultPrevented||!i||!a)return;const l=!!this._interval;this.pause(),this._isSliding=!0,this._setActiveIndicatorElement(f),this._activeElement=a;const u=r?mC:gC,A=r?vC:wC;a.classList.add(A),rA(a),i.classList.add(u),a.classList.add(u);const c=()=>{a.classList.remove(u,A),a.classList.add(bA),i.classList.remove(bA,A,u),this._isSliding=!1,o(hh)};this._queueCallback(c,i,this._isAnimated()),l&&this.cycle()}_isAnimated(){return this._element.classList.contains(pC)}_getActive(){return Qt.findOne(_C,this._element)}_getItems(){return Qt.find(L0,this._element)}_clearInterval(){this._interval&&(clearInterval(this._interval),this._interval=null)}_directionToOrder(t){return qi()?t===Js?ms:ja:t===Js?ja:ms}_orderToDirection(t){return qi()?t===ms?Js:zl:t===ms?zl:Js}static jQueryInterface(t){return this.each(function(){const e=aA.getOrCreateInstance(this,t);if(typeof t=="number"){e.to(t);return}if(typeof t=="string"){if(e[t]===void 0||t.startsWith("_")||t==="constructor")throw new TypeError(`No method named "${t}"`);e[t]()}})}}wt.on(document,dC,CC,function(n){const t=Qt.getElementFromSelector(this);if(!t||!t.classList.contains(F0))return;n.preventDefault();const e=aA.getOrCreateInstance(t),i=this.getAttribute("data-bs-slide-to");if(i){e.to(i),e._maybeEnableCycle();return}if(Nn.getDataAttribute(this,"slide")==="next"){e.next(),e._maybeEnableCycle();return}e.prev(),e._maybeEnableCycle()});wt.on(window,fC,()=>{const n=Qt.find(bC);for(const t of n)aA.getOrCreateInstance(t)});Ji(aA);const MC="collapse",TC="bs.collapse",oA=`.${TC}`,FC=".data-api",UC=`show${oA}`,LC=`shown${oA}`,IC=`hide${oA}`,DC=`hidden${oA}`,PC=`click${oA}${FC}`,uh="show",na="collapse",BA="collapsing",OC="collapsed",QC=`:scope .${na} .${na}`,RC="collapse-horizontal",HC="width",kC="height",NC=".collapse.show, .collapse.collapsing",Gu='[data-bs-toggle="collapse"]',VC={parent:null,toggle:!0},zC={parent:"(null|element)",toggle:"boolean"};class No extends ln{constructor(t,e){super(t,e),this._isTransitioning=!1,this._triggerArray=[];const i=Qt.find(Gu);for(const r of i){const a=Qt.getSelectorFromElement(r),f=Qt.find(a).filter(o=>o===this._element);a!==null&&f.length&&this._triggerArray.push(r)}this._initializeChildren(),this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown()),this._config.toggle&&this.toggle()}static get Default(){return VC}static get DefaultType(){return zC}static get NAME(){return MC}toggle(){this._isShown()?this.hide():this.show()}show(){if(this._isTransitioning||this._isShown())return;let t=[];if(this._config.parent&&(t=this._getFirstLevelChildren(NC).filter(o=>o!==this._element).map(o=>No.getOrCreateInstance(o,{toggle:!1}))),t.length&&t[0]._isTransitioning||wt.trigger(this._element,UC).defaultPrevented)return;for(const o of t)o.hide();const i=this._getDimension();this._element.classList.remove(na),this._element.classList.add(BA),this._element.style[i]=0,this._addAriaAndCollapsedClass(this._triggerArray,!0),this._isTransitioning=!0;const r=()=>{this._isTransitioning=!1,this._element.classList.remove(BA),this._element.classList.add(na,uh),this._element.style[i]="",wt.trigger(this._element,LC)},f=`scroll${i[0].toUpperCase()+i.slice(1)}`;this._queueCallback(r,this._element,!0),this._element.style[i]=`${this._element[f]}px`}hide(){if(this._isTransitioning||!this._isShown()||wt.trigger(this._element,IC).defaultPrevented)return;const e=this._getDimension();this._element.style[e]=`${this._element.getBoundingClientRect()[e]}px`,rA(this._element),this._element.classList.add(BA),this._element.classList.remove(na,uh);for(const r of this._triggerArray){const a=Qt.getElementFromSelector(r);a&&!this._isShown(a)&&this._addAriaAndCollapsedClass([r],!1)}this._isTransitioning=!0;const i=()=>{this._isTransitioning=!1,this._element.classList.remove(BA),this._element.classList.add(na),wt.trigger(this._element,DC)};this._element.style[e]="",this._queueCallback(i,this._element,!0)}_isShown(t=this._element){return t.classList.contains(uh)}_configAfterMerge(t){return t.toggle=!!t.toggle,t.parent=wr(t.parent),t}_getDimension(){return this._element.classList.contains(RC)?HC:kC}_initializeChildren(){if(!this._config.parent)return;const t=this._getFirstLevelChildren(Gu);for(const e of t){const i=Qt.getElementFromSelector(e);i&&this._addAriaAndCollapsedClass([e],this._isShown(i))}}_getFirstLevelChildren(t){const e=Qt.find(QC,this._config.parent);return Qt.find(t,this._config.parent).filter(i=>!e.includes(i))}_addAriaAndCollapsedClass(t,e){if(t.length)for(const i of t)i.classList.toggle(OC,!e),i.setAttribute("aria-expanded",e)}static jQueryInterface(t){const e={};return typeof t=="string"&&/show|hide/.test(t)&&(e.toggle=!1),this.each(function(){const i=No.getOrCreateInstance(this,e);if(typeof t=="string"){if(typeof i[t]>"u")throw new TypeError(`No method named "${t}"`);i[t]()}})}}wt.on(document,PC,Gu,function(n){(n.target.tagName==="A"||n.delegateTarget&&n.delegateTarget.tagName==="A")&&n.preventDefault();for(const t of Qt.getMultipleElementsFromSelector(this))No.getOrCreateInstance(t,{toggle:!1}).toggle()});Ji(No);const cp="dropdown",GC="bs.dropdown",ds=`.${GC}`,Ad=".data-api",WC="Escape",hp="Tab",KC="ArrowUp",up="ArrowDown",XC=2,jC=`hide${ds}`,YC=`hidden${ds}`,qC=`show${ds}`,$C=`shown${ds}`,I0=`click${ds}${Ad}`,D0=`keydown${ds}${Ad}`,JC=`keyup${ds}${Ad}`,Zs="show",ZC="dropup",tb="dropend",eb="dropstart",ib="dropup-center",nb="dropdown-center",jr='[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',rb=`${jr}.${Zs}`,Gl=".dropdown-menu",sb=".navbar",ab=".navbar-nav",ob=".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",Ab=qi()?"top-end":"top-start",lb=qi()?"top-start":"top-end",cb=qi()?"bottom-end":"bottom-start",hb=qi()?"bottom-start":"bottom-end",ub=qi()?"left-start":"right-start",fb=qi()?"right-start":"left-start",db="top",pb="bottom",gb={autoClose:!0,boundary:"clippingParents",display:"dynamic",offset:[0,2],popperConfig:null,reference:"toggle"},mb={autoClose:"(boolean|string)",boundary:"(string|element)",display:"string",offset:"(array|string|function)",popperConfig:"(null|object|function)",reference:"(string|element|object)"};class _n extends ln{constructor(t,e){super(t,e),this._popper=null,this._parent=this._element.parentNode,this._menu=Qt.next(this._element,Gl)[0]||Qt.prev(this._element,Gl)[0]||Qt.findOne(Gl,this._parent),this._inNavbar=this._detectNavbar()}static get Default(){return gb}static get DefaultType(){return mb}static get NAME(){return cp}toggle(){return this._isShown()?this.hide():this.show()}show(){if(_r(this._element)||this._isShown())return;const t={relatedTarget:this._element};if(!wt.trigger(this._element,qC,t).defaultPrevented){if(this._createPopper(),"ontouchstart"in document.documentElement&&!this._parent.closest(ab))for(const i of[].concat(...document.body.children))wt.on(i,"mouseover",tc);this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add(Zs),this._element.classList.add(Zs),wt.trigger(this._element,$C,t)}}hide(){if(_r(this._element)||!this._isShown())return;const t={relatedTarget:this._element};this._completeHide(t)}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_completeHide(t){if(!wt.trigger(this._element,jC,t).defaultPrevented){if("ontouchstart"in document.documentElement)for(const i of[].concat(...document.body.children))wt.off(i,"mouseover",tc);this._popper&&this._popper.destroy(),this._menu.classList.remove(Zs),this._element.classList.remove(Zs),this._element.setAttribute("aria-expanded","false"),Nn.removeDataAttribute(this._menu,"popper"),wt.trigger(this._element,YC,t)}}_getConfig(t){if(t=super._getConfig(t),typeof t.reference=="object"&&!kn(t.reference)&&typeof t.reference.getBoundingClientRect!="function")throw new TypeError(`${cp.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);return t}_createPopper(){if(typeof g0>"u")throw new TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org)");let t=this._element;this._config.reference==="parent"?t=this._parent:kn(this._config.reference)?t=wr(this._config.reference):typeof this._config.reference=="object"&&(t=this._config.reference);const e=this._getPopperConfig();this._popper=sd(t,this._menu,e)}_isShown(){return this._menu.classList.contains(Zs)}_getPlacement(){const t=this._parent;if(t.classList.contains(tb))return ub;if(t.classList.contains(eb))return fb;if(t.classList.contains(ib))return db;if(t.classList.contains(nb))return pb;const e=getComputedStyle(this._menu).getPropertyValue("--bs-position").trim()==="end";return t.classList.contains(ZC)?e?lb:Ab:e?hb:cb}_detectNavbar(){return this._element.closest(sb)!==null}_getOffset(){const{offset:t}=this._config;return typeof t=="string"?t.split(",").map(e=>Number.parseInt(e,10)):typeof t=="function"?e=>t(e,this._element):t}_getPopperConfig(){const t={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return(this._inNavbar||this._config.display==="static")&&(Nn.setDataAttribute(this._menu,"popper","static"),t.modifiers=[{name:"applyStyles",enabled:!1}]),{...t,...wi(this._config.popperConfig,[t])}}_selectMenuItem({key:t,target:e}){const i=Qt.find(ob,this._menu).filter(r=>Oa(r));i.length&&ad(i,e,t===up,!i.includes(e)).focus()}static jQueryInterface(t){return this.each(function(){const e=_n.getOrCreateInstance(this,t);if(typeof t=="string"){if(typeof e[t]>"u")throw new TypeError(`No method named "${t}"`);e[t]()}})}static clearMenus(t){if(t.button===XC||t.type==="keyup"&&t.key!==hp)return;const e=Qt.find(rb);for(const i of e){const r=_n.getInstance(i);if(!r||r._config.autoClose===!1)continue;const a=t.composedPath(),f=a.includes(r._menu);if(a.includes(r._element)||r._config.autoClose==="inside"&&!f||r._config.autoClose==="outside"&&f||r._menu.contains(t.target)&&(t.type==="keyup"&&t.key===hp||/input|select|option|textarea|form/i.test(t.target.tagName)))continue;const o={relatedTarget:r._element};t.type==="click"&&(o.clickEvent=t),r._completeHide(o)}}static dataApiKeydownHandler(t){const e=/input|textarea/i.test(t.target.tagName),i=t.key===WC,r=[KC,up].includes(t.key);if(!r&&!i||e&&!i)return;t.preventDefault();const a=this.matches(jr)?this:Qt.prev(this,jr)[0]||Qt.next(this,jr)[0]||Qt.findOne(jr,t.delegateTarget.parentNode),f=_n.getOrCreateInstance(a);if(r){t.stopPropagation(),f.show(),f._selectMenuItem(t);return}f._isShown()&&(t.stopPropagation(),f.hide(),a.focus())}}wt.on(document,D0,jr,_n.dataApiKeydownHandler);wt.on(document,D0,Gl,_n.dataApiKeydownHandler);wt.on(document,I0,_n.clearMenus);wt.on(document,JC,_n.clearMenus);wt.on(document,I0,jr,function(n){n.preventDefault(),_n.getOrCreateInstance(this).toggle()});Ji(_n);const P0="backdrop",vb="fade",fp="show",dp=`mousedown.bs.${P0}`,wb={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},_b={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"};class O0 extends sA{constructor(t){super(),this._config=this._getConfig(t),this._isAppended=!1,this._element=null}static get Default(){return wb}static get DefaultType(){return _b}static get NAME(){return P0}show(t){if(!this._config.isVisible){wi(t);return}this._append();const e=this._getElement();this._config.isAnimated&&rA(e),e.classList.add(fp),this._emulateAnimation(()=>{wi(t)})}hide(t){if(!this._config.isVisible){wi(t);return}this._getElement().classList.remove(fp),this._emulateAnimation(()=>{this.dispose(),wi(t)})}dispose(){this._isAppended&&(wt.off(this._element,dp),this._element.remove(),this._isAppended=!1)}_getElement(){if(!this._element){const t=document.createElement("div");t.className=this._config.className,this._config.isAnimated&&t.classList.add(vb),this._element=t}return this._element}_configAfterMerge(t){return t.rootElement=wr(t.rootElement),t}_append(){if(this._isAppended)return;const t=this._getElement();this._config.rootElement.append(t),wt.on(t,dp,()=>{wi(this._config.clickCallback)}),this._isAppended=!0}_emulateAnimation(t){y0(t,this._getElement(),this._config.isAnimated)}}const yb="focustrap",xb="bs.focustrap",ic=`.${xb}`,Cb=`focusin${ic}`,bb=`keydown.tab${ic}`,Bb="Tab",Sb="forward",pp="backward",Eb={autofocus:!0,trapElement:null},Mb={autofocus:"boolean",trapElement:"element"};class Q0 extends sA{constructor(t){super(),this._config=this._getConfig(t),this._isActive=!1,this._lastTabNavDirection=null}static get Default(){return Eb}static get DefaultType(){return Mb}static get NAME(){return yb}activate(){this._isActive||(this._config.autofocus&&this._config.trapElement.focus(),wt.off(document,ic),wt.on(document,Cb,t=>this._handleFocusin(t)),wt.on(document,bb,t=>this._handleKeydown(t)),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,wt.off(document,ic))}_handleFocusin(t){const{trapElement:e}=this._config;if(t.target===document||t.target===e||e.contains(t.target))return;const i=Qt.focusableChildren(e);i.length===0?e.focus():this._lastTabNavDirection===pp?i[i.length-1].focus():i[0].focus()}_handleKeydown(t){t.key===Bb&&(this._lastTabNavDirection=t.shiftKey?pp:Sb)}}const gp=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",mp=".sticky-top",SA="padding-right",vp="margin-right";class Wu{constructor(){this._element=document.body}getWidth(){const t=document.documentElement.clientWidth;return Math.abs(window.innerWidth-t)}hide(){const t=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,SA,e=>e+t),this._setElementAttributes(gp,SA,e=>e+t),this._setElementAttributes(mp,vp,e=>e-t)}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,SA),this._resetElementAttributes(gp,SA),this._resetElementAttributes(mp,vp)}isOverflowing(){return this.getWidth()>0}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(t,e,i){const r=this.getWidth(),a=f=>{if(f!==this._element&&window.innerWidth>f.clientWidth+r)return;this._saveInitialAttribute(f,e);const o=window.getComputedStyle(f).getPropertyValue(e);f.style.setProperty(e,`${i(Number.parseFloat(o))}px`)};this._applyManipulationCallback(t,a)}_saveInitialAttribute(t,e){const i=t.style.getPropertyValue(e);i&&Nn.setDataAttribute(t,e,i)}_resetElementAttributes(t,e){const i=r=>{const a=Nn.getDataAttribute(r,e);if(a===null){r.style.removeProperty(e);return}Nn.removeDataAttribute(r,e),r.style.setProperty(e,a)};this._applyManipulationCallback(t,i)}_applyManipulationCallback(t,e){if(kn(t)){e(t);return}for(const i of Qt.find(t,this._element))e(i)}}const Tb="modal",Fb="bs.modal",$i=`.${Fb}`,Ub=".data-api",Lb="Escape",Ib=`hide${$i}`,Db=`hidePrevented${$i}`,R0=`hidden${$i}`,H0=`show${$i}`,Pb=`shown${$i}`,Ob=`resize${$i}`,Qb=`click.dismiss${$i}`,Rb=`mousedown.dismiss${$i}`,Hb=`keydown.dismiss${$i}`,kb=`click${$i}${Ub}`,wp="modal-open",Nb="fade",_p="show",fh="modal-static",Vb=".modal.show",zb=".modal-dialog",Gb=".modal-body",Wb='[data-bs-toggle="modal"]',Kb={backdrop:!0,focus:!0,keyboard:!0},Xb={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"};class os extends ln{constructor(t,e){super(t,e),this._dialog=Qt.findOne(zb,this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._isTransitioning=!1,this._scrollBar=new Wu,this._addEventListeners()}static get Default(){return Kb}static get DefaultType(){return Xb}static get NAME(){return Tb}toggle(t){return this._isShown?this.hide():this.show(t)}show(t){this._isShown||this._isTransitioning||wt.trigger(this._element,H0,{relatedTarget:t}).defaultPrevented||(this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add(wp),this._adjustDialog(),this._backdrop.show(()=>this._showElement(t)))}hide(){!this._isShown||this._isTransitioning||wt.trigger(this._element,Ib).defaultPrevented||(this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove(_p),this._queueCallback(()=>this._hideModal(),this._element,this._isAnimated()))}dispose(){wt.off(window,$i),wt.off(this._dialog,$i),this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new O0({isVisible:!!this._config.backdrop,isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new Q0({trapElement:this._element})}_showElement(t){document.body.contains(this._element)||document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0;const e=Qt.findOne(Gb,this._dialog);e&&(e.scrollTop=0),rA(this._element),this._element.classList.add(_p);const i=()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,wt.trigger(this._element,Pb,{relatedTarget:t})};this._queueCallback(i,this._dialog,this._isAnimated())}_addEventListeners(){wt.on(this._element,Hb,t=>{if(t.key===Lb){if(this._config.keyboard){this.hide();return}this._triggerBackdropTransition()}}),wt.on(window,Ob,()=>{this._isShown&&!this._isTransitioning&&this._adjustDialog()}),wt.on(this._element,Rb,t=>{wt.one(this._element,Qb,e=>{if(!(this._element!==t.target||this._element!==e.target)){if(this._config.backdrop==="static"){this._triggerBackdropTransition();return}this._config.backdrop&&this.hide()}})})}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide(()=>{document.body.classList.remove(wp),this._resetAdjustments(),this._scrollBar.reset(),wt.trigger(this._element,R0)})}_isAnimated(){return this._element.classList.contains(Nb)}_triggerBackdropTransition(){if(wt.trigger(this._element,Db).defaultPrevented)return;const e=this._element.scrollHeight>document.documentElement.clientHeight,i=this._element.style.overflowY;i==="hidden"||this._element.classList.contains(fh)||(e||(this._element.style.overflowY="hidden"),this._element.classList.add(fh),this._queueCallback(()=>{this._element.classList.remove(fh),this._queueCallback(()=>{this._element.style.overflowY=i},this._dialog)},this._dialog),this._element.focus())}_adjustDialog(){const t=this._element.scrollHeight>document.documentElement.clientHeight,e=this._scrollBar.getWidth(),i=e>0;if(i&&!t){const r=qi()?"paddingLeft":"paddingRight";this._element.style[r]=`${e}px`}if(!i&&t){const r=qi()?"paddingRight":"paddingLeft";this._element.style[r]=`${e}px`}}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(t,e){return this.each(function(){const i=os.getOrCreateInstance(this,t);if(typeof t=="string"){if(typeof i[t]>"u")throw new TypeError(`No method named "${t}"`);i[t](e)}})}}wt.on(document,kb,Wb,function(n){const t=Qt.getElementFromSelector(this);["A","AREA"].includes(this.tagName)&&n.preventDefault(),wt.one(t,H0,r=>{r.defaultPrevented||wt.one(t,R0,()=>{Oa(this)&&this.focus()})});const e=Qt.findOne(Vb);e&&os.getInstance(e).hide(),os.getOrCreateInstance(t).toggle(this)});Sc(os);Ji(os);const jb="offcanvas",Yb="bs.offcanvas",jn=`.${Yb}`,k0=".data-api",qb=`load${jn}${k0}`,$b="Escape",yp="show",xp="showing",Cp="hiding",Jb="offcanvas-backdrop",N0=".offcanvas.show",Zb=`show${jn}`,tB=`shown${jn}`,eB=`hide${jn}`,bp=`hidePrevented${jn}`,V0=`hidden${jn}`,iB=`resize${jn}`,nB=`click${jn}${k0}`,rB=`keydown.dismiss${jn}`,sB='[data-bs-toggle="offcanvas"]',aB={backdrop:!0,keyboard:!0,scroll:!1},oB={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"};class yr extends ln{constructor(t,e){super(t,e),this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get Default(){return aB}static get DefaultType(){return oB}static get NAME(){return jb}toggle(t){return this._isShown?this.hide():this.show(t)}show(t){if(this._isShown||wt.trigger(this._element,Zb,{relatedTarget:t}).defaultPrevented)return;this._isShown=!0,this._backdrop.show(),this._config.scroll||new Wu().hide(),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add(xp);const i=()=>{(!this._config.scroll||this._config.backdrop)&&this._focustrap.activate(),this._element.classList.add(yp),this._element.classList.remove(xp),wt.trigger(this._element,tB,{relatedTarget:t})};this._queueCallback(i,this._element,!0)}hide(){if(!this._isShown||wt.trigger(this._element,eB).defaultPrevented)return;this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add(Cp),this._backdrop.hide();const e=()=>{this._element.classList.remove(yp,Cp),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._config.scroll||new Wu().reset(),wt.trigger(this._element,V0)};this._queueCallback(e,this._element,!0)}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_initializeBackDrop(){const t=()=>{if(this._config.backdrop==="static"){wt.trigger(this._element,bp);return}this.hide()},e=!!this._config.backdrop;return new O0({className:Jb,isVisible:e,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:e?t:null})}_initializeFocusTrap(){return new Q0({trapElement:this._element})}_addEventListeners(){wt.on(this._element,rB,t=>{if(t.key===$b){if(this._config.keyboard){this.hide();return}wt.trigger(this._element,bp)}})}static jQueryInterface(t){return this.each(function(){const e=yr.getOrCreateInstance(this,t);if(typeof t=="string"){if(e[t]===void 0||t.startsWith("_")||t==="constructor")throw new TypeError(`No method named "${t}"`);e[t](this)}})}}wt.on(document,nB,sB,function(n){const t=Qt.getElementFromSelector(this);if(["A","AREA"].includes(this.tagName)&&n.preventDefault(),_r(this))return;wt.one(t,V0,()=>{Oa(this)&&this.focus()});const e=Qt.findOne(N0);e&&e!==t&&yr.getInstance(e).hide(),yr.getOrCreateInstance(t).toggle(this)});wt.on(window,qb,()=>{for(const n of Qt.find(N0))yr.getOrCreateInstance(n).show()});wt.on(window,iB,()=>{for(const n of Qt.find("[aria-modal][class*=show][class*=offcanvas-]"))getComputedStyle(n).position!=="fixed"&&yr.getOrCreateInstance(n).hide()});Sc(yr);Ji(yr);const AB=/^aria-[\w-]*$/i,z0={"*":["class","dir","id","lang","role",AB],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],div:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},lB=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),cB=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:/?#]*(?:[/?#]|$))/i,hB=(n,t)=>{const e=n.nodeName.toLowerCase();return t.includes(e)?lB.has(e)?!!cB.test(n.nodeValue):!0:t.filter(i=>i instanceof RegExp).some(i=>i.test(e))};function uB(n,t,e){if(!n.length)return n;if(e&&typeof e=="function")return e(n);const r=new window.DOMParser().parseFromString(n,"text/html"),a=[].concat(...r.body.querySelectorAll("*"));for(const f of a){const o=f.nodeName.toLowerCase();if(!Object.keys(t).includes(o)){f.remove();continue}const s=[].concat(...f.attributes),l=[].concat(t["*"]||[],t[o]||[]);for(const u of s)hB(u,l)||f.removeAttribute(u.nodeName)}return r.body.innerHTML}const fB="TemplateFactory",dB={allowList:z0,content:{},extraClass:"",html:!1,sanitize:!0,sanitizeFn:null,template:"<div></div>"},pB={allowList:"object",content:"object",extraClass:"(string|function)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",template:"string"},gB={entry:"(string|element|function|null)",selector:"(string|element)"};class mB extends sA{constructor(t){super(),this._config=this._getConfig(t)}static get Default(){return dB}static get DefaultType(){return pB}static get NAME(){return fB}getContent(){return Object.values(this._config.content).map(t=>this._resolvePossibleFunction(t)).filter(Boolean)}hasContent(){return this.getContent().length>0}changeContent(t){return this._checkContent(t),this._config.content={...this._config.content,...t},this}toHtml(){const t=document.createElement("div");t.innerHTML=this._maybeSanitize(this._config.template);for(const[r,a]of Object.entries(this._config.content))this._setContent(t,a,r);const e=t.children[0],i=this._resolvePossibleFunction(this._config.extraClass);return i&&e.classList.add(...i.split(" ")),e}_typeCheckConfig(t){super._typeCheckConfig(t),this._checkContent(t.content)}_checkContent(t){for(const[e,i]of Object.entries(t))super._typeCheckConfig({selector:e,entry:i},gB)}_setContent(t,e,i){const r=Qt.findOne(i,t);if(r){if(e=this._resolvePossibleFunction(e),!e){r.remove();return}if(kn(e)){this._putElementInTemplate(wr(e),r);return}if(this._config.html){r.innerHTML=this._maybeSanitize(e);return}r.textContent=e}}_maybeSanitize(t){return this._config.sanitize?uB(t,this._config.allowList,this._config.sanitizeFn):t}_resolvePossibleFunction(t){return wi(t,[this])}_putElementInTemplate(t,e){if(this._config.html){e.innerHTML="",e.append(t);return}e.textContent=t.textContent}}const vB="tooltip",wB=new Set(["sanitize","allowList","sanitizeFn"]),dh="fade",_B="modal",EA="show",yB=".tooltip-inner",Bp=`.${_B}`,Sp="hide.bs.modal",Ya="hover",ph="focus",xB="click",CB="manual",bB="hide",BB="hidden",SB="show",EB="shown",MB="inserted",TB="click",FB="focusin",UB="focusout",LB="mouseenter",IB="mouseleave",DB={AUTO:"auto",TOP:"top",RIGHT:qi()?"left":"right",BOTTOM:"bottom",LEFT:qi()?"right":"left"},PB={allowList:z0,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,6],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"",trigger:"hover focus"},OB={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"};class Ra extends ln{constructor(t,e){if(typeof g0>"u")throw new TypeError("Bootstrap's tooltips require Popper (https://popper.js.org)");super(t,e),this._isEnabled=!0,this._timeout=0,this._isHovered=null,this._activeTrigger={},this._popper=null,this._templateFactory=null,this._newContent=null,this.tip=null,this._setListeners(),this._config.selector||this._fixTitle()}static get Default(){return PB}static get DefaultType(){return OB}static get NAME(){return vB}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){if(this._isEnabled){if(this._activeTrigger.click=!this._activeTrigger.click,this._isShown()){this._leave();return}this._enter()}}dispose(){clearTimeout(this._timeout),wt.off(this._element.closest(Bp),Sp,this._hideModalHandler),this._element.getAttribute("data-bs-original-title")&&this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title")),this._disposePopper(),super.dispose()}show(){if(this._element.style.display==="none")throw new Error("Please use show on visible elements");if(!(this._isWithContent()&&this._isEnabled))return;const t=wt.trigger(this._element,this.constructor.eventName(SB)),i=(w0(this._element)||this._element.ownerDocument.documentElement).contains(this._element);if(t.defaultPrevented||!i)return;this._disposePopper();const r=this._getTipElement();this._element.setAttribute("aria-describedby",r.getAttribute("id"));const{container:a}=this._config;if(this._element.ownerDocument.documentElement.contains(this.tip)||(a.append(r),wt.trigger(this._element,this.constructor.eventName(MB))),this._popper=this._createPopper(r),r.classList.add(EA),"ontouchstart"in document.documentElement)for(const o of[].concat(...document.body.children))wt.on(o,"mouseover",tc);const f=()=>{wt.trigger(this._element,this.constructor.eventName(EB)),this._isHovered===!1&&this._leave(),this._isHovered=!1};this._queueCallback(f,this.tip,this._isAnimated())}hide(){if(!this._isShown()||wt.trigger(this._element,this.constructor.eventName(bB)).defaultPrevented)return;if(this._getTipElement().classList.remove(EA),"ontouchstart"in document.documentElement)for(const r of[].concat(...document.body.children))wt.off(r,"mouseover",tc);this._activeTrigger[xB]=!1,this._activeTrigger[ph]=!1,this._activeTrigger[Ya]=!1,this._isHovered=null;const i=()=>{this._isWithActiveTrigger()||(this._isHovered||this._disposePopper(),this._element.removeAttribute("aria-describedby"),wt.trigger(this._element,this.constructor.eventName(BB)))};this._queueCallback(i,this.tip,this._isAnimated())}update(){this._popper&&this._popper.update()}_isWithContent(){return!!this._getTitle()}_getTipElement(){return this.tip||(this.tip=this._createTipElement(this._newContent||this._getContentForTemplate())),this.tip}_createTipElement(t){const e=this._getTemplateFactory(t).toHtml();if(!e)return null;e.classList.remove(dh,EA),e.classList.add(`bs-${this.constructor.NAME}-auto`);const i=xx(this.constructor.NAME).toString();return e.setAttribute("id",i),this._isAnimated()&&e.classList.add(dh),e}setContent(t){this._newContent=t,this._isShown()&&(this._disposePopper(),this.show())}_getTemplateFactory(t){return this._templateFactory?this._templateFactory.changeContent(t):this._templateFactory=new mB({...this._config,content:t,extraClass:this._resolvePossibleFunction(this._config.customClass)}),this._templateFactory}_getContentForTemplate(){return{[yB]:this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget(t){return this.constructor.getOrCreateInstance(t.delegateTarget,this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains(dh)}_isShown(){return this.tip&&this.tip.classList.contains(EA)}_createPopper(t){const e=wi(this._config.placement,[this,t,this._element]),i=DB[e.toUpperCase()];return sd(this._element,t,this._getPopperConfig(i))}_getOffset(){const{offset:t}=this._config;return typeof t=="string"?t.split(",").map(e=>Number.parseInt(e,10)):typeof t=="function"?e=>t(e,this._element):t}_resolvePossibleFunction(t){return wi(t,[this._element])}_getPopperConfig(t){const e={placement:t,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:i=>{this._getTipElement().setAttribute("data-popper-placement",i.state.placement)}}]};return{...e,...wi(this._config.popperConfig,[e])}}_setListeners(){const t=this._config.trigger.split(" ");for(const e of t)if(e==="click")wt.on(this._element,this.constructor.eventName(TB),this._config.selector,i=>{this._initializeOnDelegatedTarget(i).toggle()});else if(e!==CB){const i=e===Ya?this.constructor.eventName(LB):this.constructor.eventName(FB),r=e===Ya?this.constructor.eventName(IB):this.constructor.eventName(UB);wt.on(this._element,i,this._config.selector,a=>{const f=this._initializeOnDelegatedTarget(a);f._activeTrigger[a.type==="focusin"?ph:Ya]=!0,f._enter()}),wt.on(this._element,r,this._config.selector,a=>{const f=this._initializeOnDelegatedTarget(a);f._activeTrigger[a.type==="focusout"?ph:Ya]=f._element.contains(a.relatedTarget),f._leave()})}this._hideModalHandler=()=>{this._element&&this.hide()},wt.on(this._element.closest(Bp),Sp,this._hideModalHandler)}_fixTitle(){const t=this._element.getAttribute("title");t&&(!this._element.getAttribute("aria-label")&&!this._element.textContent.trim()&&this._element.setAttribute("aria-label",t),this._element.setAttribute("data-bs-original-title",t),this._element.removeAttribute("title"))}_enter(){if(this._isShown()||this._isHovered){this._isHovered=!0;return}this._isHovered=!0,this._setTimeout(()=>{this._isHovered&&this.show()},this._config.delay.show)}_leave(){this._isWithActiveTrigger()||(this._isHovered=!1,this._setTimeout(()=>{this._isHovered||this.hide()},this._config.delay.hide))}_setTimeout(t,e){clearTimeout(this._timeout),this._timeout=setTimeout(t,e)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig(t){const e=Nn.getDataAttributes(this._element);for(const i of Object.keys(e))wB.has(i)&&delete e[i];return t={...e,...typeof t=="object"&&t?t:{}},t=this._mergeConfigObj(t),t=this._configAfterMerge(t),this._typeCheckConfig(t),t}_configAfterMerge(t){return t.container=t.container===!1?document.body:wr(t.container),typeof t.delay=="number"&&(t.delay={show:t.delay,hide:t.delay}),typeof t.title=="number"&&(t.title=t.title.toString()),typeof t.content=="number"&&(t.content=t.content.toString()),t}_getDelegateConfig(){const t={};for(const[e,i]of Object.entries(this._config))this.constructor.Default[e]!==i&&(t[e]=i);return t.selector=!1,t.trigger="manual",t}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null),this.tip&&(this.tip.remove(),this.tip=null)}static jQueryInterface(t){return this.each(function(){const e=Ra.getOrCreateInstance(this,t);if(typeof t=="string"){if(typeof e[t]>"u")throw new TypeError(`No method named "${t}"`);e[t]()}})}}Ji(Ra);const QB="popover",RB=".popover-header",HB=".popover-body",kB={...Ra.Default,content:"",offset:[0,8],placement:"right",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',trigger:"click"},NB={...Ra.DefaultType,content:"(null|string|element|function)"};class ld extends Ra{static get Default(){return kB}static get DefaultType(){return NB}static get NAME(){return QB}_isWithContent(){return this._getTitle()||this._getContent()}_getContentForTemplate(){return{[RB]:this._getTitle(),[HB]:this._getContent()}}_getContent(){return this._resolvePossibleFunction(this._config.content)}static jQueryInterface(t){return this.each(function(){const e=ld.getOrCreateInstance(this,t);if(typeof t=="string"){if(typeof e[t]>"u")throw new TypeError(`No method named "${t}"`);e[t]()}})}}Ji(ld);const VB="scrollspy",zB="bs.scrollspy",cd=`.${zB}`,GB=".data-api",WB=`activate${cd}`,Ep=`click${cd}`,KB=`load${cd}${GB}`,XB="dropdown-item",vs="active",jB='[data-bs-spy="scroll"]',gh="[href]",YB=".nav, .list-group",Mp=".nav-link",qB=".nav-item",$B=".list-group-item",JB=`${Mp}, ${qB} > ${Mp}, ${$B}`,ZB=".dropdown",tS=".dropdown-toggle",eS={offset:null,rootMargin:"0px 0px -25%",smoothScroll:!1,target:null,threshold:[.1,.5,1]},iS={offset:"(number|null)",rootMargin:"string",smoothScroll:"boolean",target:"element",threshold:"array"};class Tc extends ln{constructor(t,e){super(t,e),this._targetLinks=new Map,this._observableSections=new Map,this._rootElement=getComputedStyle(this._element).overflowY==="visible"?null:this._element,this._activeTarget=null,this._observer=null,this._previousScrollData={visibleEntryTop:0,parentScrollTop:0},this.refresh()}static get Default(){return eS}static get DefaultType(){return iS}static get NAME(){return VB}refresh(){this._initializeTargetsAndObservables(),this._maybeEnableSmoothScroll(),this._observer?this._observer.disconnect():this._observer=this._getNewObserver();for(const t of this._observableSections.values())this._observer.observe(t)}dispose(){this._observer.disconnect(),super.dispose()}_configAfterMerge(t){return t.target=wr(t.target)||document.body,t.rootMargin=t.offset?`${t.offset}px 0px -30%`:t.rootMargin,typeof t.threshold=="string"&&(t.threshold=t.threshold.split(",").map(e=>Number.parseFloat(e))),t}_maybeEnableSmoothScroll(){this._config.smoothScroll&&(wt.off(this._config.target,Ep),wt.on(this._config.target,Ep,gh,t=>{const e=this._observableSections.get(t.target.hash);if(e){t.preventDefault();const i=this._rootElement||window,r=e.offsetTop-this._element.offsetTop;if(i.scrollTo){i.scrollTo({top:r,behavior:"smooth"});return}i.scrollTop=r}}))}_getNewObserver(){const t={root:this._rootElement,threshold:this._config.threshold,rootMargin:this._config.rootMargin};return new IntersectionObserver(e=>this._observerCallback(e),t)}_observerCallback(t){const e=f=>this._targetLinks.get(`#${f.target.id}`),i=f=>{this._previousScrollData.visibleEntryTop=f.target.offsetTop,this._process(e(f))},r=(this._rootElement||document.documentElement).scrollTop,a=r>=this._previousScrollData.parentScrollTop;this._previousScrollData.parentScrollTop=r;for(const f of t){if(!f.isIntersecting){this._activeTarget=null,this._clearActiveClass(e(f));continue}const o=f.target.offsetTop>=this._previousScrollData.visibleEntryTop;if(a&&o){if(i(f),!r)return;continue}!a&&!o&&i(f)}}_initializeTargetsAndObservables(){this._targetLinks=new Map,this._observableSections=new Map;const t=Qt.find(gh,this._config.target);for(const e of t){if(!e.hash||_r(e))continue;const i=Qt.findOne(decodeURI(e.hash),this._element);Oa(i)&&(this._targetLinks.set(decodeURI(e.hash),e),this._observableSections.set(e.hash,i))}}_process(t){this._activeTarget!==t&&(this._clearActiveClass(this._config.target),this._activeTarget=t,t.classList.add(vs),this._activateParents(t),wt.trigger(this._element,WB,{relatedTarget:t}))}_activateParents(t){if(t.classList.contains(XB)){Qt.findOne(tS,t.closest(ZB)).classList.add(vs);return}for(const e of Qt.parents(t,YB))for(const i of Qt.prev(e,JB))i.classList.add(vs)}_clearActiveClass(t){t.classList.remove(vs);const e=Qt.find(`${gh}.${vs}`,t);for(const i of e)i.classList.remove(vs)}static jQueryInterface(t){return this.each(function(){const e=Tc.getOrCreateInstance(this,t);if(typeof t=="string"){if(e[t]===void 0||t.startsWith("_")||t==="constructor")throw new TypeError(`No method named "${t}"`);e[t]()}})}}wt.on(window,KB,()=>{for(const n of Qt.find(jB))Tc.getOrCreateInstance(n)});Ji(Tc);const nS="tab",rS="bs.tab",ps=`.${rS}`,sS=`hide${ps}`,aS=`hidden${ps}`,oS=`show${ps}`,AS=`shown${ps}`,lS=`click${ps}`,cS=`keydown${ps}`,hS=`load${ps}`,uS="ArrowLeft",Tp="ArrowRight",fS="ArrowUp",Fp="ArrowDown",Yr="active",Up="fade",mh="show",dS="dropdown",pS=".dropdown-toggle",gS=".dropdown-menu",vh=":not(.dropdown-toggle)",mS='.list-group, .nav, [role="tablist"]',vS=".nav-item, .list-group-item",wS=`.nav-link${vh}, .list-group-item${vh}, [role="tab"]${vh}`,G0='[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',wh=`${wS}, ${G0}`,_S=`.${Yr}[data-bs-toggle="tab"], .${Yr}[data-bs-toggle="pill"], .${Yr}[data-bs-toggle="list"]`;class xa extends ln{constructor(t){super(t),this._parent=this._element.closest(mS),this._parent&&(this._setInitialAttributes(this._parent,this._getChildren()),wt.on(this._element,cS,e=>this._keydown(e)))}static get NAME(){return nS}show(){const t=this._element;if(this._elemIsActive(t))return;const e=this._getActiveElem(),i=e?wt.trigger(e,sS,{relatedTarget:t}):null;wt.trigger(t,oS,{relatedTarget:e}).defaultPrevented||i&&i.defaultPrevented||(this._deactivate(e,t),this._activate(t,e))}_activate(t,e){if(!t)return;t.classList.add(Yr),this._activate(Qt.getElementFromSelector(t));const i=()=>{if(t.getAttribute("role")!=="tab"){t.classList.add(mh);return}t.removeAttribute("tabindex"),t.setAttribute("aria-selected",!0),this._toggleDropDown(t,!0),wt.trigger(t,AS,{relatedTarget:e})};this._queueCallback(i,t,t.classList.contains(Up))}_deactivate(t,e){if(!t)return;t.classList.remove(Yr),t.blur(),this._deactivate(Qt.getElementFromSelector(t));const i=()=>{if(t.getAttribute("role")!=="tab"){t.classList.remove(mh);return}t.setAttribute("aria-selected",!1),t.setAttribute("tabindex","-1"),this._toggleDropDown(t,!1),wt.trigger(t,aS,{relatedTarget:e})};this._queueCallback(i,t,t.classList.contains(Up))}_keydown(t){if(![uS,Tp,fS,Fp].includes(t.key))return;t.stopPropagation(),t.preventDefault();const e=[Tp,Fp].includes(t.key),i=ad(this._getChildren().filter(r=>!_r(r)),t.target,e,!0);i&&(i.focus({preventScroll:!0}),xa.getOrCreateInstance(i).show())}_getChildren(){return Qt.find(wh,this._parent)}_getActiveElem(){return this._getChildren().find(t=>this._elemIsActive(t))||null}_setInitialAttributes(t,e){this._setAttributeIfNotExists(t,"role","tablist");for(const i of e)this._setInitialAttributesOnChild(i)}_setInitialAttributesOnChild(t){t=this._getInnerElement(t);const e=this._elemIsActive(t),i=this._getOuterElement(t);t.setAttribute("aria-selected",e),i!==t&&this._setAttributeIfNotExists(i,"role","presentation"),e||t.setAttribute("tabindex","-1"),this._setAttributeIfNotExists(t,"role","tab"),this._setInitialAttributesOnTargetPanel(t)}_setInitialAttributesOnTargetPanel(t){const e=Qt.getElementFromSelector(t);e&&(this._setAttributeIfNotExists(e,"role","tabpanel"),t.id&&this._setAttributeIfNotExists(e,"aria-labelledby",`${t.id}`))}_toggleDropDown(t,e){const i=this._getOuterElement(t);if(!i.classList.contains(dS))return;const r=(a,f)=>{const o=Qt.findOne(a,i);o&&o.classList.toggle(f,e)};r(pS,Yr),r(gS,mh),i.setAttribute("aria-expanded",e)}_setAttributeIfNotExists(t,e,i){t.hasAttribute(e)||t.setAttribute(e,i)}_elemIsActive(t){return t.classList.contains(Yr)}_getInnerElement(t){return t.matches(wh)?t:Qt.findOne(wh,t)}_getOuterElement(t){return t.closest(vS)||t}static jQueryInterface(t){return this.each(function(){const e=xa.getOrCreateInstance(this);if(typeof t=="string"){if(e[t]===void 0||t.startsWith("_")||t==="constructor")throw new TypeError(`No method named "${t}"`);e[t]()}})}}wt.on(document,lS,G0,function(n){["A","AREA"].includes(this.tagName)&&n.preventDefault(),!_r(this)&&xa.getOrCreateInstance(this).show()});wt.on(window,hS,()=>{for(const n of Qt.find(_S))xa.getOrCreateInstance(n)});Ji(xa);const yS="toast",xS="bs.toast",Tr=`.${xS}`,CS=`mouseover${Tr}`,bS=`mouseout${Tr}`,BS=`focusin${Tr}`,SS=`focusout${Tr}`,ES=`hide${Tr}`,MS=`hidden${Tr}`,TS=`show${Tr}`,FS=`shown${Tr}`,US="fade",Lp="hide",MA="show",TA="showing",LS={animation:"boolean",autohide:"boolean",delay:"number"},IS={animation:!0,autohide:!0,delay:5e3};class Fc extends ln{constructor(t,e){super(t,e),this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get Default(){return IS}static get DefaultType(){return LS}static get NAME(){return yS}show(){if(wt.trigger(this._element,TS).defaultPrevented)return;this._clearTimeout(),this._config.animation&&this._element.classList.add(US);const e=()=>{this._element.classList.remove(TA),wt.trigger(this._element,FS),this._maybeScheduleHide()};this._element.classList.remove(Lp),rA(this._element),this._element.classList.add(MA,TA),this._queueCallback(e,this._element,this._config.animation)}hide(){if(!this.isShown()||wt.trigger(this._element,ES).defaultPrevented)return;const e=()=>{this._element.classList.add(Lp),this._element.classList.remove(TA,MA),wt.trigger(this._element,MS)};this._element.classList.add(TA),this._queueCallback(e,this._element,this._config.animation)}dispose(){this._clearTimeout(),this.isShown()&&this._element.classList.remove(MA),super.dispose()}isShown(){return this._element.classList.contains(MA)}_maybeScheduleHide(){this._config.autohide&&(this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout(()=>{this.hide()},this._config.delay)))}_onInteraction(t,e){switch(t.type){case"mouseover":case"mouseout":{this._hasMouseInteraction=e;break}case"focusin":case"focusout":{this._hasKeyboardInteraction=e;break}}if(e){this._clearTimeout();return}const i=t.relatedTarget;this._element===i||this._element.contains(i)||this._maybeScheduleHide()}_setListeners(){wt.on(this._element,CS,t=>this._onInteraction(t,!0)),wt.on(this._element,bS,t=>this._onInteraction(t,!1)),wt.on(this._element,BS,t=>this._onInteraction(t,!0)),wt.on(this._element,SS,t=>this._onInteraction(t,!1))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface(t){return this.each(function(){const e=Fc.getOrCreateInstance(this,t);if(typeof t=="string"){if(typeof e[t]>"u")throw new TypeError(`No method named "${t}"`);e[t](this)}})}}Sc(Fc);Ji(Fc);/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const hd="151",_h={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},DS=0,Ip=1,PS=2,W0=1,OS=2,mo=3,Wn=0,yi=1,Ui=2,gr=0,ha=1,Dp=2,Pp=3,Op=4,QS=5,ta=100,RS=101,HS=102,Qp=103,Rp=104,kS=200,NS=201,VS=202,zS=203,K0=204,X0=205,GS=206,WS=207,KS=208,XS=209,jS=210,YS=0,qS=1,$S=2,Ku=3,JS=4,ZS=5,tE=6,eE=7,Uc=0,iE=1,nE=2,Vn=0,rE=1,sE=2,aE=3,oE=4,AE=5,j0=300,Ca=301,ba=302,Xu=303,ju=304,Lc=306,Ba=1e3,Wi=1001,nc=1002,Xe=1003,Yu=1004,Wl=1005,vi=1006,Y0=1007,As=1008,ls=1009,lE=1010,cE=1011,q0=1012,hE=1013,qr=1014,ur=1015,Vo=1016,uE=1017,fE=1018,ua=1020,dE=1021,Ki=1023,pE=1024,gE=1025,Zr=1026,Sa=1027,mE=1028,vE=1029,wE=1030,_E=1031,yE=1033,yh=33776,xh=33777,Ch=33778,bh=33779,Hp=35840,kp=35841,Np=35842,Vp=35843,xE=36196,zp=37492,Gp=37496,Wp=37808,Kp=37809,Xp=37810,jp=37811,Yp=37812,qp=37813,$p=37814,Jp=37815,Zp=37816,tg=37817,eg=37818,ig=37819,ng=37820,rg=37821,Bh=36492,CE=36283,sg=36284,ag=36285,og=36286,zo=2300,Ea=2301,Sh=2302,Ag=2400,lg=2401,cg=2402,bE=2500,BE=0,$0=1,qu=2,cs=3e3,le=3001,SE=3200,EE=3201,Ic=0,ME=1,pn="srgb",Go="srgb-linear",J0="display-p3",Eh=7680,Mh=7681,TE=517,FE=519,$u=35044,hg="300 es",Ju=1035;class Ha{addEventListener(t,e){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[t]===void 0&&(i[t]=[]),i[t].indexOf(e)===-1&&i[t].push(e)}hasEventListener(t,e){if(this._listeners===void 0)return!1;const i=this._listeners;return i[t]!==void 0&&i[t].indexOf(e)!==-1}removeEventListener(t,e){if(this._listeners===void 0)return;const r=this._listeners[t];if(r!==void 0){const a=r.indexOf(e);a!==-1&&r.splice(a,1)}}dispatchEvent(t){if(this._listeners===void 0)return;const i=this._listeners[t.type];if(i!==void 0){t.target=this;const r=i.slice(0);for(let a=0,f=r.length;a<f;a++)r[a].call(this,t);t.target=null}}}const ei=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let ug=1234567;const fa=Math.PI/180,Ma=180/Math.PI;function an(){const n=Math.random()*4294967295|0,t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(ei[n&255]+ei[n>>8&255]+ei[n>>16&255]+ei[n>>24&255]+"-"+ei[t&255]+ei[t>>8&255]+"-"+ei[t>>16&15|64]+ei[t>>24&255]+"-"+ei[e&63|128]+ei[e>>8&255]+"-"+ei[e>>16&255]+ei[e>>24&255]+ei[i&255]+ei[i>>8&255]+ei[i>>16&255]+ei[i>>24&255]).toLowerCase()}function Je(n,t,e){return Math.max(t,Math.min(e,n))}function ud(n,t){return(n%t+t)%t}function UE(n,t,e,i,r){return i+(n-t)*(r-i)/(e-t)}function LE(n,t,e){return n!==t?(e-n)/(t-n):0}function Do(n,t,e){return(1-e)*n+e*t}function IE(n,t,e,i){return Do(n,t,1-Math.exp(-e*i))}function DE(n,t=1){return t-Math.abs(ud(n,t*2)-t)}function PE(n,t,e){return n<=t?0:n>=e?1:(n=(n-t)/(e-t),n*n*(3-2*n))}function OE(n,t,e){return n<=t?0:n>=e?1:(n=(n-t)/(e-t),n*n*n*(n*(n*6-15)+10))}function QE(n,t){return n+Math.floor(Math.random()*(t-n+1))}function RE(n,t){return n+Math.random()*(t-n)}function HE(n){return n*(.5-Math.random())}function kE(n){n!==void 0&&(ug=n);let t=ug+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}function NE(n){return n*fa}function VE(n){return n*Ma}function Zu(n){return(n&n-1)===0&&n!==0}function Z0(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function tw(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function zE(n,t,e,i,r){const a=Math.cos,f=Math.sin,o=a(e/2),s=f(e/2),l=a((t+i)/2),u=f((t+i)/2),A=a((t-i)/2),c=f((t-i)/2),h=a((i-t)/2),p=f((i-t)/2);switch(r){case"XYX":n.set(o*u,s*A,s*c,o*l);break;case"YZY":n.set(s*c,o*u,s*A,o*l);break;case"ZXZ":n.set(s*A,s*c,o*u,o*l);break;case"XZX":n.set(o*u,s*p,s*h,o*l);break;case"YXY":n.set(s*h,o*u,s*p,o*l);break;case"ZYZ":n.set(s*p,s*h,o*u,o*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}function Hn(n,t){switch(t.constructor){case Float32Array:return n;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function we(n,t){switch(t.constructor){case Float32Array:return n;case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}const ew={DEG2RAD:fa,RAD2DEG:Ma,generateUUID:an,clamp:Je,euclideanModulo:ud,mapLinear:UE,inverseLerp:LE,lerp:Do,damp:IE,pingpong:DE,smoothstep:PE,smootherstep:OE,randInt:QE,randFloat:RE,randFloatSpread:HE,seededRandom:kE,degToRad:NE,radToDeg:VE,isPowerOfTwo:Zu,ceilPowerOfTwo:Z0,floorPowerOfTwo:tw,setQuaternionFromProperEuler:zE,normalize:we,denormalize:Hn};class xt{constructor(t=0,e=0){xt.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,i=this.y,r=t.elements;return this.x=r[0]*e+r[3]*i+r[6],this.y=r[1]*e+r[4]*i+r[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(Je(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const i=Math.cos(e),r=Math.sin(e),a=this.x-t.x,f=this.y-t.y;return this.x=a*i-f*r+t.x,this.y=a*r+f*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class ee{constructor(){ee.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(t,e,i,r,a,f,o,s,l){const u=this.elements;return u[0]=t,u[1]=r,u[2]=o,u[3]=e,u[4]=a,u[5]=s,u[6]=i,u[7]=f,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}extractBasis(t,e,i){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,r=e.elements,a=this.elements,f=i[0],o=i[3],s=i[6],l=i[1],u=i[4],A=i[7],c=i[2],h=i[5],p=i[8],m=r[0],d=r[3],g=r[6],v=r[1],w=r[4],_=r[7],y=r[2],C=r[5],b=r[8];return a[0]=f*m+o*v+s*y,a[3]=f*d+o*w+s*C,a[6]=f*g+o*_+s*b,a[1]=l*m+u*v+A*y,a[4]=l*d+u*w+A*C,a[7]=l*g+u*_+A*b,a[2]=c*m+h*v+p*y,a[5]=c*d+h*w+p*C,a[8]=c*g+h*_+p*b,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[1],r=t[2],a=t[3],f=t[4],o=t[5],s=t[6],l=t[7],u=t[8];return e*f*u-e*o*l-i*a*u+i*o*s+r*a*l-r*f*s}invert(){const t=this.elements,e=t[0],i=t[1],r=t[2],a=t[3],f=t[4],o=t[5],s=t[6],l=t[7],u=t[8],A=u*f-o*l,c=o*s-u*a,h=l*a-f*s,p=e*A+i*c+r*h;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);const m=1/p;return t[0]=A*m,t[1]=(r*l-u*i)*m,t[2]=(o*i-r*f)*m,t[3]=c*m,t[4]=(u*e-r*s)*m,t[5]=(r*a-o*e)*m,t[6]=h*m,t[7]=(i*s-l*e)*m,t[8]=(f*e-i*a)*m,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,i,r,a,f,o){const s=Math.cos(a),l=Math.sin(a);return this.set(i*s,i*l,-i*(s*f+l*o)+f+t,-r*l,r*s,-r*(-l*f+s*o)+o+e,0,0,1),this}scale(t,e){return this.premultiply(Th.makeScale(t,e)),this}rotate(t){return this.premultiply(Th.makeRotation(-t)),this}translate(t,e){return this.premultiply(Th.makeTranslation(t,e)),this}makeTranslation(t,e){return this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,i,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,i=t.elements;for(let r=0;r<9;r++)if(e[r]!==i[r])return!1;return!0}fromArray(t,e=0){for(let i=0;i<9;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const Th=new ee;function iw(n){for(let t=n.length-1;t>=0;--t)if(n[t]>=65535)return!0;return!1}function Wo(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function da(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function Fh(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}const GE=new ee().fromArray([.8224621,.0331941,.0170827,.177538,.9668058,.0723974,-1e-7,1e-7,.9105199]),WE=new ee().fromArray([1.2249401,-.0420569,-.0196376,-.2249404,1.0420571,-.0786361,1e-7,0,1.0982735]);function KE(n){return n.convertSRGBToLinear().applyMatrix3(WE)}function XE(n){return n.applyMatrix3(GE).convertLinearToSRGB()}const jE={[Go]:n=>n,[pn]:n=>n.convertSRGBToLinear(),[J0]:KE},YE={[Go]:n=>n,[pn]:n=>n.convertLinearToSRGB(),[J0]:XE},Bi={enabled:!1,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(n){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!n},get workingColorSpace(){return Go},set workingColorSpace(n){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(n,t,e){if(this.enabled===!1||t===e||!t||!e)return n;const i=jE[t],r=YE[e];if(i===void 0||r===void 0)throw new Error(`Unsupported color space conversion, "${t}" to "${e}".`);return r(i(n))},fromWorkingColorSpace:function(n,t){return this.convert(n,this.workingColorSpace,t)},toWorkingColorSpace:function(n,t){return this.convert(n,t,this.workingColorSpace)}};let ws;class nw{static getDataURL(t){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{ws===void 0&&(ws=Wo("canvas")),ws.width=t.width,ws.height=t.height;const i=ws.getContext("2d");t instanceof ImageData?i.putImageData(t,0,0):i.drawImage(t,0,0,t.width,t.height),e=ws}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){const e=Wo("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");i.drawImage(t,0,0,t.width,t.height);const r=i.getImageData(0,0,t.width,t.height),a=r.data;for(let f=0;f<a.length;f++)a[f]=da(a[f]/255)*255;return i.putImageData(r,0,0),e}else if(t.data){const e=t.data.slice(0);for(let i=0;i<e.length;i++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[i]=Math.floor(da(e[i]/255)*255):e[i]=da(e[i]);return{data:e,width:t.width,height:t.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}class rw{constructor(t=null){this.isSource=!0,this.uuid=an(),this.data=t,this.version=0}set needsUpdate(t){t===!0&&this.version++}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.images[this.uuid]!==void 0)return t.images[this.uuid];const i={uuid:this.uuid,url:""},r=this.data;if(r!==null){let a;if(Array.isArray(r)){a=[];for(let f=0,o=r.length;f<o;f++)r[f].isDataTexture?a.push(Uh(r[f].image)):a.push(Uh(r[f]))}else a=Uh(r);i.url=a}return e||(t.images[this.uuid]=i),i}}function Uh(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?nw.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let qE=0;class je extends Ha{constructor(t=je.DEFAULT_IMAGE,e=je.DEFAULT_MAPPING,i=Wi,r=Wi,a=vi,f=As,o=Ki,s=ls,l=je.DEFAULT_ANISOTROPY,u=cs){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:qE++}),this.uuid=an(),this.name="",this.source=new rw(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=i,this.wrapT=r,this.magFilter=a,this.minFilter=f,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=s,this.offset=new xt(0,0),this.repeat=new xt(1,1),this.center=new xt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new ee,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=u,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];const i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),e||(t.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==j0)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case Ba:t.x=t.x-Math.floor(t.x);break;case Wi:t.x=t.x<0?0:1;break;case nc:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case Ba:t.y=t.y-Math.floor(t.y);break;case Wi:t.y=t.y<0?0:1;break;case nc:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}}je.DEFAULT_IMAGE=null;je.DEFAULT_MAPPING=j0;je.DEFAULT_ANISOTROPY=1;class pe{constructor(t=0,e=0,i=0,r=1){pe.prototype.isVector4=!0,this.x=t,this.y=e,this.z=i,this.w=r}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,i,r){return this.x=t,this.y=e,this.z=i,this.w=r,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,i=this.y,r=this.z,a=this.w,f=t.elements;return this.x=f[0]*e+f[4]*i+f[8]*r+f[12]*a,this.y=f[1]*e+f[5]*i+f[9]*r+f[13]*a,this.z=f[2]*e+f[6]*i+f[10]*r+f[14]*a,this.w=f[3]*e+f[7]*i+f[11]*r+f[15]*a,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,i,r,a;const s=t.elements,l=s[0],u=s[4],A=s[8],c=s[1],h=s[5],p=s[9],m=s[2],d=s[6],g=s[10];if(Math.abs(u-c)<.01&&Math.abs(A-m)<.01&&Math.abs(p-d)<.01){if(Math.abs(u+c)<.1&&Math.abs(A+m)<.1&&Math.abs(p+d)<.1&&Math.abs(l+h+g-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;const w=(l+1)/2,_=(h+1)/2,y=(g+1)/2,C=(u+c)/4,b=(A+m)/4,S=(p+d)/4;return w>_&&w>y?w<.01?(i=0,r=.707106781,a=.707106781):(i=Math.sqrt(w),r=C/i,a=b/i):_>y?_<.01?(i=.707106781,r=0,a=.707106781):(r=Math.sqrt(_),i=C/r,a=S/r):y<.01?(i=.707106781,r=.707106781,a=0):(a=Math.sqrt(y),i=b/a,r=S/a),this.set(i,r,a,e),this}let v=Math.sqrt((d-p)*(d-p)+(A-m)*(A-m)+(c-u)*(c-u));return Math.abs(v)<.001&&(v=1),this.x=(d-p)/v,this.y=(A-m)/v,this.z=(c-u)/v,this.w=Math.acos((l+h+g-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this.w=t.w+(e.w-t.w)*i,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class xr extends Ha{constructor(t=1,e=1,i={}){super(),this.isWebGLRenderTarget=!0,this.width=t,this.height=e,this.depth=1,this.scissor=new pe(0,0,t,e),this.scissorTest=!1,this.viewport=new pe(0,0,t,e);const r={width:t,height:e,depth:1};this.texture=new je(r,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.internalFormat=i.internalFormat!==void 0?i.internalFormat:null,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:vi,this.depthBuffer=i.depthBuffer!==void 0?i.depthBuffer:!0,this.stencilBuffer=i.stencilBuffer!==void 0?i.stencilBuffer:!1,this.depthTexture=i.depthTexture!==void 0?i.depthTexture:null,this.samples=i.samples!==void 0?i.samples:0}setSize(t,e,i=1){(this.width!==t||this.height!==e||this.depth!==i)&&(this.width=t,this.height=e,this.depth=i,this.texture.image.width=t,this.texture.image.height=e,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return new this.constructor().copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.isRenderTargetTexture=!0;const e=Object.assign({},t.texture.image);return this.texture.source=new rw(e),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,t.depthTexture!==null&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class sw extends je{constructor(t=null,e=1,i=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:e,height:i,depth:r},this.magFilter=Xe,this.minFilter=Xe,this.wrapR=Wi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class $E extends je{constructor(t=null,e=1,i=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:t,width:e,height:i,depth:r},this.magFilter=Xe,this.minFilter=Xe,this.wrapR=Wi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}let De=class{constructor(t=0,e=0,i=0,r=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=i,this._w=r}static slerpFlat(t,e,i,r,a,f,o){let s=i[r+0],l=i[r+1],u=i[r+2],A=i[r+3];const c=a[f+0],h=a[f+1],p=a[f+2],m=a[f+3];if(o===0){t[e+0]=s,t[e+1]=l,t[e+2]=u,t[e+3]=A;return}if(o===1){t[e+0]=c,t[e+1]=h,t[e+2]=p,t[e+3]=m;return}if(A!==m||s!==c||l!==h||u!==p){let d=1-o;const g=s*c+l*h+u*p+A*m,v=g>=0?1:-1,w=1-g*g;if(w>Number.EPSILON){const y=Math.sqrt(w),C=Math.atan2(y,g*v);d=Math.sin(d*C)/y,o=Math.sin(o*C)/y}const _=o*v;if(s=s*d+c*_,l=l*d+h*_,u=u*d+p*_,A=A*d+m*_,d===1-o){const y=1/Math.sqrt(s*s+l*l+u*u+A*A);s*=y,l*=y,u*=y,A*=y}}t[e]=s,t[e+1]=l,t[e+2]=u,t[e+3]=A}static multiplyQuaternionsFlat(t,e,i,r,a,f){const o=i[r],s=i[r+1],l=i[r+2],u=i[r+3],A=a[f],c=a[f+1],h=a[f+2],p=a[f+3];return t[e]=o*p+u*A+s*h-l*c,t[e+1]=s*p+u*c+l*A-o*h,t[e+2]=l*p+u*h+o*c-s*A,t[e+3]=u*p-o*A-s*c-l*h,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,i,r){return this._x=t,this._y=e,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){const i=t._x,r=t._y,a=t._z,f=t._order,o=Math.cos,s=Math.sin,l=o(i/2),u=o(r/2),A=o(a/2),c=s(i/2),h=s(r/2),p=s(a/2);switch(f){case"XYZ":this._x=c*u*A+l*h*p,this._y=l*h*A-c*u*p,this._z=l*u*p+c*h*A,this._w=l*u*A-c*h*p;break;case"YXZ":this._x=c*u*A+l*h*p,this._y=l*h*A-c*u*p,this._z=l*u*p-c*h*A,this._w=l*u*A+c*h*p;break;case"ZXY":this._x=c*u*A-l*h*p,this._y=l*h*A+c*u*p,this._z=l*u*p+c*h*A,this._w=l*u*A-c*h*p;break;case"ZYX":this._x=c*u*A-l*h*p,this._y=l*h*A+c*u*p,this._z=l*u*p-c*h*A,this._w=l*u*A+c*h*p;break;case"YZX":this._x=c*u*A+l*h*p,this._y=l*h*A+c*u*p,this._z=l*u*p-c*h*A,this._w=l*u*A-c*h*p;break;case"XZY":this._x=c*u*A-l*h*p,this._y=l*h*A-c*u*p,this._z=l*u*p+c*h*A,this._w=l*u*A+c*h*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+f)}return e!==!1&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const i=e/2,r=Math.sin(i);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,i=e[0],r=e[4],a=e[8],f=e[1],o=e[5],s=e[9],l=e[2],u=e[6],A=e[10],c=i+o+A;if(c>0){const h=.5/Math.sqrt(c+1);this._w=.25/h,this._x=(u-s)*h,this._y=(a-l)*h,this._z=(f-r)*h}else if(i>o&&i>A){const h=2*Math.sqrt(1+i-o-A);this._w=(u-s)/h,this._x=.25*h,this._y=(r+f)/h,this._z=(a+l)/h}else if(o>A){const h=2*Math.sqrt(1+o-i-A);this._w=(a-l)/h,this._x=(r+f)/h,this._y=.25*h,this._z=(s+u)/h}else{const h=2*Math.sqrt(1+A-i-o);this._w=(f-r)/h,this._x=(a+l)/h,this._y=(s+u)/h,this._z=.25*h}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(Je(this.dot(t),-1,1)))}rotateTowards(t,e){const i=this.angleTo(t);if(i===0)return this;const r=Math.min(1,e/i);return this.slerp(t,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const i=t._x,r=t._y,a=t._z,f=t._w,o=e._x,s=e._y,l=e._z,u=e._w;return this._x=i*u+f*o+r*l-a*s,this._y=r*u+f*s+a*o-i*l,this._z=a*u+f*l+i*s-r*o,this._w=f*u-i*o-r*s-a*l,this._onChangeCallback(),this}slerp(t,e){if(e===0)return this;if(e===1)return this.copy(t);const i=this._x,r=this._y,a=this._z,f=this._w;let o=f*t._w+i*t._x+r*t._y+a*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=f,this._x=i,this._y=r,this._z=a,this;const s=1-o*o;if(s<=Number.EPSILON){const h=1-e;return this._w=h*f+e*this._w,this._x=h*i+e*this._x,this._y=h*r+e*this._y,this._z=h*a+e*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(s),u=Math.atan2(l,o),A=Math.sin((1-e)*u)/l,c=Math.sin(e*u)/l;return this._w=f*A+this._w*c,this._x=i*A+this._x*c,this._y=r*A+this._y*c,this._z=a*A+this._z*c,this._onChangeCallback(),this}slerpQuaternions(t,e,i){return this.copy(t).slerp(e,i)}random(){const t=Math.random(),e=Math.sqrt(1-t),i=Math.sqrt(t),r=2*Math.PI*Math.random(),a=2*Math.PI*Math.random();return this.set(e*Math.cos(r),i*Math.sin(a),i*Math.cos(a),e*Math.sin(r))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},H=class aw{constructor(t=0,e=0,i=0){aw.prototype.isVector3=!0,this.x=t,this.y=e,this.z=i}set(t,e,i){return i===void 0&&(i=this.z),this.x=t,this.y=e,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(fg.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(fg.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,i=this.y,r=this.z,a=t.elements;return this.x=a[0]*e+a[3]*i+a[6]*r,this.y=a[1]*e+a[4]*i+a[7]*r,this.z=a[2]*e+a[5]*i+a[8]*r,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,i=this.y,r=this.z,a=t.elements,f=1/(a[3]*e+a[7]*i+a[11]*r+a[15]);return this.x=(a[0]*e+a[4]*i+a[8]*r+a[12])*f,this.y=(a[1]*e+a[5]*i+a[9]*r+a[13])*f,this.z=(a[2]*e+a[6]*i+a[10]*r+a[14])*f,this}applyQuaternion(t){const e=this.x,i=this.y,r=this.z,a=t.x,f=t.y,o=t.z,s=t.w,l=s*e+f*r-o*i,u=s*i+o*e-a*r,A=s*r+a*i-f*e,c=-a*e-f*i-o*r;return this.x=l*s+c*-a+u*-o-A*-f,this.y=u*s+c*-f+A*-a-l*-o,this.z=A*s+c*-o+l*-f-u*-a,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,i=this.y,r=this.z,a=t.elements;return this.x=a[0]*e+a[4]*i+a[8]*r,this.y=a[1]*e+a[5]*i+a[9]*r,this.z=a[2]*e+a[6]*i+a[10]*r,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const i=t.x,r=t.y,a=t.z,f=e.x,o=e.y,s=e.z;return this.x=r*s-a*o,this.y=a*f-i*s,this.z=i*o-r*f,this}projectOnVector(t){const e=t.lengthSq();if(e===0)return this.set(0,0,0);const i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return Lh.copy(this).projectOnVector(t),this.sub(Lh)}reflect(t){return this.sub(Lh.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(Je(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y,r=this.z-t.z;return e*e+i*i+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){const r=Math.sin(e)*t;return this.x=r*Math.sin(i),this.y=Math.cos(e)*t,this.z=r*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),r=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=r,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,e*4)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,e*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=(Math.random()-.5)*2,e=Math.random()*Math.PI*2,i=Math.sqrt(1-t**2);return this.x=i*Math.cos(e),this.y=i*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}};const Lh=new H,fg=new De;class Qi{constructor(t=new H(1/0,1/0,1/0),e=new H(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e+=3)this.expandByPoint(Fn.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,i=t.count;e<i;e++)this.expandByPoint(Fn.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const i=Fn.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){if(t.updateWorldMatrix(!1,!1),t.boundingBox!==void 0)t.boundingBox===null&&t.computeBoundingBox(),_s.copy(t.boundingBox),_s.applyMatrix4(t.matrixWorld),this.union(_s);else{const r=t.geometry;if(r!==void 0)if(e&&r.attributes!==void 0&&r.attributes.position!==void 0){const a=r.attributes.position;for(let f=0,o=a.count;f<o;f++)Fn.fromBufferAttribute(a,f).applyMatrix4(t.matrixWorld),this.expandByPoint(Fn)}else r.boundingBox===null&&r.computeBoundingBox(),_s.copy(r.boundingBox),_s.applyMatrix4(t.matrixWorld),this.union(_s)}const i=t.children;for(let r=0,a=i.length;r<a;r++)this.expandByObject(i[r],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,Fn),Fn.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,i;return t.normal.x>0?(e=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,i=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=-t.constant&&i>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(qa),FA.subVectors(this.max,qa),ys.subVectors(t.a,qa),xs.subVectors(t.b,qa),Cs.subVectors(t.c,qa),Jn.subVectors(xs,ys),Zn.subVectors(Cs,xs),Dr.subVectors(ys,Cs);let e=[0,-Jn.z,Jn.y,0,-Zn.z,Zn.y,0,-Dr.z,Dr.y,Jn.z,0,-Jn.x,Zn.z,0,-Zn.x,Dr.z,0,-Dr.x,-Jn.y,Jn.x,0,-Zn.y,Zn.x,0,-Dr.y,Dr.x,0];return!Ih(e,ys,xs,Cs,FA)||(e=[1,0,0,0,1,0,0,0,1],!Ih(e,ys,xs,Cs,FA))?!1:(UA.crossVectors(Jn,Zn),e=[UA.x,UA.y,UA.z],Ih(e,ys,xs,Cs,FA))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,Fn).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=this.getSize(Fn).length()*.5),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(Tn[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Tn[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Tn[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Tn[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Tn[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Tn[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Tn[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Tn[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Tn),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const Tn=[new H,new H,new H,new H,new H,new H,new H,new H],Fn=new H,_s=new Qi,ys=new H,xs=new H,Cs=new H,Jn=new H,Zn=new H,Dr=new H,qa=new H,FA=new H,UA=new H,Pr=new H;function Ih(n,t,e,i,r){for(let a=0,f=n.length-3;a<=f;a+=3){Pr.fromArray(n,a);const o=r.x*Math.abs(Pr.x)+r.y*Math.abs(Pr.y)+r.z*Math.abs(Pr.z),s=t.dot(Pr),l=e.dot(Pr),u=i.dot(Pr);if(Math.max(-Math.max(s,l,u),Math.min(s,l,u))>o)return!1}return!0}const JE=new Qi,$a=new H,Dh=new H;class Cn{constructor(t=new H,e=-1){this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const i=this.center;e!==void 0?i.copy(e):JE.setFromPoints(t).getCenter(i);let r=0;for(let a=0,f=t.length;a<f;a++)r=Math.max(r,i.distanceToSquared(t[a]));return this.radius=Math.sqrt(r),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const i=this.center.distanceToSquared(t);return e.copy(t),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;$a.subVectors(t,this.center);const e=$a.lengthSq();if(e>this.radius*this.radius){const i=Math.sqrt(e),r=(i-this.radius)*.5;this.center.addScaledVector($a,r/i),this.radius+=r}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(this.center.equals(t.center)===!0?this.radius=Math.max(this.radius,t.radius):(Dh.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint($a.copy(t.center).add(Dh)),this.expandByPoint($a.copy(t.center).sub(Dh))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Un=new H,Ph=new H,LA=new H,tr=new H,Oh=new H,IA=new H,Qh=new H;class Dc{constructor(t=new H,e=new H(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,Un)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const i=e.dot(this.direction);return i<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=Un.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(Un.copy(this.origin).addScaledVector(this.direction,e),Un.distanceToSquared(t))}distanceSqToSegment(t,e,i,r){Ph.copy(t).add(e).multiplyScalar(.5),LA.copy(e).sub(t).normalize(),tr.copy(this.origin).sub(Ph);const a=t.distanceTo(e)*.5,f=-this.direction.dot(LA),o=tr.dot(this.direction),s=-tr.dot(LA),l=tr.lengthSq(),u=Math.abs(1-f*f);let A,c,h,p;if(u>0)if(A=f*s-o,c=f*o-s,p=a*u,A>=0)if(c>=-p)if(c<=p){const m=1/u;A*=m,c*=m,h=A*(A+f*c+2*o)+c*(f*A+c+2*s)+l}else c=a,A=Math.max(0,-(f*c+o)),h=-A*A+c*(c+2*s)+l;else c=-a,A=Math.max(0,-(f*c+o)),h=-A*A+c*(c+2*s)+l;else c<=-p?(A=Math.max(0,-(-f*a+o)),c=A>0?-a:Math.min(Math.max(-a,-s),a),h=-A*A+c*(c+2*s)+l):c<=p?(A=0,c=Math.min(Math.max(-a,-s),a),h=c*(c+2*s)+l):(A=Math.max(0,-(f*a+o)),c=A>0?a:Math.min(Math.max(-a,-s),a),h=-A*A+c*(c+2*s)+l);else c=f>0?-a:a,A=Math.max(0,-(f*c+o)),h=-A*A+c*(c+2*s)+l;return i&&i.copy(this.origin).addScaledVector(this.direction,A),r&&r.copy(Ph).addScaledVector(LA,c),h}intersectSphere(t,e){Un.subVectors(t.center,this.origin);const i=Un.dot(this.direction),r=Un.dot(Un)-i*i,a=t.radius*t.radius;if(r>a)return null;const f=Math.sqrt(a-r),o=i-f,s=i+f;return s<0?null:o<0?this.at(s,e):this.at(o,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(e===0)return t.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(t.normal)+t.constant)/e;return i>=0?i:null}intersectPlane(t,e){const i=this.distanceToPlane(t);return i===null?null:this.at(i,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);return e===0||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let i,r,a,f,o,s;const l=1/this.direction.x,u=1/this.direction.y,A=1/this.direction.z,c=this.origin;return l>=0?(i=(t.min.x-c.x)*l,r=(t.max.x-c.x)*l):(i=(t.max.x-c.x)*l,r=(t.min.x-c.x)*l),u>=0?(a=(t.min.y-c.y)*u,f=(t.max.y-c.y)*u):(a=(t.max.y-c.y)*u,f=(t.min.y-c.y)*u),i>f||a>r||((a>i||isNaN(i))&&(i=a),(f<r||isNaN(r))&&(r=f),A>=0?(o=(t.min.z-c.z)*A,s=(t.max.z-c.z)*A):(o=(t.max.z-c.z)*A,s=(t.min.z-c.z)*A),i>s||o>r)||((o>i||i!==i)&&(i=o),(s<r||r!==r)&&(r=s),r<0)?null:this.at(i>=0?i:r,e)}intersectsBox(t){return this.intersectBox(t,Un)!==null}intersectTriangle(t,e,i,r,a){Oh.subVectors(e,t),IA.subVectors(i,t),Qh.crossVectors(Oh,IA);let f=this.direction.dot(Qh),o;if(f>0){if(r)return null;o=1}else if(f<0)o=-1,f=-f;else return null;tr.subVectors(this.origin,t);const s=o*this.direction.dot(IA.crossVectors(tr,IA));if(s<0)return null;const l=o*this.direction.dot(Oh.cross(tr));if(l<0||s+l>f)return null;const u=-o*tr.dot(Qh);return u<0?null:this.at(u/f,a)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Kt{constructor(){Kt.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(t,e,i,r,a,f,o,s,l,u,A,c,h,p,m,d){const g=this.elements;return g[0]=t,g[4]=e,g[8]=i,g[12]=r,g[1]=a,g[5]=f,g[9]=o,g[13]=s,g[2]=l,g[6]=u,g[10]=A,g[14]=c,g[3]=h,g[7]=p,g[11]=m,g[15]=d,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Kt().fromArray(this.elements)}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}copyPosition(t){const e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,i=t.elements,r=1/bs.setFromMatrixColumn(t,0).length(),a=1/bs.setFromMatrixColumn(t,1).length(),f=1/bs.setFromMatrixColumn(t,2).length();return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=0,e[4]=i[4]*a,e[5]=i[5]*a,e[6]=i[6]*a,e[7]=0,e[8]=i[8]*f,e[9]=i[9]*f,e[10]=i[10]*f,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,i=t.x,r=t.y,a=t.z,f=Math.cos(i),o=Math.sin(i),s=Math.cos(r),l=Math.sin(r),u=Math.cos(a),A=Math.sin(a);if(t.order==="XYZ"){const c=f*u,h=f*A,p=o*u,m=o*A;e[0]=s*u,e[4]=-s*A,e[8]=l,e[1]=h+p*l,e[5]=c-m*l,e[9]=-o*s,e[2]=m-c*l,e[6]=p+h*l,e[10]=f*s}else if(t.order==="YXZ"){const c=s*u,h=s*A,p=l*u,m=l*A;e[0]=c+m*o,e[4]=p*o-h,e[8]=f*l,e[1]=f*A,e[5]=f*u,e[9]=-o,e[2]=h*o-p,e[6]=m+c*o,e[10]=f*s}else if(t.order==="ZXY"){const c=s*u,h=s*A,p=l*u,m=l*A;e[0]=c-m*o,e[4]=-f*A,e[8]=p+h*o,e[1]=h+p*o,e[5]=f*u,e[9]=m-c*o,e[2]=-f*l,e[6]=o,e[10]=f*s}else if(t.order==="ZYX"){const c=f*u,h=f*A,p=o*u,m=o*A;e[0]=s*u,e[4]=p*l-h,e[8]=c*l+m,e[1]=s*A,e[5]=m*l+c,e[9]=h*l-p,e[2]=-l,e[6]=o*s,e[10]=f*s}else if(t.order==="YZX"){const c=f*s,h=f*l,p=o*s,m=o*l;e[0]=s*u,e[4]=m-c*A,e[8]=p*A+h,e[1]=A,e[5]=f*u,e[9]=-o*u,e[2]=-l*u,e[6]=h*A+p,e[10]=c-m*A}else if(t.order==="XZY"){const c=f*s,h=f*l,p=o*s,m=o*l;e[0]=s*u,e[4]=-A,e[8]=l*u,e[1]=c*A+m,e[5]=f*u,e[9]=h*A-p,e[2]=p*A-h,e[6]=o*u,e[10]=m*A+c}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(ZE,t,tM)}lookAt(t,e,i){const r=this.elements;return Si.subVectors(t,e),Si.lengthSq()===0&&(Si.z=1),Si.normalize(),er.crossVectors(i,Si),er.lengthSq()===0&&(Math.abs(i.z)===1?Si.x+=1e-4:Si.z+=1e-4,Si.normalize(),er.crossVectors(i,Si)),er.normalize(),DA.crossVectors(Si,er),r[0]=er.x,r[4]=DA.x,r[8]=Si.x,r[1]=er.y,r[5]=DA.y,r[9]=Si.y,r[2]=er.z,r[6]=DA.z,r[10]=Si.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,r=e.elements,a=this.elements,f=i[0],o=i[4],s=i[8],l=i[12],u=i[1],A=i[5],c=i[9],h=i[13],p=i[2],m=i[6],d=i[10],g=i[14],v=i[3],w=i[7],_=i[11],y=i[15],C=r[0],b=r[4],S=r[8],B=r[12],M=r[1],z=r[5],G=r[9],P=r[13],R=r[2],W=r[6],K=r[10],tt=r[14],j=r[3],E=r[7],I=r[11],Q=r[15];return a[0]=f*C+o*M+s*R+l*j,a[4]=f*b+o*z+s*W+l*E,a[8]=f*S+o*G+s*K+l*I,a[12]=f*B+o*P+s*tt+l*Q,a[1]=u*C+A*M+c*R+h*j,a[5]=u*b+A*z+c*W+h*E,a[9]=u*S+A*G+c*K+h*I,a[13]=u*B+A*P+c*tt+h*Q,a[2]=p*C+m*M+d*R+g*j,a[6]=p*b+m*z+d*W+g*E,a[10]=p*S+m*G+d*K+g*I,a[14]=p*B+m*P+d*tt+g*Q,a[3]=v*C+w*M+_*R+y*j,a[7]=v*b+w*z+_*W+y*E,a[11]=v*S+w*G+_*K+y*I,a[15]=v*B+w*P+_*tt+y*Q,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[4],r=t[8],a=t[12],f=t[1],o=t[5],s=t[9],l=t[13],u=t[2],A=t[6],c=t[10],h=t[14],p=t[3],m=t[7],d=t[11],g=t[15];return p*(+a*s*A-r*l*A-a*o*c+i*l*c+r*o*h-i*s*h)+m*(+e*s*h-e*l*c+a*f*c-r*f*h+r*l*u-a*s*u)+d*(+e*l*A-e*o*h-a*f*A+i*f*h+a*o*u-i*l*u)+g*(-r*o*u-e*s*A+e*o*c+r*f*A-i*f*c+i*s*u)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,i){const r=this.elements;return t.isVector3?(r[12]=t.x,r[13]=t.y,r[14]=t.z):(r[12]=t,r[13]=e,r[14]=i),this}invert(){const t=this.elements,e=t[0],i=t[1],r=t[2],a=t[3],f=t[4],o=t[5],s=t[6],l=t[7],u=t[8],A=t[9],c=t[10],h=t[11],p=t[12],m=t[13],d=t[14],g=t[15],v=A*d*l-m*c*l+m*s*h-o*d*h-A*s*g+o*c*g,w=p*c*l-u*d*l-p*s*h+f*d*h+u*s*g-f*c*g,_=u*m*l-p*A*l+p*o*h-f*m*h-u*o*g+f*A*g,y=p*A*s-u*m*s-p*o*c+f*m*c+u*o*d-f*A*d,C=e*v+i*w+r*_+a*y;if(C===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const b=1/C;return t[0]=v*b,t[1]=(m*c*a-A*d*a-m*r*h+i*d*h+A*r*g-i*c*g)*b,t[2]=(o*d*a-m*s*a+m*r*l-i*d*l-o*r*g+i*s*g)*b,t[3]=(A*s*a-o*c*a-A*r*l+i*c*l+o*r*h-i*s*h)*b,t[4]=w*b,t[5]=(u*d*a-p*c*a+p*r*h-e*d*h-u*r*g+e*c*g)*b,t[6]=(p*s*a-f*d*a-p*r*l+e*d*l+f*r*g-e*s*g)*b,t[7]=(f*c*a-u*s*a+u*r*l-e*c*l-f*r*h+e*s*h)*b,t[8]=_*b,t[9]=(p*A*a-u*m*a-p*i*h+e*m*h+u*i*g-e*A*g)*b,t[10]=(f*m*a-p*o*a+p*i*l-e*m*l-f*i*g+e*o*g)*b,t[11]=(u*o*a-f*A*a-u*i*l+e*A*l+f*i*h-e*o*h)*b,t[12]=y*b,t[13]=(u*m*r-p*A*r+p*i*c-e*m*c-u*i*d+e*A*d)*b,t[14]=(p*o*r-f*m*r-p*i*s+e*m*s+f*i*d-e*o*d)*b,t[15]=(f*A*r-u*o*r+u*i*s-e*A*s-f*i*c+e*o*c)*b,this}scale(t){const e=this.elements,i=t.x,r=t.y,a=t.z;return e[0]*=i,e[4]*=r,e[8]*=a,e[1]*=i,e[5]*=r,e[9]*=a,e[2]*=i,e[6]*=r,e[10]*=a,e[3]*=i,e[7]*=r,e[11]*=a,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],r=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,r))}makeTranslation(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const i=Math.cos(e),r=Math.sin(e),a=1-i,f=t.x,o=t.y,s=t.z,l=a*f,u=a*o;return this.set(l*f+i,l*o-r*s,l*s+r*o,0,l*o+r*s,u*o+i,u*s-r*f,0,l*s-r*o,u*s+r*f,a*s*s+i,0,0,0,0,1),this}makeScale(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,e,i,r,a,f){return this.set(1,i,a,0,t,1,f,0,e,r,1,0,0,0,0,1),this}compose(t,e,i){const r=this.elements,a=e._x,f=e._y,o=e._z,s=e._w,l=a+a,u=f+f,A=o+o,c=a*l,h=a*u,p=a*A,m=f*u,d=f*A,g=o*A,v=s*l,w=s*u,_=s*A,y=i.x,C=i.y,b=i.z;return r[0]=(1-(m+g))*y,r[1]=(h+_)*y,r[2]=(p-w)*y,r[3]=0,r[4]=(h-_)*C,r[5]=(1-(c+g))*C,r[6]=(d+v)*C,r[7]=0,r[8]=(p+w)*b,r[9]=(d-v)*b,r[10]=(1-(c+m))*b,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,this}decompose(t,e,i){const r=this.elements;let a=bs.set(r[0],r[1],r[2]).length();const f=bs.set(r[4],r[5],r[6]).length(),o=bs.set(r[8],r[9],r[10]).length();this.determinant()<0&&(a=-a),t.x=r[12],t.y=r[13],t.z=r[14],tn.copy(this);const l=1/a,u=1/f,A=1/o;return tn.elements[0]*=l,tn.elements[1]*=l,tn.elements[2]*=l,tn.elements[4]*=u,tn.elements[5]*=u,tn.elements[6]*=u,tn.elements[8]*=A,tn.elements[9]*=A,tn.elements[10]*=A,e.setFromRotationMatrix(tn),i.x=a,i.y=f,i.z=o,this}makePerspective(t,e,i,r,a,f){const o=this.elements,s=2*a/(e-t),l=2*a/(i-r),u=(e+t)/(e-t),A=(i+r)/(i-r),c=-(f+a)/(f-a),h=-2*f*a/(f-a);return o[0]=s,o[4]=0,o[8]=u,o[12]=0,o[1]=0,o[5]=l,o[9]=A,o[13]=0,o[2]=0,o[6]=0,o[10]=c,o[14]=h,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(t,e,i,r,a,f){const o=this.elements,s=1/(e-t),l=1/(i-r),u=1/(f-a),A=(e+t)*s,c=(i+r)*l,h=(f+a)*u;return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-A,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-c,o[2]=0,o[6]=0,o[10]=-2*u,o[14]=-h,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(t){const e=this.elements,i=t.elements;for(let r=0;r<16;r++)if(e[r]!==i[r])return!1;return!0}fromArray(t,e=0){for(let i=0;i<16;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}const bs=new H,tn=new Kt,ZE=new H(0,0,0),tM=new H(1,1,1),er=new H,DA=new H,Si=new H,dg=new Kt,pg=new De;class Cr{constructor(t=0,e=0,i=0,r=Cr.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=i,this._order=r}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,i,r=this._order){return this._x=t,this._y=e,this._z=i,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,i=!0){const r=t.elements,a=r[0],f=r[4],o=r[8],s=r[1],l=r[5],u=r[9],A=r[2],c=r[6],h=r[10];switch(e){case"XYZ":this._y=Math.asin(Je(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-u,h),this._z=Math.atan2(-f,a)):(this._x=Math.atan2(c,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Je(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(o,h),this._z=Math.atan2(s,l)):(this._y=Math.atan2(-A,a),this._z=0);break;case"ZXY":this._x=Math.asin(Je(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(-A,h),this._z=Math.atan2(-f,l)):(this._y=0,this._z=Math.atan2(s,a));break;case"ZYX":this._y=Math.asin(-Je(A,-1,1)),Math.abs(A)<.9999999?(this._x=Math.atan2(c,h),this._z=Math.atan2(s,a)):(this._x=0,this._z=Math.atan2(-f,l));break;case"YZX":this._z=Math.asin(Je(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-u,l),this._y=Math.atan2(-A,a)):(this._x=0,this._y=Math.atan2(o,h));break;case"XZY":this._z=Math.asin(-Je(f,-1,1)),Math.abs(f)<.9999999?(this._x=Math.atan2(c,l),this._y=Math.atan2(o,a)):(this._x=Math.atan2(-u,h),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,i===!0&&this._onChangeCallback(),this}setFromQuaternion(t,e,i){return dg.makeRotationFromQuaternion(t),this.setFromRotationMatrix(dg,e,i)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return pg.setFromEuler(this),this.setFromQuaternion(pg,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Cr.DEFAULT_ORDER="XYZ";class fd{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}isEnabled(t){return(this.mask&(1<<t|0))!==0}}let eM=0;const gg=new H,Bs=new De,Ln=new Kt,PA=new H,Ja=new H,iM=new H,nM=new De,mg=new H(1,0,0),vg=new H(0,1,0),wg=new H(0,0,1),rM={type:"added"},_g={type:"removed"};class ce extends Ha{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:eM++}),this.uuid=an(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=ce.DEFAULT_UP.clone();const t=new H,e=new Cr,i=new De,r=new H(1,1,1);function a(){i.setFromEuler(e,!1)}function f(){e.setFromQuaternion(i,void 0,!1)}e._onChange(a),i._onChange(f),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Kt},normalMatrix:{value:new ee}}),this.matrix=new Kt,this.matrixWorld=new Kt,this.matrixAutoUpdate=ce.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=ce.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new fd,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return Bs.setFromAxisAngle(t,e),this.quaternion.multiply(Bs),this}rotateOnWorldAxis(t,e){return Bs.setFromAxisAngle(t,e),this.quaternion.premultiply(Bs),this}rotateX(t){return this.rotateOnAxis(mg,t)}rotateY(t){return this.rotateOnAxis(vg,t)}rotateZ(t){return this.rotateOnAxis(wg,t)}translateOnAxis(t,e){return gg.copy(t).applyQuaternion(this.quaternion),this.position.add(gg.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(mg,t)}translateY(t){return this.translateOnAxis(vg,t)}translateZ(t){return this.translateOnAxis(wg,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(Ln.copy(this.matrixWorld).invert())}lookAt(t,e,i){t.isVector3?PA.copy(t):PA.set(t,e,i);const r=this.parent;this.updateWorldMatrix(!0,!1),Ja.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Ln.lookAt(Ja,PA,this.up):Ln.lookAt(PA,Ja,this.up),this.quaternion.setFromRotationMatrix(Ln),r&&(Ln.extractRotation(r.matrixWorld),Bs.setFromRotationMatrix(Ln),this.quaternion.premultiply(Bs.invert()))}add(t){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.parent!==null&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(rM)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const e=this.children.indexOf(t);return e!==-1&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(_g)),this}removeFromParent(){const t=this.parent;return t!==null&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){const e=this.children[t];e.parent=null,e.dispatchEvent(_g)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),Ln.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),Ln.multiply(t.parent.matrixWorld)),t.applyMatrix4(Ln),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let i=0,r=this.children.length;i<r;i++){const f=this.children[i].getObjectByProperty(t,e);if(f!==void 0)return f}}getObjectsByProperty(t,e){let i=[];this[t]===e&&i.push(this);for(let r=0,a=this.children.length;r<a;r++){const f=this.children[r].getObjectsByProperty(t,e);f.length>0&&(i=i.concat(f))}return i}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ja,t,iM),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ja,nM,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let i=0,r=e.length;i<r;i++)e[i].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);const e=this.children;for(let i=0,r=e.length;i<r;i++)e[i].traverseVisible(t)}traverseAncestors(t){const e=this.parent;e!==null&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let i=0,r=e.length;i<r;i++){const a=e[i];(a.matrixWorldAutoUpdate===!0||t===!0)&&a.updateMatrixWorld(t)}}updateWorldMatrix(t,e){const i=this.parent;if(t===!0&&i!==null&&i.matrixWorldAutoUpdate===!0&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),e===!0){const r=this.children;for(let a=0,f=r.length;a<f;a++){const o=r[a];o.matrixWorldAutoUpdate===!0&&o.updateWorldMatrix(!1,!0)}}}toJSON(t){const e=t===void 0||typeof t=="string",i={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON()));function a(o,s){return o[s.uuid]===void 0&&(o[s.uuid]=s.toJSON(t)),s.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=a(t.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const s=o.shapes;if(Array.isArray(s))for(let l=0,u=s.length;l<u;l++){const A=s[l];a(t.shapes,A)}else a(t.shapes,s)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(a(t.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let s=0,l=this.material.length;s<l;s++)o.push(a(t.materials,this.material[s]));r.material=o}else r.material=a(t.materials,this.material);if(this.children.length>0){r.children=[];for(let o=0;o<this.children.length;o++)r.children.push(this.children[o].toJSON(t).object)}if(this.animations.length>0){r.animations=[];for(let o=0;o<this.animations.length;o++){const s=this.animations[o];r.animations.push(a(t.animations,s))}}if(e){const o=f(t.geometries),s=f(t.materials),l=f(t.textures),u=f(t.images),A=f(t.shapes),c=f(t.skeletons),h=f(t.animations),p=f(t.nodes);o.length>0&&(i.geometries=o),s.length>0&&(i.materials=s),l.length>0&&(i.textures=l),u.length>0&&(i.images=u),A.length>0&&(i.shapes=A),c.length>0&&(i.skeletons=c),h.length>0&&(i.animations=h),p.length>0&&(i.nodes=p)}return i.object=r,i;function f(o){const s=[];for(const l in o){const u=o[l];delete u.metadata,s.push(u)}return s}}clone(t){return new this.constructor().copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),e===!0)for(let i=0;i<t.children.length;i++){const r=t.children[i];this.add(r.clone())}return this}}ce.DEFAULT_UP=new H(0,1,0);ce.DEFAULT_MATRIX_AUTO_UPDATE=!0;ce.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const en=new H,In=new H,Rh=new H,Dn=new H,Ss=new H,Es=new H,yg=new H,Hh=new H,kh=new H,Nh=new H;let OA=!1;class Ti{constructor(t=new H,e=new H,i=new H){this.a=t,this.b=e,this.c=i}static getNormal(t,e,i,r){r.subVectors(i,e),en.subVectors(t,e),r.cross(en);const a=r.lengthSq();return a>0?r.multiplyScalar(1/Math.sqrt(a)):r.set(0,0,0)}static getBarycoord(t,e,i,r,a){en.subVectors(r,e),In.subVectors(i,e),Rh.subVectors(t,e);const f=en.dot(en),o=en.dot(In),s=en.dot(Rh),l=In.dot(In),u=In.dot(Rh),A=f*l-o*o;if(A===0)return a.set(-2,-1,-1);const c=1/A,h=(l*s-o*u)*c,p=(f*u-o*s)*c;return a.set(1-h-p,p,h)}static containsPoint(t,e,i,r){return this.getBarycoord(t,e,i,r,Dn),Dn.x>=0&&Dn.y>=0&&Dn.x+Dn.y<=1}static getUV(t,e,i,r,a,f,o,s){return OA===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),OA=!0),this.getInterpolation(t,e,i,r,a,f,o,s)}static getInterpolation(t,e,i,r,a,f,o,s){return this.getBarycoord(t,e,i,r,Dn),s.setScalar(0),s.addScaledVector(a,Dn.x),s.addScaledVector(f,Dn.y),s.addScaledVector(o,Dn.z),s}static isFrontFacing(t,e,i,r){return en.subVectors(i,e),In.subVectors(t,e),en.cross(In).dot(r)<0}set(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this}setFromPointsAndIndices(t,e,i,r){return this.a.copy(t[e]),this.b.copy(t[i]),this.c.copy(t[r]),this}setFromAttributeAndIndices(t,e,i,r){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,i),this.c.fromBufferAttribute(t,r),this}clone(){return new this.constructor().copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return en.subVectors(this.c,this.b),In.subVectors(this.a,this.b),en.cross(In).length()*.5}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return Ti.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return Ti.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,i,r,a){return OA===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),OA=!0),Ti.getInterpolation(t,this.a,this.b,this.c,e,i,r,a)}getInterpolation(t,e,i,r,a){return Ti.getInterpolation(t,this.a,this.b,this.c,e,i,r,a)}containsPoint(t){return Ti.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return Ti.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const i=this.a,r=this.b,a=this.c;let f,o;Ss.subVectors(r,i),Es.subVectors(a,i),Hh.subVectors(t,i);const s=Ss.dot(Hh),l=Es.dot(Hh);if(s<=0&&l<=0)return e.copy(i);kh.subVectors(t,r);const u=Ss.dot(kh),A=Es.dot(kh);if(u>=0&&A<=u)return e.copy(r);const c=s*A-u*l;if(c<=0&&s>=0&&u<=0)return f=s/(s-u),e.copy(i).addScaledVector(Ss,f);Nh.subVectors(t,a);const h=Ss.dot(Nh),p=Es.dot(Nh);if(p>=0&&h<=p)return e.copy(a);const m=h*l-s*p;if(m<=0&&l>=0&&p<=0)return o=l/(l-p),e.copy(i).addScaledVector(Es,o);const d=u*p-h*A;if(d<=0&&A-u>=0&&h-p>=0)return yg.subVectors(a,r),o=(A-u)/(A-u+(h-p)),e.copy(r).addScaledVector(yg,o);const g=1/(d+m+c);return f=m*g,o=c*g,e.copy(i).addScaledVector(Ss,f).addScaledVector(Es,o)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}let sM=0;class Li extends Ha{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:sM++}),this.uuid=an(),this.name="",this.type="Material",this.blending=ha,this.side=Wn,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=K0,this.blendDst=X0,this.blendEquation=ta,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Ku,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=FE,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Eh,this.stencilZFail=Eh,this.stencilZPass=Eh,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(t!==void 0)for(const e in t){const i=t[e];if(i===void 0){console.warn(`THREE.Material: parameter '${e}' has value of undefined.`);continue}const r=this[e];if(r===void 0){console.warn(`THREE.Material: '${e}' is not a property of THREE.${this.type}.`);continue}r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[e]=i}}toJSON(t){const e=t===void 0||typeof t=="string";e&&(t={textures:{},images:{}});const i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(t).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(t).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(t).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(t).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(t).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(t).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(t).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(t).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(t).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==ha&&(i.blending=this.blending),this.side!==Wn&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(i.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=this.premultipliedAlpha),this.forceSinglePass===!0&&(i.forceSinglePass=this.forceSinglePass),this.wireframe===!0&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=this.flatShading),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function r(a){const f=[];for(const o in a){const s=a[o];delete s.metadata,f.push(s)}return f}if(e){const a=r(t.textures),f=r(t.images);a.length>0&&(i.textures=a),f.length>0&&(i.images=f)}return i}clone(){return new this.constructor().copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let i=null;if(e!==null){const r=e.length;i=new Array(r);for(let a=0;a!==r;++a)i[a]=e[a].clone()}return this.clippingPlanes=i,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){t===!0&&this.version++}}const ow={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},nn={h:0,s:0,l:0},QA={h:0,s:0,l:0};function Vh(n,t,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?n+(t-n)*6*e:e<1/2?t:e<2/3?n+(t-n)*6*(2/3-e):n}let Rt=class{constructor(t,e,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,e===void 0&&i===void 0?this.set(t):this.setRGB(t,e,i)}set(t){return t&&t.isColor?this.copy(t):typeof t=="number"?this.setHex(t):typeof t=="string"&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=pn){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,Bi.toWorkingColorSpace(this,e),this}setRGB(t,e,i,r=Bi.workingColorSpace){return this.r=t,this.g=e,this.b=i,Bi.toWorkingColorSpace(this,r),this}setHSL(t,e,i,r=Bi.workingColorSpace){if(t=ud(t,1),e=Je(e,0,1),i=Je(i,0,1),e===0)this.r=this.g=this.b=i;else{const a=i<=.5?i*(1+e):i+e-i*e,f=2*i-a;this.r=Vh(f,a,t+1/3),this.g=Vh(f,a,t),this.b=Vh(f,a,t-1/3)}return Bi.toWorkingColorSpace(this,r),this}setStyle(t,e=pn){function i(a){a!==void 0&&parseFloat(a)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(t)){let a;const f=r[1],o=r[2];switch(f){case"rgb":case"rgba":if(a=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(a[1],10))/255,this.g=Math.min(255,parseInt(a[2],10))/255,this.b=Math.min(255,parseInt(a[3],10))/255,Bi.toWorkingColorSpace(this,e),i(a[4]),this;if(a=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(a[1],10))/100,this.g=Math.min(100,parseInt(a[2],10))/100,this.b=Math.min(100,parseInt(a[3],10))/100,Bi.toWorkingColorSpace(this,e),i(a[4]),this;break;case"hsl":case"hsla":if(a=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o)){const s=parseFloat(a[1])/360,l=parseFloat(a[2])/100,u=parseFloat(a[3])/100;return i(a[4]),this.setHSL(s,l,u,e)}break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(t)){const a=r[1],f=a.length;if(f===3)return this.setRGB(parseInt(a.charAt(0),16)/15,parseInt(a.charAt(1),16)/15,parseInt(a.charAt(2),16)/15,e);if(f===6)return this.setHex(parseInt(a,16),e);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,e);return this}setColorName(t,e=pn){const i=ow[t.toLowerCase()];return i!==void 0?this.setHex(i,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=da(t.r),this.g=da(t.g),this.b=da(t.b),this}copyLinearToSRGB(t){return this.r=Fh(t.r),this.g=Fh(t.g),this.b=Fh(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=pn){return Bi.fromWorkingColorSpace(ii.copy(this),t),Je(ii.r*255,0,255)<<16^Je(ii.g*255,0,255)<<8^Je(ii.b*255,0,255)<<0}getHexString(t=pn){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=Bi.workingColorSpace){Bi.fromWorkingColorSpace(ii.copy(this),e);const i=ii.r,r=ii.g,a=ii.b,f=Math.max(i,r,a),o=Math.min(i,r,a);let s,l;const u=(o+f)/2;if(o===f)s=0,l=0;else{const A=f-o;switch(l=u<=.5?A/(f+o):A/(2-f-o),f){case i:s=(r-a)/A+(r<a?6:0);break;case r:s=(a-i)/A+2;break;case a:s=(i-r)/A+4;break}s/=6}return t.h=s,t.s=l,t.l=u,t}getRGB(t,e=Bi.workingColorSpace){return Bi.fromWorkingColorSpace(ii.copy(this),e),t.r=ii.r,t.g=ii.g,t.b=ii.b,t}getStyle(t=pn){Bi.fromWorkingColorSpace(ii.copy(this),t);const e=ii.r,i=ii.g,r=ii.b;return t!==pn?`color(${t} ${e.toFixed(3)} ${i.toFixed(3)} ${r.toFixed(3)})`:`rgb(${e*255|0},${i*255|0},${r*255|0})`}offsetHSL(t,e,i){return this.getHSL(nn),nn.h+=t,nn.s+=e,nn.l+=i,this.setHSL(nn.h,nn.s,nn.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,i){return this.r=t.r+(e.r-t.r)*i,this.g=t.g+(e.g-t.g)*i,this.b=t.b+(e.b-t.b)*i,this}lerpHSL(t,e){this.getHSL(nn),t.getHSL(QA);const i=Do(nn.h,QA.h,e),r=Do(nn.s,QA.s,e),a=Do(nn.l,QA.l,e);return this.setHSL(i,r,a),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const e=this.r,i=this.g,r=this.b,a=t.elements;return this.r=a[0]*e+a[3]*i+a[6]*r,this.g=a[1]*e+a[4]*i+a[7]*r,this.b=a[2]*e+a[5]*i+a[8]*r,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};const ii=new Rt;Rt.NAMES=ow;class vn extends Li{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Rt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Uc,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const Re=new H,RA=new xt;class Oe{constructor(t,e,i=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=e,this.count=t!==void 0?t.length/e:0,this.normalized=i,this.usage=$u,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this}copyAt(t,e,i){t*=this.itemSize,i*=e.itemSize;for(let r=0,a=this.itemSize;r<a;r++)this.array[t+r]=e.array[i+r];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(this.itemSize===2)for(let e=0,i=this.count;e<i;e++)RA.fromBufferAttribute(this,e),RA.applyMatrix3(t),this.setXY(e,RA.x,RA.y);else if(this.itemSize===3)for(let e=0,i=this.count;e<i;e++)Re.fromBufferAttribute(this,e),Re.applyMatrix3(t),this.setXYZ(e,Re.x,Re.y,Re.z);return this}applyMatrix4(t){for(let e=0,i=this.count;e<i;e++)Re.fromBufferAttribute(this,e),Re.applyMatrix4(t),this.setXYZ(e,Re.x,Re.y,Re.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)Re.fromBufferAttribute(this,e),Re.applyNormalMatrix(t),this.setXYZ(e,Re.x,Re.y,Re.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)Re.fromBufferAttribute(this,e),Re.transformDirection(t),this.setXYZ(e,Re.x,Re.y,Re.z);return this}set(t,e=0){return this.array.set(t,e),this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=Hn(e,this.array)),e}setX(t,e){return this.normalized&&(e=we(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=Hn(e,this.array)),e}setY(t,e){return this.normalized&&(e=we(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=Hn(e,this.array)),e}setZ(t,e){return this.normalized&&(e=we(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=Hn(e,this.array)),e}setW(t,e){return this.normalized&&(e=we(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,i){return t*=this.itemSize,this.normalized&&(e=we(e,this.array),i=we(i,this.array)),this.array[t+0]=e,this.array[t+1]=i,this}setXYZ(t,e,i,r){return t*=this.itemSize,this.normalized&&(e=we(e,this.array),i=we(i,this.array),r=we(r,this.array)),this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=r,this}setXYZW(t,e,i,r,a){return t*=this.itemSize,this.normalized&&(e=we(e,this.array),i=we(i,this.array),r=we(r,this.array),a=we(a,this.array)),this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=r,this.array[t+3]=a,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(t.name=this.name),this.usage!==$u&&(t.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(t.updateRange=this.updateRange),t}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class Aw extends Oe{constructor(t,e,i){super(new Uint16Array(t),e,i)}}class lw extends Oe{constructor(t,e,i){super(new Uint32Array(t),e,i)}}class Se extends Oe{constructor(t,e,i){super(new Float32Array(t),e,i)}}let aM=0;const ki=new Kt,zh=new ce,Ms=new H,Ei=new Qi,Za=new Qi,We=new H;class ke extends Ha{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:aM++}),this.uuid=an(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(iw(t)?lw:Aw)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,e,i=0){this.groups.push({start:t,count:e,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;e!==void 0&&(e.applyMatrix4(t),e.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const a=new ee().getNormalMatrix(t);i.applyNormalMatrix(a),i.needsUpdate=!0}const r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(t),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(t){return ki.makeRotationFromQuaternion(t),this.applyMatrix4(ki),this}rotateX(t){return ki.makeRotationX(t),this.applyMatrix4(ki),this}rotateY(t){return ki.makeRotationY(t),this.applyMatrix4(ki),this}rotateZ(t){return ki.makeRotationZ(t),this.applyMatrix4(ki),this}translate(t,e,i){return ki.makeTranslation(t,e,i),this.applyMatrix4(ki),this}scale(t,e,i){return ki.makeScale(t,e,i),this.applyMatrix4(ki),this}lookAt(t){return zh.lookAt(t),zh.updateMatrix(),this.applyMatrix4(zh.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ms).negate(),this.translate(Ms.x,Ms.y,Ms.z),this}setFromPoints(t){const e=[];for(let i=0,r=t.length;i<r;i++){const a=t[i];e.push(a.x,a.y,a.z||0)}return this.setAttribute("position",new Se(e,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Qi);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new H(-1/0,-1/0,-1/0),new H(1/0,1/0,1/0));return}if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),e)for(let i=0,r=e.length;i<r;i++){const a=e[i];Ei.setFromBufferAttribute(a),this.morphTargetsRelative?(We.addVectors(this.boundingBox.min,Ei.min),this.boundingBox.expandByPoint(We),We.addVectors(this.boundingBox.max,Ei.max),this.boundingBox.expandByPoint(We)):(this.boundingBox.expandByPoint(Ei.min),this.boundingBox.expandByPoint(Ei.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Cn);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new H,1/0);return}if(t){const i=this.boundingSphere.center;if(Ei.setFromBufferAttribute(t),e)for(let a=0,f=e.length;a<f;a++){const o=e[a];Za.setFromBufferAttribute(o),this.morphTargetsRelative?(We.addVectors(Ei.min,Za.min),Ei.expandByPoint(We),We.addVectors(Ei.max,Za.max),Ei.expandByPoint(We)):(Ei.expandByPoint(Za.min),Ei.expandByPoint(Za.max))}Ei.getCenter(i);let r=0;for(let a=0,f=t.count;a<f;a++)We.fromBufferAttribute(t,a),r=Math.max(r,i.distanceToSquared(We));if(e)for(let a=0,f=e.length;a<f;a++){const o=e[a],s=this.morphTargetsRelative;for(let l=0,u=o.count;l<u;l++)We.fromBufferAttribute(o,l),s&&(Ms.fromBufferAttribute(t,l),We.add(Ms)),r=Math.max(r,i.distanceToSquared(We))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(t===null||e.position===void 0||e.normal===void 0||e.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=t.array,r=e.position.array,a=e.normal.array,f=e.uv.array,o=r.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Oe(new Float32Array(4*o),4));const s=this.getAttribute("tangent").array,l=[],u=[];for(let M=0;M<o;M++)l[M]=new H,u[M]=new H;const A=new H,c=new H,h=new H,p=new xt,m=new xt,d=new xt,g=new H,v=new H;function w(M,z,G){A.fromArray(r,M*3),c.fromArray(r,z*3),h.fromArray(r,G*3),p.fromArray(f,M*2),m.fromArray(f,z*2),d.fromArray(f,G*2),c.sub(A),h.sub(A),m.sub(p),d.sub(p);const P=1/(m.x*d.y-d.x*m.y);isFinite(P)&&(g.copy(c).multiplyScalar(d.y).addScaledVector(h,-m.y).multiplyScalar(P),v.copy(h).multiplyScalar(m.x).addScaledVector(c,-d.x).multiplyScalar(P),l[M].add(g),l[z].add(g),l[G].add(g),u[M].add(v),u[z].add(v),u[G].add(v))}let _=this.groups;_.length===0&&(_=[{start:0,count:i.length}]);for(let M=0,z=_.length;M<z;++M){const G=_[M],P=G.start,R=G.count;for(let W=P,K=P+R;W<K;W+=3)w(i[W+0],i[W+1],i[W+2])}const y=new H,C=new H,b=new H,S=new H;function B(M){b.fromArray(a,M*3),S.copy(b);const z=l[M];y.copy(z),y.sub(b.multiplyScalar(b.dot(z))).normalize(),C.crossVectors(S,z);const P=C.dot(u[M])<0?-1:1;s[M*4]=y.x,s[M*4+1]=y.y,s[M*4+2]=y.z,s[M*4+3]=P}for(let M=0,z=_.length;M<z;++M){const G=_[M],P=G.start,R=G.count;for(let W=P,K=P+R;W<K;W+=3)B(i[W+0]),B(i[W+1]),B(i[W+2])}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(e!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new Oe(new Float32Array(e.count*3),3),this.setAttribute("normal",i);else for(let c=0,h=i.count;c<h;c++)i.setXYZ(c,0,0,0);const r=new H,a=new H,f=new H,o=new H,s=new H,l=new H,u=new H,A=new H;if(t)for(let c=0,h=t.count;c<h;c+=3){const p=t.getX(c+0),m=t.getX(c+1),d=t.getX(c+2);r.fromBufferAttribute(e,p),a.fromBufferAttribute(e,m),f.fromBufferAttribute(e,d),u.subVectors(f,a),A.subVectors(r,a),u.cross(A),o.fromBufferAttribute(i,p),s.fromBufferAttribute(i,m),l.fromBufferAttribute(i,d),o.add(u),s.add(u),l.add(u),i.setXYZ(p,o.x,o.y,o.z),i.setXYZ(m,s.x,s.y,s.z),i.setXYZ(d,l.x,l.y,l.z)}else for(let c=0,h=e.count;c<h;c+=3)r.fromBufferAttribute(e,c+0),a.fromBufferAttribute(e,c+1),f.fromBufferAttribute(e,c+2),u.subVectors(f,a),A.subVectors(r,a),u.cross(A),i.setXYZ(c+0,u.x,u.y,u.z),i.setXYZ(c+1,u.x,u.y,u.z),i.setXYZ(c+2,u.x,u.y,u.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeGeometries() instead."),this}normalizeNormals(){const t=this.attributes.normal;for(let e=0,i=t.count;e<i;e++)We.fromBufferAttribute(t,e),We.normalize(),t.setXYZ(e,We.x,We.y,We.z)}toNonIndexed(){function t(o,s){const l=o.array,u=o.itemSize,A=o.normalized,c=new l.constructor(s.length*u);let h=0,p=0;for(let m=0,d=s.length;m<d;m++){o.isInterleavedBufferAttribute?h=s[m]*o.data.stride+o.offset:h=s[m]*u;for(let g=0;g<u;g++)c[p++]=l[h++]}return new Oe(c,u,A)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new ke,i=this.index.array,r=this.attributes;for(const o in r){const s=r[o],l=t(s,i);e.setAttribute(o,l)}const a=this.morphAttributes;for(const o in a){const s=[],l=a[o];for(let u=0,A=l.length;u<A;u++){const c=l[u],h=t(c,i);s.push(h)}e.morphAttributes[o]=s}e.morphTargetsRelative=this.morphTargetsRelative;const f=this.groups;for(let o=0,s=f.length;o<s;o++){const l=f[o];e.addGroup(l.start,l.count,l.materialIndex)}return e}toJSON(){const t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){const s=this.parameters;for(const l in s)s[l]!==void 0&&(t[l]=s[l]);return t}t.data={attributes:{}};const e=this.index;e!==null&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const i=this.attributes;for(const s in i){const l=i[s];t.data.attributes[s]=l.toJSON(t.data)}const r={};let a=!1;for(const s in this.morphAttributes){const l=this.morphAttributes[s],u=[];for(let A=0,c=l.length;A<c;A++){const h=l[A];u.push(h.toJSON(t.data))}u.length>0&&(r[s]=u,a=!0)}a&&(t.data.morphAttributes=r,t.data.morphTargetsRelative=this.morphTargetsRelative);const f=this.groups;f.length>0&&(t.data.groups=JSON.parse(JSON.stringify(f)));const o=this.boundingSphere;return o!==null&&(t.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),t}clone(){return new this.constructor().copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const i=t.index;i!==null&&this.setIndex(i.clone(e));const r=t.attributes;for(const l in r){const u=r[l];this.setAttribute(l,u.clone(e))}const a=t.morphAttributes;for(const l in a){const u=[],A=a[l];for(let c=0,h=A.length;c<h;c++)u.push(A[c].clone(e));this.morphAttributes[l]=u}this.morphTargetsRelative=t.morphTargetsRelative;const f=t.groups;for(let l=0,u=f.length;l<u;l++){const A=f[l];this.addGroup(A.start,A.count,A.materialIndex)}const o=t.boundingBox;o!==null&&(this.boundingBox=o.clone());const s=t.boundingSphere;return s!==null&&(this.boundingSphere=s.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const xg=new Kt,un=new Dc,HA=new Cn,Cg=new H,Ts=new H,Fs=new H,Us=new H,Gh=new H,kA=new H,NA=new xt,VA=new xt,zA=new xt,bg=new H,Bg=new H,Sg=new H,GA=new H,WA=new H;class yt extends ce{constructor(t=new ke,e=new vn){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),t.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),t.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,i=Object.keys(e);if(i.length>0){const r=e[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let a=0,f=r.length;a<f;a++){const o=r[a].name||String(a);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=a}}}}getVertexPosition(t,e){const i=this.geometry,r=i.attributes.position,a=i.morphAttributes.position,f=i.morphTargetsRelative;e.fromBufferAttribute(r,t);const o=this.morphTargetInfluences;if(a&&o){kA.set(0,0,0);for(let s=0,l=a.length;s<l;s++){const u=o[s],A=a[s];u!==0&&(Gh.fromBufferAttribute(A,t),f?kA.addScaledVector(Gh,u):kA.addScaledVector(Gh.sub(e),u))}e.add(kA)}return this.isSkinnedMesh&&this.applyBoneTransform(t,e),e}raycast(t,e){const i=this.geometry,r=this.material,a=this.matrixWorld;if(r===void 0||(i.boundingSphere===null&&i.computeBoundingSphere(),HA.copy(i.boundingSphere),HA.applyMatrix4(a),un.copy(t.ray).recast(t.near),HA.containsPoint(un.origin)===!1&&(un.intersectSphere(HA,Cg)===null||un.origin.distanceToSquared(Cg)>(t.far-t.near)**2))||(xg.copy(a).invert(),un.copy(t.ray).applyMatrix4(xg),i.boundingBox!==null&&un.intersectsBox(i.boundingBox)===!1))return;let f;const o=i.index,s=i.attributes.position,l=i.attributes.uv,u=i.attributes.uv2,A=i.attributes.normal,c=i.groups,h=i.drawRange;if(o!==null)if(Array.isArray(r))for(let p=0,m=c.length;p<m;p++){const d=c[p],g=r[d.materialIndex],v=Math.max(d.start,h.start),w=Math.min(o.count,Math.min(d.start+d.count,h.start+h.count));for(let _=v,y=w;_<y;_+=3){const C=o.getX(_),b=o.getX(_+1),S=o.getX(_+2);f=KA(this,g,t,un,l,u,A,C,b,S),f&&(f.faceIndex=Math.floor(_/3),f.face.materialIndex=d.materialIndex,e.push(f))}}else{const p=Math.max(0,h.start),m=Math.min(o.count,h.start+h.count);for(let d=p,g=m;d<g;d+=3){const v=o.getX(d),w=o.getX(d+1),_=o.getX(d+2);f=KA(this,r,t,un,l,u,A,v,w,_),f&&(f.faceIndex=Math.floor(d/3),e.push(f))}}else if(s!==void 0)if(Array.isArray(r))for(let p=0,m=c.length;p<m;p++){const d=c[p],g=r[d.materialIndex],v=Math.max(d.start,h.start),w=Math.min(s.count,Math.min(d.start+d.count,h.start+h.count));for(let _=v,y=w;_<y;_+=3){const C=_,b=_+1,S=_+2;f=KA(this,g,t,un,l,u,A,C,b,S),f&&(f.faceIndex=Math.floor(_/3),f.face.materialIndex=d.materialIndex,e.push(f))}}else{const p=Math.max(0,h.start),m=Math.min(s.count,h.start+h.count);for(let d=p,g=m;d<g;d+=3){const v=d,w=d+1,_=d+2;f=KA(this,r,t,un,l,u,A,v,w,_),f&&(f.faceIndex=Math.floor(d/3),e.push(f))}}}}function oM(n,t,e,i,r,a,f,o){let s;if(t.side===yi?s=i.intersectTriangle(f,a,r,!0,o):s=i.intersectTriangle(r,a,f,t.side===Wn,o),s===null)return null;WA.copy(o),WA.applyMatrix4(n.matrixWorld);const l=e.ray.origin.distanceTo(WA);return l<e.near||l>e.far?null:{distance:l,point:WA.clone(),object:n}}function KA(n,t,e,i,r,a,f,o,s,l){n.getVertexPosition(o,Ts),n.getVertexPosition(s,Fs),n.getVertexPosition(l,Us);const u=oM(n,t,e,i,Ts,Fs,Us,GA);if(u){r&&(NA.fromBufferAttribute(r,o),VA.fromBufferAttribute(r,s),zA.fromBufferAttribute(r,l),u.uv=Ti.getInterpolation(GA,Ts,Fs,Us,NA,VA,zA,new xt)),a&&(NA.fromBufferAttribute(a,o),VA.fromBufferAttribute(a,s),zA.fromBufferAttribute(a,l),u.uv2=Ti.getInterpolation(GA,Ts,Fs,Us,NA,VA,zA,new xt)),f&&(bg.fromBufferAttribute(f,o),Bg.fromBufferAttribute(f,s),Sg.fromBufferAttribute(f,l),u.normal=Ti.getInterpolation(GA,Ts,Fs,Us,bg,Bg,Sg,new H),u.normal.dot(i.direction)>0&&u.normal.multiplyScalar(-1));const A={a:o,b:s,c:l,normal:new H,materialIndex:0};Ti.getNormal(Ts,Fs,Us,A.normal),u.face=A}return u}class Te extends ke{constructor(t=1,e=1,i=1,r=1,a=1,f=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:i,widthSegments:r,heightSegments:a,depthSegments:f};const o=this;r=Math.floor(r),a=Math.floor(a),f=Math.floor(f);const s=[],l=[],u=[],A=[];let c=0,h=0;p("z","y","x",-1,-1,i,e,t,f,a,0),p("z","y","x",1,-1,i,e,-t,f,a,1),p("x","z","y",1,1,t,i,e,r,f,2),p("x","z","y",1,-1,t,i,-e,r,f,3),p("x","y","z",1,-1,t,e,i,r,a,4),p("x","y","z",-1,-1,t,e,-i,r,a,5),this.setIndex(s),this.setAttribute("position",new Se(l,3)),this.setAttribute("normal",new Se(u,3)),this.setAttribute("uv",new Se(A,2));function p(m,d,g,v,w,_,y,C,b,S,B){const M=_/b,z=y/S,G=_/2,P=y/2,R=C/2,W=b+1,K=S+1;let tt=0,j=0;const E=new H;for(let I=0;I<K;I++){const Q=I*z-P;for(let D=0;D<W;D++){const k=D*M-G;E[m]=k*v,E[d]=Q*w,E[g]=R,l.push(E.x,E.y,E.z),E[m]=0,E[d]=0,E[g]=C>0?1:-1,u.push(E.x,E.y,E.z),A.push(D/b),A.push(1-I/S),tt+=1}}for(let I=0;I<S;I++)for(let Q=0;Q<b;Q++){const D=c+Q+W*I,k=c+Q+W*(I+1),U=c+(Q+1)+W*(I+1),T=c+(Q+1)+W*I;s.push(D,k,T),s.push(k,U,T),j+=6}o.addGroup(h,j,B),h+=j,c+=tt}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Te(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function Ta(n){const t={};for(const e in n){t[e]={};for(const i in n[e]){const r=n[e][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[e][i]=null):t[e][i]=r.clone():Array.isArray(r)?t[e][i]=r.slice():t[e][i]=r}}return t}function ci(n){const t={};for(let e=0;e<n.length;e++){const i=Ta(n[e]);for(const r in i)t[r]=i[r]}return t}function AM(n){const t=[];for(let e=0;e<n.length;e++)t.push(n[e].clone());return t}function cw(n){return n.getRenderTarget()===null&&n.outputEncoding===le?pn:Go}const lM={clone:Ta,merge:ci};var cM=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,hM=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Kn extends Li{constructor(t){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=cM,this.fragmentShader=hM,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,t!==void 0&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=Ta(t.uniforms),this.uniformsGroups=AM(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const r in this.uniforms){const f=this.uniforms[r].value;f&&f.isTexture?e.uniforms[r]={type:"t",value:f.toJSON(t).uuid}:f&&f.isColor?e.uniforms[r]={type:"c",value:f.getHex()}:f&&f.isVector2?e.uniforms[r]={type:"v2",value:f.toArray()}:f&&f.isVector3?e.uniforms[r]={type:"v3",value:f.toArray()}:f&&f.isVector4?e.uniforms[r]={type:"v4",value:f.toArray()}:f&&f.isMatrix3?e.uniforms[r]={type:"m3",value:f.toArray()}:f&&f.isMatrix4?e.uniforms[r]={type:"m4",value:f.toArray()}:e.uniforms[r]={value:f}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;const i={};for(const r in this.extensions)this.extensions[r]===!0&&(i[r]=!0);return Object.keys(i).length>0&&(e.extensions=i),e}}class hw extends ce{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Kt,this.projectionMatrix=new Kt,this.projectionMatrixInverse=new Kt}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class ui extends hw{constructor(t=50,e=1,i=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=t.view===null?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=Ma*2*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(fa*.5*this.fov);return .5*this.getFilmHeight()/t}getEffectiveFOV(){return Ma*2*Math.atan(Math.tan(fa*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,e,i,r,a,f){this.aspect=t/e,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=r,this.view.width=a,this.view.height=f,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(fa*.5*this.fov)/this.zoom,i=2*e,r=this.aspect*i,a=-.5*r;const f=this.view;if(this.view!==null&&this.view.enabled){const s=f.fullWidth,l=f.fullHeight;a+=f.offsetX*r/s,e-=f.offsetY*i/l,r*=f.width/s,i*=f.height/l}const o=this.filmOffset;o!==0&&(a+=t*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(a,a+r,e,e-i,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,this.view!==null&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}const Ls=-90,Is=1;class uM extends ce{constructor(t,e,i){super(),this.type="CubeCamera",this.renderTarget=i;const r=new ui(Ls,Is,t,e);r.layers=this.layers,r.up.set(0,1,0),r.lookAt(1,0,0),this.add(r);const a=new ui(Ls,Is,t,e);a.layers=this.layers,a.up.set(0,1,0),a.lookAt(-1,0,0),this.add(a);const f=new ui(Ls,Is,t,e);f.layers=this.layers,f.up.set(0,0,-1),f.lookAt(0,1,0),this.add(f);const o=new ui(Ls,Is,t,e);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(0,-1,0),this.add(o);const s=new ui(Ls,Is,t,e);s.layers=this.layers,s.up.set(0,1,0),s.lookAt(0,0,1),this.add(s);const l=new ui(Ls,Is,t,e);l.layers=this.layers,l.up.set(0,1,0),l.lookAt(0,0,-1),this.add(l)}update(t,e){this.parent===null&&this.updateMatrixWorld();const i=this.renderTarget,[r,a,f,o,s,l]=this.children,u=t.getRenderTarget(),A=t.toneMapping,c=t.xr.enabled;t.toneMapping=Vn,t.xr.enabled=!1;const h=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,t.setRenderTarget(i,0),t.render(e,r),t.setRenderTarget(i,1),t.render(e,a),t.setRenderTarget(i,2),t.render(e,f),t.setRenderTarget(i,3),t.render(e,o),t.setRenderTarget(i,4),t.render(e,s),i.texture.generateMipmaps=h,t.setRenderTarget(i,5),t.render(e,l),t.setRenderTarget(u),t.toneMapping=A,t.xr.enabled=c,i.texture.needsPMREMUpdate=!0}}class uw extends je{constructor(t,e,i,r,a,f,o,s,l,u){t=t!==void 0?t:[],e=e!==void 0?e:Ca,super(t,e,i,r,a,f,o,s,l,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}class fM extends xr{constructor(t=1,e={}){super(t,t,e),this.isWebGLCubeRenderTarget=!0;const i={width:t,height:t,depth:1},r=[i,i,i,i,i,i];this.texture=new uw(r,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=e.generateMipmaps!==void 0?e.generateMipmaps:!1,this.texture.minFilter=e.minFilter!==void 0?e.minFilter:vi}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.encoding=e.encoding,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new Te(5,5,5),a=new Kn({name:"CubemapFromEquirect",uniforms:Ta(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:yi,blending:gr});a.uniforms.tEquirect.value=e;const f=new yt(r,a),o=e.minFilter;return e.minFilter===As&&(e.minFilter=vi),new uM(1,10,this).update(t,f),e.minFilter=o,f.geometry.dispose(),f.material.dispose(),this}clear(t,e,i,r){const a=t.getRenderTarget();for(let f=0;f<6;f++)t.setRenderTarget(this,f),t.clear(e,i,r);t.setRenderTarget(a)}}const Wh=new H,dM=new H,pM=new ee;class Fi{constructor(t=new H(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,i,r){return this.normal.set(t,e,i),this.constant=r,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,i){const r=Wh.subVectors(i,e).cross(dM.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(r,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,e){const i=t.delta(Wh),r=this.normal.dot(i);if(r===0)return this.distanceToPoint(t.start)===0?e.copy(t.start):null;const a=-(t.start.dot(this.normal)+this.constant)/r;return a<0||a>1?null:e.copy(t.start).addScaledVector(i,a)}intersectsLine(t){const e=this.distanceToPoint(t.start),i=this.distanceToPoint(t.end);return e<0&&i>0||i<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const i=e||pM.getNormalMatrix(t),r=this.coplanarPoint(Wh).applyMatrix4(t),a=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(a),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Or=new Cn,XA=new H;class dd{constructor(t=new Fi,e=new Fi,i=new Fi,r=new Fi,a=new Fi,f=new Fi){this.planes=[t,e,i,r,a,f]}set(t,e,i,r,a,f){const o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(i),o[3].copy(r),o[4].copy(a),o[5].copy(f),this}copy(t){const e=this.planes;for(let i=0;i<6;i++)e[i].copy(t.planes[i]);return this}setFromProjectionMatrix(t){const e=this.planes,i=t.elements,r=i[0],a=i[1],f=i[2],o=i[3],s=i[4],l=i[5],u=i[6],A=i[7],c=i[8],h=i[9],p=i[10],m=i[11],d=i[12],g=i[13],v=i[14],w=i[15];return e[0].setComponents(o-r,A-s,m-c,w-d).normalize(),e[1].setComponents(o+r,A+s,m+c,w+d).normalize(),e[2].setComponents(o+a,A+l,m+h,w+g).normalize(),e[3].setComponents(o-a,A-l,m-h,w-g).normalize(),e[4].setComponents(o-f,A-u,m-p,w-v).normalize(),e[5].setComponents(o+f,A+u,m+p,w+v).normalize(),this}intersectsObject(t){if(t.boundingSphere!==void 0)t.boundingSphere===null&&t.computeBoundingSphere(),Or.copy(t.boundingSphere).applyMatrix4(t.matrixWorld);else{const e=t.geometry;e.boundingSphere===null&&e.computeBoundingSphere(),Or.copy(e.boundingSphere).applyMatrix4(t.matrixWorld)}return this.intersectsSphere(Or)}intersectsSprite(t){return Or.center.set(0,0,0),Or.radius=.7071067811865476,Or.applyMatrix4(t.matrixWorld),this.intersectsSphere(Or)}intersectsSphere(t){const e=this.planes,i=t.center,r=-t.radius;for(let a=0;a<6;a++)if(e[a].distanceToPoint(i)<r)return!1;return!0}intersectsBox(t){const e=this.planes;for(let i=0;i<6;i++){const r=e[i];if(XA.x=r.normal.x>0?t.max.x:t.min.x,XA.y=r.normal.y>0?t.max.y:t.min.y,XA.z=r.normal.z>0?t.max.z:t.min.z,r.distanceToPoint(XA)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let i=0;i<6;i++)if(e[i].distanceToPoint(t)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function fw(){let n=null,t=!1,e=null,i=null;function r(a,f){e(a,f),i=n.requestAnimationFrame(r)}return{start:function(){t!==!0&&e!==null&&(i=n.requestAnimationFrame(r),t=!0)},stop:function(){n.cancelAnimationFrame(i),t=!1},setAnimationLoop:function(a){e=a},setContext:function(a){n=a}}}function gM(n,t){const e=t.isWebGL2,i=new WeakMap;function r(l,u){const A=l.array,c=l.usage,h=n.createBuffer();n.bindBuffer(u,h),n.bufferData(u,A,c),l.onUploadCallback();let p;if(A instanceof Float32Array)p=5126;else if(A instanceof Uint16Array)if(l.isFloat16BufferAttribute)if(e)p=5131;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else p=5123;else if(A instanceof Int16Array)p=5122;else if(A instanceof Uint32Array)p=5125;else if(A instanceof Int32Array)p=5124;else if(A instanceof Int8Array)p=5120;else if(A instanceof Uint8Array)p=5121;else if(A instanceof Uint8ClampedArray)p=5121;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+A);return{buffer:h,type:p,bytesPerElement:A.BYTES_PER_ELEMENT,version:l.version}}function a(l,u,A){const c=u.array,h=u.updateRange;n.bindBuffer(A,l),h.count===-1?n.bufferSubData(A,0,c):(e?n.bufferSubData(A,h.offset*c.BYTES_PER_ELEMENT,c,h.offset,h.count):n.bufferSubData(A,h.offset*c.BYTES_PER_ELEMENT,c.subarray(h.offset,h.offset+h.count)),h.count=-1),u.onUploadCallback()}function f(l){return l.isInterleavedBufferAttribute&&(l=l.data),i.get(l)}function o(l){l.isInterleavedBufferAttribute&&(l=l.data);const u=i.get(l);u&&(n.deleteBuffer(u.buffer),i.delete(l))}function s(l,u){if(l.isGLBufferAttribute){const c=i.get(l);(!c||c.version<l.version)&&i.set(l,{buffer:l.buffer,type:l.type,bytesPerElement:l.elementSize,version:l.version});return}l.isInterleavedBufferAttribute&&(l=l.data);const A=i.get(l);A===void 0?i.set(l,r(l,u)):A.version<l.version&&(a(A.buffer,l,u),A.version=l.version)}return{get:f,remove:o,update:s}}class Fa extends ke{constructor(t=1,e=1,i=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:i,heightSegments:r};const a=t/2,f=e/2,o=Math.floor(i),s=Math.floor(r),l=o+1,u=s+1,A=t/o,c=e/s,h=[],p=[],m=[],d=[];for(let g=0;g<u;g++){const v=g*c-f;for(let w=0;w<l;w++){const _=w*A-a;p.push(_,-v,0),m.push(0,0,1),d.push(w/o),d.push(1-g/s)}}for(let g=0;g<s;g++)for(let v=0;v<o;v++){const w=v+l*g,_=v+l*(g+1),y=v+1+l*(g+1),C=v+1+l*g;h.push(w,_,C),h.push(_,y,C)}this.setIndex(h),this.setAttribute("position",new Se(p,3)),this.setAttribute("normal",new Se(m,3)),this.setAttribute("uv",new Se(d,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Fa(t.width,t.height,t.widthSegments,t.heightSegments)}}var mM=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,vM=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,wM=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,_M=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,yM=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,xM=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,CM="vec3 transformed = vec3( position );",bM=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,BM=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,SM=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,EM=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,MM=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,TM=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,FM=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,UM=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,LM=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,IM=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,DM=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,PM=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,OM=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,QM=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,RM=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,HM=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,kM=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,NM=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,VM=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,zM="gl_FragColor = linearToOutputTexel( gl_FragColor );",GM=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,WM=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,KM=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,XM=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,jM=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,YM=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,qM=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,$M=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,JM=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,ZM=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,tT=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,eT=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,iT=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,nT=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,rT=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,sT=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,aT=`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,oT=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,AT=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,lT=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,cT=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,hT=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif`,uT=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,fT=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,dT=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,pT=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,gT=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,mT=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,vT=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,wT=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,_T=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,yT=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,xT=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,CT=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,bT=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,BT=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,ST=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,ET=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,MT=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,TT=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,FT=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#ifdef USE_NORMALMAP_TANGENTSPACE
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal, vNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 geometryNormal = normal;`,UT=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,LT=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,IT=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,DT=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,PT=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,OT=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,QT=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,RT=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,HT=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,kT=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,NT=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,VT=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,zT=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,GT=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,WT=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,KT=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,XT=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,jT=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,YT=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,qT=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,$T=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,JT=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,ZT=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,t1=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,e1=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,i1=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,n1=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,r1=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,s1=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,a1=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
#endif`,o1=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, vec2 fullSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		
		vec2 lodFudge = pow( 1.95, lod ) / fullSize;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec2 fullSize = vec2( textureSize( sampler, 0 ) );
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), fullSize, floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), fullSize, ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,A1=`#ifdef USE_UV
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,l1=`#ifdef USE_UV
	varying vec2 vUv;
#endif
#ifdef USE_UV2
	attribute vec2 uv2;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,c1=`#ifdef USE_UV
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,h1=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const u1=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,f1=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,d1=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,p1=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,g1=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,m1=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,v1=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,w1=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,_1=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,y1=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,x1=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,C1=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,b1=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,B1=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,S1=`#include <common>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,E1=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,M1=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,T1=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,F1=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,U1=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,L1=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,I1=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,D1=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,P1=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,O1=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,Q1=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,R1=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,H1=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,k1=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,N1=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,V1=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,z1=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,G1=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,W1=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,jt={alphamap_fragment:mM,alphamap_pars_fragment:vM,alphatest_fragment:wM,alphatest_pars_fragment:_M,aomap_fragment:yM,aomap_pars_fragment:xM,begin_vertex:CM,beginnormal_vertex:bM,bsdfs:BM,iridescence_fragment:SM,bumpmap_pars_fragment:EM,clipping_planes_fragment:MM,clipping_planes_pars_fragment:TM,clipping_planes_pars_vertex:FM,clipping_planes_vertex:UM,color_fragment:LM,color_pars_fragment:IM,color_pars_vertex:DM,color_vertex:PM,common:OM,cube_uv_reflection_fragment:QM,defaultnormal_vertex:RM,displacementmap_pars_vertex:HM,displacementmap_vertex:kM,emissivemap_fragment:NM,emissivemap_pars_fragment:VM,encodings_fragment:zM,encodings_pars_fragment:GM,envmap_fragment:WM,envmap_common_pars_fragment:KM,envmap_pars_fragment:XM,envmap_pars_vertex:jM,envmap_physical_pars_fragment:aT,envmap_vertex:YM,fog_vertex:qM,fog_pars_vertex:$M,fog_fragment:JM,fog_pars_fragment:ZM,gradientmap_pars_fragment:tT,lightmap_fragment:eT,lightmap_pars_fragment:iT,lights_lambert_fragment:nT,lights_lambert_pars_fragment:rT,lights_pars_begin:sT,lights_toon_fragment:oT,lights_toon_pars_fragment:AT,lights_phong_fragment:lT,lights_phong_pars_fragment:cT,lights_physical_fragment:hT,lights_physical_pars_fragment:uT,lights_fragment_begin:fT,lights_fragment_maps:dT,lights_fragment_end:pT,logdepthbuf_fragment:gT,logdepthbuf_pars_fragment:mT,logdepthbuf_pars_vertex:vT,logdepthbuf_vertex:wT,map_fragment:_T,map_pars_fragment:yT,map_particle_fragment:xT,map_particle_pars_fragment:CT,metalnessmap_fragment:bT,metalnessmap_pars_fragment:BT,morphcolor_vertex:ST,morphnormal_vertex:ET,morphtarget_pars_vertex:MT,morphtarget_vertex:TT,normal_fragment_begin:FT,normal_fragment_maps:UT,normal_pars_fragment:LT,normal_pars_vertex:IT,normal_vertex:DT,normalmap_pars_fragment:PT,clearcoat_normal_fragment_begin:OT,clearcoat_normal_fragment_maps:QT,clearcoat_pars_fragment:RT,iridescence_pars_fragment:HT,output_fragment:kT,packing:NT,premultiplied_alpha_fragment:VT,project_vertex:zT,dithering_fragment:GT,dithering_pars_fragment:WT,roughnessmap_fragment:KT,roughnessmap_pars_fragment:XT,shadowmap_pars_fragment:jT,shadowmap_pars_vertex:YT,shadowmap_vertex:qT,shadowmask_pars_fragment:$T,skinbase_vertex:JT,skinning_pars_vertex:ZT,skinning_vertex:t1,skinnormal_vertex:e1,specularmap_fragment:i1,specularmap_pars_fragment:n1,tonemapping_fragment:r1,tonemapping_pars_fragment:s1,transmission_fragment:a1,transmission_pars_fragment:o1,uv_pars_fragment:A1,uv_pars_vertex:l1,uv_vertex:c1,worldpos_vertex:h1,background_vert:u1,background_frag:f1,backgroundCube_vert:d1,backgroundCube_frag:p1,cube_vert:g1,cube_frag:m1,depth_vert:v1,depth_frag:w1,distanceRGBA_vert:_1,distanceRGBA_frag:y1,equirect_vert:x1,equirect_frag:C1,linedashed_vert:b1,linedashed_frag:B1,meshbasic_vert:S1,meshbasic_frag:E1,meshlambert_vert:M1,meshlambert_frag:T1,meshmatcap_vert:F1,meshmatcap_frag:U1,meshnormal_vert:L1,meshnormal_frag:I1,meshphong_vert:D1,meshphong_frag:P1,meshphysical_vert:O1,meshphysical_frag:Q1,meshtoon_vert:R1,meshtoon_frag:H1,points_vert:k1,points_frag:N1,shadow_vert:V1,shadow_frag:z1,sprite_vert:G1,sprite_frag:W1},Bt={common:{diffuse:{value:new Rt(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new ee},alphaMap:{value:null},alphaMapTransform:{value:new ee},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new ee}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new ee}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new ee}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new ee},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new ee},normalScale:{value:new xt(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new ee},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new ee}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new ee}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new ee}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Rt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Rt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new ee}},sprite:{diffuse:{value:new Rt(16777215)},opacity:{value:1},center:{value:new xt(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new ee},alphaMap:{value:null},alphaTest:{value:0}}},gn={basic:{uniforms:ci([Bt.common,Bt.specularmap,Bt.envmap,Bt.aomap,Bt.lightmap,Bt.fog]),vertexShader:jt.meshbasic_vert,fragmentShader:jt.meshbasic_frag},lambert:{uniforms:ci([Bt.common,Bt.specularmap,Bt.envmap,Bt.aomap,Bt.lightmap,Bt.emissivemap,Bt.bumpmap,Bt.normalmap,Bt.displacementmap,Bt.fog,Bt.lights,{emissive:{value:new Rt(0)}}]),vertexShader:jt.meshlambert_vert,fragmentShader:jt.meshlambert_frag},phong:{uniforms:ci([Bt.common,Bt.specularmap,Bt.envmap,Bt.aomap,Bt.lightmap,Bt.emissivemap,Bt.bumpmap,Bt.normalmap,Bt.displacementmap,Bt.fog,Bt.lights,{emissive:{value:new Rt(0)},specular:{value:new Rt(1118481)},shininess:{value:30}}]),vertexShader:jt.meshphong_vert,fragmentShader:jt.meshphong_frag},standard:{uniforms:ci([Bt.common,Bt.envmap,Bt.aomap,Bt.lightmap,Bt.emissivemap,Bt.bumpmap,Bt.normalmap,Bt.displacementmap,Bt.roughnessmap,Bt.metalnessmap,Bt.fog,Bt.lights,{emissive:{value:new Rt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:jt.meshphysical_vert,fragmentShader:jt.meshphysical_frag},toon:{uniforms:ci([Bt.common,Bt.aomap,Bt.lightmap,Bt.emissivemap,Bt.bumpmap,Bt.normalmap,Bt.displacementmap,Bt.gradientmap,Bt.fog,Bt.lights,{emissive:{value:new Rt(0)}}]),vertexShader:jt.meshtoon_vert,fragmentShader:jt.meshtoon_frag},matcap:{uniforms:ci([Bt.common,Bt.bumpmap,Bt.normalmap,Bt.displacementmap,Bt.fog,{matcap:{value:null}}]),vertexShader:jt.meshmatcap_vert,fragmentShader:jt.meshmatcap_frag},points:{uniforms:ci([Bt.points,Bt.fog]),vertexShader:jt.points_vert,fragmentShader:jt.points_frag},dashed:{uniforms:ci([Bt.common,Bt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:jt.linedashed_vert,fragmentShader:jt.linedashed_frag},depth:{uniforms:ci([Bt.common,Bt.displacementmap]),vertexShader:jt.depth_vert,fragmentShader:jt.depth_frag},normal:{uniforms:ci([Bt.common,Bt.bumpmap,Bt.normalmap,Bt.displacementmap,{opacity:{value:1}}]),vertexShader:jt.meshnormal_vert,fragmentShader:jt.meshnormal_frag},sprite:{uniforms:ci([Bt.sprite,Bt.fog]),vertexShader:jt.sprite_vert,fragmentShader:jt.sprite_frag},background:{uniforms:{uvTransform:{value:new ee},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:jt.background_vert,fragmentShader:jt.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:jt.backgroundCube_vert,fragmentShader:jt.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:jt.cube_vert,fragmentShader:jt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:jt.equirect_vert,fragmentShader:jt.equirect_frag},distanceRGBA:{uniforms:ci([Bt.common,Bt.displacementmap,{referencePosition:{value:new H},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:jt.distanceRGBA_vert,fragmentShader:jt.distanceRGBA_frag},shadow:{uniforms:ci([Bt.lights,Bt.fog,{color:{value:new Rt(0)},opacity:{value:1}}]),vertexShader:jt.shadow_vert,fragmentShader:jt.shadow_frag}};gn.physical={uniforms:ci([gn.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new ee},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new ee},clearcoatNormalScale:{value:new xt(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new ee},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new ee},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new ee},sheen:{value:0},sheenColor:{value:new Rt(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new ee},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new ee},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new ee},transmissionSamplerSize:{value:new xt},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new ee},attenuationDistance:{value:0},attenuationColor:{value:new Rt(0)},specularColor:{value:new Rt(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new ee},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new ee}}]),vertexShader:jt.meshphysical_vert,fragmentShader:jt.meshphysical_frag};const jA={r:0,b:0,g:0};function K1(n,t,e,i,r,a,f){const o=new Rt(0);let s=a===!0?0:1,l,u,A=null,c=0,h=null;function p(d,g){let v=!1,w=g.isScene===!0?g.background:null;w&&w.isTexture&&(w=(g.backgroundBlurriness>0?e:t).get(w));const _=n.xr,y=_.getSession&&_.getSession();y&&y.environmentBlendMode==="additive"&&(w=null),w===null?m(o,s):w&&w.isColor&&(m(w,1),v=!0),(n.autoClear||v)&&n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil),w&&(w.isCubeTexture||w.mapping===Lc)?(u===void 0&&(u=new yt(new Te(1,1,1),new Kn({name:"BackgroundCubeMaterial",uniforms:Ta(gn.backgroundCube.uniforms),vertexShader:gn.backgroundCube.vertexShader,fragmentShader:gn.backgroundCube.fragmentShader,side:yi,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(C,b,S){this.matrixWorld.copyPosition(S.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(u)),u.material.uniforms.envMap.value=w,u.material.uniforms.flipEnvMap.value=w.isCubeTexture&&w.isRenderTargetTexture===!1?-1:1,u.material.uniforms.backgroundBlurriness.value=g.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=g.backgroundIntensity,u.material.toneMapped=w.encoding!==le,(A!==w||c!==w.version||h!==n.toneMapping)&&(u.material.needsUpdate=!0,A=w,c=w.version,h=n.toneMapping),u.layers.enableAll(),d.unshift(u,u.geometry,u.material,0,0,null)):w&&w.isTexture&&(l===void 0&&(l=new yt(new Fa(2,2),new Kn({name:"BackgroundMaterial",uniforms:Ta(gn.background.uniforms),vertexShader:gn.background.vertexShader,fragmentShader:gn.background.fragmentShader,side:Wn,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(l)),l.material.uniforms.t2D.value=w,l.material.uniforms.backgroundIntensity.value=g.backgroundIntensity,l.material.toneMapped=w.encoding!==le,w.matrixAutoUpdate===!0&&w.updateMatrix(),l.material.uniforms.uvTransform.value.copy(w.matrix),(A!==w||c!==w.version||h!==n.toneMapping)&&(l.material.needsUpdate=!0,A=w,c=w.version,h=n.toneMapping),l.layers.enableAll(),d.unshift(l,l.geometry,l.material,0,0,null))}function m(d,g){d.getRGB(jA,cw(n)),i.buffers.color.setClear(jA.r,jA.g,jA.b,g,f)}return{getClearColor:function(){return o},setClearColor:function(d,g=1){o.set(d),s=g,m(o,s)},getClearAlpha:function(){return s},setClearAlpha:function(d){s=d,m(o,s)},render:p}}function X1(n,t,e,i){const r=n.getParameter(34921),a=i.isWebGL2?null:t.get("OES_vertex_array_object"),f=i.isWebGL2||a!==null,o={},s=d(null);let l=s,u=!1;function A(R,W,K,tt,j){let E=!1;if(f){const I=m(tt,K,W);l!==I&&(l=I,h(l.object)),E=g(R,tt,K,j),E&&v(R,tt,K,j)}else{const I=W.wireframe===!0;(l.geometry!==tt.id||l.program!==K.id||l.wireframe!==I)&&(l.geometry=tt.id,l.program=K.id,l.wireframe=I,E=!0)}j!==null&&e.update(j,34963),(E||u)&&(u=!1,S(R,W,K,tt),j!==null&&n.bindBuffer(34963,e.get(j).buffer))}function c(){return i.isWebGL2?n.createVertexArray():a.createVertexArrayOES()}function h(R){return i.isWebGL2?n.bindVertexArray(R):a.bindVertexArrayOES(R)}function p(R){return i.isWebGL2?n.deleteVertexArray(R):a.deleteVertexArrayOES(R)}function m(R,W,K){const tt=K.wireframe===!0;let j=o[R.id];j===void 0&&(j={},o[R.id]=j);let E=j[W.id];E===void 0&&(E={},j[W.id]=E);let I=E[tt];return I===void 0&&(I=d(c()),E[tt]=I),I}function d(R){const W=[],K=[],tt=[];for(let j=0;j<r;j++)W[j]=0,K[j]=0,tt[j]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:W,enabledAttributes:K,attributeDivisors:tt,object:R,attributes:{},index:null}}function g(R,W,K,tt){const j=l.attributes,E=W.attributes;let I=0;const Q=K.getAttributes();for(const D in Q)if(Q[D].location>=0){const U=j[D];let T=E[D];if(T===void 0&&(D==="instanceMatrix"&&R.instanceMatrix&&(T=R.instanceMatrix),D==="instanceColor"&&R.instanceColor&&(T=R.instanceColor)),U===void 0||U.attribute!==T||T&&U.data!==T.data)return!0;I++}return l.attributesNum!==I||l.index!==tt}function v(R,W,K,tt){const j={},E=W.attributes;let I=0;const Q=K.getAttributes();for(const D in Q)if(Q[D].location>=0){let U=E[D];U===void 0&&(D==="instanceMatrix"&&R.instanceMatrix&&(U=R.instanceMatrix),D==="instanceColor"&&R.instanceColor&&(U=R.instanceColor));const T={};T.attribute=U,U&&U.data&&(T.data=U.data),j[D]=T,I++}l.attributes=j,l.attributesNum=I,l.index=tt}function w(){const R=l.newAttributes;for(let W=0,K=R.length;W<K;W++)R[W]=0}function _(R){y(R,0)}function y(R,W){const K=l.newAttributes,tt=l.enabledAttributes,j=l.attributeDivisors;K[R]=1,tt[R]===0&&(n.enableVertexAttribArray(R),tt[R]=1),j[R]!==W&&((i.isWebGL2?n:t.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](R,W),j[R]=W)}function C(){const R=l.newAttributes,W=l.enabledAttributes;for(let K=0,tt=W.length;K<tt;K++)W[K]!==R[K]&&(n.disableVertexAttribArray(K),W[K]=0)}function b(R,W,K,tt,j,E){i.isWebGL2===!0&&(K===5124||K===5125)?n.vertexAttribIPointer(R,W,K,j,E):n.vertexAttribPointer(R,W,K,tt,j,E)}function S(R,W,K,tt){if(i.isWebGL2===!1&&(R.isInstancedMesh||tt.isInstancedBufferGeometry)&&t.get("ANGLE_instanced_arrays")===null)return;w();const j=tt.attributes,E=K.getAttributes(),I=W.defaultAttributeValues;for(const Q in E){const D=E[Q];if(D.location>=0){let k=j[Q];if(k===void 0&&(Q==="instanceMatrix"&&R.instanceMatrix&&(k=R.instanceMatrix),Q==="instanceColor"&&R.instanceColor&&(k=R.instanceColor)),k!==void 0){const U=k.normalized,T=k.itemSize,V=e.get(k);if(V===void 0)continue;const O=V.buffer,et=V.type,q=V.bytesPerElement;if(k.isInterleavedBufferAttribute){const J=k.data,st=J.stride,gt=k.offset;if(J.isInstancedInterleavedBuffer){for(let Y=0;Y<D.locationSize;Y++)y(D.location+Y,J.meshPerAttribute);R.isInstancedMesh!==!0&&tt._maxInstanceCount===void 0&&(tt._maxInstanceCount=J.meshPerAttribute*J.count)}else for(let Y=0;Y<D.locationSize;Y++)_(D.location+Y);n.bindBuffer(34962,O);for(let Y=0;Y<D.locationSize;Y++)b(D.location+Y,T/D.locationSize,et,U,st*q,(gt+T/D.locationSize*Y)*q)}else{if(k.isInstancedBufferAttribute){for(let J=0;J<D.locationSize;J++)y(D.location+J,k.meshPerAttribute);R.isInstancedMesh!==!0&&tt._maxInstanceCount===void 0&&(tt._maxInstanceCount=k.meshPerAttribute*k.count)}else for(let J=0;J<D.locationSize;J++)_(D.location+J);n.bindBuffer(34962,O);for(let J=0;J<D.locationSize;J++)b(D.location+J,T/D.locationSize,et,U,T*q,T/D.locationSize*J*q)}}else if(I!==void 0){const U=I[Q];if(U!==void 0)switch(U.length){case 2:n.vertexAttrib2fv(D.location,U);break;case 3:n.vertexAttrib3fv(D.location,U);break;case 4:n.vertexAttrib4fv(D.location,U);break;default:n.vertexAttrib1fv(D.location,U)}}}}C()}function B(){G();for(const R in o){const W=o[R];for(const K in W){const tt=W[K];for(const j in tt)p(tt[j].object),delete tt[j];delete W[K]}delete o[R]}}function M(R){if(o[R.id]===void 0)return;const W=o[R.id];for(const K in W){const tt=W[K];for(const j in tt)p(tt[j].object),delete tt[j];delete W[K]}delete o[R.id]}function z(R){for(const W in o){const K=o[W];if(K[R.id]===void 0)continue;const tt=K[R.id];for(const j in tt)p(tt[j].object),delete tt[j];delete K[R.id]}}function G(){P(),u=!0,l!==s&&(l=s,h(l.object))}function P(){s.geometry=null,s.program=null,s.wireframe=!1}return{setup:A,reset:G,resetDefaultState:P,dispose:B,releaseStatesOfGeometry:M,releaseStatesOfProgram:z,initAttributes:w,enableAttribute:_,disableUnusedAttributes:C}}function j1(n,t,e,i){const r=i.isWebGL2;let a;function f(l){a=l}function o(l,u){n.drawArrays(a,l,u),e.update(u,a,1)}function s(l,u,A){if(A===0)return;let c,h;if(r)c=n,h="drawArraysInstanced";else if(c=t.get("ANGLE_instanced_arrays"),h="drawArraysInstancedANGLE",c===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}c[h](a,l,u,A),e.update(u,a,A)}this.setMode=f,this.render=o,this.renderInstances=s}function Y1(n,t,e){let i;function r(){if(i!==void 0)return i;if(t.has("EXT_texture_filter_anisotropic")===!0){const b=t.get("EXT_texture_filter_anisotropic");i=n.getParameter(b.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i}function a(b){if(b==="highp"){if(n.getShaderPrecisionFormat(35633,36338).precision>0&&n.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";b="mediump"}return b==="mediump"&&n.getShaderPrecisionFormat(35633,36337).precision>0&&n.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const f=typeof WebGL2RenderingContext<"u"&&n.constructor.name==="WebGL2RenderingContext";let o=e.precision!==void 0?e.precision:"highp";const s=a(o);s!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",s,"instead."),o=s);const l=f||t.has("WEBGL_draw_buffers"),u=e.logarithmicDepthBuffer===!0,A=n.getParameter(34930),c=n.getParameter(35660),h=n.getParameter(3379),p=n.getParameter(34076),m=n.getParameter(34921),d=n.getParameter(36347),g=n.getParameter(36348),v=n.getParameter(36349),w=c>0,_=f||t.has("OES_texture_float"),y=w&&_,C=f?n.getParameter(36183):0;return{isWebGL2:f,drawBuffers:l,getMaxAnisotropy:r,getMaxPrecision:a,precision:o,logarithmicDepthBuffer:u,maxTextures:A,maxVertexTextures:c,maxTextureSize:h,maxCubemapSize:p,maxAttributes:m,maxVertexUniforms:d,maxVaryings:g,maxFragmentUniforms:v,vertexTextures:w,floatFragmentTextures:_,floatVertexTextures:y,maxSamples:C}}function q1(n){const t=this;let e=null,i=0,r=!1,a=!1;const f=new Fi,o=new ee,s={value:null,needsUpdate:!1};this.uniform=s,this.numPlanes=0,this.numIntersection=0,this.init=function(A,c){const h=A.length!==0||c||i!==0||r;return r=c,i=A.length,h},this.beginShadows=function(){a=!0,u(null)},this.endShadows=function(){a=!1},this.setGlobalState=function(A,c){e=u(A,c,0)},this.setState=function(A,c,h){const p=A.clippingPlanes,m=A.clipIntersection,d=A.clipShadows,g=n.get(A);if(!r||p===null||p.length===0||a&&!d)a?u(null):l();else{const v=a?0:i,w=v*4;let _=g.clippingState||null;s.value=_,_=u(p,c,w,h);for(let y=0;y!==w;++y)_[y]=e[y];g.clippingState=_,this.numIntersection=m?this.numPlanes:0,this.numPlanes+=v}};function l(){s.value!==e&&(s.value=e,s.needsUpdate=i>0),t.numPlanes=i,t.numIntersection=0}function u(A,c,h,p){const m=A!==null?A.length:0;let d=null;if(m!==0){if(d=s.value,p!==!0||d===null){const g=h+m*4,v=c.matrixWorldInverse;o.getNormalMatrix(v),(d===null||d.length<g)&&(d=new Float32Array(g));for(let w=0,_=h;w!==m;++w,_+=4)f.copy(A[w]).applyMatrix4(v,o),f.normal.toArray(d,_),d[_+3]=f.constant}s.value=d,s.needsUpdate=!0}return t.numPlanes=m,t.numIntersection=0,d}}function $1(n){let t=new WeakMap;function e(f,o){return o===Xu?f.mapping=Ca:o===ju&&(f.mapping=ba),f}function i(f){if(f&&f.isTexture&&f.isRenderTargetTexture===!1){const o=f.mapping;if(o===Xu||o===ju)if(t.has(f)){const s=t.get(f).texture;return e(s,f.mapping)}else{const s=f.image;if(s&&s.height>0){const l=new fM(s.height/2);return l.fromEquirectangularTexture(n,f),t.set(f,l),f.addEventListener("dispose",r),e(l.texture,f.mapping)}else return null}}return f}function r(f){const o=f.target;o.removeEventListener("dispose",r);const s=t.get(o);s!==void 0&&(t.delete(o),s.dispose())}function a(){t=new WeakMap}return{get:i,dispose:a}}class AA extends hw{constructor(t=-1,e=1,i=1,r=-1,a=.1,f=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=i,this.bottom=r,this.near=a,this.far=f,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=t.view===null?null:Object.assign({},t.view),this}setViewOffset(t,e,i,r,a,f){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=r,this.view.width=a,this.view.height=f,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let a=i-t,f=i+t,o=r+e,s=r-e;if(this.view!==null&&this.view.enabled){const l=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;a+=l*this.view.offsetX,f=a+l*this.view.width,o-=u*this.view.offsetY,s=o-u*this.view.height}this.projectionMatrix.makeOrthographic(a,f,o,s,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,this.view!==null&&(e.object.view=Object.assign({},this.view)),e}}const ra=4,Eg=[.125,.215,.35,.446,.526,.582],Gr=20,Kh=new AA,Mg=new Rt;let Xh=null;const Hr=(1+Math.sqrt(5))/2,Ds=1/Hr,Tg=[new H(1,1,1),new H(-1,1,1),new H(1,1,-1),new H(-1,1,-1),new H(0,Hr,Ds),new H(0,Hr,-Ds),new H(Ds,0,Hr),new H(-Ds,0,Hr),new H(Hr,Ds,0),new H(-Hr,Ds,0)];class Fg{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,i=.1,r=100){Xh=this._renderer.getRenderTarget(),this._setSize(256);const a=this._allocateTargets();return a.depthBuffer=!0,this._sceneToCubeUV(t,i,r,a),e>0&&this._blur(a,0,0,e),this._applyPMREM(a),this._cleanup(a),a}fromEquirectangular(t,e=null){return this._fromTexture(t,e)}fromCubemap(t,e=null){return this._fromTexture(t,e)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=Ig(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=Lg(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(Xh),t.scissorTest=!1,YA(t,0,0,t.width,t.height)}_fromTexture(t,e){t.mapping===Ca||t.mapping===ba?this._setSize(t.image.length===0?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),Xh=this._renderer.getRenderTarget();const i=e||this._allocateTargets();return this._textureToCubeUV(t,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize,i={magFilter:vi,minFilter:vi,generateMipmaps:!1,type:Vo,format:Ki,encoding:cs,depthBuffer:!1},r=Ug(t,e,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==t||this._pingPongRenderTarget.height!==e){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=Ug(t,e,i);const{_lodMax:a}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=J1(a)),this._blurMaterial=Z1(a,t,e)}return r}_compileMaterial(t){const e=new yt(this._lodPlanes[0],t);this._renderer.compile(e,Kh)}_sceneToCubeUV(t,e,i,r){const o=new ui(90,1,e,i),s=[1,-1,1,1,1,1],l=[1,1,1,-1,-1,-1],u=this._renderer,A=u.autoClear,c=u.toneMapping;u.getClearColor(Mg),u.toneMapping=Vn,u.autoClear=!1;const h=new vn({name:"PMREM.Background",side:yi,depthWrite:!1,depthTest:!1}),p=new yt(new Te,h);let m=!1;const d=t.background;d?d.isColor&&(h.color.copy(d),t.background=null,m=!0):(h.color.copy(Mg),m=!0);for(let g=0;g<6;g++){const v=g%3;v===0?(o.up.set(0,s[g],0),o.lookAt(l[g],0,0)):v===1?(o.up.set(0,0,s[g]),o.lookAt(0,l[g],0)):(o.up.set(0,s[g],0),o.lookAt(0,0,l[g]));const w=this._cubeSize;YA(r,v*w,g>2?w:0,w,w),u.setRenderTarget(r),m&&u.render(p,o),u.render(t,o)}p.geometry.dispose(),p.material.dispose(),u.toneMapping=c,u.autoClear=A,t.background=d}_textureToCubeUV(t,e){const i=this._renderer,r=t.mapping===Ca||t.mapping===ba;r?(this._cubemapMaterial===null&&(this._cubemapMaterial=Ig()),this._cubemapMaterial.uniforms.flipEnvMap.value=t.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=Lg());const a=r?this._cubemapMaterial:this._equirectMaterial,f=new yt(this._lodPlanes[0],a),o=a.uniforms;o.envMap.value=t;const s=this._cubeSize;YA(e,0,0,3*s,2*s),i.setRenderTarget(e),i.render(f,Kh)}_applyPMREM(t){const e=this._renderer,i=e.autoClear;e.autoClear=!1;for(let r=1;r<this._lodPlanes.length;r++){const a=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),f=Tg[(r-1)%Tg.length];this._blur(t,r-1,r,a,f)}e.autoClear=i}_blur(t,e,i,r,a){const f=this._pingPongRenderTarget;this._halfBlur(t,f,e,i,r,"latitudinal",a),this._halfBlur(f,t,i,i,r,"longitudinal",a)}_halfBlur(t,e,i,r,a,f,o){const s=this._renderer,l=this._blurMaterial;f!=="latitudinal"&&f!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const u=3,A=new yt(this._lodPlanes[r],l),c=l.uniforms,h=this._sizeLods[i]-1,p=isFinite(a)?Math.PI/(2*h):2*Math.PI/(2*Gr-1),m=a/p,d=isFinite(a)?1+Math.floor(u*m):Gr;d>Gr&&console.warn(`sigmaRadians, ${a}, is too large and will clip, as it requested ${d} samples when the maximum is set to ${Gr}`);const g=[];let v=0;for(let b=0;b<Gr;++b){const S=b/m,B=Math.exp(-S*S/2);g.push(B),b===0?v+=B:b<d&&(v+=2*B)}for(let b=0;b<g.length;b++)g[b]=g[b]/v;c.envMap.value=t.texture,c.samples.value=d,c.weights.value=g,c.latitudinal.value=f==="latitudinal",o&&(c.poleAxis.value=o);const{_lodMax:w}=this;c.dTheta.value=p,c.mipInt.value=w-i;const _=this._sizeLods[r],y=3*_*(r>w-ra?r-w+ra:0),C=4*(this._cubeSize-_);YA(e,y,C,3*_,2*_),s.setRenderTarget(e),s.render(A,Kh)}}function J1(n){const t=[],e=[],i=[];let r=n;const a=n-ra+1+Eg.length;for(let f=0;f<a;f++){const o=Math.pow(2,r);e.push(o);let s=1/o;f>n-ra?s=Eg[f-n+ra-1]:f===0&&(s=0),i.push(s);const l=1/(o-2),u=-l,A=1+l,c=[u,u,A,u,A,A,u,u,A,A,u,A],h=6,p=6,m=3,d=2,g=1,v=new Float32Array(m*p*h),w=new Float32Array(d*p*h),_=new Float32Array(g*p*h);for(let C=0;C<h;C++){const b=C%3*2/3-1,S=C>2?0:-1,B=[b,S,0,b+2/3,S,0,b+2/3,S+1,0,b,S,0,b+2/3,S+1,0,b,S+1,0];v.set(B,m*p*C),w.set(c,d*p*C);const M=[C,C,C,C,C,C];_.set(M,g*p*C)}const y=new ke;y.setAttribute("position",new Oe(v,m)),y.setAttribute("uv",new Oe(w,d)),y.setAttribute("faceIndex",new Oe(_,g)),t.push(y),r>ra&&r--}return{lodPlanes:t,sizeLods:e,sigmas:i}}function Ug(n,t,e){const i=new xr(n,t,e);return i.texture.mapping=Lc,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function YA(n,t,e,i,r){n.viewport.set(t,e,i,r),n.scissor.set(t,e,i,r)}function Z1(n,t,e){const i=new Float32Array(Gr),r=new H(0,1,0);return new Kn({name:"SphericalGaussianBlur",defines:{n:Gr,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/e,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:pd(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:gr,depthTest:!1,depthWrite:!1})}function Lg(){return new Kn({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:pd(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:gr,depthTest:!1,depthWrite:!1})}function Ig(){return new Kn({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:pd(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:gr,depthTest:!1,depthWrite:!1})}function pd(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function tF(n){let t=new WeakMap,e=null;function i(o){if(o&&o.isTexture){const s=o.mapping,l=s===Xu||s===ju,u=s===Ca||s===ba;if(l||u)if(o.isRenderTargetTexture&&o.needsPMREMUpdate===!0){o.needsPMREMUpdate=!1;let A=t.get(o);return e===null&&(e=new Fg(n)),A=l?e.fromEquirectangular(o,A):e.fromCubemap(o,A),t.set(o,A),A.texture}else{if(t.has(o))return t.get(o).texture;{const A=o.image;if(l&&A&&A.height>0||u&&A&&r(A)){e===null&&(e=new Fg(n));const c=l?e.fromEquirectangular(o):e.fromCubemap(o);return t.set(o,c),o.addEventListener("dispose",a),c.texture}else return null}}}return o}function r(o){let s=0;const l=6;for(let u=0;u<l;u++)o[u]!==void 0&&s++;return s===l}function a(o){const s=o.target;s.removeEventListener("dispose",a);const l=t.get(s);l!==void 0&&(t.delete(s),l.dispose())}function f(){t=new WeakMap,e!==null&&(e.dispose(),e=null)}return{get:i,dispose:f}}function eF(n){const t={};function e(i){if(t[i]!==void 0)return t[i];let r;switch(i){case"WEBGL_depth_texture":r=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=n.getExtension(i)}return t[i]=r,r}return{has:function(i){return e(i)!==null},init:function(i){i.isWebGL2?e("EXT_color_buffer_float"):(e("WEBGL_depth_texture"),e("OES_texture_float"),e("OES_texture_half_float"),e("OES_texture_half_float_linear"),e("OES_standard_derivatives"),e("OES_element_index_uint"),e("OES_vertex_array_object"),e("ANGLE_instanced_arrays")),e("OES_texture_float_linear"),e("EXT_color_buffer_half_float"),e("WEBGL_multisampled_render_to_texture")},get:function(i){const r=e(i);return r===null&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),r}}}function iF(n,t,e,i){const r={},a=new WeakMap;function f(A){const c=A.target;c.index!==null&&t.remove(c.index);for(const p in c.attributes)t.remove(c.attributes[p]);c.removeEventListener("dispose",f),delete r[c.id];const h=a.get(c);h&&(t.remove(h),a.delete(c)),i.releaseStatesOfGeometry(c),c.isInstancedBufferGeometry===!0&&delete c._maxInstanceCount,e.memory.geometries--}function o(A,c){return r[c.id]===!0||(c.addEventListener("dispose",f),r[c.id]=!0,e.memory.geometries++),c}function s(A){const c=A.attributes;for(const p in c)t.update(c[p],34962);const h=A.morphAttributes;for(const p in h){const m=h[p];for(let d=0,g=m.length;d<g;d++)t.update(m[d],34962)}}function l(A){const c=[],h=A.index,p=A.attributes.position;let m=0;if(h!==null){const v=h.array;m=h.version;for(let w=0,_=v.length;w<_;w+=3){const y=v[w+0],C=v[w+1],b=v[w+2];c.push(y,C,C,b,b,y)}}else{const v=p.array;m=p.version;for(let w=0,_=v.length/3-1;w<_;w+=3){const y=w+0,C=w+1,b=w+2;c.push(y,C,C,b,b,y)}}const d=new(iw(c)?lw:Aw)(c,1);d.version=m;const g=a.get(A);g&&t.remove(g),a.set(A,d)}function u(A){const c=a.get(A);if(c){const h=A.index;h!==null&&c.version<h.version&&l(A)}else l(A);return a.get(A)}return{get:o,update:s,getWireframeAttribute:u}}function nF(n,t,e,i){const r=i.isWebGL2;let a;function f(c){a=c}let o,s;function l(c){o=c.type,s=c.bytesPerElement}function u(c,h){n.drawElements(a,h,o,c*s),e.update(h,a,1)}function A(c,h,p){if(p===0)return;let m,d;if(r)m=n,d="drawElementsInstanced";else if(m=t.get("ANGLE_instanced_arrays"),d="drawElementsInstancedANGLE",m===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}m[d](a,h,o,c*s,p),e.update(h,a,p)}this.setMode=f,this.setIndex=l,this.render=u,this.renderInstances=A}function rF(n){const t={geometries:0,textures:0},e={frame:0,calls:0,triangles:0,points:0,lines:0};function i(a,f,o){switch(e.calls++,f){case 4:e.triangles+=o*(a/3);break;case 1:e.lines+=o*(a/2);break;case 3:e.lines+=o*(a-1);break;case 2:e.lines+=o*a;break;case 0:e.points+=o*a;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",f);break}}function r(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0}return{memory:t,render:e,programs:null,autoReset:!0,reset:r,update:i}}function sF(n,t){return n[0]-t[0]}function aF(n,t){return Math.abs(t[1])-Math.abs(n[1])}function oF(n,t,e){const i={},r=new Float32Array(8),a=new WeakMap,f=new pe,o=[];for(let l=0;l<8;l++)o[l]=[l,0];function s(l,u,A){const c=l.morphTargetInfluences;if(t.isWebGL2===!0){const p=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,m=p!==void 0?p.length:0;let d=a.get(u);if(d===void 0||d.count!==m){let W=function(){P.dispose(),a.delete(u),u.removeEventListener("dispose",W)};var h=W;d!==void 0&&d.texture.dispose();const w=u.morphAttributes.position!==void 0,_=u.morphAttributes.normal!==void 0,y=u.morphAttributes.color!==void 0,C=u.morphAttributes.position||[],b=u.morphAttributes.normal||[],S=u.morphAttributes.color||[];let B=0;w===!0&&(B=1),_===!0&&(B=2),y===!0&&(B=3);let M=u.attributes.position.count*B,z=1;M>t.maxTextureSize&&(z=Math.ceil(M/t.maxTextureSize),M=t.maxTextureSize);const G=new Float32Array(M*z*4*m),P=new sw(G,M,z,m);P.type=ur,P.needsUpdate=!0;const R=B*4;for(let K=0;K<m;K++){const tt=C[K],j=b[K],E=S[K],I=M*z*4*K;for(let Q=0;Q<tt.count;Q++){const D=Q*R;w===!0&&(f.fromBufferAttribute(tt,Q),G[I+D+0]=f.x,G[I+D+1]=f.y,G[I+D+2]=f.z,G[I+D+3]=0),_===!0&&(f.fromBufferAttribute(j,Q),G[I+D+4]=f.x,G[I+D+5]=f.y,G[I+D+6]=f.z,G[I+D+7]=0),y===!0&&(f.fromBufferAttribute(E,Q),G[I+D+8]=f.x,G[I+D+9]=f.y,G[I+D+10]=f.z,G[I+D+11]=E.itemSize===4?f.w:1)}}d={count:m,texture:P,size:new xt(M,z)},a.set(u,d),u.addEventListener("dispose",W)}let g=0;for(let w=0;w<c.length;w++)g+=c[w];const v=u.morphTargetsRelative?1:1-g;A.getUniforms().setValue(n,"morphTargetBaseInfluence",v),A.getUniforms().setValue(n,"morphTargetInfluences",c),A.getUniforms().setValue(n,"morphTargetsTexture",d.texture,e),A.getUniforms().setValue(n,"morphTargetsTextureSize",d.size)}else{const p=c===void 0?0:c.length;let m=i[u.id];if(m===void 0||m.length!==p){m=[];for(let _=0;_<p;_++)m[_]=[_,0];i[u.id]=m}for(let _=0;_<p;_++){const y=m[_];y[0]=_,y[1]=c[_]}m.sort(aF);for(let _=0;_<8;_++)_<p&&m[_][1]?(o[_][0]=m[_][0],o[_][1]=m[_][1]):(o[_][0]=Number.MAX_SAFE_INTEGER,o[_][1]=0);o.sort(sF);const d=u.morphAttributes.position,g=u.morphAttributes.normal;let v=0;for(let _=0;_<8;_++){const y=o[_],C=y[0],b=y[1];C!==Number.MAX_SAFE_INTEGER&&b?(d&&u.getAttribute("morphTarget"+_)!==d[C]&&u.setAttribute("morphTarget"+_,d[C]),g&&u.getAttribute("morphNormal"+_)!==g[C]&&u.setAttribute("morphNormal"+_,g[C]),r[_]=b,v+=b):(d&&u.hasAttribute("morphTarget"+_)===!0&&u.deleteAttribute("morphTarget"+_),g&&u.hasAttribute("morphNormal"+_)===!0&&u.deleteAttribute("morphNormal"+_),r[_]=0)}const w=u.morphTargetsRelative?1:1-v;A.getUniforms().setValue(n,"morphTargetBaseInfluence",w),A.getUniforms().setValue(n,"morphTargetInfluences",r)}}return{update:s}}function AF(n,t,e,i){let r=new WeakMap;function a(s){const l=i.render.frame,u=s.geometry,A=t.get(s,u);return r.get(A)!==l&&(t.update(A),r.set(A,l)),s.isInstancedMesh&&(s.hasEventListener("dispose",o)===!1&&s.addEventListener("dispose",o),e.update(s.instanceMatrix,34962),s.instanceColor!==null&&e.update(s.instanceColor,34962)),A}function f(){r=new WeakMap}function o(s){const l=s.target;l.removeEventListener("dispose",o),e.remove(l.instanceMatrix),l.instanceColor!==null&&e.remove(l.instanceColor)}return{update:a,dispose:f}}const dw=new je,pw=new sw,gw=new $E,mw=new uw,Dg=[],Pg=[],Og=new Float32Array(16),Qg=new Float32Array(9),Rg=new Float32Array(4);function ka(n,t,e){const i=n[0];if(i<=0||i>0)return n;const r=t*e;let a=Dg[r];if(a===void 0&&(a=new Float32Array(r),Dg[r]=a),t!==0){i.toArray(a,0);for(let f=1,o=0;f!==t;++f)o+=e,n[f].toArray(a,o)}return a}function Ve(n,t){if(n.length!==t.length)return!1;for(let e=0,i=n.length;e<i;e++)if(n[e]!==t[e])return!1;return!0}function ze(n,t){for(let e=0,i=t.length;e<i;e++)n[e]=t[e]}function Pc(n,t){let e=Pg[t];e===void 0&&(e=new Int32Array(t),Pg[t]=e);for(let i=0;i!==t;++i)e[i]=n.allocateTextureUnit();return e}function lF(n,t){const e=this.cache;e[0]!==t&&(n.uniform1f(this.addr,t),e[0]=t)}function cF(n,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y)&&(n.uniform2f(this.addr,t.x,t.y),e[0]=t.x,e[1]=t.y);else{if(Ve(e,t))return;n.uniform2fv(this.addr,t),ze(e,t)}}function hF(n,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z)&&(n.uniform3f(this.addr,t.x,t.y,t.z),e[0]=t.x,e[1]=t.y,e[2]=t.z);else if(t.r!==void 0)(e[0]!==t.r||e[1]!==t.g||e[2]!==t.b)&&(n.uniform3f(this.addr,t.r,t.g,t.b),e[0]=t.r,e[1]=t.g,e[2]=t.b);else{if(Ve(e,t))return;n.uniform3fv(this.addr,t),ze(e,t)}}function uF(n,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z||e[3]!==t.w)&&(n.uniform4f(this.addr,t.x,t.y,t.z,t.w),e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.w);else{if(Ve(e,t))return;n.uniform4fv(this.addr,t),ze(e,t)}}function fF(n,t){const e=this.cache,i=t.elements;if(i===void 0){if(Ve(e,t))return;n.uniformMatrix2fv(this.addr,!1,t),ze(e,t)}else{if(Ve(e,i))return;Rg.set(i),n.uniformMatrix2fv(this.addr,!1,Rg),ze(e,i)}}function dF(n,t){const e=this.cache,i=t.elements;if(i===void 0){if(Ve(e,t))return;n.uniformMatrix3fv(this.addr,!1,t),ze(e,t)}else{if(Ve(e,i))return;Qg.set(i),n.uniformMatrix3fv(this.addr,!1,Qg),ze(e,i)}}function pF(n,t){const e=this.cache,i=t.elements;if(i===void 0){if(Ve(e,t))return;n.uniformMatrix4fv(this.addr,!1,t),ze(e,t)}else{if(Ve(e,i))return;Og.set(i),n.uniformMatrix4fv(this.addr,!1,Og),ze(e,i)}}function gF(n,t){const e=this.cache;e[0]!==t&&(n.uniform1i(this.addr,t),e[0]=t)}function mF(n,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y)&&(n.uniform2i(this.addr,t.x,t.y),e[0]=t.x,e[1]=t.y);else{if(Ve(e,t))return;n.uniform2iv(this.addr,t),ze(e,t)}}function vF(n,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z)&&(n.uniform3i(this.addr,t.x,t.y,t.z),e[0]=t.x,e[1]=t.y,e[2]=t.z);else{if(Ve(e,t))return;n.uniform3iv(this.addr,t),ze(e,t)}}function wF(n,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z||e[3]!==t.w)&&(n.uniform4i(this.addr,t.x,t.y,t.z,t.w),e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.w);else{if(Ve(e,t))return;n.uniform4iv(this.addr,t),ze(e,t)}}function _F(n,t){const e=this.cache;e[0]!==t&&(n.uniform1ui(this.addr,t),e[0]=t)}function yF(n,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y)&&(n.uniform2ui(this.addr,t.x,t.y),e[0]=t.x,e[1]=t.y);else{if(Ve(e,t))return;n.uniform2uiv(this.addr,t),ze(e,t)}}function xF(n,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z)&&(n.uniform3ui(this.addr,t.x,t.y,t.z),e[0]=t.x,e[1]=t.y,e[2]=t.z);else{if(Ve(e,t))return;n.uniform3uiv(this.addr,t),ze(e,t)}}function CF(n,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z||e[3]!==t.w)&&(n.uniform4ui(this.addr,t.x,t.y,t.z,t.w),e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.w);else{if(Ve(e,t))return;n.uniform4uiv(this.addr,t),ze(e,t)}}function bF(n,t,e){const i=this.cache,r=e.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),e.setTexture2D(t||dw,r)}function BF(n,t,e){const i=this.cache,r=e.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),e.setTexture3D(t||gw,r)}function SF(n,t,e){const i=this.cache,r=e.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),e.setTextureCube(t||mw,r)}function EF(n,t,e){const i=this.cache,r=e.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),e.setTexture2DArray(t||pw,r)}function MF(n){switch(n){case 5126:return lF;case 35664:return cF;case 35665:return hF;case 35666:return uF;case 35674:return fF;case 35675:return dF;case 35676:return pF;case 5124:case 35670:return gF;case 35667:case 35671:return mF;case 35668:case 35672:return vF;case 35669:case 35673:return wF;case 5125:return _F;case 36294:return yF;case 36295:return xF;case 36296:return CF;case 35678:case 36198:case 36298:case 36306:case 35682:return bF;case 35679:case 36299:case 36307:return BF;case 35680:case 36300:case 36308:case 36293:return SF;case 36289:case 36303:case 36311:case 36292:return EF}}function TF(n,t){n.uniform1fv(this.addr,t)}function FF(n,t){const e=ka(t,this.size,2);n.uniform2fv(this.addr,e)}function UF(n,t){const e=ka(t,this.size,3);n.uniform3fv(this.addr,e)}function LF(n,t){const e=ka(t,this.size,4);n.uniform4fv(this.addr,e)}function IF(n,t){const e=ka(t,this.size,4);n.uniformMatrix2fv(this.addr,!1,e)}function DF(n,t){const e=ka(t,this.size,9);n.uniformMatrix3fv(this.addr,!1,e)}function PF(n,t){const e=ka(t,this.size,16);n.uniformMatrix4fv(this.addr,!1,e)}function OF(n,t){n.uniform1iv(this.addr,t)}function QF(n,t){n.uniform2iv(this.addr,t)}function RF(n,t){n.uniform3iv(this.addr,t)}function HF(n,t){n.uniform4iv(this.addr,t)}function kF(n,t){n.uniform1uiv(this.addr,t)}function NF(n,t){n.uniform2uiv(this.addr,t)}function VF(n,t){n.uniform3uiv(this.addr,t)}function zF(n,t){n.uniform4uiv(this.addr,t)}function GF(n,t,e){const i=this.cache,r=t.length,a=Pc(e,r);Ve(i,a)||(n.uniform1iv(this.addr,a),ze(i,a));for(let f=0;f!==r;++f)e.setTexture2D(t[f]||dw,a[f])}function WF(n,t,e){const i=this.cache,r=t.length,a=Pc(e,r);Ve(i,a)||(n.uniform1iv(this.addr,a),ze(i,a));for(let f=0;f!==r;++f)e.setTexture3D(t[f]||gw,a[f])}function KF(n,t,e){const i=this.cache,r=t.length,a=Pc(e,r);Ve(i,a)||(n.uniform1iv(this.addr,a),ze(i,a));for(let f=0;f!==r;++f)e.setTextureCube(t[f]||mw,a[f])}function XF(n,t,e){const i=this.cache,r=t.length,a=Pc(e,r);Ve(i,a)||(n.uniform1iv(this.addr,a),ze(i,a));for(let f=0;f!==r;++f)e.setTexture2DArray(t[f]||pw,a[f])}function jF(n){switch(n){case 5126:return TF;case 35664:return FF;case 35665:return UF;case 35666:return LF;case 35674:return IF;case 35675:return DF;case 35676:return PF;case 5124:case 35670:return OF;case 35667:case 35671:return QF;case 35668:case 35672:return RF;case 35669:case 35673:return HF;case 5125:return kF;case 36294:return NF;case 36295:return VF;case 36296:return zF;case 35678:case 36198:case 36298:case 36306:case 35682:return GF;case 35679:case 36299:case 36307:return WF;case 35680:case 36300:case 36308:case 36293:return KF;case 36289:case 36303:case 36311:case 36292:return XF}}class YF{constructor(t,e,i){this.id=t,this.addr=i,this.cache=[],this.setValue=MF(e.type)}}class qF{constructor(t,e,i){this.id=t,this.addr=i,this.cache=[],this.size=e.size,this.setValue=jF(e.type)}}class $F{constructor(t){this.id=t,this.seq=[],this.map={}}setValue(t,e,i){const r=this.seq;for(let a=0,f=r.length;a!==f;++a){const o=r[a];o.setValue(t,e[o.id],i)}}}const jh=/(\w+)(\])?(\[|\.)?/g;function Hg(n,t){n.seq.push(t),n.map[t.id]=t}function JF(n,t,e){const i=n.name,r=i.length;for(jh.lastIndex=0;;){const a=jh.exec(i),f=jh.lastIndex;let o=a[1];const s=a[2]==="]",l=a[3];if(s&&(o=o|0),l===void 0||l==="["&&f+2===r){Hg(e,l===void 0?new YF(o,n,t):new qF(o,n,t));break}else{let A=e.map[o];A===void 0&&(A=new $F(o),Hg(e,A)),e=A}}}class Kl{constructor(t,e){this.seq=[],this.map={};const i=t.getProgramParameter(e,35718);for(let r=0;r<i;++r){const a=t.getActiveUniform(e,r),f=t.getUniformLocation(e,a.name);JF(a,f,this)}}setValue(t,e,i,r){const a=this.map[e];a!==void 0&&a.setValue(t,i,r)}setOptional(t,e,i){const r=e[i];r!==void 0&&this.setValue(t,i,r)}static upload(t,e,i,r){for(let a=0,f=e.length;a!==f;++a){const o=e[a],s=i[o.id];s.needsUpdate!==!1&&o.setValue(t,s.value,r)}}static seqWithValue(t,e){const i=[];for(let r=0,a=t.length;r!==a;++r){const f=t[r];f.id in e&&i.push(f)}return i}}function kg(n,t,e){const i=n.createShader(t);return n.shaderSource(i,e),n.compileShader(i),i}let ZF=0;function tU(n,t){const e=n.split(`
`),i=[],r=Math.max(t-6,0),a=Math.min(t+6,e.length);for(let f=r;f<a;f++){const o=f+1;i.push(`${o===t?">":" "} ${o}: ${e[f]}`)}return i.join(`
`)}function eU(n){switch(n){case cs:return["Linear","( value )"];case le:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",n),["Linear","( value )"]}}function Ng(n,t,e){const i=n.getShaderParameter(t,35713),r=n.getShaderInfoLog(t).trim();if(i&&r==="")return"";const a=/ERROR: 0:(\d+)/.exec(r);if(a){const f=parseInt(a[1]);return e.toUpperCase()+`

`+r+`

`+tU(n.getShaderSource(t),f)}else return r}function iU(n,t){const e=eU(t);return"vec4 "+n+"( vec4 value ) { return LinearTo"+e[0]+e[1]+"; }"}function nU(n,t){let e;switch(t){case rE:e="Linear";break;case sE:e="Reinhard";break;case aE:e="OptimizedCineon";break;case oE:e="ACESFilmic";break;case AE:e="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),e="Linear"}return"vec3 "+n+"( vec3 color ) { return "+e+"ToneMapping( color ); }"}function rU(n){return[n.extensionDerivatives||n.envMapCubeUVHeight||n.bumpMap||n.normalMapTangentSpace||n.clearcoatNormalMap||n.flatShading||n.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(n.extensionFragDepth||n.logarithmicDepthBuffer)&&n.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",n.extensionDrawBuffers&&n.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(n.extensionShaderTextureLOD||n.envMap||n.transmission)&&n.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(vo).join(`
`)}function sU(n){const t=[];for(const e in n){const i=n[e];i!==!1&&t.push("#define "+e+" "+i)}return t.join(`
`)}function aU(n,t){const e={},i=n.getProgramParameter(t,35721);for(let r=0;r<i;r++){const a=n.getActiveAttrib(t,r),f=a.name;let o=1;a.type===35674&&(o=2),a.type===35675&&(o=3),a.type===35676&&(o=4),e[f]={type:a.type,location:n.getAttribLocation(t,f),locationSize:o}}return e}function vo(n){return n!==""}function Vg(n,t){const e=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,e).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function zg(n,t){return n.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const oU=/^[ \t]*#include +<([\w\d./]+)>/gm;function tf(n){return n.replace(oU,AU)}function AU(n,t){const e=jt[t];if(e===void 0)throw new Error("Can not resolve #include <"+t+">");return tf(e)}const lU=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Gg(n){return n.replace(lU,cU)}function cU(n,t,e,i){let r="";for(let a=parseInt(t);a<parseInt(e);a++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+a+" ]").replace(/UNROLLED_LOOP_INDEX/g,a);return r}function Wg(n){let t="precision "+n.precision+` float;
precision `+n.precision+" int;";return n.precision==="highp"?t+=`
#define HIGH_PRECISION`:n.precision==="mediump"?t+=`
#define MEDIUM_PRECISION`:n.precision==="lowp"&&(t+=`
#define LOW_PRECISION`),t}function hU(n){let t="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===W0?t="SHADOWMAP_TYPE_PCF":n.shadowMapType===OS?t="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===mo&&(t="SHADOWMAP_TYPE_VSM"),t}function uU(n){let t="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case Ca:case ba:t="ENVMAP_TYPE_CUBE";break;case Lc:t="ENVMAP_TYPE_CUBE_UV";break}return t}function fU(n){let t="ENVMAP_MODE_REFLECTION";if(n.envMap)switch(n.envMapMode){case ba:t="ENVMAP_MODE_REFRACTION";break}return t}function dU(n){let t="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case Uc:t="ENVMAP_BLENDING_MULTIPLY";break;case iE:t="ENVMAP_BLENDING_MIX";break;case nE:t="ENVMAP_BLENDING_ADD";break}return t}function pU(n){const t=n.envMapCubeUVHeight;if(t===null)return null;const e=Math.log2(t)-2,i=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,e),7*16)),texelHeight:i,maxMip:e}}function gU(n,t,e,i){const r=n.getContext(),a=e.defines;let f=e.vertexShader,o=e.fragmentShader;const s=hU(e),l=uU(e),u=fU(e),A=dU(e),c=pU(e),h=e.isWebGL2?"":rU(e),p=sU(a),m=r.createProgram();let d,g,v=e.glslVersion?"#version "+e.glslVersion+`
`:"";e.isRawShaderMaterial?(d=[p].filter(vo).join(`
`),d.length>0&&(d+=`
`),g=[h,p].filter(vo).join(`
`),g.length>0&&(g+=`
`)):(d=[Wg(e),"#define SHADER_NAME "+e.shaderName,p,e.instancing?"#define USE_INSTANCING":"",e.instancingColor?"#define USE_INSTANCING_COLOR":"",e.useFog&&e.fog?"#define USE_FOG":"",e.useFog&&e.fogExp2?"#define FOG_EXP2":"",e.map?"#define USE_MAP":"",e.envMap?"#define USE_ENVMAP":"",e.envMap?"#define "+u:"",e.lightMap?"#define USE_LIGHTMAP":"",e.aoMap?"#define USE_AOMAP":"",e.bumpMap?"#define USE_BUMPMAP":"",e.normalMap?"#define USE_NORMALMAP":"",e.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",e.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",e.displacementMap?"#define USE_DISPLACEMENTMAP":"",e.emissiveMap?"#define USE_EMISSIVEMAP":"",e.clearcoatMap?"#define USE_CLEARCOATMAP":"",e.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",e.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",e.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",e.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",e.specularMap?"#define USE_SPECULARMAP":"",e.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",e.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",e.roughnessMap?"#define USE_ROUGHNESSMAP":"",e.metalnessMap?"#define USE_METALNESSMAP":"",e.alphaMap?"#define USE_ALPHAMAP":"",e.transmission?"#define USE_TRANSMISSION":"",e.transmissionMap?"#define USE_TRANSMISSIONMAP":"",e.thicknessMap?"#define USE_THICKNESSMAP":"",e.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",e.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",e.mapUv?"#define MAP_UV "+e.mapUv:"",e.alphaMapUv?"#define ALPHAMAP_UV "+e.alphaMapUv:"",e.lightMapUv?"#define LIGHTMAP_UV "+e.lightMapUv:"",e.aoMapUv?"#define AOMAP_UV "+e.aoMapUv:"",e.emissiveMapUv?"#define EMISSIVEMAP_UV "+e.emissiveMapUv:"",e.bumpMapUv?"#define BUMPMAP_UV "+e.bumpMapUv:"",e.normalMapUv?"#define NORMALMAP_UV "+e.normalMapUv:"",e.displacementMapUv?"#define DISPLACEMENTMAP_UV "+e.displacementMapUv:"",e.metalnessMapUv?"#define METALNESSMAP_UV "+e.metalnessMapUv:"",e.roughnessMapUv?"#define ROUGHNESSMAP_UV "+e.roughnessMapUv:"",e.clearcoatMapUv?"#define CLEARCOATMAP_UV "+e.clearcoatMapUv:"",e.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+e.clearcoatNormalMapUv:"",e.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+e.clearcoatRoughnessMapUv:"",e.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+e.iridescenceMapUv:"",e.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+e.iridescenceThicknessMapUv:"",e.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+e.sheenColorMapUv:"",e.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+e.sheenRoughnessMapUv:"",e.specularMapUv?"#define SPECULARMAP_UV "+e.specularMapUv:"",e.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+e.specularColorMapUv:"",e.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+e.specularIntensityMapUv:"",e.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+e.transmissionMapUv:"",e.thicknessMapUv?"#define THICKNESSMAP_UV "+e.thicknessMapUv:"",e.vertexTangents?"#define USE_TANGENT":"",e.vertexColors?"#define USE_COLOR":"",e.vertexAlphas?"#define USE_COLOR_ALPHA":"",e.vertexUvs2?"#define USE_UV2":"",e.pointsUvs?"#define USE_POINTS_UV":"",e.flatShading?"#define FLAT_SHADED":"",e.skinning?"#define USE_SKINNING":"",e.morphTargets?"#define USE_MORPHTARGETS":"",e.morphNormals&&e.flatShading===!1?"#define USE_MORPHNORMALS":"",e.morphColors&&e.isWebGL2?"#define USE_MORPHCOLORS":"",e.morphTargetsCount>0&&e.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",e.morphTargetsCount>0&&e.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+e.morphTextureStride:"",e.morphTargetsCount>0&&e.isWebGL2?"#define MORPHTARGETS_COUNT "+e.morphTargetsCount:"",e.doubleSided?"#define DOUBLE_SIDED":"",e.flipSided?"#define FLIP_SIDED":"",e.shadowMapEnabled?"#define USE_SHADOWMAP":"",e.shadowMapEnabled?"#define "+s:"",e.sizeAttenuation?"#define USE_SIZEATTENUATION":"",e.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",e.logarithmicDepthBuffer&&e.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(vo).join(`
`),g=[h,Wg(e),"#define SHADER_NAME "+e.shaderName,p,e.useFog&&e.fog?"#define USE_FOG":"",e.useFog&&e.fogExp2?"#define FOG_EXP2":"",e.map?"#define USE_MAP":"",e.matcap?"#define USE_MATCAP":"",e.envMap?"#define USE_ENVMAP":"",e.envMap?"#define "+l:"",e.envMap?"#define "+u:"",e.envMap?"#define "+A:"",c?"#define CUBEUV_TEXEL_WIDTH "+c.texelWidth:"",c?"#define CUBEUV_TEXEL_HEIGHT "+c.texelHeight:"",c?"#define CUBEUV_MAX_MIP "+c.maxMip+".0":"",e.lightMap?"#define USE_LIGHTMAP":"",e.aoMap?"#define USE_AOMAP":"",e.bumpMap?"#define USE_BUMPMAP":"",e.normalMap?"#define USE_NORMALMAP":"",e.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",e.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",e.emissiveMap?"#define USE_EMISSIVEMAP":"",e.clearcoat?"#define USE_CLEARCOAT":"",e.clearcoatMap?"#define USE_CLEARCOATMAP":"",e.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",e.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",e.iridescence?"#define USE_IRIDESCENCE":"",e.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",e.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",e.specularMap?"#define USE_SPECULARMAP":"",e.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",e.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",e.roughnessMap?"#define USE_ROUGHNESSMAP":"",e.metalnessMap?"#define USE_METALNESSMAP":"",e.alphaMap?"#define USE_ALPHAMAP":"",e.alphaTest?"#define USE_ALPHATEST":"",e.sheen?"#define USE_SHEEN":"",e.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",e.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",e.transmission?"#define USE_TRANSMISSION":"",e.transmissionMap?"#define USE_TRANSMISSIONMAP":"",e.thicknessMap?"#define USE_THICKNESSMAP":"",e.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",e.vertexTangents?"#define USE_TANGENT":"",e.vertexColors||e.instancingColor?"#define USE_COLOR":"",e.vertexAlphas?"#define USE_COLOR_ALPHA":"",e.vertexUvs2?"#define USE_UV2":"",e.pointsUvs?"#define USE_POINTS_UV":"",e.gradientMap?"#define USE_GRADIENTMAP":"",e.flatShading?"#define FLAT_SHADED":"",e.doubleSided?"#define DOUBLE_SIDED":"",e.flipSided?"#define FLIP_SIDED":"",e.shadowMapEnabled?"#define USE_SHADOWMAP":"",e.shadowMapEnabled?"#define "+s:"",e.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",e.useLegacyLights?"#define LEGACY_LIGHTS":"",e.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",e.logarithmicDepthBuffer&&e.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",e.toneMapping!==Vn?"#define TONE_MAPPING":"",e.toneMapping!==Vn?jt.tonemapping_pars_fragment:"",e.toneMapping!==Vn?nU("toneMapping",e.toneMapping):"",e.dithering?"#define DITHERING":"",e.opaque?"#define OPAQUE":"",jt.encodings_pars_fragment,iU("linearToOutputTexel",e.outputEncoding),e.useDepthPacking?"#define DEPTH_PACKING "+e.depthPacking:"",`
`].filter(vo).join(`
`)),f=tf(f),f=Vg(f,e),f=zg(f,e),o=tf(o),o=Vg(o,e),o=zg(o,e),f=Gg(f),o=Gg(o),e.isWebGL2&&e.isRawShaderMaterial!==!0&&(v=`#version 300 es
`,d=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+d,g=["#define varying in",e.glslVersion===hg?"":"layout(location = 0) out highp vec4 pc_fragColor;",e.glslVersion===hg?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+g);const w=v+d+f,_=v+g+o,y=kg(r,35633,w),C=kg(r,35632,_);if(r.attachShader(m,y),r.attachShader(m,C),e.index0AttributeName!==void 0?r.bindAttribLocation(m,0,e.index0AttributeName):e.morphTargets===!0&&r.bindAttribLocation(m,0,"position"),r.linkProgram(m),n.debug.checkShaderErrors){const B=r.getProgramInfoLog(m).trim(),M=r.getShaderInfoLog(y).trim(),z=r.getShaderInfoLog(C).trim();let G=!0,P=!0;if(r.getProgramParameter(m,35714)===!1)if(G=!1,typeof n.debug.onShaderError=="function")n.debug.onShaderError(r,m,y,C);else{const R=Ng(r,y,"vertex"),W=Ng(r,C,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(m,35715)+`

Program Info Log: `+B+`
`+R+`
`+W)}else B!==""?console.warn("THREE.WebGLProgram: Program Info Log:",B):(M===""||z==="")&&(P=!1);P&&(this.diagnostics={runnable:G,programLog:B,vertexShader:{log:M,prefix:d},fragmentShader:{log:z,prefix:g}})}r.deleteShader(y),r.deleteShader(C);let b;this.getUniforms=function(){return b===void 0&&(b=new Kl(r,m)),b};let S;return this.getAttributes=function(){return S===void 0&&(S=aU(r,m)),S},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(m),this.program=void 0},this.name=e.shaderName,this.id=ZF++,this.cacheKey=t,this.usedTimes=1,this.program=m,this.vertexShader=y,this.fragmentShader=C,this}let mU=0;class vU{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){const e=t.vertexShader,i=t.fragmentShader,r=this._getShaderStage(e),a=this._getShaderStage(i),f=this._getShaderCacheForMaterial(t);return f.has(r)===!1&&(f.add(r),r.usedTimes++),f.has(a)===!1&&(f.add(a),a.usedTimes++),this}remove(t){const e=this.materialCache.get(t);for(const i of e)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const e=this.materialCache;let i=e.get(t);return i===void 0&&(i=new Set,e.set(t,i)),i}_getShaderStage(t){const e=this.shaderCache;let i=e.get(t);return i===void 0&&(i=new wU(t),e.set(t,i)),i}}class wU{constructor(t){this.id=mU++,this.code=t,this.usedTimes=0}}function _U(n,t,e,i,r,a,f){const o=new fd,s=new vU,l=[],u=r.isWebGL2,A=r.logarithmicDepthBuffer,c=r.vertexTextures;let h=r.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(B){return B===1?"uv2":"uv"}function d(B,M,z,G,P){const R=G.fog,W=P.geometry,K=B.isMeshStandardMaterial?G.environment:null,tt=(B.isMeshStandardMaterial?e:t).get(B.envMap||K),j=tt&&tt.mapping===Lc?tt.image.height:null,E=p[B.type];B.precision!==null&&(h=r.getMaxPrecision(B.precision),h!==B.precision&&console.warn("THREE.WebGLProgram.getParameters:",B.precision,"not supported, using",h,"instead."));const I=W.morphAttributes.position||W.morphAttributes.normal||W.morphAttributes.color,Q=I!==void 0?I.length:0;let D=0;W.morphAttributes.position!==void 0&&(D=1),W.morphAttributes.normal!==void 0&&(D=2),W.morphAttributes.color!==void 0&&(D=3);let k,U,T,V;if(E){const Tt=gn[E];k=Tt.vertexShader,U=Tt.fragmentShader}else k=B.vertexShader,U=B.fragmentShader,s.update(B),T=s.getVertexShaderID(B),V=s.getFragmentShaderID(B);const O=n.getRenderTarget(),et=P.isInstancedMesh===!0,q=!!B.map,J=!!B.matcap,st=!!tt,gt=!!B.aoMap,Y=!!B.lightMap,X=!!B.bumpMap,ot=!!B.normalMap,At=!!B.displacementMap,rt=!!B.emissiveMap,lt=!!B.metalnessMap,mt=!!B.roughnessMap,St=B.clearcoat>0,bt=B.iridescence>0,F=B.sheen>0,L=B.transmission>0,it=St&&!!B.clearcoatMap,ct=St&&!!B.clearcoatNormalMap,dt=St&&!!B.clearcoatRoughnessMap,vt=bt&&!!B.iridescenceMap,Ut=bt&&!!B.iridescenceThicknessMap,Ct=F&&!!B.sheenColorMap,ht=F&&!!B.sheenRoughnessMap,It=!!B.specularMap,Lt=!!B.specularColorMap,Nt=!!B.specularIntensityMap,Ft=L&&!!B.transmissionMap,Dt=L&&!!B.thicknessMap,Jt=!!B.gradientMap,fe=!!B.alphaMap,Fe=B.alphaTest>0,Z=!!B.extensions,ft=!!W.attributes.uv2;return{isWebGL2:u,shaderID:E,shaderName:B.type,vertexShader:k,fragmentShader:U,defines:B.defines,customVertexShaderID:T,customFragmentShaderID:V,isRawShaderMaterial:B.isRawShaderMaterial===!0,glslVersion:B.glslVersion,precision:h,instancing:et,instancingColor:et&&P.instanceColor!==null,supportsVertexTextures:c,outputEncoding:O===null?n.outputEncoding:O.isXRRenderTarget===!0?O.texture.encoding:cs,map:q,matcap:J,envMap:st,envMapMode:st&&tt.mapping,envMapCubeUVHeight:j,aoMap:gt,lightMap:Y,bumpMap:X,normalMap:ot,displacementMap:c&&At,emissiveMap:rt,normalMapObjectSpace:ot&&B.normalMapType===ME,normalMapTangentSpace:ot&&B.normalMapType===Ic,decodeVideoTexture:q&&B.map.isVideoTexture===!0&&B.map.encoding===le,metalnessMap:lt,roughnessMap:mt,clearcoat:St,clearcoatMap:it,clearcoatNormalMap:ct,clearcoatRoughnessMap:dt,iridescence:bt,iridescenceMap:vt,iridescenceThicknessMap:Ut,sheen:F,sheenColorMap:Ct,sheenRoughnessMap:ht,specularMap:It,specularColorMap:Lt,specularIntensityMap:Nt,transmission:L,transmissionMap:Ft,thicknessMap:Dt,gradientMap:Jt,opaque:B.transparent===!1&&B.blending===ha,alphaMap:fe,alphaTest:Fe,combine:B.combine,mapUv:q&&m(B.map.channel),aoMapUv:gt&&m(B.aoMap.channel),lightMapUv:Y&&m(B.lightMap.channel),bumpMapUv:X&&m(B.bumpMap.channel),normalMapUv:ot&&m(B.normalMap.channel),displacementMapUv:At&&m(B.displacementMap.channel),emissiveMapUv:rt&&m(B.emissiveMap.channel),metalnessMapUv:lt&&m(B.metalnessMap.channel),roughnessMapUv:mt&&m(B.roughnessMap.channel),clearcoatMapUv:it&&m(B.clearcoatMap.channel),clearcoatNormalMapUv:ct&&m(B.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:dt&&m(B.clearcoatRoughnessMap.channel),iridescenceMapUv:vt&&m(B.iridescenceMap.channel),iridescenceThicknessMapUv:Ut&&m(B.iridescenceThicknessMap.channel),sheenColorMapUv:Ct&&m(B.sheenColorMap.channel),sheenRoughnessMapUv:ht&&m(B.sheenRoughnessMap.channel),specularMapUv:It&&m(B.specularMap.channel),specularColorMapUv:Lt&&m(B.specularColorMap.channel),specularIntensityMapUv:Nt&&m(B.specularIntensityMap.channel),transmissionMapUv:Ft&&m(B.transmissionMap.channel),thicknessMapUv:Dt&&m(B.thicknessMap.channel),alphaMapUv:fe&&m(B.alphaMap.channel),vertexTangents:ot&&!!W.attributes.tangent,vertexColors:B.vertexColors,vertexAlphas:B.vertexColors===!0&&!!W.attributes.color&&W.attributes.color.itemSize===4,vertexUvs2:ft,pointsUvs:P.isPoints===!0&&!!W.attributes.uv&&(q||fe),fog:!!R,useFog:B.fog===!0,fogExp2:R&&R.isFogExp2,flatShading:B.flatShading===!0,sizeAttenuation:B.sizeAttenuation===!0,logarithmicDepthBuffer:A,skinning:P.isSkinnedMesh===!0,morphTargets:W.morphAttributes.position!==void 0,morphNormals:W.morphAttributes.normal!==void 0,morphColors:W.morphAttributes.color!==void 0,morphTargetsCount:Q,morphTextureStride:D,numDirLights:M.directional.length,numPointLights:M.point.length,numSpotLights:M.spot.length,numSpotLightMaps:M.spotLightMap.length,numRectAreaLights:M.rectArea.length,numHemiLights:M.hemi.length,numDirLightShadows:M.directionalShadowMap.length,numPointLightShadows:M.pointShadowMap.length,numSpotLightShadows:M.spotShadowMap.length,numSpotLightShadowsWithMaps:M.numSpotLightShadowsWithMaps,numClippingPlanes:f.numPlanes,numClipIntersection:f.numIntersection,dithering:B.dithering,shadowMapEnabled:n.shadowMap.enabled&&z.length>0,shadowMapType:n.shadowMap.type,toneMapping:B.toneMapped?n.toneMapping:Vn,useLegacyLights:n.useLegacyLights,premultipliedAlpha:B.premultipliedAlpha,doubleSided:B.side===Ui,flipSided:B.side===yi,useDepthPacking:B.depthPacking>=0,depthPacking:B.depthPacking||0,index0AttributeName:B.index0AttributeName,extensionDerivatives:Z&&B.extensions.derivatives===!0,extensionFragDepth:Z&&B.extensions.fragDepth===!0,extensionDrawBuffers:Z&&B.extensions.drawBuffers===!0,extensionShaderTextureLOD:Z&&B.extensions.shaderTextureLOD===!0,rendererExtensionFragDepth:u||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||i.has("EXT_shader_texture_lod"),customProgramCacheKey:B.customProgramCacheKey()}}function g(B){const M=[];if(B.shaderID?M.push(B.shaderID):(M.push(B.customVertexShaderID),M.push(B.customFragmentShaderID)),B.defines!==void 0)for(const z in B.defines)M.push(z),M.push(B.defines[z]);return B.isRawShaderMaterial===!1&&(v(M,B),w(M,B),M.push(n.outputEncoding)),M.push(B.customProgramCacheKey),M.join()}function v(B,M){B.push(M.precision),B.push(M.outputEncoding),B.push(M.envMapMode),B.push(M.envMapCubeUVHeight),B.push(M.mapUv),B.push(M.alphaMapUv),B.push(M.lightMapUv),B.push(M.aoMapUv),B.push(M.bumpMapUv),B.push(M.normalMapUv),B.push(M.displacementMapUv),B.push(M.emissiveMapUv),B.push(M.metalnessMapUv),B.push(M.roughnessMapUv),B.push(M.clearcoatMapUv),B.push(M.clearcoatNormalMapUv),B.push(M.clearcoatRoughnessMapUv),B.push(M.iridescenceMapUv),B.push(M.iridescenceThicknessMapUv),B.push(M.sheenColorMapUv),B.push(M.sheenRoughnessMapUv),B.push(M.specularMapUv),B.push(M.specularColorMapUv),B.push(M.specularIntensityMapUv),B.push(M.transmissionMapUv),B.push(M.thicknessMapUv),B.push(M.combine),B.push(M.fogExp2),B.push(M.sizeAttenuation),B.push(M.morphTargetsCount),B.push(M.morphAttributeCount),B.push(M.numDirLights),B.push(M.numPointLights),B.push(M.numSpotLights),B.push(M.numSpotLightMaps),B.push(M.numHemiLights),B.push(M.numRectAreaLights),B.push(M.numDirLightShadows),B.push(M.numPointLightShadows),B.push(M.numSpotLightShadows),B.push(M.numSpotLightShadowsWithMaps),B.push(M.shadowMapType),B.push(M.toneMapping),B.push(M.numClippingPlanes),B.push(M.numClipIntersection),B.push(M.depthPacking)}function w(B,M){o.disableAll(),M.isWebGL2&&o.enable(0),M.supportsVertexTextures&&o.enable(1),M.instancing&&o.enable(2),M.instancingColor&&o.enable(3),M.matcap&&o.enable(4),M.envMap&&o.enable(5),M.normalMapObjectSpace&&o.enable(6),M.normalMapTangentSpace&&o.enable(7),M.clearcoat&&o.enable(8),M.iridescence&&o.enable(9),M.alphaTest&&o.enable(10),M.vertexColors&&o.enable(11),M.vertexAlphas&&o.enable(12),M.vertexUvs2&&o.enable(13),M.vertexTangents&&o.enable(14),B.push(o.mask),o.disableAll(),M.fog&&o.enable(0),M.useFog&&o.enable(1),M.flatShading&&o.enable(2),M.logarithmicDepthBuffer&&o.enable(3),M.skinning&&o.enable(4),M.morphTargets&&o.enable(5),M.morphNormals&&o.enable(6),M.morphColors&&o.enable(7),M.premultipliedAlpha&&o.enable(8),M.shadowMapEnabled&&o.enable(9),M.useLegacyLights&&o.enable(10),M.doubleSided&&o.enable(11),M.flipSided&&o.enable(12),M.useDepthPacking&&o.enable(13),M.dithering&&o.enable(14),M.transmission&&o.enable(15),M.sheen&&o.enable(16),M.decodeVideoTexture&&o.enable(17),M.opaque&&o.enable(18),M.pointsUvs&&o.enable(19),B.push(o.mask)}function _(B){const M=p[B.type];let z;if(M){const G=gn[M];z=lM.clone(G.uniforms)}else z=B.uniforms;return z}function y(B,M){let z;for(let G=0,P=l.length;G<P;G++){const R=l[G];if(R.cacheKey===M){z=R,++z.usedTimes;break}}return z===void 0&&(z=new gU(n,M,B,a),l.push(z)),z}function C(B){if(--B.usedTimes===0){const M=l.indexOf(B);l[M]=l[l.length-1],l.pop(),B.destroy()}}function b(B){s.remove(B)}function S(){s.dispose()}return{getParameters:d,getProgramCacheKey:g,getUniforms:_,acquireProgram:y,releaseProgram:C,releaseShaderCache:b,programs:l,dispose:S}}function yU(){let n=new WeakMap;function t(a){let f=n.get(a);return f===void 0&&(f={},n.set(a,f)),f}function e(a){n.delete(a)}function i(a,f,o){n.get(a)[f]=o}function r(){n=new WeakMap}return{get:t,remove:e,update:i,dispose:r}}function xU(n,t){return n.groupOrder!==t.groupOrder?n.groupOrder-t.groupOrder:n.renderOrder!==t.renderOrder?n.renderOrder-t.renderOrder:n.material.id!==t.material.id?n.material.id-t.material.id:n.z!==t.z?n.z-t.z:n.id-t.id}function Kg(n,t){return n.groupOrder!==t.groupOrder?n.groupOrder-t.groupOrder:n.renderOrder!==t.renderOrder?n.renderOrder-t.renderOrder:n.z!==t.z?t.z-n.z:n.id-t.id}function Xg(){const n=[];let t=0;const e=[],i=[],r=[];function a(){t=0,e.length=0,i.length=0,r.length=0}function f(A,c,h,p,m,d){let g=n[t];return g===void 0?(g={id:A.id,object:A,geometry:c,material:h,groupOrder:p,renderOrder:A.renderOrder,z:m,group:d},n[t]=g):(g.id=A.id,g.object=A,g.geometry=c,g.material=h,g.groupOrder=p,g.renderOrder=A.renderOrder,g.z=m,g.group=d),t++,g}function o(A,c,h,p,m,d){const g=f(A,c,h,p,m,d);h.transmission>0?i.push(g):h.transparent===!0?r.push(g):e.push(g)}function s(A,c,h,p,m,d){const g=f(A,c,h,p,m,d);h.transmission>0?i.unshift(g):h.transparent===!0?r.unshift(g):e.unshift(g)}function l(A,c){e.length>1&&e.sort(A||xU),i.length>1&&i.sort(c||Kg),r.length>1&&r.sort(c||Kg)}function u(){for(let A=t,c=n.length;A<c;A++){const h=n[A];if(h.id===null)break;h.id=null,h.object=null,h.geometry=null,h.material=null,h.group=null}}return{opaque:e,transmissive:i,transparent:r,init:a,push:o,unshift:s,finish:u,sort:l}}function CU(){let n=new WeakMap;function t(i,r){const a=n.get(i);let f;return a===void 0?(f=new Xg,n.set(i,[f])):r>=a.length?(f=new Xg,a.push(f)):f=a[r],f}function e(){n=new WeakMap}return{get:t,dispose:e}}function bU(){const n={};return{get:function(t){if(n[t.id]!==void 0)return n[t.id];let e;switch(t.type){case"DirectionalLight":e={direction:new H,color:new Rt};break;case"SpotLight":e={position:new H,direction:new H,color:new Rt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":e={position:new H,color:new Rt,distance:0,decay:0};break;case"HemisphereLight":e={direction:new H,skyColor:new Rt,groundColor:new Rt};break;case"RectAreaLight":e={color:new Rt,position:new H,halfWidth:new H,halfHeight:new H};break}return n[t.id]=e,e}}}function BU(){const n={};return{get:function(t){if(n[t.id]!==void 0)return n[t.id];let e;switch(t.type){case"DirectionalLight":e={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new xt};break;case"SpotLight":e={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new xt};break;case"PointLight":e={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new xt,shadowCameraNear:1,shadowCameraFar:1e3};break}return n[t.id]=e,e}}}let SU=0;function EU(n,t){return(t.castShadow?2:0)-(n.castShadow?2:0)+(t.map?1:0)-(n.map?1:0)}function MU(n,t){const e=new bU,i=BU(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let u=0;u<9;u++)r.probe.push(new H);const a=new H,f=new Kt,o=new Kt;function s(u,A){let c=0,h=0,p=0;for(let z=0;z<9;z++)r.probe[z].set(0,0,0);let m=0,d=0,g=0,v=0,w=0,_=0,y=0,C=0,b=0,S=0;u.sort(EU);const B=A===!0?Math.PI:1;for(let z=0,G=u.length;z<G;z++){const P=u[z],R=P.color,W=P.intensity,K=P.distance,tt=P.shadow&&P.shadow.map?P.shadow.map.texture:null;if(P.isAmbientLight)c+=R.r*W*B,h+=R.g*W*B,p+=R.b*W*B;else if(P.isLightProbe)for(let j=0;j<9;j++)r.probe[j].addScaledVector(P.sh.coefficients[j],W);else if(P.isDirectionalLight){const j=e.get(P);if(j.color.copy(P.color).multiplyScalar(P.intensity*B),P.castShadow){const E=P.shadow,I=i.get(P);I.shadowBias=E.bias,I.shadowNormalBias=E.normalBias,I.shadowRadius=E.radius,I.shadowMapSize=E.mapSize,r.directionalShadow[m]=I,r.directionalShadowMap[m]=tt,r.directionalShadowMatrix[m]=P.shadow.matrix,_++}r.directional[m]=j,m++}else if(P.isSpotLight){const j=e.get(P);j.position.setFromMatrixPosition(P.matrixWorld),j.color.copy(R).multiplyScalar(W*B),j.distance=K,j.coneCos=Math.cos(P.angle),j.penumbraCos=Math.cos(P.angle*(1-P.penumbra)),j.decay=P.decay,r.spot[g]=j;const E=P.shadow;if(P.map&&(r.spotLightMap[b]=P.map,b++,E.updateMatrices(P),P.castShadow&&S++),r.spotLightMatrix[g]=E.matrix,P.castShadow){const I=i.get(P);I.shadowBias=E.bias,I.shadowNormalBias=E.normalBias,I.shadowRadius=E.radius,I.shadowMapSize=E.mapSize,r.spotShadow[g]=I,r.spotShadowMap[g]=tt,C++}g++}else if(P.isRectAreaLight){const j=e.get(P);j.color.copy(R).multiplyScalar(W),j.halfWidth.set(P.width*.5,0,0),j.halfHeight.set(0,P.height*.5,0),r.rectArea[v]=j,v++}else if(P.isPointLight){const j=e.get(P);if(j.color.copy(P.color).multiplyScalar(P.intensity*B),j.distance=P.distance,j.decay=P.decay,P.castShadow){const E=P.shadow,I=i.get(P);I.shadowBias=E.bias,I.shadowNormalBias=E.normalBias,I.shadowRadius=E.radius,I.shadowMapSize=E.mapSize,I.shadowCameraNear=E.camera.near,I.shadowCameraFar=E.camera.far,r.pointShadow[d]=I,r.pointShadowMap[d]=tt,r.pointShadowMatrix[d]=P.shadow.matrix,y++}r.point[d]=j,d++}else if(P.isHemisphereLight){const j=e.get(P);j.skyColor.copy(P.color).multiplyScalar(W*B),j.groundColor.copy(P.groundColor).multiplyScalar(W*B),r.hemi[w]=j,w++}}v>0&&(t.isWebGL2||n.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=Bt.LTC_FLOAT_1,r.rectAreaLTC2=Bt.LTC_FLOAT_2):n.has("OES_texture_half_float_linear")===!0?(r.rectAreaLTC1=Bt.LTC_HALF_1,r.rectAreaLTC2=Bt.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=c,r.ambient[1]=h,r.ambient[2]=p;const M=r.hash;(M.directionalLength!==m||M.pointLength!==d||M.spotLength!==g||M.rectAreaLength!==v||M.hemiLength!==w||M.numDirectionalShadows!==_||M.numPointShadows!==y||M.numSpotShadows!==C||M.numSpotMaps!==b)&&(r.directional.length=m,r.spot.length=g,r.rectArea.length=v,r.point.length=d,r.hemi.length=w,r.directionalShadow.length=_,r.directionalShadowMap.length=_,r.pointShadow.length=y,r.pointShadowMap.length=y,r.spotShadow.length=C,r.spotShadowMap.length=C,r.directionalShadowMatrix.length=_,r.pointShadowMatrix.length=y,r.spotLightMatrix.length=C+b-S,r.spotLightMap.length=b,r.numSpotLightShadowsWithMaps=S,M.directionalLength=m,M.pointLength=d,M.spotLength=g,M.rectAreaLength=v,M.hemiLength=w,M.numDirectionalShadows=_,M.numPointShadows=y,M.numSpotShadows=C,M.numSpotMaps=b,r.version=SU++)}function l(u,A){let c=0,h=0,p=0,m=0,d=0;const g=A.matrixWorldInverse;for(let v=0,w=u.length;v<w;v++){const _=u[v];if(_.isDirectionalLight){const y=r.directional[c];y.direction.setFromMatrixPosition(_.matrixWorld),a.setFromMatrixPosition(_.target.matrixWorld),y.direction.sub(a),y.direction.transformDirection(g),c++}else if(_.isSpotLight){const y=r.spot[p];y.position.setFromMatrixPosition(_.matrixWorld),y.position.applyMatrix4(g),y.direction.setFromMatrixPosition(_.matrixWorld),a.setFromMatrixPosition(_.target.matrixWorld),y.direction.sub(a),y.direction.transformDirection(g),p++}else if(_.isRectAreaLight){const y=r.rectArea[m];y.position.setFromMatrixPosition(_.matrixWorld),y.position.applyMatrix4(g),o.identity(),f.copy(_.matrixWorld),f.premultiply(g),o.extractRotation(f),y.halfWidth.set(_.width*.5,0,0),y.halfHeight.set(0,_.height*.5,0),y.halfWidth.applyMatrix4(o),y.halfHeight.applyMatrix4(o),m++}else if(_.isPointLight){const y=r.point[h];y.position.setFromMatrixPosition(_.matrixWorld),y.position.applyMatrix4(g),h++}else if(_.isHemisphereLight){const y=r.hemi[d];y.direction.setFromMatrixPosition(_.matrixWorld),y.direction.transformDirection(g),d++}}}return{setup:s,setupView:l,state:r}}function jg(n,t){const e=new MU(n,t),i=[],r=[];function a(){i.length=0,r.length=0}function f(A){i.push(A)}function o(A){r.push(A)}function s(A){e.setup(i,A)}function l(A){e.setupView(i,A)}return{init:a,state:{lightsArray:i,shadowsArray:r,lights:e},setupLights:s,setupLightsView:l,pushLight:f,pushShadow:o}}function TU(n,t){let e=new WeakMap;function i(a,f=0){const o=e.get(a);let s;return o===void 0?(s=new jg(n,t),e.set(a,[s])):f>=o.length?(s=new jg(n,t),o.push(s)):s=o[f],s}function r(){e=new WeakMap}return{get:i,dispose:r}}class FU extends Li{constructor(t){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=SE,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}class UU extends Li{constructor(t){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}const LU=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,IU=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function DU(n,t,e){let i=new dd;const r=new xt,a=new xt,f=new pe,o=new FU({depthPacking:EE}),s=new UU,l={},u=e.maxTextureSize,A={[Wn]:yi,[yi]:Wn,[Ui]:Ui},c=new Kn({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new xt},radius:{value:4}},vertexShader:LU,fragmentShader:IU}),h=c.clone();h.defines.HORIZONTAL_PASS=1;const p=new ke;p.setAttribute("position",new Oe(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new yt(p,c),d=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=W0,this.render=function(_,y,C){if(d.enabled===!1||d.autoUpdate===!1&&d.needsUpdate===!1||_.length===0)return;const b=n.getRenderTarget(),S=n.getActiveCubeFace(),B=n.getActiveMipmapLevel(),M=n.state;M.setBlending(gr),M.buffers.color.setClear(1,1,1,1),M.buffers.depth.setTest(!0),M.setScissorTest(!1);for(let z=0,G=_.length;z<G;z++){const P=_[z],R=P.shadow;if(R===void 0){console.warn("THREE.WebGLShadowMap:",P,"has no shadow.");continue}if(R.autoUpdate===!1&&R.needsUpdate===!1)continue;r.copy(R.mapSize);const W=R.getFrameExtents();if(r.multiply(W),a.copy(R.mapSize),(r.x>u||r.y>u)&&(r.x>u&&(a.x=Math.floor(u/W.x),r.x=a.x*W.x,R.mapSize.x=a.x),r.y>u&&(a.y=Math.floor(u/W.y),r.y=a.y*W.y,R.mapSize.y=a.y)),R.map===null){const tt=this.type!==mo?{minFilter:Xe,magFilter:Xe}:{};R.map=new xr(r.x,r.y,tt),R.map.texture.name=P.name+".shadowMap",R.camera.updateProjectionMatrix()}n.setRenderTarget(R.map),n.clear();const K=R.getViewportCount();for(let tt=0;tt<K;tt++){const j=R.getViewport(tt);f.set(a.x*j.x,a.y*j.y,a.x*j.z,a.y*j.w),M.viewport(f),R.updateMatrices(P,tt),i=R.getFrustum(),w(y,C,R.camera,P,this.type)}R.isPointLightShadow!==!0&&this.type===mo&&g(R,C),R.needsUpdate=!1}d.needsUpdate=!1,n.setRenderTarget(b,S,B)};function g(_,y){const C=t.update(m);c.defines.VSM_SAMPLES!==_.blurSamples&&(c.defines.VSM_SAMPLES=_.blurSamples,h.defines.VSM_SAMPLES=_.blurSamples,c.needsUpdate=!0,h.needsUpdate=!0),_.mapPass===null&&(_.mapPass=new xr(r.x,r.y)),c.uniforms.shadow_pass.value=_.map.texture,c.uniforms.resolution.value=_.mapSize,c.uniforms.radius.value=_.radius,n.setRenderTarget(_.mapPass),n.clear(),n.renderBufferDirect(y,null,C,c,m,null),h.uniforms.shadow_pass.value=_.mapPass.texture,h.uniforms.resolution.value=_.mapSize,h.uniforms.radius.value=_.radius,n.setRenderTarget(_.map),n.clear(),n.renderBufferDirect(y,null,C,h,m,null)}function v(_,y,C,b){let S=null;const B=C.isPointLight===!0?_.customDistanceMaterial:_.customDepthMaterial;if(B!==void 0)S=B;else if(S=C.isPointLight===!0?s:o,n.localClippingEnabled&&y.clipShadows===!0&&Array.isArray(y.clippingPlanes)&&y.clippingPlanes.length!==0||y.displacementMap&&y.displacementScale!==0||y.alphaMap&&y.alphaTest>0||y.map&&y.alphaTest>0){const M=S.uuid,z=y.uuid;let G=l[M];G===void 0&&(G={},l[M]=G);let P=G[z];P===void 0&&(P=S.clone(),G[z]=P),S=P}if(S.visible=y.visible,S.wireframe=y.wireframe,b===mo?S.side=y.shadowSide!==null?y.shadowSide:y.side:S.side=y.shadowSide!==null?y.shadowSide:A[y.side],S.alphaMap=y.alphaMap,S.alphaTest=y.alphaTest,S.map=y.map,S.clipShadows=y.clipShadows,S.clippingPlanes=y.clippingPlanes,S.clipIntersection=y.clipIntersection,S.displacementMap=y.displacementMap,S.displacementScale=y.displacementScale,S.displacementBias=y.displacementBias,S.wireframeLinewidth=y.wireframeLinewidth,S.linewidth=y.linewidth,C.isPointLight===!0&&S.isMeshDistanceMaterial===!0){const M=n.properties.get(S);M.light=C}return S}function w(_,y,C,b,S){if(_.visible===!1)return;if(_.layers.test(y.layers)&&(_.isMesh||_.isLine||_.isPoints)&&(_.castShadow||_.receiveShadow&&S===mo)&&(!_.frustumCulled||i.intersectsObject(_))){_.modelViewMatrix.multiplyMatrices(C.matrixWorldInverse,_.matrixWorld);const z=t.update(_),G=_.material;if(Array.isArray(G)){const P=z.groups;for(let R=0,W=P.length;R<W;R++){const K=P[R],tt=G[K.materialIndex];if(tt&&tt.visible){const j=v(_,tt,b,S);n.renderBufferDirect(C,null,z,j,_,K)}}}else if(G.visible){const P=v(_,G,b,S);n.renderBufferDirect(C,null,z,P,_,null)}}const M=_.children;for(let z=0,G=M.length;z<G;z++)w(M[z],y,C,b,S)}}function PU(n,t,e){const i=e.isWebGL2;function r(){let Z=!1;const ft=new pe;let _t=null;const Tt=new pe(0,0,0,0);return{setMask:function(Pt){_t!==Pt&&!Z&&(n.colorMask(Pt,Pt,Pt,Pt),_t=Pt)},setLocked:function(Pt){Z=Pt},setClear:function(Pt,ye,Ee,ti,qn){qn===!0&&(Pt*=ti,ye*=ti,Ee*=ti),ft.set(Pt,ye,Ee,ti),Tt.equals(ft)===!1&&(n.clearColor(Pt,ye,Ee,ti),Tt.copy(ft))},reset:function(){Z=!1,_t=null,Tt.set(-1,0,0,0)}}}function a(){let Z=!1,ft=null,_t=null,Tt=null;return{setTest:function(Pt){Pt?O(2929):et(2929)},setMask:function(Pt){ft!==Pt&&!Z&&(n.depthMask(Pt),ft=Pt)},setFunc:function(Pt){if(_t!==Pt){switch(Pt){case YS:n.depthFunc(512);break;case qS:n.depthFunc(519);break;case $S:n.depthFunc(513);break;case Ku:n.depthFunc(515);break;case JS:n.depthFunc(514);break;case ZS:n.depthFunc(518);break;case tE:n.depthFunc(516);break;case eE:n.depthFunc(517);break;default:n.depthFunc(515)}_t=Pt}},setLocked:function(Pt){Z=Pt},setClear:function(Pt){Tt!==Pt&&(n.clearDepth(Pt),Tt=Pt)},reset:function(){Z=!1,ft=null,_t=null,Tt=null}}}function f(){let Z=!1,ft=null,_t=null,Tt=null,Pt=null,ye=null,Ee=null,ti=null,qn=null;return{setTest:function(Ue){Z||(Ue?O(2960):et(2960))},setMask:function(Ue){ft!==Ue&&!Z&&(n.stencilMask(Ue),ft=Ue)},setFunc:function(Ue,Hi,hn){(_t!==Ue||Tt!==Hi||Pt!==hn)&&(n.stencilFunc(Ue,Hi,hn),_t=Ue,Tt=Hi,Pt=hn)},setOp:function(Ue,Hi,hn){(ye!==Ue||Ee!==Hi||ti!==hn)&&(n.stencilOp(Ue,Hi,hn),ye=Ue,Ee=Hi,ti=hn)},setLocked:function(Ue){Z=Ue},setClear:function(Ue){qn!==Ue&&(n.clearStencil(Ue),qn=Ue)},reset:function(){Z=!1,ft=null,_t=null,Tt=null,Pt=null,ye=null,Ee=null,ti=null,qn=null}}}const o=new r,s=new a,l=new f,u=new WeakMap,A=new WeakMap;let c={},h={},p=new WeakMap,m=[],d=null,g=!1,v=null,w=null,_=null,y=null,C=null,b=null,S=null,B=!1,M=null,z=null,G=null,P=null,R=null;const W=n.getParameter(35661);let K=!1,tt=0;const j=n.getParameter(7938);j.indexOf("WebGL")!==-1?(tt=parseFloat(/^WebGL (\d)/.exec(j)[1]),K=tt>=1):j.indexOf("OpenGL ES")!==-1&&(tt=parseFloat(/^OpenGL ES (\d)/.exec(j)[1]),K=tt>=2);let E=null,I={};const Q=n.getParameter(3088),D=n.getParameter(2978),k=new pe().fromArray(Q),U=new pe().fromArray(D);function T(Z,ft,_t){const Tt=new Uint8Array(4),Pt=n.createTexture();n.bindTexture(Z,Pt),n.texParameteri(Z,10241,9728),n.texParameteri(Z,10240,9728);for(let ye=0;ye<_t;ye++)n.texImage2D(ft+ye,0,6408,1,1,0,6408,5121,Tt);return Pt}const V={};V[3553]=T(3553,3553,1),V[34067]=T(34067,34069,6),o.setClear(0,0,0,1),s.setClear(1),l.setClear(0),O(2929),s.setFunc(Ku),At(!1),rt(Ip),O(2884),X(gr);function O(Z){c[Z]!==!0&&(n.enable(Z),c[Z]=!0)}function et(Z){c[Z]!==!1&&(n.disable(Z),c[Z]=!1)}function q(Z,ft){return h[Z]!==ft?(n.bindFramebuffer(Z,ft),h[Z]=ft,i&&(Z===36009&&(h[36160]=ft),Z===36160&&(h[36009]=ft)),!0):!1}function J(Z,ft){let _t=m,Tt=!1;if(Z)if(_t=p.get(ft),_t===void 0&&(_t=[],p.set(ft,_t)),Z.isWebGLMultipleRenderTargets){const Pt=Z.texture;if(_t.length!==Pt.length||_t[0]!==36064){for(let ye=0,Ee=Pt.length;ye<Ee;ye++)_t[ye]=36064+ye;_t.length=Pt.length,Tt=!0}}else _t[0]!==36064&&(_t[0]=36064,Tt=!0);else _t[0]!==1029&&(_t[0]=1029,Tt=!0);Tt&&(e.isWebGL2?n.drawBuffers(_t):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(_t))}function st(Z){return d!==Z?(n.useProgram(Z),d=Z,!0):!1}const gt={[ta]:32774,[RS]:32778,[HS]:32779};if(i)gt[Qp]=32775,gt[Rp]=32776;else{const Z=t.get("EXT_blend_minmax");Z!==null&&(gt[Qp]=Z.MIN_EXT,gt[Rp]=Z.MAX_EXT)}const Y={[kS]:0,[NS]:1,[VS]:768,[K0]:770,[jS]:776,[KS]:774,[GS]:772,[zS]:769,[X0]:771,[XS]:775,[WS]:773};function X(Z,ft,_t,Tt,Pt,ye,Ee,ti){if(Z===gr){g===!0&&(et(3042),g=!1);return}if(g===!1&&(O(3042),g=!0),Z!==QS){if(Z!==v||ti!==B){if((w!==ta||C!==ta)&&(n.blendEquation(32774),w=ta,C=ta),ti)switch(Z){case ha:n.blendFuncSeparate(1,771,1,771);break;case Dp:n.blendFunc(1,1);break;case Pp:n.blendFuncSeparate(0,769,0,1);break;case Op:n.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",Z);break}else switch(Z){case ha:n.blendFuncSeparate(770,771,1,771);break;case Dp:n.blendFunc(770,1);break;case Pp:n.blendFuncSeparate(0,769,0,1);break;case Op:n.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",Z);break}_=null,y=null,b=null,S=null,v=Z,B=ti}return}Pt=Pt||ft,ye=ye||_t,Ee=Ee||Tt,(ft!==w||Pt!==C)&&(n.blendEquationSeparate(gt[ft],gt[Pt]),w=ft,C=Pt),(_t!==_||Tt!==y||ye!==b||Ee!==S)&&(n.blendFuncSeparate(Y[_t],Y[Tt],Y[ye],Y[Ee]),_=_t,y=Tt,b=ye,S=Ee),v=Z,B=!1}function ot(Z,ft){Z.side===Ui?et(2884):O(2884);let _t=Z.side===yi;ft&&(_t=!_t),At(_t),Z.blending===ha&&Z.transparent===!1?X(gr):X(Z.blending,Z.blendEquation,Z.blendSrc,Z.blendDst,Z.blendEquationAlpha,Z.blendSrcAlpha,Z.blendDstAlpha,Z.premultipliedAlpha),s.setFunc(Z.depthFunc),s.setTest(Z.depthTest),s.setMask(Z.depthWrite),o.setMask(Z.colorWrite);const Tt=Z.stencilWrite;l.setTest(Tt),Tt&&(l.setMask(Z.stencilWriteMask),l.setFunc(Z.stencilFunc,Z.stencilRef,Z.stencilFuncMask),l.setOp(Z.stencilFail,Z.stencilZFail,Z.stencilZPass)),mt(Z.polygonOffset,Z.polygonOffsetFactor,Z.polygonOffsetUnits),Z.alphaToCoverage===!0?O(32926):et(32926)}function At(Z){M!==Z&&(Z?n.frontFace(2304):n.frontFace(2305),M=Z)}function rt(Z){Z!==DS?(O(2884),Z!==z&&(Z===Ip?n.cullFace(1029):Z===PS?n.cullFace(1028):n.cullFace(1032))):et(2884),z=Z}function lt(Z){Z!==G&&(K&&n.lineWidth(Z),G=Z)}function mt(Z,ft,_t){Z?(O(32823),(P!==ft||R!==_t)&&(n.polygonOffset(ft,_t),P=ft,R=_t)):et(32823)}function St(Z){Z?O(3089):et(3089)}function bt(Z){Z===void 0&&(Z=33984+W-1),E!==Z&&(n.activeTexture(Z),E=Z)}function F(Z,ft,_t){_t===void 0&&(E===null?_t=33984+W-1:_t=E);let Tt=I[_t];Tt===void 0&&(Tt={type:void 0,texture:void 0},I[_t]=Tt),(Tt.type!==Z||Tt.texture!==ft)&&(E!==_t&&(n.activeTexture(_t),E=_t),n.bindTexture(Z,ft||V[Z]),Tt.type=Z,Tt.texture=ft)}function L(){const Z=I[E];Z!==void 0&&Z.type!==void 0&&(n.bindTexture(Z.type,null),Z.type=void 0,Z.texture=void 0)}function it(){try{n.compressedTexImage2D.apply(n,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function ct(){try{n.compressedTexImage3D.apply(n,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function dt(){try{n.texSubImage2D.apply(n,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function vt(){try{n.texSubImage3D.apply(n,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function Ut(){try{n.compressedTexSubImage2D.apply(n,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function Ct(){try{n.compressedTexSubImage3D.apply(n,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function ht(){try{n.texStorage2D.apply(n,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function It(){try{n.texStorage3D.apply(n,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function Lt(){try{n.texImage2D.apply(n,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function Nt(){try{n.texImage3D.apply(n,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function Ft(Z){k.equals(Z)===!1&&(n.scissor(Z.x,Z.y,Z.z,Z.w),k.copy(Z))}function Dt(Z){U.equals(Z)===!1&&(n.viewport(Z.x,Z.y,Z.z,Z.w),U.copy(Z))}function Jt(Z,ft){let _t=A.get(ft);_t===void 0&&(_t=new WeakMap,A.set(ft,_t));let Tt=_t.get(Z);Tt===void 0&&(Tt=n.getUniformBlockIndex(ft,Z.name),_t.set(Z,Tt))}function fe(Z,ft){const Tt=A.get(ft).get(Z);u.get(ft)!==Tt&&(n.uniformBlockBinding(ft,Tt,Z.__bindingPointIndex),u.set(ft,Tt))}function Fe(){n.disable(3042),n.disable(2884),n.disable(2929),n.disable(32823),n.disable(3089),n.disable(2960),n.disable(32926),n.blendEquation(32774),n.blendFunc(1,0),n.blendFuncSeparate(1,0,1,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(513),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(519,0,4294967295),n.stencilOp(7680,7680,7680),n.clearStencil(0),n.cullFace(1029),n.frontFace(2305),n.polygonOffset(0,0),n.activeTexture(33984),n.bindFramebuffer(36160,null),i===!0&&(n.bindFramebuffer(36009,null),n.bindFramebuffer(36008,null)),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),c={},E=null,I={},h={},p=new WeakMap,m=[],d=null,g=!1,v=null,w=null,_=null,y=null,C=null,b=null,S=null,B=!1,M=null,z=null,G=null,P=null,R=null,k.set(0,0,n.canvas.width,n.canvas.height),U.set(0,0,n.canvas.width,n.canvas.height),o.reset(),s.reset(),l.reset()}return{buffers:{color:o,depth:s,stencil:l},enable:O,disable:et,bindFramebuffer:q,drawBuffers:J,useProgram:st,setBlending:X,setMaterial:ot,setFlipSided:At,setCullFace:rt,setLineWidth:lt,setPolygonOffset:mt,setScissorTest:St,activeTexture:bt,bindTexture:F,unbindTexture:L,compressedTexImage2D:it,compressedTexImage3D:ct,texImage2D:Lt,texImage3D:Nt,updateUBOMapping:Jt,uniformBlockBinding:fe,texStorage2D:ht,texStorage3D:It,texSubImage2D:dt,texSubImage3D:vt,compressedTexSubImage2D:Ut,compressedTexSubImage3D:Ct,scissor:Ft,viewport:Dt,reset:Fe}}function OU(n,t,e,i,r,a,f){const o=r.isWebGL2,s=r.maxTextures,l=r.maxCubemapSize,u=r.maxTextureSize,A=r.maxSamples,c=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,h=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),p=new WeakMap;let m;const d=new WeakMap;let g=!1;try{g=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function v(F,L){return g?new OffscreenCanvas(F,L):Wo("canvas")}function w(F,L,it,ct){let dt=1;if((F.width>ct||F.height>ct)&&(dt=ct/Math.max(F.width,F.height)),dt<1||L===!0)if(typeof HTMLImageElement<"u"&&F instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&F instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&F instanceof ImageBitmap){const vt=L?tw:Math.floor,Ut=vt(dt*F.width),Ct=vt(dt*F.height);m===void 0&&(m=v(Ut,Ct));const ht=it?v(Ut,Ct):m;return ht.width=Ut,ht.height=Ct,ht.getContext("2d").drawImage(F,0,0,Ut,Ct),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+F.width+"x"+F.height+") to ("+Ut+"x"+Ct+")."),ht}else return"data"in F&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+F.width+"x"+F.height+")."),F;return F}function _(F){return Zu(F.width)&&Zu(F.height)}function y(F){return o?!1:F.wrapS!==Wi||F.wrapT!==Wi||F.minFilter!==Xe&&F.minFilter!==vi}function C(F,L){return F.generateMipmaps&&L&&F.minFilter!==Xe&&F.minFilter!==vi}function b(F){n.generateMipmap(F)}function S(F,L,it,ct,dt=!1){if(o===!1)return L;if(F!==null){if(n[F]!==void 0)return n[F];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+F+"'")}let vt=L;return L===6403&&(it===5126&&(vt=33326),it===5131&&(vt=33325),it===5121&&(vt=33321)),L===33319&&(it===5126&&(vt=33328),it===5131&&(vt=33327),it===5121&&(vt=33323)),L===6408&&(it===5126&&(vt=34836),it===5131&&(vt=34842),it===5121&&(vt=ct===le&&dt===!1?35907:32856),it===32819&&(vt=32854),it===32820&&(vt=32855)),(vt===33325||vt===33326||vt===33327||vt===33328||vt===34842||vt===34836)&&t.get("EXT_color_buffer_float"),vt}function B(F,L,it){return C(F,it)===!0||F.isFramebufferTexture&&F.minFilter!==Xe&&F.minFilter!==vi?Math.log2(Math.max(L.width,L.height))+1:F.mipmaps!==void 0&&F.mipmaps.length>0?F.mipmaps.length:F.isCompressedTexture&&Array.isArray(F.image)?L.mipmaps.length:1}function M(F){return F===Xe||F===Yu||F===Wl?9728:9729}function z(F){const L=F.target;L.removeEventListener("dispose",z),P(L),L.isVideoTexture&&p.delete(L)}function G(F){const L=F.target;L.removeEventListener("dispose",G),W(L)}function P(F){const L=i.get(F);if(L.__webglInit===void 0)return;const it=F.source,ct=d.get(it);if(ct){const dt=ct[L.__cacheKey];dt.usedTimes--,dt.usedTimes===0&&R(F),Object.keys(ct).length===0&&d.delete(it)}i.remove(F)}function R(F){const L=i.get(F);n.deleteTexture(L.__webglTexture);const it=F.source,ct=d.get(it);delete ct[L.__cacheKey],f.memory.textures--}function W(F){const L=F.texture,it=i.get(F),ct=i.get(L);if(ct.__webglTexture!==void 0&&(n.deleteTexture(ct.__webglTexture),f.memory.textures--),F.depthTexture&&F.depthTexture.dispose(),F.isWebGLCubeRenderTarget)for(let dt=0;dt<6;dt++)n.deleteFramebuffer(it.__webglFramebuffer[dt]),it.__webglDepthbuffer&&n.deleteRenderbuffer(it.__webglDepthbuffer[dt]);else{if(n.deleteFramebuffer(it.__webglFramebuffer),it.__webglDepthbuffer&&n.deleteRenderbuffer(it.__webglDepthbuffer),it.__webglMultisampledFramebuffer&&n.deleteFramebuffer(it.__webglMultisampledFramebuffer),it.__webglColorRenderbuffer)for(let dt=0;dt<it.__webglColorRenderbuffer.length;dt++)it.__webglColorRenderbuffer[dt]&&n.deleteRenderbuffer(it.__webglColorRenderbuffer[dt]);it.__webglDepthRenderbuffer&&n.deleteRenderbuffer(it.__webglDepthRenderbuffer)}if(F.isWebGLMultipleRenderTargets)for(let dt=0,vt=L.length;dt<vt;dt++){const Ut=i.get(L[dt]);Ut.__webglTexture&&(n.deleteTexture(Ut.__webglTexture),f.memory.textures--),i.remove(L[dt])}i.remove(L),i.remove(F)}let K=0;function tt(){K=0}function j(){const F=K;return F>=s&&console.warn("THREE.WebGLTextures: Trying to use "+F+" texture units while this GPU supports only "+s),K+=1,F}function E(F){const L=[];return L.push(F.wrapS),L.push(F.wrapT),L.push(F.wrapR||0),L.push(F.magFilter),L.push(F.minFilter),L.push(F.anisotropy),L.push(F.internalFormat),L.push(F.format),L.push(F.type),L.push(F.generateMipmaps),L.push(F.premultiplyAlpha),L.push(F.flipY),L.push(F.unpackAlignment),L.push(F.encoding),L.join()}function I(F,L){const it=i.get(F);if(F.isVideoTexture&&St(F),F.isRenderTargetTexture===!1&&F.version>0&&it.__version!==F.version){const ct=F.image;if(ct===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(ct.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{et(it,F,L);return}}e.bindTexture(3553,it.__webglTexture,33984+L)}function Q(F,L){const it=i.get(F);if(F.version>0&&it.__version!==F.version){et(it,F,L);return}e.bindTexture(35866,it.__webglTexture,33984+L)}function D(F,L){const it=i.get(F);if(F.version>0&&it.__version!==F.version){et(it,F,L);return}e.bindTexture(32879,it.__webglTexture,33984+L)}function k(F,L){const it=i.get(F);if(F.version>0&&it.__version!==F.version){q(it,F,L);return}e.bindTexture(34067,it.__webglTexture,33984+L)}const U={[Ba]:10497,[Wi]:33071,[nc]:33648},T={[Xe]:9728,[Yu]:9984,[Wl]:9986,[vi]:9729,[Y0]:9985,[As]:9987};function V(F,L,it){if(it?(n.texParameteri(F,10242,U[L.wrapS]),n.texParameteri(F,10243,U[L.wrapT]),(F===32879||F===35866)&&n.texParameteri(F,32882,U[L.wrapR]),n.texParameteri(F,10240,T[L.magFilter]),n.texParameteri(F,10241,T[L.minFilter])):(n.texParameteri(F,10242,33071),n.texParameteri(F,10243,33071),(F===32879||F===35866)&&n.texParameteri(F,32882,33071),(L.wrapS!==Wi||L.wrapT!==Wi)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),n.texParameteri(F,10240,M(L.magFilter)),n.texParameteri(F,10241,M(L.minFilter)),L.minFilter!==Xe&&L.minFilter!==vi&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),t.has("EXT_texture_filter_anisotropic")===!0){const ct=t.get("EXT_texture_filter_anisotropic");if(L.magFilter===Xe||L.minFilter!==Wl&&L.minFilter!==As||L.type===ur&&t.has("OES_texture_float_linear")===!1||o===!1&&L.type===Vo&&t.has("OES_texture_half_float_linear")===!1)return;(L.anisotropy>1||i.get(L).__currentAnisotropy)&&(n.texParameterf(F,ct.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(L.anisotropy,r.getMaxAnisotropy())),i.get(L).__currentAnisotropy=L.anisotropy)}}function O(F,L){let it=!1;F.__webglInit===void 0&&(F.__webglInit=!0,L.addEventListener("dispose",z));const ct=L.source;let dt=d.get(ct);dt===void 0&&(dt={},d.set(ct,dt));const vt=E(L);if(vt!==F.__cacheKey){dt[vt]===void 0&&(dt[vt]={texture:n.createTexture(),usedTimes:0},f.memory.textures++,it=!0),dt[vt].usedTimes++;const Ut=dt[F.__cacheKey];Ut!==void 0&&(dt[F.__cacheKey].usedTimes--,Ut.usedTimes===0&&R(L)),F.__cacheKey=vt,F.__webglTexture=dt[vt].texture}return it}function et(F,L,it){let ct=3553;(L.isDataArrayTexture||L.isCompressedArrayTexture)&&(ct=35866),L.isData3DTexture&&(ct=32879);const dt=O(F,L),vt=L.source;e.bindTexture(ct,F.__webglTexture,33984+it);const Ut=i.get(vt);if(vt.version!==Ut.__version||dt===!0){e.activeTexture(33984+it),n.pixelStorei(37440,L.flipY),n.pixelStorei(37441,L.premultiplyAlpha),n.pixelStorei(3317,L.unpackAlignment),n.pixelStorei(37443,0);const Ct=y(L)&&_(L.image)===!1;let ht=w(L.image,Ct,!1,u);ht=bt(L,ht);const It=_(ht)||o,Lt=a.convert(L.format,L.encoding);let Nt=a.convert(L.type),Ft=S(L.internalFormat,Lt,Nt,L.encoding,L.isVideoTexture);V(ct,L,It);let Dt;const Jt=L.mipmaps,fe=o&&L.isVideoTexture!==!0,Fe=Ut.__version===void 0||dt===!0,Z=B(L,ht,It);if(L.isDepthTexture)Ft=6402,o?L.type===ur?Ft=36012:L.type===qr?Ft=33190:L.type===ua?Ft=35056:Ft=33189:L.type===ur&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),L.format===Zr&&Ft===6402&&L.type!==q0&&L.type!==qr&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),L.type=qr,Nt=a.convert(L.type)),L.format===Sa&&Ft===6402&&(Ft=34041,L.type!==ua&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),L.type=ua,Nt=a.convert(L.type))),Fe&&(fe?e.texStorage2D(3553,1,Ft,ht.width,ht.height):e.texImage2D(3553,0,Ft,ht.width,ht.height,0,Lt,Nt,null));else if(L.isDataTexture)if(Jt.length>0&&It){fe&&Fe&&e.texStorage2D(3553,Z,Ft,Jt[0].width,Jt[0].height);for(let ft=0,_t=Jt.length;ft<_t;ft++)Dt=Jt[ft],fe?e.texSubImage2D(3553,ft,0,0,Dt.width,Dt.height,Lt,Nt,Dt.data):e.texImage2D(3553,ft,Ft,Dt.width,Dt.height,0,Lt,Nt,Dt.data);L.generateMipmaps=!1}else fe?(Fe&&e.texStorage2D(3553,Z,Ft,ht.width,ht.height),e.texSubImage2D(3553,0,0,0,ht.width,ht.height,Lt,Nt,ht.data)):e.texImage2D(3553,0,Ft,ht.width,ht.height,0,Lt,Nt,ht.data);else if(L.isCompressedTexture)if(L.isCompressedArrayTexture){fe&&Fe&&e.texStorage3D(35866,Z,Ft,Jt[0].width,Jt[0].height,ht.depth);for(let ft=0,_t=Jt.length;ft<_t;ft++)Dt=Jt[ft],L.format!==Ki?Lt!==null?fe?e.compressedTexSubImage3D(35866,ft,0,0,0,Dt.width,Dt.height,ht.depth,Lt,Dt.data,0,0):e.compressedTexImage3D(35866,ft,Ft,Dt.width,Dt.height,ht.depth,0,Dt.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):fe?e.texSubImage3D(35866,ft,0,0,0,Dt.width,Dt.height,ht.depth,Lt,Nt,Dt.data):e.texImage3D(35866,ft,Ft,Dt.width,Dt.height,ht.depth,0,Lt,Nt,Dt.data)}else{fe&&Fe&&e.texStorage2D(3553,Z,Ft,Jt[0].width,Jt[0].height);for(let ft=0,_t=Jt.length;ft<_t;ft++)Dt=Jt[ft],L.format!==Ki?Lt!==null?fe?e.compressedTexSubImage2D(3553,ft,0,0,Dt.width,Dt.height,Lt,Dt.data):e.compressedTexImage2D(3553,ft,Ft,Dt.width,Dt.height,0,Dt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):fe?e.texSubImage2D(3553,ft,0,0,Dt.width,Dt.height,Lt,Nt,Dt.data):e.texImage2D(3553,ft,Ft,Dt.width,Dt.height,0,Lt,Nt,Dt.data)}else if(L.isDataArrayTexture)fe?(Fe&&e.texStorage3D(35866,Z,Ft,ht.width,ht.height,ht.depth),e.texSubImage3D(35866,0,0,0,0,ht.width,ht.height,ht.depth,Lt,Nt,ht.data)):e.texImage3D(35866,0,Ft,ht.width,ht.height,ht.depth,0,Lt,Nt,ht.data);else if(L.isData3DTexture)fe?(Fe&&e.texStorage3D(32879,Z,Ft,ht.width,ht.height,ht.depth),e.texSubImage3D(32879,0,0,0,0,ht.width,ht.height,ht.depth,Lt,Nt,ht.data)):e.texImage3D(32879,0,Ft,ht.width,ht.height,ht.depth,0,Lt,Nt,ht.data);else if(L.isFramebufferTexture){if(Fe)if(fe)e.texStorage2D(3553,Z,Ft,ht.width,ht.height);else{let ft=ht.width,_t=ht.height;for(let Tt=0;Tt<Z;Tt++)e.texImage2D(3553,Tt,Ft,ft,_t,0,Lt,Nt,null),ft>>=1,_t>>=1}}else if(Jt.length>0&&It){fe&&Fe&&e.texStorage2D(3553,Z,Ft,Jt[0].width,Jt[0].height);for(let ft=0,_t=Jt.length;ft<_t;ft++)Dt=Jt[ft],fe?e.texSubImage2D(3553,ft,0,0,Lt,Nt,Dt):e.texImage2D(3553,ft,Ft,Lt,Nt,Dt);L.generateMipmaps=!1}else fe?(Fe&&e.texStorage2D(3553,Z,Ft,ht.width,ht.height),e.texSubImage2D(3553,0,0,0,Lt,Nt,ht)):e.texImage2D(3553,0,Ft,Lt,Nt,ht);C(L,It)&&b(ct),Ut.__version=vt.version,L.onUpdate&&L.onUpdate(L)}F.__version=L.version}function q(F,L,it){if(L.image.length!==6)return;const ct=O(F,L),dt=L.source;e.bindTexture(34067,F.__webglTexture,33984+it);const vt=i.get(dt);if(dt.version!==vt.__version||ct===!0){e.activeTexture(33984+it),n.pixelStorei(37440,L.flipY),n.pixelStorei(37441,L.premultiplyAlpha),n.pixelStorei(3317,L.unpackAlignment),n.pixelStorei(37443,0);const Ut=L.isCompressedTexture||L.image[0].isCompressedTexture,Ct=L.image[0]&&L.image[0].isDataTexture,ht=[];for(let ft=0;ft<6;ft++)!Ut&&!Ct?ht[ft]=w(L.image[ft],!1,!0,l):ht[ft]=Ct?L.image[ft].image:L.image[ft],ht[ft]=bt(L,ht[ft]);const It=ht[0],Lt=_(It)||o,Nt=a.convert(L.format,L.encoding),Ft=a.convert(L.type),Dt=S(L.internalFormat,Nt,Ft,L.encoding),Jt=o&&L.isVideoTexture!==!0,fe=vt.__version===void 0||ct===!0;let Fe=B(L,It,Lt);V(34067,L,Lt);let Z;if(Ut){Jt&&fe&&e.texStorage2D(34067,Fe,Dt,It.width,It.height);for(let ft=0;ft<6;ft++){Z=ht[ft].mipmaps;for(let _t=0;_t<Z.length;_t++){const Tt=Z[_t];L.format!==Ki?Nt!==null?Jt?e.compressedTexSubImage2D(34069+ft,_t,0,0,Tt.width,Tt.height,Nt,Tt.data):e.compressedTexImage2D(34069+ft,_t,Dt,Tt.width,Tt.height,0,Tt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Jt?e.texSubImage2D(34069+ft,_t,0,0,Tt.width,Tt.height,Nt,Ft,Tt.data):e.texImage2D(34069+ft,_t,Dt,Tt.width,Tt.height,0,Nt,Ft,Tt.data)}}}else{Z=L.mipmaps,Jt&&fe&&(Z.length>0&&Fe++,e.texStorage2D(34067,Fe,Dt,ht[0].width,ht[0].height));for(let ft=0;ft<6;ft++)if(Ct){Jt?e.texSubImage2D(34069+ft,0,0,0,ht[ft].width,ht[ft].height,Nt,Ft,ht[ft].data):e.texImage2D(34069+ft,0,Dt,ht[ft].width,ht[ft].height,0,Nt,Ft,ht[ft].data);for(let _t=0;_t<Z.length;_t++){const Pt=Z[_t].image[ft].image;Jt?e.texSubImage2D(34069+ft,_t+1,0,0,Pt.width,Pt.height,Nt,Ft,Pt.data):e.texImage2D(34069+ft,_t+1,Dt,Pt.width,Pt.height,0,Nt,Ft,Pt.data)}}else{Jt?e.texSubImage2D(34069+ft,0,0,0,Nt,Ft,ht[ft]):e.texImage2D(34069+ft,0,Dt,Nt,Ft,ht[ft]);for(let _t=0;_t<Z.length;_t++){const Tt=Z[_t];Jt?e.texSubImage2D(34069+ft,_t+1,0,0,Nt,Ft,Tt.image[ft]):e.texImage2D(34069+ft,_t+1,Dt,Nt,Ft,Tt.image[ft])}}}C(L,Lt)&&b(34067),vt.__version=dt.version,L.onUpdate&&L.onUpdate(L)}F.__version=L.version}function J(F,L,it,ct,dt){const vt=a.convert(it.format,it.encoding),Ut=a.convert(it.type),Ct=S(it.internalFormat,vt,Ut,it.encoding);i.get(L).__hasExternalTextures||(dt===32879||dt===35866?e.texImage3D(dt,0,Ct,L.width,L.height,L.depth,0,vt,Ut,null):e.texImage2D(dt,0,Ct,L.width,L.height,0,vt,Ut,null)),e.bindFramebuffer(36160,F),mt(L)?c.framebufferTexture2DMultisampleEXT(36160,ct,dt,i.get(it).__webglTexture,0,lt(L)):(dt===3553||dt>=34069&&dt<=34074)&&n.framebufferTexture2D(36160,ct,dt,i.get(it).__webglTexture,0),e.bindFramebuffer(36160,null)}function st(F,L,it){if(n.bindRenderbuffer(36161,F),L.depthBuffer&&!L.stencilBuffer){let ct=33189;if(it||mt(L)){const dt=L.depthTexture;dt&&dt.isDepthTexture&&(dt.type===ur?ct=36012:dt.type===qr&&(ct=33190));const vt=lt(L);mt(L)?c.renderbufferStorageMultisampleEXT(36161,vt,ct,L.width,L.height):n.renderbufferStorageMultisample(36161,vt,ct,L.width,L.height)}else n.renderbufferStorage(36161,ct,L.width,L.height);n.framebufferRenderbuffer(36160,36096,36161,F)}else if(L.depthBuffer&&L.stencilBuffer){const ct=lt(L);it&&mt(L)===!1?n.renderbufferStorageMultisample(36161,ct,35056,L.width,L.height):mt(L)?c.renderbufferStorageMultisampleEXT(36161,ct,35056,L.width,L.height):n.renderbufferStorage(36161,34041,L.width,L.height),n.framebufferRenderbuffer(36160,33306,36161,F)}else{const ct=L.isWebGLMultipleRenderTargets===!0?L.texture:[L.texture];for(let dt=0;dt<ct.length;dt++){const vt=ct[dt],Ut=a.convert(vt.format,vt.encoding),Ct=a.convert(vt.type),ht=S(vt.internalFormat,Ut,Ct,vt.encoding),It=lt(L);it&&mt(L)===!1?n.renderbufferStorageMultisample(36161,It,ht,L.width,L.height):mt(L)?c.renderbufferStorageMultisampleEXT(36161,It,ht,L.width,L.height):n.renderbufferStorage(36161,ht,L.width,L.height)}}n.bindRenderbuffer(36161,null)}function gt(F,L){if(L&&L.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(36160,F),!(L.depthTexture&&L.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!i.get(L.depthTexture).__webglTexture||L.depthTexture.image.width!==L.width||L.depthTexture.image.height!==L.height)&&(L.depthTexture.image.width=L.width,L.depthTexture.image.height=L.height,L.depthTexture.needsUpdate=!0),I(L.depthTexture,0);const ct=i.get(L.depthTexture).__webglTexture,dt=lt(L);if(L.depthTexture.format===Zr)mt(L)?c.framebufferTexture2DMultisampleEXT(36160,36096,3553,ct,0,dt):n.framebufferTexture2D(36160,36096,3553,ct,0);else if(L.depthTexture.format===Sa)mt(L)?c.framebufferTexture2DMultisampleEXT(36160,33306,3553,ct,0,dt):n.framebufferTexture2D(36160,33306,3553,ct,0);else throw new Error("Unknown depthTexture format")}function Y(F){const L=i.get(F),it=F.isWebGLCubeRenderTarget===!0;if(F.depthTexture&&!L.__autoAllocateDepthBuffer){if(it)throw new Error("target.depthTexture not supported in Cube render targets");gt(L.__webglFramebuffer,F)}else if(it){L.__webglDepthbuffer=[];for(let ct=0;ct<6;ct++)e.bindFramebuffer(36160,L.__webglFramebuffer[ct]),L.__webglDepthbuffer[ct]=n.createRenderbuffer(),st(L.__webglDepthbuffer[ct],F,!1)}else e.bindFramebuffer(36160,L.__webglFramebuffer),L.__webglDepthbuffer=n.createRenderbuffer(),st(L.__webglDepthbuffer,F,!1);e.bindFramebuffer(36160,null)}function X(F,L,it){const ct=i.get(F);L!==void 0&&J(ct.__webglFramebuffer,F,F.texture,36064,3553),it!==void 0&&Y(F)}function ot(F){const L=F.texture,it=i.get(F),ct=i.get(L);F.addEventListener("dispose",G),F.isWebGLMultipleRenderTargets!==!0&&(ct.__webglTexture===void 0&&(ct.__webglTexture=n.createTexture()),ct.__version=L.version,f.memory.textures++);const dt=F.isWebGLCubeRenderTarget===!0,vt=F.isWebGLMultipleRenderTargets===!0,Ut=_(F)||o;if(dt){it.__webglFramebuffer=[];for(let Ct=0;Ct<6;Ct++)it.__webglFramebuffer[Ct]=n.createFramebuffer()}else{if(it.__webglFramebuffer=n.createFramebuffer(),vt)if(r.drawBuffers){const Ct=F.texture;for(let ht=0,It=Ct.length;ht<It;ht++){const Lt=i.get(Ct[ht]);Lt.__webglTexture===void 0&&(Lt.__webglTexture=n.createTexture(),f.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(o&&F.samples>0&&mt(F)===!1){const Ct=vt?L:[L];it.__webglMultisampledFramebuffer=n.createFramebuffer(),it.__webglColorRenderbuffer=[],e.bindFramebuffer(36160,it.__webglMultisampledFramebuffer);for(let ht=0;ht<Ct.length;ht++){const It=Ct[ht];it.__webglColorRenderbuffer[ht]=n.createRenderbuffer(),n.bindRenderbuffer(36161,it.__webglColorRenderbuffer[ht]);const Lt=a.convert(It.format,It.encoding),Nt=a.convert(It.type),Ft=S(It.internalFormat,Lt,Nt,It.encoding,F.isXRRenderTarget===!0),Dt=lt(F);n.renderbufferStorageMultisample(36161,Dt,Ft,F.width,F.height),n.framebufferRenderbuffer(36160,36064+ht,36161,it.__webglColorRenderbuffer[ht])}n.bindRenderbuffer(36161,null),F.depthBuffer&&(it.__webglDepthRenderbuffer=n.createRenderbuffer(),st(it.__webglDepthRenderbuffer,F,!0)),e.bindFramebuffer(36160,null)}}if(dt){e.bindTexture(34067,ct.__webglTexture),V(34067,L,Ut);for(let Ct=0;Ct<6;Ct++)J(it.__webglFramebuffer[Ct],F,L,36064,34069+Ct);C(L,Ut)&&b(34067),e.unbindTexture()}else if(vt){const Ct=F.texture;for(let ht=0,It=Ct.length;ht<It;ht++){const Lt=Ct[ht],Nt=i.get(Lt);e.bindTexture(3553,Nt.__webglTexture),V(3553,Lt,Ut),J(it.__webglFramebuffer,F,Lt,36064+ht,3553),C(Lt,Ut)&&b(3553)}e.unbindTexture()}else{let Ct=3553;(F.isWebGL3DRenderTarget||F.isWebGLArrayRenderTarget)&&(o?Ct=F.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),e.bindTexture(Ct,ct.__webglTexture),V(Ct,L,Ut),J(it.__webglFramebuffer,F,L,36064,Ct),C(L,Ut)&&b(Ct),e.unbindTexture()}F.depthBuffer&&Y(F)}function At(F){const L=_(F)||o,it=F.isWebGLMultipleRenderTargets===!0?F.texture:[F.texture];for(let ct=0,dt=it.length;ct<dt;ct++){const vt=it[ct];if(C(vt,L)){const Ut=F.isWebGLCubeRenderTarget?34067:3553,Ct=i.get(vt).__webglTexture;e.bindTexture(Ut,Ct),b(Ut),e.unbindTexture()}}}function rt(F){if(o&&F.samples>0&&mt(F)===!1){const L=F.isWebGLMultipleRenderTargets?F.texture:[F.texture],it=F.width,ct=F.height;let dt=16384;const vt=[],Ut=F.stencilBuffer?33306:36096,Ct=i.get(F),ht=F.isWebGLMultipleRenderTargets===!0;if(ht)for(let It=0;It<L.length;It++)e.bindFramebuffer(36160,Ct.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(36160,36064+It,36161,null),e.bindFramebuffer(36160,Ct.__webglFramebuffer),n.framebufferTexture2D(36009,36064+It,3553,null,0);e.bindFramebuffer(36008,Ct.__webglMultisampledFramebuffer),e.bindFramebuffer(36009,Ct.__webglFramebuffer);for(let It=0;It<L.length;It++){vt.push(36064+It),F.depthBuffer&&vt.push(Ut);const Lt=Ct.__ignoreDepthValues!==void 0?Ct.__ignoreDepthValues:!1;if(Lt===!1&&(F.depthBuffer&&(dt|=256),F.stencilBuffer&&(dt|=1024)),ht&&n.framebufferRenderbuffer(36008,36064,36161,Ct.__webglColorRenderbuffer[It]),Lt===!0&&(n.invalidateFramebuffer(36008,[Ut]),n.invalidateFramebuffer(36009,[Ut])),ht){const Nt=i.get(L[It]).__webglTexture;n.framebufferTexture2D(36009,36064,3553,Nt,0)}n.blitFramebuffer(0,0,it,ct,0,0,it,ct,dt,9728),h&&n.invalidateFramebuffer(36008,vt)}if(e.bindFramebuffer(36008,null),e.bindFramebuffer(36009,null),ht)for(let It=0;It<L.length;It++){e.bindFramebuffer(36160,Ct.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(36160,36064+It,36161,Ct.__webglColorRenderbuffer[It]);const Lt=i.get(L[It]).__webglTexture;e.bindFramebuffer(36160,Ct.__webglFramebuffer),n.framebufferTexture2D(36009,36064+It,3553,Lt,0)}e.bindFramebuffer(36009,Ct.__webglMultisampledFramebuffer)}}function lt(F){return Math.min(A,F.samples)}function mt(F){const L=i.get(F);return o&&F.samples>0&&t.has("WEBGL_multisampled_render_to_texture")===!0&&L.__useRenderToTexture!==!1}function St(F){const L=f.render.frame;p.get(F)!==L&&(p.set(F,L),F.update())}function bt(F,L){const it=F.encoding,ct=F.format,dt=F.type;return F.isCompressedTexture===!0||F.isVideoTexture===!0||F.format===Ju||it!==cs&&(it===le?o===!1?t.has("EXT_sRGB")===!0&&ct===Ki?(F.format=Ju,F.minFilter=vi,F.generateMipmaps=!1):L=nw.sRGBToLinear(L):(ct!==Ki||dt!==ls)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",it)),L}this.allocateTextureUnit=j,this.resetTextureUnits=tt,this.setTexture2D=I,this.setTexture2DArray=Q,this.setTexture3D=D,this.setTextureCube=k,this.rebindTextures=X,this.setupRenderTarget=ot,this.updateRenderTargetMipmap=At,this.updateMultisampleRenderTarget=rt,this.setupDepthRenderbuffer=Y,this.setupFrameBufferTexture=J,this.useMultisampledRTT=mt}function QU(n,t,e){const i=e.isWebGL2;function r(a,f=null){let o;if(a===ls)return 5121;if(a===uE)return 32819;if(a===fE)return 32820;if(a===lE)return 5120;if(a===cE)return 5122;if(a===q0)return 5123;if(a===hE)return 5124;if(a===qr)return 5125;if(a===ur)return 5126;if(a===Vo)return i?5131:(o=t.get("OES_texture_half_float"),o!==null?o.HALF_FLOAT_OES:null);if(a===dE)return 6406;if(a===Ki)return 6408;if(a===pE)return 6409;if(a===gE)return 6410;if(a===Zr)return 6402;if(a===Sa)return 34041;if(a===Ju)return o=t.get("EXT_sRGB"),o!==null?o.SRGB_ALPHA_EXT:null;if(a===mE)return 6403;if(a===vE)return 36244;if(a===wE)return 33319;if(a===_E)return 33320;if(a===yE)return 36249;if(a===yh||a===xh||a===Ch||a===bh)if(f===le)if(o=t.get("WEBGL_compressed_texture_s3tc_srgb"),o!==null){if(a===yh)return o.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(a===xh)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(a===Ch)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(a===bh)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(o=t.get("WEBGL_compressed_texture_s3tc"),o!==null){if(a===yh)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(a===xh)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(a===Ch)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(a===bh)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(a===Hp||a===kp||a===Np||a===Vp)if(o=t.get("WEBGL_compressed_texture_pvrtc"),o!==null){if(a===Hp)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(a===kp)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(a===Np)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(a===Vp)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(a===xE)return o=t.get("WEBGL_compressed_texture_etc1"),o!==null?o.COMPRESSED_RGB_ETC1_WEBGL:null;if(a===zp||a===Gp)if(o=t.get("WEBGL_compressed_texture_etc"),o!==null){if(a===zp)return f===le?o.COMPRESSED_SRGB8_ETC2:o.COMPRESSED_RGB8_ETC2;if(a===Gp)return f===le?o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:o.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(a===Wp||a===Kp||a===Xp||a===jp||a===Yp||a===qp||a===$p||a===Jp||a===Zp||a===tg||a===eg||a===ig||a===ng||a===rg)if(o=t.get("WEBGL_compressed_texture_astc"),o!==null){if(a===Wp)return f===le?o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:o.COMPRESSED_RGBA_ASTC_4x4_KHR;if(a===Kp)return f===le?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:o.COMPRESSED_RGBA_ASTC_5x4_KHR;if(a===Xp)return f===le?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:o.COMPRESSED_RGBA_ASTC_5x5_KHR;if(a===jp)return f===le?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:o.COMPRESSED_RGBA_ASTC_6x5_KHR;if(a===Yp)return f===le?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:o.COMPRESSED_RGBA_ASTC_6x6_KHR;if(a===qp)return f===le?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:o.COMPRESSED_RGBA_ASTC_8x5_KHR;if(a===$p)return f===le?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:o.COMPRESSED_RGBA_ASTC_8x6_KHR;if(a===Jp)return f===le?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:o.COMPRESSED_RGBA_ASTC_8x8_KHR;if(a===Zp)return f===le?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:o.COMPRESSED_RGBA_ASTC_10x5_KHR;if(a===tg)return f===le?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:o.COMPRESSED_RGBA_ASTC_10x6_KHR;if(a===eg)return f===le?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:o.COMPRESSED_RGBA_ASTC_10x8_KHR;if(a===ig)return f===le?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:o.COMPRESSED_RGBA_ASTC_10x10_KHR;if(a===ng)return f===le?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:o.COMPRESSED_RGBA_ASTC_12x10_KHR;if(a===rg)return f===le?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:o.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(a===Bh)if(o=t.get("EXT_texture_compression_bptc"),o!==null){if(a===Bh)return f===le?o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:o.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(a===CE||a===sg||a===ag||a===og)if(o=t.get("EXT_texture_compression_rgtc"),o!==null){if(a===Bh)return o.COMPRESSED_RED_RGTC1_EXT;if(a===sg)return o.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(a===ag)return o.COMPRESSED_RED_GREEN_RGTC2_EXT;if(a===og)return o.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return a===ua?i?34042:(o=t.get("WEBGL_depth_texture"),o!==null?o.UNSIGNED_INT_24_8_WEBGL:null):n[a]!==void 0?n[a]:null}return{convert:r}}class RU extends ui{constructor(t=[]){super(),this.isArrayCamera=!0,this.cameras=t}}let _i=class extends ce{constructor(){super(),this.isGroup=!0,this.type="Group"}};const HU={type:"move"};class Yh{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new _i,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new _i,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new H,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new H),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new _i,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new H,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new H),this._grip}dispatchEvent(t){return this._targetRay!==null&&this._targetRay.dispatchEvent(t),this._grip!==null&&this._grip.dispatchEvent(t),this._hand!==null&&this._hand.dispatchEvent(t),this}connect(t){if(t&&t.hand){const e=this._hand;if(e)for(const i of t.hand.values())this._getHandJoint(e,i)}return this.dispatchEvent({type:"connected",data:t}),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(t,e,i){let r=null,a=null,f=null;const o=this._targetRay,s=this._grip,l=this._hand;if(t&&e.session.visibilityState!=="visible-blurred"){if(l&&t.hand){f=!0;for(const m of t.hand.values()){const d=e.getJointPose(m,i),g=this._getHandJoint(l,m);d!==null&&(g.matrix.fromArray(d.transform.matrix),g.matrix.decompose(g.position,g.rotation,g.scale),g.jointRadius=d.radius),g.visible=d!==null}const u=l.joints["index-finger-tip"],A=l.joints["thumb-tip"],c=u.position.distanceTo(A.position),h=.02,p=.005;l.inputState.pinching&&c>h+p?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!l.inputState.pinching&&c<=h-p&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else s!==null&&t.gripSpace&&(a=e.getPose(t.gripSpace,i),a!==null&&(s.matrix.fromArray(a.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),a.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(a.linearVelocity)):s.hasLinearVelocity=!1,a.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(a.angularVelocity)):s.hasAngularVelocity=!1));o!==null&&(r=e.getPose(t.targetRaySpace,i),r===null&&a!==null&&(r=a),r!==null&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(HU)))}return o!==null&&(o.visible=r!==null),s!==null&&(s.visible=a!==null),l!==null&&(l.visible=f!==null),this}_getHandJoint(t,e){if(t.joints[e.jointName]===void 0){const i=new _i;i.matrixAutoUpdate=!1,i.visible=!1,t.joints[e.jointName]=i,t.add(i)}return t.joints[e.jointName]}}class kU extends je{constructor(t,e,i,r,a,f,o,s,l,u){if(u=u!==void 0?u:Zr,u!==Zr&&u!==Sa)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&u===Zr&&(i=qr),i===void 0&&u===Sa&&(i=ua),super(null,r,a,f,o,s,u,i,l),this.isDepthTexture=!0,this.image={width:t,height:e},this.magFilter=o!==void 0?o:Xe,this.minFilter=s!==void 0?s:Xe,this.flipY=!1,this.generateMipmaps=!1}}class NU extends Ha{constructor(t,e){super();const i=this;let r=null,a=1,f=null,o="local-floor",s=1,l=null,u=null,A=null,c=null,h=null,p=null;const m=e.getContextAttributes();let d=null,g=null;const v=[],w=[],_=new Set,y=new Map,C=new ui;C.layers.enable(1),C.viewport=new pe;const b=new ui;b.layers.enable(2),b.viewport=new pe;const S=[C,b],B=new RU;B.layers.enable(1),B.layers.enable(2);let M=null,z=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(k){let U=v[k];return U===void 0&&(U=new Yh,v[k]=U),U.getTargetRaySpace()},this.getControllerGrip=function(k){let U=v[k];return U===void 0&&(U=new Yh,v[k]=U),U.getGripSpace()},this.getHand=function(k){let U=v[k];return U===void 0&&(U=new Yh,v[k]=U),U.getHandSpace()};function G(k){const U=w.indexOf(k.inputSource);if(U===-1)return;const T=v[U];T!==void 0&&T.dispatchEvent({type:k.type,data:k.inputSource})}function P(){r.removeEventListener("select",G),r.removeEventListener("selectstart",G),r.removeEventListener("selectend",G),r.removeEventListener("squeeze",G),r.removeEventListener("squeezestart",G),r.removeEventListener("squeezeend",G),r.removeEventListener("end",P),r.removeEventListener("inputsourceschange",R);for(let k=0;k<v.length;k++){const U=w[k];U!==null&&(w[k]=null,v[k].disconnect(U))}M=null,z=null,t.setRenderTarget(d),h=null,c=null,A=null,r=null,g=null,D.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(k){a=k,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(k){o=k,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||f},this.setReferenceSpace=function(k){l=k},this.getBaseLayer=function(){return c!==null?c:h},this.getBinding=function(){return A},this.getFrame=function(){return p},this.getSession=function(){return r},this.setSession=async function(k){if(r=k,r!==null){if(d=t.getRenderTarget(),r.addEventListener("select",G),r.addEventListener("selectstart",G),r.addEventListener("selectend",G),r.addEventListener("squeeze",G),r.addEventListener("squeezestart",G),r.addEventListener("squeezeend",G),r.addEventListener("end",P),r.addEventListener("inputsourceschange",R),m.xrCompatible!==!0&&await e.makeXRCompatible(),r.renderState.layers===void 0||t.capabilities.isWebGL2===!1){const U={antialias:r.renderState.layers===void 0?m.antialias:!0,alpha:m.alpha,depth:m.depth,stencil:m.stencil,framebufferScaleFactor:a};h=new XRWebGLLayer(r,e,U),r.updateRenderState({baseLayer:h}),g=new xr(h.framebufferWidth,h.framebufferHeight,{format:Ki,type:ls,encoding:t.outputEncoding,stencilBuffer:m.stencil})}else{let U=null,T=null,V=null;m.depth&&(V=m.stencil?35056:33190,U=m.stencil?Sa:Zr,T=m.stencil?ua:qr);const O={colorFormat:32856,depthFormat:V,scaleFactor:a};A=new XRWebGLBinding(r,e),c=A.createProjectionLayer(O),r.updateRenderState({layers:[c]}),g=new xr(c.textureWidth,c.textureHeight,{format:Ki,type:ls,depthTexture:new kU(c.textureWidth,c.textureHeight,T,void 0,void 0,void 0,void 0,void 0,void 0,U),stencilBuffer:m.stencil,encoding:t.outputEncoding,samples:m.antialias?4:0});const et=t.properties.get(g);et.__ignoreDepthValues=c.ignoreDepthValues}g.isXRRenderTarget=!0,this.setFoveation(s),l=null,f=await r.requestReferenceSpace(o),D.setContext(r),D.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}};function R(k){for(let U=0;U<k.removed.length;U++){const T=k.removed[U],V=w.indexOf(T);V>=0&&(w[V]=null,v[V].disconnect(T))}for(let U=0;U<k.added.length;U++){const T=k.added[U];let V=w.indexOf(T);if(V===-1){for(let et=0;et<v.length;et++)if(et>=w.length){w.push(T),V=et;break}else if(w[et]===null){w[et]=T,V=et;break}if(V===-1)break}const O=v[V];O&&O.connect(T)}}const W=new H,K=new H;function tt(k,U,T){W.setFromMatrixPosition(U.matrixWorld),K.setFromMatrixPosition(T.matrixWorld);const V=W.distanceTo(K),O=U.projectionMatrix.elements,et=T.projectionMatrix.elements,q=O[14]/(O[10]-1),J=O[14]/(O[10]+1),st=(O[9]+1)/O[5],gt=(O[9]-1)/O[5],Y=(O[8]-1)/O[0],X=(et[8]+1)/et[0],ot=q*Y,At=q*X,rt=V/(-Y+X),lt=rt*-Y;U.matrixWorld.decompose(k.position,k.quaternion,k.scale),k.translateX(lt),k.translateZ(rt),k.matrixWorld.compose(k.position,k.quaternion,k.scale),k.matrixWorldInverse.copy(k.matrixWorld).invert();const mt=q+rt,St=J+rt,bt=ot-lt,F=At+(V-lt),L=st*J/St*mt,it=gt*J/St*mt;k.projectionMatrix.makePerspective(bt,F,L,it,mt,St),k.projectionMatrixInverse.copy(k.projectionMatrix).invert()}function j(k,U){U===null?k.matrixWorld.copy(k.matrix):k.matrixWorld.multiplyMatrices(U.matrixWorld,k.matrix),k.matrixWorldInverse.copy(k.matrixWorld).invert()}this.updateCamera=function(k){if(r===null)return;B.near=b.near=C.near=k.near,B.far=b.far=C.far=k.far,(M!==B.near||z!==B.far)&&(r.updateRenderState({depthNear:B.near,depthFar:B.far}),M=B.near,z=B.far);const U=k.parent,T=B.cameras;j(B,U);for(let V=0;V<T.length;V++)j(T[V],U);T.length===2?tt(B,C,b):B.projectionMatrix.copy(C.projectionMatrix),E(k,B,U)};function E(k,U,T){T===null?k.matrix.copy(U.matrixWorld):(k.matrix.copy(T.matrixWorld),k.matrix.invert(),k.matrix.multiply(U.matrixWorld)),k.matrix.decompose(k.position,k.quaternion,k.scale),k.updateMatrixWorld(!0);const V=k.children;for(let O=0,et=V.length;O<et;O++)V[O].updateMatrixWorld(!0);k.projectionMatrix.copy(U.projectionMatrix),k.projectionMatrixInverse.copy(U.projectionMatrixInverse),k.isPerspectiveCamera&&(k.fov=Ma*2*Math.atan(1/k.projectionMatrix.elements[5]),k.zoom=1)}this.getCamera=function(){return B},this.getFoveation=function(){if(!(c===null&&h===null))return s},this.setFoveation=function(k){s=k,c!==null&&(c.fixedFoveation=k),h!==null&&h.fixedFoveation!==void 0&&(h.fixedFoveation=k)},this.getPlanes=function(){return _};let I=null;function Q(k,U){if(u=U.getViewerPose(l||f),p=U,u!==null){const T=u.views;h!==null&&(t.setRenderTargetFramebuffer(g,h.framebuffer),t.setRenderTarget(g));let V=!1;T.length!==B.cameras.length&&(B.cameras.length=0,V=!0);for(let O=0;O<T.length;O++){const et=T[O];let q=null;if(h!==null)q=h.getViewport(et);else{const st=A.getViewSubImage(c,et);q=st.viewport,O===0&&(t.setRenderTargetTextures(g,st.colorTexture,c.ignoreDepthValues?void 0:st.depthStencilTexture),t.setRenderTarget(g))}let J=S[O];J===void 0&&(J=new ui,J.layers.enable(O),J.viewport=new pe,S[O]=J),J.matrix.fromArray(et.transform.matrix),J.matrix.decompose(J.position,J.quaternion,J.scale),J.projectionMatrix.fromArray(et.projectionMatrix),J.projectionMatrixInverse.copy(J.projectionMatrix).invert(),J.viewport.set(q.x,q.y,q.width,q.height),O===0&&(B.matrix.copy(J.matrix),B.matrix.decompose(B.position,B.quaternion,B.scale)),V===!0&&B.cameras.push(J)}}for(let T=0;T<v.length;T++){const V=w[T],O=v[T];V!==null&&O!==void 0&&O.update(V,U,l||f)}if(I&&I(k,U),U.detectedPlanes){i.dispatchEvent({type:"planesdetected",data:U.detectedPlanes});let T=null;for(const V of _)U.detectedPlanes.has(V)||(T===null&&(T=[]),T.push(V));if(T!==null)for(const V of T)_.delete(V),y.delete(V),i.dispatchEvent({type:"planeremoved",data:V});for(const V of U.detectedPlanes)if(!_.has(V))_.add(V),y.set(V,U.lastChangedTime),i.dispatchEvent({type:"planeadded",data:V});else{const O=y.get(V);V.lastChangedTime>O&&(y.set(V,V.lastChangedTime),i.dispatchEvent({type:"planechanged",data:V}))}}p=null}const D=new fw;D.setAnimationLoop(Q),this.setAnimationLoop=function(k){I=k},this.dispose=function(){}}}function VU(n,t){function e(d,g){d.matrixAutoUpdate===!0&&d.updateMatrix(),g.value.copy(d.matrix)}function i(d,g){g.color.getRGB(d.fogColor.value,cw(n)),g.isFog?(d.fogNear.value=g.near,d.fogFar.value=g.far):g.isFogExp2&&(d.fogDensity.value=g.density)}function r(d,g,v,w,_){g.isMeshBasicMaterial||g.isMeshLambertMaterial?a(d,g):g.isMeshToonMaterial?(a(d,g),A(d,g)):g.isMeshPhongMaterial?(a(d,g),u(d,g)):g.isMeshStandardMaterial?(a(d,g),c(d,g),g.isMeshPhysicalMaterial&&h(d,g,_)):g.isMeshMatcapMaterial?(a(d,g),p(d,g)):g.isMeshDepthMaterial?a(d,g):g.isMeshDistanceMaterial?(a(d,g),m(d,g)):g.isMeshNormalMaterial?a(d,g):g.isLineBasicMaterial?(f(d,g),g.isLineDashedMaterial&&o(d,g)):g.isPointsMaterial?s(d,g,v,w):g.isSpriteMaterial?l(d,g):g.isShadowMaterial?(d.color.value.copy(g.color),d.opacity.value=g.opacity):g.isShaderMaterial&&(g.uniformsNeedUpdate=!1)}function a(d,g){d.opacity.value=g.opacity,g.color&&d.diffuse.value.copy(g.color),g.emissive&&d.emissive.value.copy(g.emissive).multiplyScalar(g.emissiveIntensity),g.map&&(d.map.value=g.map,e(g.map,d.mapTransform)),g.alphaMap&&(d.alphaMap.value=g.alphaMap,e(g.alphaMap,d.alphaMapTransform)),g.bumpMap&&(d.bumpMap.value=g.bumpMap,e(g.bumpMap,d.bumpMapTransform),d.bumpScale.value=g.bumpScale,g.side===yi&&(d.bumpScale.value*=-1)),g.normalMap&&(d.normalMap.value=g.normalMap,e(g.normalMap,d.normalMapTransform),d.normalScale.value.copy(g.normalScale),g.side===yi&&d.normalScale.value.negate()),g.displacementMap&&(d.displacementMap.value=g.displacementMap,e(g.displacementMap,d.displacementMapTransform),d.displacementScale.value=g.displacementScale,d.displacementBias.value=g.displacementBias),g.emissiveMap&&(d.emissiveMap.value=g.emissiveMap,e(g.emissiveMap,d.emissiveMapTransform)),g.specularMap&&(d.specularMap.value=g.specularMap,e(g.specularMap,d.specularMapTransform)),g.alphaTest>0&&(d.alphaTest.value=g.alphaTest);const v=t.get(g).envMap;if(v&&(d.envMap.value=v,d.flipEnvMap.value=v.isCubeTexture&&v.isRenderTargetTexture===!1?-1:1,d.reflectivity.value=g.reflectivity,d.ior.value=g.ior,d.refractionRatio.value=g.refractionRatio),g.lightMap){d.lightMap.value=g.lightMap;const w=n.useLegacyLights===!0?Math.PI:1;d.lightMapIntensity.value=g.lightMapIntensity*w,e(g.lightMap,d.lightMapTransform)}g.aoMap&&(d.aoMap.value=g.aoMap,d.aoMapIntensity.value=g.aoMapIntensity,e(g.aoMap,d.aoMapTransform))}function f(d,g){d.diffuse.value.copy(g.color),d.opacity.value=g.opacity,g.map&&(d.map.value=g.map,e(g.map,d.mapTransform))}function o(d,g){d.dashSize.value=g.dashSize,d.totalSize.value=g.dashSize+g.gapSize,d.scale.value=g.scale}function s(d,g,v,w){d.diffuse.value.copy(g.color),d.opacity.value=g.opacity,d.size.value=g.size*v,d.scale.value=w*.5,g.map&&(d.map.value=g.map,e(g.map,d.uvTransform)),g.alphaMap&&(d.alphaMap.value=g.alphaMap),g.alphaTest>0&&(d.alphaTest.value=g.alphaTest)}function l(d,g){d.diffuse.value.copy(g.color),d.opacity.value=g.opacity,d.rotation.value=g.rotation,g.map&&(d.map.value=g.map,e(g.map,d.mapTransform)),g.alphaMap&&(d.alphaMap.value=g.alphaMap),g.alphaTest>0&&(d.alphaTest.value=g.alphaTest)}function u(d,g){d.specular.value.copy(g.specular),d.shininess.value=Math.max(g.shininess,1e-4)}function A(d,g){g.gradientMap&&(d.gradientMap.value=g.gradientMap)}function c(d,g){d.metalness.value=g.metalness,g.metalnessMap&&(d.metalnessMap.value=g.metalnessMap,e(g.metalnessMap,d.metalnessMapTransform)),d.roughness.value=g.roughness,g.roughnessMap&&(d.roughnessMap.value=g.roughnessMap,e(g.roughnessMap,d.roughnessMapTransform)),t.get(g).envMap&&(d.envMapIntensity.value=g.envMapIntensity)}function h(d,g,v){d.ior.value=g.ior,g.sheen>0&&(d.sheenColor.value.copy(g.sheenColor).multiplyScalar(g.sheen),d.sheenRoughness.value=g.sheenRoughness,g.sheenColorMap&&(d.sheenColorMap.value=g.sheenColorMap,e(g.sheenColorMap,d.sheenColorMapTransform)),g.sheenRoughnessMap&&(d.sheenRoughnessMap.value=g.sheenRoughnessMap,e(g.sheenRoughnessMap,d.sheenRoughnessMapTransform))),g.clearcoat>0&&(d.clearcoat.value=g.clearcoat,d.clearcoatRoughness.value=g.clearcoatRoughness,g.clearcoatMap&&(d.clearcoatMap.value=g.clearcoatMap,e(g.clearcoatMap,d.clearcoatMapTransform)),g.clearcoatRoughnessMap&&(d.clearcoatRoughnessMap.value=g.clearcoatRoughnessMap,e(g.clearcoatRoughnessMap,d.clearcoatRoughnessMapTransform)),g.clearcoatNormalMap&&(d.clearcoatNormalMap.value=g.clearcoatNormalMap,e(g.clearcoatNormalMap,d.clearcoatNormalMapTransform),d.clearcoatNormalScale.value.copy(g.clearcoatNormalScale),g.side===yi&&d.clearcoatNormalScale.value.negate())),g.iridescence>0&&(d.iridescence.value=g.iridescence,d.iridescenceIOR.value=g.iridescenceIOR,d.iridescenceThicknessMinimum.value=g.iridescenceThicknessRange[0],d.iridescenceThicknessMaximum.value=g.iridescenceThicknessRange[1],g.iridescenceMap&&(d.iridescenceMap.value=g.iridescenceMap,e(g.iridescenceMap,d.iridescenceMapTransform)),g.iridescenceThicknessMap&&(d.iridescenceThicknessMap.value=g.iridescenceThicknessMap,e(g.iridescenceThicknessMap,d.iridescenceThicknessMapTransform))),g.transmission>0&&(d.transmission.value=g.transmission,d.transmissionSamplerMap.value=v.texture,d.transmissionSamplerSize.value.set(v.width,v.height),g.transmissionMap&&(d.transmissionMap.value=g.transmissionMap,e(g.transmissionMap,d.transmissionMapTransform)),d.thickness.value=g.thickness,g.thicknessMap&&(d.thicknessMap.value=g.thicknessMap,e(g.thicknessMap,d.thicknessMapTransform)),d.attenuationDistance.value=g.attenuationDistance,d.attenuationColor.value.copy(g.attenuationColor)),d.specularIntensity.value=g.specularIntensity,d.specularColor.value.copy(g.specularColor),g.specularColorMap&&(d.specularColorMap.value=g.specularColorMap,e(g.specularColorMap,d.specularColorMapTransform)),g.specularIntensityMap&&(d.specularIntensityMap.value=g.specularIntensityMap,e(g.specularIntensityMap,d.specularIntensityMapTransform))}function p(d,g){g.matcap&&(d.matcap.value=g.matcap)}function m(d,g){const v=t.get(g).light;d.referencePosition.value.setFromMatrixPosition(v.matrixWorld),d.nearDistance.value=v.shadow.camera.near,d.farDistance.value=v.shadow.camera.far}return{refreshFogUniforms:i,refreshMaterialUniforms:r}}function zU(n,t,e,i){let r={},a={},f=[];const o=e.isWebGL2?n.getParameter(35375):0;function s(v,w){const _=w.program;i.uniformBlockBinding(v,_)}function l(v,w){let _=r[v.id];_===void 0&&(p(v),_=u(v),r[v.id]=_,v.addEventListener("dispose",d));const y=w.program;i.updateUBOMapping(v,y);const C=t.render.frame;a[v.id]!==C&&(c(v),a[v.id]=C)}function u(v){const w=A();v.__bindingPointIndex=w;const _=n.createBuffer(),y=v.__size,C=v.usage;return n.bindBuffer(35345,_),n.bufferData(35345,y,C),n.bindBuffer(35345,null),n.bindBufferBase(35345,w,_),_}function A(){for(let v=0;v<o;v++)if(f.indexOf(v)===-1)return f.push(v),v;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function c(v){const w=r[v.id],_=v.uniforms,y=v.__cache;n.bindBuffer(35345,w);for(let C=0,b=_.length;C<b;C++){const S=_[C];if(h(S,C,y)===!0){const B=S.__offset,M=Array.isArray(S.value)?S.value:[S.value];let z=0;for(let G=0;G<M.length;G++){const P=M[G],R=m(P);typeof P=="number"?(S.__data[0]=P,n.bufferSubData(35345,B+z,S.__data)):P.isMatrix3?(S.__data[0]=P.elements[0],S.__data[1]=P.elements[1],S.__data[2]=P.elements[2],S.__data[3]=P.elements[0],S.__data[4]=P.elements[3],S.__data[5]=P.elements[4],S.__data[6]=P.elements[5],S.__data[7]=P.elements[0],S.__data[8]=P.elements[6],S.__data[9]=P.elements[7],S.__data[10]=P.elements[8],S.__data[11]=P.elements[0]):(P.toArray(S.__data,z),z+=R.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(35345,B,S.__data)}}n.bindBuffer(35345,null)}function h(v,w,_){const y=v.value;if(_[w]===void 0){if(typeof y=="number")_[w]=y;else{const C=Array.isArray(y)?y:[y],b=[];for(let S=0;S<C.length;S++)b.push(C[S].clone());_[w]=b}return!0}else if(typeof y=="number"){if(_[w]!==y)return _[w]=y,!0}else{const C=Array.isArray(_[w])?_[w]:[_[w]],b=Array.isArray(y)?y:[y];for(let S=0;S<C.length;S++){const B=C[S];if(B.equals(b[S])===!1)return B.copy(b[S]),!0}}return!1}function p(v){const w=v.uniforms;let _=0;const y=16;let C=0;for(let b=0,S=w.length;b<S;b++){const B=w[b],M={boundary:0,storage:0},z=Array.isArray(B.value)?B.value:[B.value];for(let G=0,P=z.length;G<P;G++){const R=z[G],W=m(R);M.boundary+=W.boundary,M.storage+=W.storage}if(B.__data=new Float32Array(M.storage/Float32Array.BYTES_PER_ELEMENT),B.__offset=_,b>0){C=_%y;const G=y-C;C!==0&&G-M.boundary<0&&(_+=y-C,B.__offset=_)}_+=M.storage}return C=_%y,C>0&&(_+=y-C),v.__size=_,v.__cache={},this}function m(v){const w={boundary:0,storage:0};return typeof v=="number"?(w.boundary=4,w.storage=4):v.isVector2?(w.boundary=8,w.storage=8):v.isVector3||v.isColor?(w.boundary=16,w.storage=12):v.isVector4?(w.boundary=16,w.storage=16):v.isMatrix3?(w.boundary=48,w.storage=48):v.isMatrix4?(w.boundary=64,w.storage=64):v.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",v),w}function d(v){const w=v.target;w.removeEventListener("dispose",d);const _=f.indexOf(w.__bindingPointIndex);f.splice(_,1),n.deleteBuffer(r[w.id]),delete r[w.id],delete a[w.id]}function g(){for(const v in r)n.deleteBuffer(r[v]);f=[],r={},a={}}return{bind:s,update:l,dispose:g}}function GU(){const n=Wo("canvas");return n.style.display="block",n}class vw{constructor(t={}){const{canvas:e=GU(),context:i=null,depth:r=!0,stencil:a=!0,alpha:f=!1,antialias:o=!1,premultipliedAlpha:s=!0,preserveDrawingBuffer:l=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:A=!1}=t;this.isWebGLRenderer=!0;let c;i!==null?c=i.getContextAttributes().alpha:c=f;let h=null,p=null;const m=[],d=[];this.domElement=e,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=cs,this.useLegacyLights=!0,this.toneMapping=Vn,this.toneMappingExposure=1;const g=this;let v=!1,w=0,_=0,y=null,C=-1,b=null;const S=new pe,B=new pe;let M=null,z=e.width,G=e.height,P=1,R=null,W=null;const K=new pe(0,0,z,G),tt=new pe(0,0,z,G);let j=!1;const E=new dd;let I=!1,Q=!1,D=null;const k=new Kt,U=new H,T={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function V(){return y===null?P:1}let O=i;function et(N,at){for(let ut=0;ut<N.length;ut++){const nt=N[ut],pt=e.getContext(nt,at);if(pt!==null)return pt}return null}try{const N={alpha:!0,depth:r,stencil:a,antialias:o,premultipliedAlpha:s,preserveDrawingBuffer:l,powerPreference:u,failIfMajorPerformanceCaveat:A};if("setAttribute"in e&&e.setAttribute("data-engine",`three.js r${hd}`),e.addEventListener("webglcontextlost",Dt,!1),e.addEventListener("webglcontextrestored",Jt,!1),e.addEventListener("webglcontextcreationerror",fe,!1),O===null){const at=["webgl2","webgl","experimental-webgl"];if(g.isWebGL1Renderer===!0&&at.shift(),O=et(at,N),O===null)throw et(at)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}O.getShaderPrecisionFormat===void 0&&(O.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(N){throw console.error("THREE.WebGLRenderer: "+N.message),N}let q,J,st,gt,Y,X,ot,At,rt,lt,mt,St,bt,F,L,it,ct,dt,vt,Ut,Ct,ht,It,Lt;function Nt(){q=new eF(O),J=new Y1(O,q,t),q.init(J),ht=new QU(O,q,J),st=new PU(O,q,J),gt=new rF,Y=new yU,X=new OU(O,q,st,Y,J,ht,gt),ot=new $1(g),At=new tF(g),rt=new gM(O,J),It=new X1(O,q,rt,J),lt=new iF(O,rt,gt,It),mt=new AF(O,lt,rt,gt),vt=new oF(O,J,X),it=new q1(Y),St=new _U(g,ot,At,q,J,It,it),bt=new VU(g,Y),F=new CU,L=new TU(q,J),dt=new K1(g,ot,At,st,mt,c,s),ct=new DU(g,mt,J),Lt=new zU(O,gt,J,st),Ut=new j1(O,q,gt,J),Ct=new nF(O,q,gt,J),gt.programs=St.programs,g.capabilities=J,g.extensions=q,g.properties=Y,g.renderLists=F,g.shadowMap=ct,g.state=st,g.info=gt}Nt();const Ft=new NU(g,O);this.xr=Ft,this.getContext=function(){return O},this.getContextAttributes=function(){return O.getContextAttributes()},this.forceContextLoss=function(){const N=q.get("WEBGL_lose_context");N&&N.loseContext()},this.forceContextRestore=function(){const N=q.get("WEBGL_lose_context");N&&N.restoreContext()},this.getPixelRatio=function(){return P},this.setPixelRatio=function(N){N!==void 0&&(P=N,this.setSize(z,G,!1))},this.getSize=function(N){return N.set(z,G)},this.setSize=function(N,at,ut=!0){if(Ft.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}z=N,G=at,e.width=Math.floor(N*P),e.height=Math.floor(at*P),ut===!0&&(e.style.width=N+"px",e.style.height=at+"px"),this.setViewport(0,0,N,at)},this.getDrawingBufferSize=function(N){return N.set(z*P,G*P).floor()},this.setDrawingBufferSize=function(N,at,ut){z=N,G=at,P=ut,e.width=Math.floor(N*ut),e.height=Math.floor(at*ut),this.setViewport(0,0,N,at)},this.getCurrentViewport=function(N){return N.copy(S)},this.getViewport=function(N){return N.copy(K)},this.setViewport=function(N,at,ut,nt){N.isVector4?K.set(N.x,N.y,N.z,N.w):K.set(N,at,ut,nt),st.viewport(S.copy(K).multiplyScalar(P).floor())},this.getScissor=function(N){return N.copy(tt)},this.setScissor=function(N,at,ut,nt){N.isVector4?tt.set(N.x,N.y,N.z,N.w):tt.set(N,at,ut,nt),st.scissor(B.copy(tt).multiplyScalar(P).floor())},this.getScissorTest=function(){return j},this.setScissorTest=function(N){st.setScissorTest(j=N)},this.setOpaqueSort=function(N){R=N},this.setTransparentSort=function(N){W=N},this.getClearColor=function(N){return N.copy(dt.getClearColor())},this.setClearColor=function(){dt.setClearColor.apply(dt,arguments)},this.getClearAlpha=function(){return dt.getClearAlpha()},this.setClearAlpha=function(){dt.setClearAlpha.apply(dt,arguments)},this.clear=function(N=!0,at=!0,ut=!0){let nt=0;N&&(nt|=16384),at&&(nt|=256),ut&&(nt|=1024),O.clear(nt)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",Dt,!1),e.removeEventListener("webglcontextrestored",Jt,!1),e.removeEventListener("webglcontextcreationerror",fe,!1),F.dispose(),L.dispose(),Y.dispose(),ot.dispose(),At.dispose(),mt.dispose(),It.dispose(),Lt.dispose(),St.dispose(),Ft.dispose(),Ft.removeEventListener("sessionstart",Pt),Ft.removeEventListener("sessionend",ye),D&&(D.dispose(),D=null),Ee.stop()};function Dt(N){N.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),v=!0}function Jt(){console.log("THREE.WebGLRenderer: Context Restored."),v=!1;const N=gt.autoReset,at=ct.enabled,ut=ct.autoUpdate,nt=ct.needsUpdate,pt=ct.type;Nt(),gt.autoReset=N,ct.enabled=at,ct.autoUpdate=ut,ct.needsUpdate=nt,ct.type=pt}function fe(N){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",N.statusMessage)}function Fe(N){const at=N.target;at.removeEventListener("dispose",Fe),Z(at)}function Z(N){ft(N),Y.remove(N)}function ft(N){const at=Y.get(N).programs;at!==void 0&&(at.forEach(function(ut){St.releaseProgram(ut)}),N.isShaderMaterial&&St.releaseShaderCache(N))}this.renderBufferDirect=function(N,at,ut,nt,pt,Ht){at===null&&(at=T);const Vt=pt.isMesh&&pt.matrixWorld.determinant()<0,zt=Ey(N,at,ut,nt,pt);st.setMaterial(nt,Vt);let Xt=ut.index,Yt=1;nt.wireframe===!0&&(Xt=lt.getWireframeAttribute(ut),Yt=2);const qt=ut.drawRange,Zt=ut.attributes.position;let de=qt.start*Yt,oi=(qt.start+qt.count)*Yt;Ht!==null&&(de=Math.max(de,Ht.start*Yt),oi=Math.min(oi,(Ht.start+Ht.count)*Yt)),Xt!==null?(de=Math.max(de,0),oi=Math.min(oi,Xt.count)):Zt!=null&&(de=Math.max(de,0),oi=Math.min(oi,Zt.count));const Zi=oi-de;if(Zi<0||Zi===1/0)return;It.setup(pt,nt,zt,ut,Xt);let Ur,Qe=Ut;if(Xt!==null&&(Ur=rt.get(Xt),Qe=Ct,Qe.setIndex(Ur)),pt.isMesh)nt.wireframe===!0?(st.setLineWidth(nt.wireframeLinewidth*V()),Qe.setMode(1)):Qe.setMode(4);else if(pt.isLine){let ie=nt.linewidth;ie===void 0&&(ie=1),st.setLineWidth(ie*V()),pt.isLineSegments?Qe.setMode(1):pt.isLineLoop?Qe.setMode(2):Qe.setMode(3)}else pt.isPoints?Qe.setMode(0):pt.isSprite&&Qe.setMode(4);if(pt.isInstancedMesh)Qe.renderInstances(de,Zi,pt.count);else if(ut.isInstancedBufferGeometry){const ie=ut._maxInstanceCount!==void 0?ut._maxInstanceCount:1/0,ih=Math.min(ut.instanceCount,ie);Qe.renderInstances(de,Zi,ih)}else Qe.render(de,Zi)},this.compile=function(N,at){function ut(nt,pt,Ht){nt.transparent===!0&&nt.side===Ui&&nt.forceSinglePass===!1?(nt.side=yi,nt.needsUpdate=!0,xA(nt,pt,Ht),nt.side=Wn,nt.needsUpdate=!0,xA(nt,pt,Ht),nt.side=Ui):xA(nt,pt,Ht)}p=L.get(N),p.init(),d.push(p),N.traverseVisible(function(nt){nt.isLight&&nt.layers.test(at.layers)&&(p.pushLight(nt),nt.castShadow&&p.pushShadow(nt))}),p.setupLights(g.useLegacyLights),N.traverse(function(nt){const pt=nt.material;if(pt)if(Array.isArray(pt))for(let Ht=0;Ht<pt.length;Ht++){const Vt=pt[Ht];ut(Vt,N,nt)}else ut(pt,N,nt)}),d.pop(),p=null};let _t=null;function Tt(N){_t&&_t(N)}function Pt(){Ee.stop()}function ye(){Ee.start()}const Ee=new fw;Ee.setAnimationLoop(Tt),typeof self<"u"&&Ee.setContext(self),this.setAnimationLoop=function(N){_t=N,Ft.setAnimationLoop(N),N===null?Ee.stop():Ee.start()},Ft.addEventListener("sessionstart",Pt),Ft.addEventListener("sessionend",ye),this.render=function(N,at){if(at!==void 0&&at.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(v===!0)return;N.matrixWorldAutoUpdate===!0&&N.updateMatrixWorld(),at.parent===null&&at.matrixWorldAutoUpdate===!0&&at.updateMatrixWorld(),Ft.enabled===!0&&Ft.isPresenting===!0&&(Ft.cameraAutoUpdate===!0&&Ft.updateCamera(at),at=Ft.getCamera()),N.isScene===!0&&N.onBeforeRender(g,N,at,y),p=L.get(N,d.length),p.init(),d.push(p),k.multiplyMatrices(at.projectionMatrix,at.matrixWorldInverse),E.setFromProjectionMatrix(k),Q=this.localClippingEnabled,I=it.init(this.clippingPlanes,Q),h=F.get(N,m.length),h.init(),m.push(h),ti(N,at,0,g.sortObjects),h.finish(),g.sortObjects===!0&&h.sort(R,W),I===!0&&it.beginShadows();const ut=p.state.shadowsArray;if(ct.render(ut,N,at),I===!0&&it.endShadows(),this.info.autoReset===!0&&this.info.reset(),dt.render(h,N),p.setupLights(g.useLegacyLights),at.isArrayCamera){const nt=at.cameras;for(let pt=0,Ht=nt.length;pt<Ht;pt++){const Vt=nt[pt];qn(h,N,Vt,Vt.viewport)}}else qn(h,N,at);y!==null&&(X.updateMultisampleRenderTarget(y),X.updateRenderTargetMipmap(y)),N.isScene===!0&&N.onAfterRender(g,N,at),It.resetDefaultState(),C=-1,b=null,d.pop(),d.length>0?p=d[d.length-1]:p=null,m.pop(),m.length>0?h=m[m.length-1]:h=null};function ti(N,at,ut,nt){if(N.visible===!1)return;if(N.layers.test(at.layers)){if(N.isGroup)ut=N.renderOrder;else if(N.isLOD)N.autoUpdate===!0&&N.update(at);else if(N.isLight)p.pushLight(N),N.castShadow&&p.pushShadow(N);else if(N.isSprite){if(!N.frustumCulled||E.intersectsSprite(N)){nt&&U.setFromMatrixPosition(N.matrixWorld).applyMatrix4(k);const Vt=mt.update(N),zt=N.material;zt.visible&&h.push(N,Vt,zt,ut,U.z,null)}}else if((N.isMesh||N.isLine||N.isPoints)&&(N.isSkinnedMesh&&N.skeleton.frame!==gt.render.frame&&(N.skeleton.update(),N.skeleton.frame=gt.render.frame),!N.frustumCulled||E.intersectsObject(N))){nt&&U.setFromMatrixPosition(N.matrixWorld).applyMatrix4(k);const Vt=mt.update(N),zt=N.material;if(Array.isArray(zt)){const Xt=Vt.groups;for(let Yt=0,qt=Xt.length;Yt<qt;Yt++){const Zt=Xt[Yt],de=zt[Zt.materialIndex];de&&de.visible&&h.push(N,Vt,de,ut,U.z,Zt)}}else zt.visible&&h.push(N,Vt,zt,ut,U.z,null)}}const Ht=N.children;for(let Vt=0,zt=Ht.length;Vt<zt;Vt++)ti(Ht[Vt],at,ut,nt)}function qn(N,at,ut,nt){const pt=N.opaque,Ht=N.transmissive,Vt=N.transparent;p.setupLightsView(ut),I===!0&&it.setGlobalState(g.clippingPlanes,ut),Ht.length>0&&Ue(pt,Ht,at,ut),nt&&st.viewport(S.copy(nt)),pt.length>0&&Hi(pt,at,ut),Ht.length>0&&Hi(Ht,at,ut),Vt.length>0&&Hi(Vt,at,ut),st.buffers.depth.setTest(!0),st.buffers.depth.setMask(!0),st.buffers.color.setMask(!0),st.setPolygonOffset(!1)}function Ue(N,at,ut,nt){if(D===null){const zt=J.isWebGL2;D=new xr(1024,1024,{generateMipmaps:!0,type:q.has("EXT_color_buffer_half_float")?Vo:ls,minFilter:As,samples:zt&&o===!0?4:0})}const pt=g.getRenderTarget();g.setRenderTarget(D),g.clear();const Ht=g.toneMapping;g.toneMapping=Vn,Hi(N,ut,nt),X.updateMultisampleRenderTarget(D),X.updateRenderTargetMipmap(D);let Vt=!1;for(let zt=0,Xt=at.length;zt<Xt;zt++){const Yt=at[zt],qt=Yt.object,Zt=Yt.geometry,de=Yt.material,oi=Yt.group;if(de.side===Ui&&qt.layers.test(nt.layers)){const Zi=de.side;de.side=yi,de.needsUpdate=!0,hn(qt,ut,nt,Zt,de,oi),de.side=Zi,de.needsUpdate=!0,Vt=!0}}Vt===!0&&(X.updateMultisampleRenderTarget(D),X.updateRenderTargetMipmap(D)),g.setRenderTarget(pt),g.toneMapping=Ht}function Hi(N,at,ut){const nt=at.isScene===!0?at.overrideMaterial:null;for(let pt=0,Ht=N.length;pt<Ht;pt++){const Vt=N[pt],zt=Vt.object,Xt=Vt.geometry,Yt=nt===null?Vt.material:nt,qt=Vt.group;zt.layers.test(ut.layers)&&hn(zt,at,ut,Xt,Yt,qt)}}function hn(N,at,ut,nt,pt,Ht){N.onBeforeRender(g,at,ut,nt,pt,Ht),N.modelViewMatrix.multiplyMatrices(ut.matrixWorldInverse,N.matrixWorld),N.normalMatrix.getNormalMatrix(N.modelViewMatrix),pt.onBeforeRender(g,at,ut,nt,N,Ht),pt.transparent===!0&&pt.side===Ui&&pt.forceSinglePass===!1?(pt.side=yi,pt.needsUpdate=!0,g.renderBufferDirect(ut,at,nt,pt,N,Ht),pt.side=Wn,pt.needsUpdate=!0,g.renderBufferDirect(ut,at,nt,pt,N,Ht),pt.side=Ui):g.renderBufferDirect(ut,at,nt,pt,N,Ht),N.onAfterRender(g,at,ut,nt,pt,Ht)}function xA(N,at,ut){at.isScene!==!0&&(at=T);const nt=Y.get(N),pt=p.state.lights,Ht=p.state.shadowsArray,Vt=pt.state.version,zt=St.getParameters(N,pt.state,Ht,at,ut),Xt=St.getProgramCacheKey(zt);let Yt=nt.programs;nt.environment=N.isMeshStandardMaterial?at.environment:null,nt.fog=at.fog,nt.envMap=(N.isMeshStandardMaterial?At:ot).get(N.envMap||nt.environment),Yt===void 0&&(N.addEventListener("dispose",Fe),Yt=new Map,nt.programs=Yt);let qt=Yt.get(Xt);if(qt!==void 0){if(nt.currentProgram===qt&&nt.lightsStateVersion===Vt)return Yd(N,zt),qt}else zt.uniforms=St.getUniforms(N),N.onBuild(ut,zt,g),N.onBeforeCompile(zt,g),qt=St.acquireProgram(zt,Xt),Yt.set(Xt,qt),nt.uniforms=zt.uniforms;const Zt=nt.uniforms;(!N.isShaderMaterial&&!N.isRawShaderMaterial||N.clipping===!0)&&(Zt.clippingPlanes=it.uniform),Yd(N,zt),nt.needsLights=Ty(N),nt.lightsStateVersion=Vt,nt.needsLights&&(Zt.ambientLightColor.value=pt.state.ambient,Zt.lightProbe.value=pt.state.probe,Zt.directionalLights.value=pt.state.directional,Zt.directionalLightShadows.value=pt.state.directionalShadow,Zt.spotLights.value=pt.state.spot,Zt.spotLightShadows.value=pt.state.spotShadow,Zt.rectAreaLights.value=pt.state.rectArea,Zt.ltc_1.value=pt.state.rectAreaLTC1,Zt.ltc_2.value=pt.state.rectAreaLTC2,Zt.pointLights.value=pt.state.point,Zt.pointLightShadows.value=pt.state.pointShadow,Zt.hemisphereLights.value=pt.state.hemi,Zt.directionalShadowMap.value=pt.state.directionalShadowMap,Zt.directionalShadowMatrix.value=pt.state.directionalShadowMatrix,Zt.spotShadowMap.value=pt.state.spotShadowMap,Zt.spotLightMatrix.value=pt.state.spotLightMatrix,Zt.spotLightMap.value=pt.state.spotLightMap,Zt.pointShadowMap.value=pt.state.pointShadowMap,Zt.pointShadowMatrix.value=pt.state.pointShadowMatrix);const de=qt.getUniforms(),oi=Kl.seqWithValue(de.seq,Zt);return nt.currentProgram=qt,nt.uniformsList=oi,qt}function Yd(N,at){const ut=Y.get(N);ut.outputEncoding=at.outputEncoding,ut.instancing=at.instancing,ut.skinning=at.skinning,ut.morphTargets=at.morphTargets,ut.morphNormals=at.morphNormals,ut.morphColors=at.morphColors,ut.morphTargetsCount=at.morphTargetsCount,ut.numClippingPlanes=at.numClippingPlanes,ut.numIntersection=at.numClipIntersection,ut.vertexAlphas=at.vertexAlphas,ut.vertexTangents=at.vertexTangents,ut.toneMapping=at.toneMapping}function Ey(N,at,ut,nt,pt){at.isScene!==!0&&(at=T),X.resetTextureUnits();const Ht=at.fog,Vt=nt.isMeshStandardMaterial?at.environment:null,zt=y===null?g.outputEncoding:y.isXRRenderTarget===!0?y.texture.encoding:cs,Xt=(nt.isMeshStandardMaterial?At:ot).get(nt.envMap||Vt),Yt=nt.vertexColors===!0&&!!ut.attributes.color&&ut.attributes.color.itemSize===4,qt=!!nt.normalMap&&!!ut.attributes.tangent,Zt=!!ut.morphAttributes.position,de=!!ut.morphAttributes.normal,oi=!!ut.morphAttributes.color,Zi=nt.toneMapped?g.toneMapping:Vn,Ur=ut.morphAttributes.position||ut.morphAttributes.normal||ut.morphAttributes.color,Qe=Ur!==void 0?Ur.length:0,ie=Y.get(nt),ih=p.state.lights;if(I===!0&&(Q===!0||N!==b)){const bi=N===b&&nt.id===C;it.setState(nt,N,bi)}let Ge=!1;nt.version===ie.__version?(ie.needsLights&&ie.lightsStateVersion!==ih.state.version||ie.outputEncoding!==zt||pt.isInstancedMesh&&ie.instancing===!1||!pt.isInstancedMesh&&ie.instancing===!0||pt.isSkinnedMesh&&ie.skinning===!1||!pt.isSkinnedMesh&&ie.skinning===!0||ie.envMap!==Xt||nt.fog===!0&&ie.fog!==Ht||ie.numClippingPlanes!==void 0&&(ie.numClippingPlanes!==it.numPlanes||ie.numIntersection!==it.numIntersection)||ie.vertexAlphas!==Yt||ie.vertexTangents!==qt||ie.morphTargets!==Zt||ie.morphNormals!==de||ie.morphColors!==oi||ie.toneMapping!==Zi||J.isWebGL2===!0&&ie.morphTargetsCount!==Qe)&&(Ge=!0):(Ge=!0,ie.__version=nt.version);let Lr=ie.currentProgram;Ge===!0&&(Lr=xA(nt,at,pt));let qd=!1,Xa=!1,nh=!1;const Ai=Lr.getUniforms(),Ir=ie.uniforms;if(st.useProgram(Lr.program)&&(qd=!0,Xa=!0,nh=!0),nt.id!==C&&(C=nt.id,Xa=!0),qd||b!==N){if(Ai.setValue(O,"projectionMatrix",N.projectionMatrix),J.logarithmicDepthBuffer&&Ai.setValue(O,"logDepthBufFC",2/(Math.log(N.far+1)/Math.LN2)),b!==N&&(b=N,Xa=!0,nh=!0),nt.isShaderMaterial||nt.isMeshPhongMaterial||nt.isMeshToonMaterial||nt.isMeshStandardMaterial||nt.envMap){const bi=Ai.map.cameraPosition;bi!==void 0&&bi.setValue(O,U.setFromMatrixPosition(N.matrixWorld))}(nt.isMeshPhongMaterial||nt.isMeshToonMaterial||nt.isMeshLambertMaterial||nt.isMeshBasicMaterial||nt.isMeshStandardMaterial||nt.isShaderMaterial)&&Ai.setValue(O,"isOrthographic",N.isOrthographicCamera===!0),(nt.isMeshPhongMaterial||nt.isMeshToonMaterial||nt.isMeshLambertMaterial||nt.isMeshBasicMaterial||nt.isMeshStandardMaterial||nt.isShaderMaterial||nt.isShadowMaterial||pt.isSkinnedMesh)&&Ai.setValue(O,"viewMatrix",N.matrixWorldInverse)}if(pt.isSkinnedMesh){Ai.setOptional(O,pt,"bindMatrix"),Ai.setOptional(O,pt,"bindMatrixInverse");const bi=pt.skeleton;bi&&(J.floatVertexTextures?(bi.boneTexture===null&&bi.computeBoneTexture(),Ai.setValue(O,"boneTexture",bi.boneTexture,X),Ai.setValue(O,"boneTextureSize",bi.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const rh=ut.morphAttributes;if((rh.position!==void 0||rh.normal!==void 0||rh.color!==void 0&&J.isWebGL2===!0)&&vt.update(pt,ut,Lr),(Xa||ie.receiveShadow!==pt.receiveShadow)&&(ie.receiveShadow=pt.receiveShadow,Ai.setValue(O,"receiveShadow",pt.receiveShadow)),nt.isMeshGouraudMaterial&&nt.envMap!==null&&(Ir.envMap.value=Xt,Ir.flipEnvMap.value=Xt.isCubeTexture&&Xt.isRenderTargetTexture===!1?-1:1),Xa&&(Ai.setValue(O,"toneMappingExposure",g.toneMappingExposure),ie.needsLights&&My(Ir,nh),Ht&&nt.fog===!0&&bt.refreshFogUniforms(Ir,Ht),bt.refreshMaterialUniforms(Ir,nt,P,G,D),Kl.upload(O,ie.uniformsList,Ir,X)),nt.isShaderMaterial&&nt.uniformsNeedUpdate===!0&&(Kl.upload(O,ie.uniformsList,Ir,X),nt.uniformsNeedUpdate=!1),nt.isSpriteMaterial&&Ai.setValue(O,"center",pt.center),Ai.setValue(O,"modelViewMatrix",pt.modelViewMatrix),Ai.setValue(O,"normalMatrix",pt.normalMatrix),Ai.setValue(O,"modelMatrix",pt.matrixWorld),nt.isShaderMaterial||nt.isRawShaderMaterial){const bi=nt.uniformsGroups;for(let sh=0,Fy=bi.length;sh<Fy;sh++)if(J.isWebGL2){const $d=bi[sh];Lt.update($d,Lr),Lt.bind($d,Lr)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return Lr}function My(N,at){N.ambientLightColor.needsUpdate=at,N.lightProbe.needsUpdate=at,N.directionalLights.needsUpdate=at,N.directionalLightShadows.needsUpdate=at,N.pointLights.needsUpdate=at,N.pointLightShadows.needsUpdate=at,N.spotLights.needsUpdate=at,N.spotLightShadows.needsUpdate=at,N.rectAreaLights.needsUpdate=at,N.hemisphereLights.needsUpdate=at}function Ty(N){return N.isMeshLambertMaterial||N.isMeshToonMaterial||N.isMeshPhongMaterial||N.isMeshStandardMaterial||N.isShadowMaterial||N.isShaderMaterial&&N.lights===!0}this.getActiveCubeFace=function(){return w},this.getActiveMipmapLevel=function(){return _},this.getRenderTarget=function(){return y},this.setRenderTargetTextures=function(N,at,ut){Y.get(N.texture).__webglTexture=at,Y.get(N.depthTexture).__webglTexture=ut;const nt=Y.get(N);nt.__hasExternalTextures=!0,nt.__hasExternalTextures&&(nt.__autoAllocateDepthBuffer=ut===void 0,nt.__autoAllocateDepthBuffer||q.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),nt.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(N,at){const ut=Y.get(N);ut.__webglFramebuffer=at,ut.__useDefaultFramebuffer=at===void 0},this.setRenderTarget=function(N,at=0,ut=0){y=N,w=at,_=ut;let nt=!0,pt=null,Ht=!1,Vt=!1;if(N){const Xt=Y.get(N);Xt.__useDefaultFramebuffer!==void 0?(st.bindFramebuffer(36160,null),nt=!1):Xt.__webglFramebuffer===void 0?X.setupRenderTarget(N):Xt.__hasExternalTextures&&X.rebindTextures(N,Y.get(N.texture).__webglTexture,Y.get(N.depthTexture).__webglTexture);const Yt=N.texture;(Yt.isData3DTexture||Yt.isDataArrayTexture||Yt.isCompressedArrayTexture)&&(Vt=!0);const qt=Y.get(N).__webglFramebuffer;N.isWebGLCubeRenderTarget?(pt=qt[at],Ht=!0):J.isWebGL2&&N.samples>0&&X.useMultisampledRTT(N)===!1?pt=Y.get(N).__webglMultisampledFramebuffer:pt=qt,S.copy(N.viewport),B.copy(N.scissor),M=N.scissorTest}else S.copy(K).multiplyScalar(P).floor(),B.copy(tt).multiplyScalar(P).floor(),M=j;if(st.bindFramebuffer(36160,pt)&&J.drawBuffers&&nt&&st.drawBuffers(N,pt),st.viewport(S),st.scissor(B),st.setScissorTest(M),Ht){const Xt=Y.get(N.texture);O.framebufferTexture2D(36160,36064,34069+at,Xt.__webglTexture,ut)}else if(Vt){const Xt=Y.get(N.texture),Yt=at||0;O.framebufferTextureLayer(36160,36064,Xt.__webglTexture,ut||0,Yt)}C=-1},this.readRenderTargetPixels=function(N,at,ut,nt,pt,Ht,Vt){if(!(N&&N.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let zt=Y.get(N).__webglFramebuffer;if(N.isWebGLCubeRenderTarget&&Vt!==void 0&&(zt=zt[Vt]),zt){st.bindFramebuffer(36160,zt);try{const Xt=N.texture,Yt=Xt.format,qt=Xt.type;if(Yt!==Ki&&ht.convert(Yt)!==O.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const Zt=qt===Vo&&(q.has("EXT_color_buffer_half_float")||J.isWebGL2&&q.has("EXT_color_buffer_float"));if(qt!==ls&&ht.convert(qt)!==O.getParameter(35738)&&!(qt===ur&&(J.isWebGL2||q.has("OES_texture_float")||q.has("WEBGL_color_buffer_float")))&&!Zt){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}at>=0&&at<=N.width-nt&&ut>=0&&ut<=N.height-pt&&O.readPixels(at,ut,nt,pt,ht.convert(Yt),ht.convert(qt),Ht)}finally{const Xt=y!==null?Y.get(y).__webglFramebuffer:null;st.bindFramebuffer(36160,Xt)}}},this.copyFramebufferToTexture=function(N,at,ut=0){const nt=Math.pow(2,-ut),pt=Math.floor(at.image.width*nt),Ht=Math.floor(at.image.height*nt);X.setTexture2D(at,0),O.copyTexSubImage2D(3553,ut,0,0,N.x,N.y,pt,Ht),st.unbindTexture()},this.copyTextureToTexture=function(N,at,ut,nt=0){const pt=at.image.width,Ht=at.image.height,Vt=ht.convert(ut.format),zt=ht.convert(ut.type);X.setTexture2D(ut,0),O.pixelStorei(37440,ut.flipY),O.pixelStorei(37441,ut.premultiplyAlpha),O.pixelStorei(3317,ut.unpackAlignment),at.isDataTexture?O.texSubImage2D(3553,nt,N.x,N.y,pt,Ht,Vt,zt,at.image.data):at.isCompressedTexture?O.compressedTexSubImage2D(3553,nt,N.x,N.y,at.mipmaps[0].width,at.mipmaps[0].height,Vt,at.mipmaps[0].data):O.texSubImage2D(3553,nt,N.x,N.y,Vt,zt,at.image),nt===0&&ut.generateMipmaps&&O.generateMipmap(3553),st.unbindTexture()},this.copyTextureToTexture3D=function(N,at,ut,nt,pt=0){if(g.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const Ht=N.max.x-N.min.x+1,Vt=N.max.y-N.min.y+1,zt=N.max.z-N.min.z+1,Xt=ht.convert(nt.format),Yt=ht.convert(nt.type);let qt;if(nt.isData3DTexture)X.setTexture3D(nt,0),qt=32879;else if(nt.isDataArrayTexture)X.setTexture2DArray(nt,0),qt=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}O.pixelStorei(37440,nt.flipY),O.pixelStorei(37441,nt.premultiplyAlpha),O.pixelStorei(3317,nt.unpackAlignment);const Zt=O.getParameter(3314),de=O.getParameter(32878),oi=O.getParameter(3316),Zi=O.getParameter(3315),Ur=O.getParameter(32877),Qe=ut.isCompressedTexture?ut.mipmaps[0]:ut.image;O.pixelStorei(3314,Qe.width),O.pixelStorei(32878,Qe.height),O.pixelStorei(3316,N.min.x),O.pixelStorei(3315,N.min.y),O.pixelStorei(32877,N.min.z),ut.isDataTexture||ut.isData3DTexture?O.texSubImage3D(qt,pt,at.x,at.y,at.z,Ht,Vt,zt,Xt,Yt,Qe.data):ut.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),O.compressedTexSubImage3D(qt,pt,at.x,at.y,at.z,Ht,Vt,zt,Xt,Qe.data)):O.texSubImage3D(qt,pt,at.x,at.y,at.z,Ht,Vt,zt,Xt,Yt,Qe),O.pixelStorei(3314,Zt),O.pixelStorei(32878,de),O.pixelStorei(3316,oi),O.pixelStorei(3315,Zi),O.pixelStorei(32877,Ur),pt===0&&nt.generateMipmaps&&O.generateMipmap(qt),st.unbindTexture()},this.initTexture=function(N){N.isCubeTexture?X.setTextureCube(N,0):N.isData3DTexture?X.setTexture3D(N,0):N.isDataArrayTexture||N.isCompressedArrayTexture?X.setTexture2DArray(N,0):X.setTexture2D(N,0),st.unbindTexture()},this.resetState=function(){w=0,_=0,y=null,st.reset(),It.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get physicallyCorrectLights(){return console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights}set physicallyCorrectLights(t){console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!t}}class WU extends vw{}WU.prototype.isWebGL1Renderer=!0;class KU extends ce{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),t.background!==null&&(this.background=t.background.clone()),t.environment!==null&&(this.environment=t.environment.clone()),t.fog!==null&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,t.overrideMaterial!==null&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return this.fog!==null&&(e.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(e.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(e.object.backgroundIntensity=this.backgroundIntensity),e}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(t){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=t}}class ww{constructor(t,e){this.isInterleavedBuffer=!0,this.array=t,this.stride=e,this.count=t!==void 0?t.length/e:0,this.usage=$u,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=an()}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,i){t*=this.stride,i*=e.stride;for(let r=0,a=this.stride;r<a;r++)this.array[t+r]=e.array[i+r];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=an()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(e,this.stride);return i.setUsage(this.usage),i}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=an()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const li=new H;class Ko{constructor(t,e,i,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=e,this.offset=i,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,i=this.data.count;e<i;e++)li.fromBufferAttribute(this,e),li.applyMatrix4(t),this.setXYZ(e,li.x,li.y,li.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)li.fromBufferAttribute(this,e),li.applyNormalMatrix(t),this.setXYZ(e,li.x,li.y,li.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)li.fromBufferAttribute(this,e),li.transformDirection(t),this.setXYZ(e,li.x,li.y,li.z);return this}setX(t,e){return this.normalized&&(e=we(e,this.array)),this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.normalized&&(e=we(e,this.array)),this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.normalized&&(e=we(e,this.array)),this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.normalized&&(e=we(e,this.array)),this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){let e=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(e=Hn(e,this.array)),e}getY(t){let e=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(e=Hn(e,this.array)),e}getZ(t){let e=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(e=Hn(e,this.array)),e}getW(t){let e=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(e=Hn(e,this.array)),e}setXY(t,e,i){return t=t*this.data.stride+this.offset,this.normalized&&(e=we(e,this.array),i=we(i,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this}setXYZ(t,e,i,r){return t=t*this.data.stride+this.offset,this.normalized&&(e=we(e,this.array),i=we(i,this.array),r=we(r,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=r,this}setXYZW(t,e,i,r,a){return t=t*this.data.stride+this.offset,this.normalized&&(e=we(e,this.array),i=we(i,this.array),r=we(r,this.array),a=we(a,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=r,this.data.array[t+3]=a,this}clone(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let i=0;i<this.count;i++){const r=i*this.data.stride+this.offset;for(let a=0;a<this.itemSize;a++)e.push(this.data.array[r+a])}return new Oe(new this.array.constructor(e),this.itemSize,this.normalized)}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new Ko(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let i=0;i<this.count;i++){const r=i*this.data.stride+this.offset;for(let a=0;a<this.itemSize;a++)e.push(this.data.array[r+a])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class _w extends Li{constructor(t){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Rt(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}let Ps;const to=new H,Os=new H,Qs=new H,Rs=new xt,eo=new xt,yw=new Kt,qA=new H,io=new H,$A=new H,Yg=new xt,qh=new xt,qg=new xt;class Hs extends ce{constructor(t){if(super(),this.isSprite=!0,this.type="Sprite",Ps===void 0){Ps=new ke;const e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),i=new ww(e,5);Ps.setIndex([0,1,2,0,2,3]),Ps.setAttribute("position",new Ko(i,3,0,!1)),Ps.setAttribute("uv",new Ko(i,2,3,!1))}this.geometry=Ps,this.material=t!==void 0?t:new _w,this.center=new xt(.5,.5)}raycast(t,e){t.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Os.setFromMatrixScale(this.matrixWorld),yw.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),Qs.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Os.multiplyScalar(-Qs.z);const i=this.material.rotation;let r,a;i!==0&&(a=Math.cos(i),r=Math.sin(i));const f=this.center;JA(qA.set(-.5,-.5,0),Qs,f,Os,r,a),JA(io.set(.5,-.5,0),Qs,f,Os,r,a),JA($A.set(.5,.5,0),Qs,f,Os,r,a),Yg.set(0,0),qh.set(1,0),qg.set(1,1);let o=t.ray.intersectTriangle(qA,io,$A,!1,to);if(o===null&&(JA(io.set(-.5,.5,0),Qs,f,Os,r,a),qh.set(0,1),o=t.ray.intersectTriangle(qA,$A,io,!1,to),o===null))return;const s=t.ray.origin.distanceTo(to);s<t.near||s>t.far||e.push({distance:s,point:to.clone(),uv:Ti.getInterpolation(to,qA,io,$A,Yg,qh,qg,new xt),face:null,object:this})}copy(t,e){return super.copy(t,e),t.center!==void 0&&this.center.copy(t.center),this.material=t.material,this}}function JA(n,t,e,i,r,a){Rs.subVectors(n,e).addScalar(.5).multiply(i),r!==void 0?(eo.x=a*Rs.x-r*Rs.y,eo.y=r*Rs.x+a*Rs.y):eo.copy(Rs),n.copy(t),n.x+=eo.x,n.y+=eo.y,n.applyMatrix4(yw)}const $g=new H,Jg=new pe,Zg=new pe,XU=new H,tm=new Kt,ks=new H;class jU extends yt{constructor(t,e){super(t,e),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Kt,this.bindMatrixInverse=new Kt,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const t=this.geometry;this.boundingBox===null&&(this.boundingBox=new Qi),this.boundingBox.makeEmpty();const e=t.getAttribute("position");for(let i=0;i<e.count;i++)ks.fromBufferAttribute(e,i),this.applyBoneTransform(i,ks),this.boundingBox.expandByPoint(ks)}computeBoundingSphere(){const t=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Cn),this.boundingSphere.makeEmpty();const e=t.getAttribute("position");for(let i=0;i<e.count;i++)ks.fromBufferAttribute(e,i),this.applyBoneTransform(i,ks),this.boundingSphere.expandByPoint(ks)}copy(t,e){return super.copy(t,e),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,this}bind(t,e){this.skeleton=t,e===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new pe,e=this.geometry.attributes.skinWeight;for(let i=0,r=e.count;i<r;i++){t.fromBufferAttribute(e,i);const a=1/t.manhattanLength();a!==1/0?t.multiplyScalar(a):t.set(1,0,0,0),e.setXYZW(i,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(t,e){const i=this.skeleton,r=this.geometry;Jg.fromBufferAttribute(r.attributes.skinIndex,t),Zg.fromBufferAttribute(r.attributes.skinWeight,t),$g.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let a=0;a<4;a++){const f=Zg.getComponent(a);if(f!==0){const o=Jg.getComponent(a);tm.multiplyMatrices(i.bones[o].matrixWorld,i.boneInverses[o]),e.addScaledVector(XU.copy($g).applyMatrix4(tm),f)}}return e.applyMatrix4(this.bindMatrixInverse)}boneTransform(t,e){return console.warn("THREE.SkinnedMesh: .boneTransform() was renamed to .applyBoneTransform() in r151."),this.applyBoneTransform(t,e)}}class xw extends ce{constructor(){super(),this.isBone=!0,this.type="Bone"}}class YU extends je{constructor(t=null,e=1,i=1,r,a,f,o,s,l=Xe,u=Xe,A,c){super(null,f,o,s,l,u,r,a,A,c),this.isDataTexture=!0,this.image={data:t,width:e,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const em=new Kt,qU=new Kt;class gd{constructor(t=[],e=[]){this.uuid=an(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(t.length*16),e.length===0)this.calculateInverses();else if(t.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,r=this.bones.length;i<r;i++)this.boneInverses.push(new Kt)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){const i=new Kt;this.bones[t]&&i.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let t=0,e=this.bones.length;t<e;t++){const i=this.bones[t];i&&i.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){const i=this.bones[t];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){const t=this.bones,e=this.boneInverses,i=this.boneMatrices,r=this.boneTexture;for(let a=0,f=t.length;a<f;a++){const o=t[a]?t[a].matrixWorld:qU;em.multiplyMatrices(o,e[a]),em.toArray(i,a*16)}r!==null&&(r.needsUpdate=!0)}clone(){return new gd(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(this.bones.length*4);t=Z0(t),t=Math.max(t,4);const e=new Float32Array(t*t*4);e.set(this.boneMatrices);const i=new YU(e,t,t,Ki,ur);return i.needsUpdate=!0,this.boneMatrices=e,this.boneTexture=i,this.boneTextureSize=t,this}getBoneByName(t){for(let e=0,i=this.bones.length;e<i;e++){const r=this.bones[e];if(r.name===t)return r}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,e){this.uuid=t.uuid;for(let i=0,r=t.bones.length;i<r;i++){const a=t.bones[i];let f=e[a];f===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",a),f=new xw),this.bones.push(f),this.boneInverses.push(new Kt().fromArray(t.boneInverses[i]))}return this.init(),this}toJSON(){const t={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const e=this.bones,i=this.boneInverses;for(let r=0,a=e.length;r<a;r++){const f=e[r];t.bones.push(f.uuid);const o=i[r];t.boneInverses.push(o.toArray())}return t}}class im extends Oe{constructor(t,e,i,r=1){super(t,e,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}const Ns=new Kt,nm=new Kt,ZA=[],rm=new Qi,$U=new Kt,no=new yt,ro=new Cn;class JU extends yt{constructor(t,e,i){super(t,e),this.isInstancedMesh=!0,this.instanceMatrix=new im(new Float32Array(i*16),16),this.instanceColor=null,this.count=i,this.boundingBox=null,this.boundingSphere=null;for(let r=0;r<i;r++)this.setMatrixAt(r,$U)}computeBoundingBox(){const t=this.geometry,e=this.count;this.boundingBox===null&&(this.boundingBox=new Qi),t.boundingBox===null&&t.computeBoundingBox(),this.boundingBox.makeEmpty();for(let i=0;i<e;i++)this.getMatrixAt(i,Ns),rm.copy(t.boundingBox).applyMatrix4(Ns),this.boundingBox.union(rm)}computeBoundingSphere(){const t=this.geometry,e=this.count;this.boundingSphere===null&&(this.boundingSphere=new Cn),t.boundingSphere===null&&t.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let i=0;i<e;i++)this.getMatrixAt(i,Ns),ro.copy(t.boundingSphere).applyMatrix4(Ns),this.boundingSphere.union(ro)}copy(t,e){return super.copy(t,e),this.instanceMatrix.copy(t.instanceMatrix),t.instanceColor!==null&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,this}getColorAt(t,e){e.fromArray(this.instanceColor.array,t*3)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,t*16)}raycast(t,e){const i=this.matrixWorld,r=this.count;if(no.geometry=this.geometry,no.material=this.material,no.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),ro.copy(this.boundingSphere),ro.applyMatrix4(i),t.ray.intersectsSphere(ro)!==!1))for(let a=0;a<r;a++){this.getMatrixAt(a,Ns),nm.multiplyMatrices(i,Ns),no.matrixWorld=nm,no.raycast(t,ZA);for(let f=0,o=ZA.length;f<o;f++){const s=ZA[f];s.instanceId=a,s.object=this,e.push(s)}ZA.length=0}}setColorAt(t,e){this.instanceColor===null&&(this.instanceColor=new im(new Float32Array(this.instanceMatrix.count*3),3)),e.toArray(this.instanceColor.array,t*3)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,t*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class lA extends Li{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Rt(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}const sm=new H,am=new H,om=new Kt,$h=new Dc,tl=new Cn;let sn=class extends ce{constructor(t=new ke,e=new lA){super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(t.index===null){const e=t.attributes.position,i=[0];for(let r=1,a=e.count;r<a;r++)sm.fromBufferAttribute(e,r-1),am.fromBufferAttribute(e,r),i[r]=i[r-1],i[r]+=sm.distanceTo(am);t.setAttribute("lineDistance",new Se(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(t,e){const i=this.geometry,r=this.matrixWorld,a=t.params.Line.threshold,f=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),tl.copy(i.boundingSphere),tl.applyMatrix4(r),tl.radius+=a,t.ray.intersectsSphere(tl)===!1)return;om.copy(r).invert(),$h.copy(t.ray).applyMatrix4(om);const o=a/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o,l=new H,u=new H,A=new H,c=new H,h=this.isLineSegments?2:1,p=i.index,d=i.attributes.position;if(p!==null){const g=Math.max(0,f.start),v=Math.min(p.count,f.start+f.count);for(let w=g,_=v-1;w<_;w+=h){const y=p.getX(w),C=p.getX(w+1);if(l.fromBufferAttribute(d,y),u.fromBufferAttribute(d,C),$h.distanceSqToSegment(l,u,c,A)>s)continue;c.applyMatrix4(this.matrixWorld);const S=t.ray.origin.distanceTo(c);S<t.near||S>t.far||e.push({distance:S,point:A.clone().applyMatrix4(this.matrixWorld),index:w,face:null,faceIndex:null,object:this})}}else{const g=Math.max(0,f.start),v=Math.min(d.count,f.start+f.count);for(let w=g,_=v-1;w<_;w+=h){if(l.fromBufferAttribute(d,w),u.fromBufferAttribute(d,w+1),$h.distanceSqToSegment(l,u,c,A)>s)continue;c.applyMatrix4(this.matrixWorld);const C=t.ray.origin.distanceTo(c);C<t.near||C>t.far||e.push({distance:C,point:A.clone().applyMatrix4(this.matrixWorld),index:w,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const e=this.geometry.morphAttributes,i=Object.keys(e);if(i.length>0){const r=e[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let a=0,f=r.length;a<f;a++){const o=r[a].name||String(a);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=a}}}}};const Am=new H,lm=new H;class Oc extends sn{constructor(t,e){super(t,e),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(t.index===null){const e=t.attributes.position,i=[];for(let r=0,a=e.count;r<a;r+=2)Am.fromBufferAttribute(e,r),lm.fromBufferAttribute(e,r+1),i[r]=r===0?0:i[r-1],i[r+1]=i[r]+Am.distanceTo(lm);t.setAttribute("lineDistance",new Se(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class ZU extends sn{constructor(t,e){super(t,e),this.isLineLoop=!0,this.type="LineLoop"}}class Cw extends Li{constructor(t){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Rt(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}const cm=new Kt,ef=new Dc,el=new Cn,il=new H;class tL extends ce{constructor(t=new ke,e=new Cw){super(),this.isPoints=!0,this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=t.material,this.geometry=t.geometry,this}raycast(t,e){const i=this.geometry,r=this.matrixWorld,a=t.params.Points.threshold,f=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),el.copy(i.boundingSphere),el.applyMatrix4(r),el.radius+=a,t.ray.intersectsSphere(el)===!1)return;cm.copy(r).invert(),ef.copy(t.ray).applyMatrix4(cm);const o=a/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o,l=i.index,A=i.attributes.position;if(l!==null){const c=Math.max(0,f.start),h=Math.min(l.count,f.start+f.count);for(let p=c,m=h;p<m;p++){const d=l.getX(p);il.fromBufferAttribute(A,d),hm(il,d,s,r,t,e,this)}}else{const c=Math.max(0,f.start),h=Math.min(A.count,f.start+f.count);for(let p=c,m=h;p<m;p++)il.fromBufferAttribute(A,p),hm(il,p,s,r,t,e,this)}}updateMorphTargets(){const e=this.geometry.morphAttributes,i=Object.keys(e);if(i.length>0){const r=e[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let a=0,f=r.length;a<f;a++){const o=r[a].name||String(a);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=a}}}}}function hm(n,t,e,i,r,a,f){const o=ef.distanceSqToPoint(n);if(o<e){const s=new H;ef.closestPointToPoint(n,s),s.applyMatrix4(i);const l=r.ray.origin.distanceTo(s);if(l<r.near||l>r.far)return;a.push({distance:l,distanceToRay:Math.sqrt(o),point:s,index:t,face:null,object:f})}}class eL extends je{constructor(t,e,i,r,a,f,o,s,l){super(t,e,i,r,a,f,o,s,l),this.isCanvasTexture=!0,this.needsUpdate=!0}}class qe extends ke{constructor(t=1,e=1,i=1,r=32,a=1,f=!1,o=0,s=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:i,radialSegments:r,heightSegments:a,openEnded:f,thetaStart:o,thetaLength:s};const l=this;r=Math.floor(r),a=Math.floor(a);const u=[],A=[],c=[],h=[];let p=0;const m=[],d=i/2;let g=0;v(),f===!1&&(t>0&&w(!0),e>0&&w(!1)),this.setIndex(u),this.setAttribute("position",new Se(A,3)),this.setAttribute("normal",new Se(c,3)),this.setAttribute("uv",new Se(h,2));function v(){const _=new H,y=new H;let C=0;const b=(e-t)/i;for(let S=0;S<=a;S++){const B=[],M=S/a,z=M*(e-t)+t;for(let G=0;G<=r;G++){const P=G/r,R=P*s+o,W=Math.sin(R),K=Math.cos(R);y.x=z*W,y.y=-M*i+d,y.z=z*K,A.push(y.x,y.y,y.z),_.set(W,b,K).normalize(),c.push(_.x,_.y,_.z),h.push(P,1-M),B.push(p++)}m.push(B)}for(let S=0;S<r;S++)for(let B=0;B<a;B++){const M=m[B][S],z=m[B+1][S],G=m[B+1][S+1],P=m[B][S+1];u.push(M,z,P),u.push(z,G,P),C+=6}l.addGroup(g,C,0),g+=C}function w(_){const y=p,C=new xt,b=new H;let S=0;const B=_===!0?t:e,M=_===!0?1:-1;for(let G=1;G<=r;G++)A.push(0,d*M,0),c.push(0,M,0),h.push(.5,.5),p++;const z=p;for(let G=0;G<=r;G++){const R=G/r*s+o,W=Math.cos(R),K=Math.sin(R);b.x=B*K,b.y=d*M,b.z=B*W,A.push(b.x,b.y,b.z),c.push(0,M,0),C.x=W*.5+.5,C.y=K*.5*M+.5,h.push(C.x,C.y),p++}for(let G=0;G<r;G++){const P=y+G,R=z+G;_===!0?u.push(R,R+1,P):u.push(R+1,R,P),S+=3}l.addGroup(g,S,_===!0?1:2),g+=S}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new qe(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class md extends ke{constructor(t=[],e=[],i=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:i,detail:r};const a=[],f=[];o(r),l(i),u(),this.setAttribute("position",new Se(a,3)),this.setAttribute("normal",new Se(a.slice(),3)),this.setAttribute("uv",new Se(f,2)),r===0?this.computeVertexNormals():this.normalizeNormals();function o(v){const w=new H,_=new H,y=new H;for(let C=0;C<e.length;C+=3)h(e[C+0],w),h(e[C+1],_),h(e[C+2],y),s(w,_,y,v)}function s(v,w,_,y){const C=y+1,b=[];for(let S=0;S<=C;S++){b[S]=[];const B=v.clone().lerp(_,S/C),M=w.clone().lerp(_,S/C),z=C-S;for(let G=0;G<=z;G++)G===0&&S===C?b[S][G]=B:b[S][G]=B.clone().lerp(M,G/z)}for(let S=0;S<C;S++)for(let B=0;B<2*(C-S)-1;B++){const M=Math.floor(B/2);B%2===0?(c(b[S][M+1]),c(b[S+1][M]),c(b[S][M])):(c(b[S][M+1]),c(b[S+1][M+1]),c(b[S+1][M]))}}function l(v){const w=new H;for(let _=0;_<a.length;_+=3)w.x=a[_+0],w.y=a[_+1],w.z=a[_+2],w.normalize().multiplyScalar(v),a[_+0]=w.x,a[_+1]=w.y,a[_+2]=w.z}function u(){const v=new H;for(let w=0;w<a.length;w+=3){v.x=a[w+0],v.y=a[w+1],v.z=a[w+2];const _=d(v)/2/Math.PI+.5,y=g(v)/Math.PI+.5;f.push(_,1-y)}p(),A()}function A(){for(let v=0;v<f.length;v+=6){const w=f[v+0],_=f[v+2],y=f[v+4],C=Math.max(w,_,y),b=Math.min(w,_,y);C>.9&&b<.1&&(w<.2&&(f[v+0]+=1),_<.2&&(f[v+2]+=1),y<.2&&(f[v+4]+=1))}}function c(v){a.push(v.x,v.y,v.z)}function h(v,w){const _=v*3;w.x=t[_+0],w.y=t[_+1],w.z=t[_+2]}function p(){const v=new H,w=new H,_=new H,y=new H,C=new xt,b=new xt,S=new xt;for(let B=0,M=0;B<a.length;B+=9,M+=6){v.set(a[B+0],a[B+1],a[B+2]),w.set(a[B+3],a[B+4],a[B+5]),_.set(a[B+6],a[B+7],a[B+8]),C.set(f[M+0],f[M+1]),b.set(f[M+2],f[M+3]),S.set(f[M+4],f[M+5]),y.copy(v).add(w).add(_).divideScalar(3);const z=d(y);m(C,M+0,v,z),m(b,M+2,w,z),m(S,M+4,_,z)}}function m(v,w,_,y){y<0&&v.x===1&&(f[w]=v.x-1),_.x===0&&_.z===0&&(f[w]=y/2/Math.PI+.5)}function d(v){return Math.atan2(v.z,-v.x)}function g(v){return Math.atan2(-v.y,Math.sqrt(v.x*v.x+v.z*v.z))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new md(t.vertices,t.indices,t.radius,t.details)}}const nl=new H,rl=new H,Jh=new H,sl=new Ti;class iL extends ke{constructor(t=null,e=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:t,thresholdAngle:e},t!==null){const r=Math.pow(10,4),a=Math.cos(fa*e),f=t.getIndex(),o=t.getAttribute("position"),s=f?f.count:o.count,l=[0,0,0],u=["a","b","c"],A=new Array(3),c={},h=[];for(let p=0;p<s;p+=3){f?(l[0]=f.getX(p),l[1]=f.getX(p+1),l[2]=f.getX(p+2)):(l[0]=p,l[1]=p+1,l[2]=p+2);const{a:m,b:d,c:g}=sl;if(m.fromBufferAttribute(o,l[0]),d.fromBufferAttribute(o,l[1]),g.fromBufferAttribute(o,l[2]),sl.getNormal(Jh),A[0]=`${Math.round(m.x*r)},${Math.round(m.y*r)},${Math.round(m.z*r)}`,A[1]=`${Math.round(d.x*r)},${Math.round(d.y*r)},${Math.round(d.z*r)}`,A[2]=`${Math.round(g.x*r)},${Math.round(g.y*r)},${Math.round(g.z*r)}`,!(A[0]===A[1]||A[1]===A[2]||A[2]===A[0]))for(let v=0;v<3;v++){const w=(v+1)%3,_=A[v],y=A[w],C=sl[u[v]],b=sl[u[w]],S=`${_}_${y}`,B=`${y}_${_}`;B in c&&c[B]?(Jh.dot(c[B].normal)<=a&&(h.push(C.x,C.y,C.z),h.push(b.x,b.y,b.z)),c[B]=null):S in c||(c[S]={index0:l[v],index1:l[w],normal:Jh.clone()})}}for(const p in c)if(c[p]){const{index0:m,index1:d}=c[p];nl.fromBufferAttribute(o,m),rl.fromBufferAttribute(o,d),h.push(nl.x,nl.y,nl.z),h.push(rl.x,rl.y,rl.z)}this.setAttribute("position",new Se(h,3))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}}class sa extends md{constructor(t=1,e=0){const i=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],r=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(i,r,t,e),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new sa(t.radius,t.detail)}}class vd extends ke{constructor(t=1,e=32,i=16,r=0,a=Math.PI*2,f=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:i,phiStart:r,phiLength:a,thetaStart:f,thetaLength:o},e=Math.max(3,Math.floor(e)),i=Math.max(2,Math.floor(i));const s=Math.min(f+o,Math.PI);let l=0;const u=[],A=new H,c=new H,h=[],p=[],m=[],d=[];for(let g=0;g<=i;g++){const v=[],w=g/i;let _=0;g===0&&f===0?_=.5/e:g===i&&s===Math.PI&&(_=-.5/e);for(let y=0;y<=e;y++){const C=y/e;A.x=-t*Math.cos(r+C*a)*Math.sin(f+w*o),A.y=t*Math.cos(f+w*o),A.z=t*Math.sin(r+C*a)*Math.sin(f+w*o),p.push(A.x,A.y,A.z),c.copy(A).normalize(),m.push(c.x,c.y,c.z),d.push(C+_,1-w),v.push(l++)}u.push(v)}for(let g=0;g<i;g++)for(let v=0;v<e;v++){const w=u[g][v+1],_=u[g][v],y=u[g+1][v],C=u[g+1][v+1];(g!==0||f>0)&&h.push(w,_,C),(g!==i-1||s<Math.PI)&&h.push(_,y,C)}this.setIndex(h),this.setAttribute("position",new Se(p,3)),this.setAttribute("normal",new Se(m,3)),this.setAttribute("uv",new Se(d,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new vd(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class Wr extends ke{constructor(t=1,e=.4,i=12,r=48,a=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:i,tubularSegments:r,arc:a},i=Math.floor(i),r=Math.floor(r);const f=[],o=[],s=[],l=[],u=new H,A=new H,c=new H;for(let h=0;h<=i;h++)for(let p=0;p<=r;p++){const m=p/r*a,d=h/i*Math.PI*2;A.x=(t+e*Math.cos(d))*Math.cos(m),A.y=(t+e*Math.cos(d))*Math.sin(m),A.z=e*Math.sin(d),o.push(A.x,A.y,A.z),u.x=t*Math.cos(m),u.y=t*Math.sin(m),c.subVectors(A,u).normalize(),s.push(c.x,c.y,c.z),l.push(p/r),l.push(h/i)}for(let h=1;h<=i;h++)for(let p=1;p<=r;p++){const m=(r+1)*h+p-1,d=(r+1)*(h-1)+p-1,g=(r+1)*(h-1)+p,v=(r+1)*h+p;f.push(m,d,v),f.push(d,g,v)}this.setIndex(f),this.setAttribute("position",new Se(o,3)),this.setAttribute("normal",new Se(s,3)),this.setAttribute("uv",new Se(l,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Wr(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)}}class Qc extends Li{constructor(t){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Rt(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Rt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ic,this.normalScale=new xt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class gs extends Qc{constructor(t){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new xt(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Je(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Rt(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Rt(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Rt(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._iridescence=0,this._transmission=0,this.setValues(t)}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get iridescence(){return this._iridescence}set iridescence(t){this._iridescence>0!=t>0&&this.version++,this._iridescence=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.ior=t.ior,this.iridescence=t.iridescence,this.iridescenceMap=t.iridescenceMap,this.iridescenceIOR=t.iridescenceIOR,this.iridescenceThicknessRange=[...t.iridescenceThicknessRange],this.iridescenceThicknessMap=t.iridescenceThicknessMap,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}class rc extends Li{constructor(t){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Rt(16777215),this.specular=new Rt(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Rt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ic,this.normalScale=new xt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Uc,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class nL extends Li{constructor(t){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Rt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Rt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ic,this.normalScale=new xt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Uc,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}function ir(n,t,e){return bw(n)?new n.constructor(n.subarray(t,e!==void 0?e:n.length)):n.slice(t,e)}function al(n,t,e){return!n||!e&&n.constructor===t?n:typeof t.BYTES_PER_ELEMENT=="number"?new t(n):Array.prototype.slice.call(n)}function bw(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function rL(n){function t(r,a){return n[r]-n[a]}const e=n.length,i=new Array(e);for(let r=0;r!==e;++r)i[r]=r;return i.sort(t),i}function um(n,t,e){const i=n.length,r=new n.constructor(i);for(let a=0,f=0;f!==i;++a){const o=e[a]*t;for(let s=0;s!==t;++s)r[f++]=n[o+s]}return r}function Bw(n,t,e,i){let r=1,a=n[0];for(;a!==void 0&&a[i]===void 0;)a=n[r++];if(a===void 0)return;let f=a[i];if(f!==void 0)if(Array.isArray(f))do f=a[i],f!==void 0&&(t.push(a.time),e.push.apply(e,f)),a=n[r++];while(a!==void 0);else if(f.toArray!==void 0)do f=a[i],f!==void 0&&(t.push(a.time),f.toArray(e,e.length)),a=n[r++];while(a!==void 0);else do f=a[i],f!==void 0&&(t.push(a.time),e.push(f)),a=n[r++];while(a!==void 0)}class cA{constructor(t,e,i,r){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=r!==void 0?r:new e.constructor(i),this.sampleValues=e,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let i=this._cachedIndex,r=e[i],a=e[i-1];i:{t:{let f;e:{n:if(!(t<r)){for(let o=i+2;;){if(r===void 0){if(t<a)break n;return i=e.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===o)break;if(a=r,r=e[++i],t<r)break t}f=e.length;break e}if(!(t>=a)){const o=e[1];t<o&&(i=2,a=o);for(let s=i-2;;){if(a===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===s)break;if(r=a,a=e[--i-1],t>=a)break t}f=i,i=0;break e}break i}for(;i<f;){const o=i+f>>>1;t<e[o]?f=o:i=o+1}if(r=e[i],a=e[i-1],a===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===void 0)return i=e.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,a,r)}return this.interpolate_(i,a,t,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,i=this.sampleValues,r=this.valueSize,a=t*r;for(let f=0;f!==r;++f)e[f]=i[a+f];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class sL extends cA{constructor(t,e,i,r){super(t,e,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Ag,endingEnd:Ag}}intervalChanged_(t,e,i){const r=this.parameterPositions;let a=t-2,f=t+1,o=r[a],s=r[f];if(o===void 0)switch(this.getSettings_().endingStart){case lg:a=t,o=2*e-i;break;case cg:a=r.length-2,o=e+r[a]-r[a+1];break;default:a=t,o=i}if(s===void 0)switch(this.getSettings_().endingEnd){case lg:f=t,s=2*i-e;break;case cg:f=1,s=i+r[1]-r[0];break;default:f=t-1,s=e}const l=(i-e)*.5,u=this.valueSize;this._weightPrev=l/(e-o),this._weightNext=l/(s-i),this._offsetPrev=a*u,this._offsetNext=f*u}interpolate_(t,e,i,r){const a=this.resultBuffer,f=this.sampleValues,o=this.valueSize,s=t*o,l=s-o,u=this._offsetPrev,A=this._offsetNext,c=this._weightPrev,h=this._weightNext,p=(i-e)/(r-e),m=p*p,d=m*p,g=-c*d+2*c*m-c*p,v=(1+c)*d+(-1.5-2*c)*m+(-.5+c)*p+1,w=(-1-h)*d+(1.5+h)*m+.5*p,_=h*d-h*m;for(let y=0;y!==o;++y)a[y]=g*f[u+y]+v*f[l+y]+w*f[s+y]+_*f[A+y];return a}}class aL extends cA{constructor(t,e,i,r){super(t,e,i,r)}interpolate_(t,e,i,r){const a=this.resultBuffer,f=this.sampleValues,o=this.valueSize,s=t*o,l=s-o,u=(i-e)/(r-e),A=1-u;for(let c=0;c!==o;++c)a[c]=f[l+c]*A+f[s+c]*u;return a}}class oL extends cA{constructor(t,e,i,r){super(t,e,i,r)}interpolate_(t){return this.copySampleValue_(t-1)}}class bn{constructor(t,e,i,r){if(t===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(e===void 0||e.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=al(e,this.TimeBufferType),this.values=al(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let i;if(e.toJSON!==this.toJSON)i=e.toJSON(t);else{i={name:t.name,times:al(t.times,Array),values:al(t.values,Array)};const r=t.getInterpolation();r!==t.DefaultInterpolation&&(i.interpolation=r)}return i.type=t.ValueTypeName,i}InterpolantFactoryMethodDiscrete(t){return new oL(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new aL(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new sL(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case zo:e=this.InterpolantFactoryMethodDiscrete;break;case Ea:e=this.InterpolantFactoryMethodLinear;break;case Sh:e=this.InterpolantFactoryMethodSmooth;break}if(e===void 0){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(t!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return zo;case this.InterpolantFactoryMethodLinear:return Ea;case this.InterpolantFactoryMethodSmooth:return Sh}}getValueSize(){return this.values.length/this.times.length}shift(t){if(t!==0){const e=this.times;for(let i=0,r=e.length;i!==r;++i)e[i]+=t}return this}scale(t){if(t!==1){const e=this.times;for(let i=0,r=e.length;i!==r;++i)e[i]*=t}return this}trim(t,e){const i=this.times,r=i.length;let a=0,f=r-1;for(;a!==r&&i[a]<t;)++a;for(;f!==-1&&i[f]>e;)--f;if(++f,a!==0||f!==r){a>=f&&(f=Math.max(f,1),a=f-1);const o=this.getValueSize();this.times=ir(i,a,f),this.values=ir(this.values,a*o,f*o)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const i=this.times,r=this.values,a=i.length;a===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let f=null;for(let o=0;o!==a;o++){const s=i[o];if(typeof s=="number"&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,s),t=!1;break}if(f!==null&&f>s){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,s,f),t=!1;break}f=s}if(r!==void 0&&bw(r))for(let o=0,s=r.length;o!==s;++o){const l=r[o];if(isNaN(l)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,l),t=!1;break}}return t}optimize(){const t=ir(this.times),e=ir(this.values),i=this.getValueSize(),r=this.getInterpolation()===Sh,a=t.length-1;let f=1;for(let o=1;o<a;++o){let s=!1;const l=t[o],u=t[o+1];if(l!==u&&(o!==1||l!==t[0]))if(r)s=!0;else{const A=o*i,c=A-i,h=A+i;for(let p=0;p!==i;++p){const m=e[A+p];if(m!==e[c+p]||m!==e[h+p]){s=!0;break}}}if(s){if(o!==f){t[f]=t[o];const A=o*i,c=f*i;for(let h=0;h!==i;++h)e[c+h]=e[A+h]}++f}}if(a>0){t[f]=t[a];for(let o=a*i,s=f*i,l=0;l!==i;++l)e[s+l]=e[o+l];++f}return f!==t.length?(this.times=ir(t,0,f),this.values=ir(e,0,f*i)):(this.times=t,this.values=e),this}clone(){const t=ir(this.times,0),e=ir(this.values,0),i=this.constructor,r=new i(this.name,t,e);return r.createInterpolant=this.createInterpolant,r}}bn.prototype.TimeBufferType=Float32Array;bn.prototype.ValueBufferType=Float32Array;bn.prototype.DefaultInterpolation=Ea;class Na extends bn{}Na.prototype.ValueTypeName="bool";Na.prototype.ValueBufferType=Array;Na.prototype.DefaultInterpolation=zo;Na.prototype.InterpolantFactoryMethodLinear=void 0;Na.prototype.InterpolantFactoryMethodSmooth=void 0;class Sw extends bn{}Sw.prototype.ValueTypeName="color";class Xo extends bn{}Xo.prototype.ValueTypeName="number";class AL extends cA{constructor(t,e,i,r){super(t,e,i,r)}interpolate_(t,e,i,r){const a=this.resultBuffer,f=this.sampleValues,o=this.valueSize,s=(i-e)/(r-e);let l=t*o;for(let u=l+o;l!==u;l+=4)De.slerpFlat(a,0,f,l-o,f,l,s);return a}}class hs extends bn{InterpolantFactoryMethodLinear(t){return new AL(this.times,this.values,this.getValueSize(),t)}}hs.prototype.ValueTypeName="quaternion";hs.prototype.DefaultInterpolation=Ea;hs.prototype.InterpolantFactoryMethodSmooth=void 0;class Va extends bn{}Va.prototype.ValueTypeName="string";Va.prototype.ValueBufferType=Array;Va.prototype.DefaultInterpolation=zo;Va.prototype.InterpolantFactoryMethodLinear=void 0;Va.prototype.InterpolantFactoryMethodSmooth=void 0;class jo extends bn{}jo.prototype.ValueTypeName="vector";class lL{constructor(t,e=-1,i,r=bE){this.name=t,this.tracks=i,this.duration=e,this.blendMode=r,this.uuid=an(),this.duration<0&&this.resetDuration()}static parse(t){const e=[],i=t.tracks,r=1/(t.fps||1);for(let f=0,o=i.length;f!==o;++f)e.push(hL(i[f]).scale(r));const a=new this(t.name,t.duration,e,t.blendMode);return a.uuid=t.uuid,a}static toJSON(t){const e=[],i=t.tracks,r={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let a=0,f=i.length;a!==f;++a)e.push(bn.toJSON(i[a]));return r}static CreateFromMorphTargetSequence(t,e,i,r){const a=e.length,f=[];for(let o=0;o<a;o++){let s=[],l=[];s.push((o+a-1)%a,o,(o+1)%a),l.push(0,1,0);const u=rL(s);s=um(s,1,u),l=um(l,1,u),!r&&s[0]===0&&(s.push(a),l.push(l[0])),f.push(new Xo(".morphTargetInfluences["+e[o].name+"]",s,l).scale(1/i))}return new this(t,-1,f)}static findByName(t,e){let i=t;if(!Array.isArray(t)){const r=t;i=r.geometry&&r.geometry.animations||r.animations}for(let r=0;r<i.length;r++)if(i[r].name===e)return i[r];return null}static CreateClipsFromMorphTargetSequences(t,e,i){const r={},a=/^([\w-]*?)([\d]+)$/;for(let o=0,s=t.length;o<s;o++){const l=t[o],u=l.name.match(a);if(u&&u.length>1){const A=u[1];let c=r[A];c||(r[A]=c=[]),c.push(l)}}const f=[];for(const o in r)f.push(this.CreateFromMorphTargetSequence(o,r[o],e,i));return f}static parseAnimation(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(A,c,h,p,m){if(h.length!==0){const d=[],g=[];Bw(h,d,g,p),d.length!==0&&m.push(new A(c,d,g))}},r=[],a=t.name||"default",f=t.fps||30,o=t.blendMode;let s=t.length||-1;const l=t.hierarchy||[];for(let A=0;A<l.length;A++){const c=l[A].keys;if(!(!c||c.length===0))if(c[0].morphTargets){const h={};let p;for(p=0;p<c.length;p++)if(c[p].morphTargets)for(let m=0;m<c[p].morphTargets.length;m++)h[c[p].morphTargets[m]]=-1;for(const m in h){const d=[],g=[];for(let v=0;v!==c[p].morphTargets.length;++v){const w=c[p];d.push(w.time),g.push(w.morphTarget===m?1:0)}r.push(new Xo(".morphTargetInfluence["+m+"]",d,g))}s=h.length*f}else{const h=".bones["+e[A].name+"]";i(jo,h+".position",c,"pos",r),i(hs,h+".quaternion",c,"rot",r),i(jo,h+".scale",c,"scl",r)}}return r.length===0?null:new this(a,s,r,o)}resetDuration(){const t=this.tracks;let e=0;for(let i=0,r=t.length;i!==r;++i){const a=this.tracks[i];e=Math.max(e,a.times[a.times.length-1])}return this.duration=e,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function cL(n){switch(n.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Xo;case"vector":case"vector2":case"vector3":case"vector4":return jo;case"color":return Sw;case"quaternion":return hs;case"bool":case"boolean":return Na;case"string":return Va}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+n)}function hL(n){if(n.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=cL(n.type);if(n.times===void 0){const e=[],i=[];Bw(n.keys,e,i,"value"),n.times=e,n.values=i}return t.parse!==void 0?t.parse(n):new t(n.name,n.times,n.values,n.interpolation)}const Ua={enabled:!1,files:{},add:function(n,t){this.enabled!==!1&&(this.files[n]=t)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class uL{constructor(t,e,i){const r=this;let a=!1,f=0,o=0,s;const l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=i,this.itemStart=function(u){o++,a===!1&&r.onStart!==void 0&&r.onStart(u,f,o),a=!0},this.itemEnd=function(u){f++,r.onProgress!==void 0&&r.onProgress(u,f,o),f===o&&(a=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(u){r.onError!==void 0&&r.onError(u)},this.resolveURL=function(u){return s?s(u):u},this.setURLModifier=function(u){return s=u,this},this.addHandler=function(u,A){return l.push(u,A),this},this.removeHandler=function(u){const A=l.indexOf(u);return A!==-1&&l.splice(A,2),this},this.getHandler=function(u){for(let A=0,c=l.length;A<c;A+=2){const h=l[A],p=l[A+1];if(h.global&&(h.lastIndex=0),h.test(u))return p}return null}}}const fL=new uL;class hA{constructor(t){this.manager=t!==void 0?t:fL,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const i=this;return new Promise(function(r,a){i.load(t,r,e,a)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}const Pn={};class dL extends Error{constructor(t,e){super(t),this.response=e}}class Ew extends hA{constructor(t){super(t)}load(t,e,i,r){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const a=Ua.get(t);if(a!==void 0)return this.manager.itemStart(t),setTimeout(()=>{e&&e(a),this.manager.itemEnd(t)},0),a;if(Pn[t]!==void 0){Pn[t].push({onLoad:e,onProgress:i,onError:r});return}Pn[t]=[],Pn[t].push({onLoad:e,onProgress:i,onError:r});const f=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,s=this.responseType;fetch(f).then(l=>{if(l.status===200||l.status===0){if(l.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||l.body===void 0||l.body.getReader===void 0)return l;const u=Pn[t],A=l.body.getReader(),c=l.headers.get("Content-Length")||l.headers.get("X-File-Size"),h=c?parseInt(c):0,p=h!==0;let m=0;const d=new ReadableStream({start(g){v();function v(){A.read().then(({done:w,value:_})=>{if(w)g.close();else{m+=_.byteLength;const y=new ProgressEvent("progress",{lengthComputable:p,loaded:m,total:h});for(let C=0,b=u.length;C<b;C++){const S=u[C];S.onProgress&&S.onProgress(y)}g.enqueue(_),v()}})}}});return new Response(d)}else throw new dL(`fetch for "${l.url}" responded with ${l.status}: ${l.statusText}`,l)}).then(l=>{switch(s){case"arraybuffer":return l.arrayBuffer();case"blob":return l.blob();case"document":return l.text().then(u=>new DOMParser().parseFromString(u,o));case"json":return l.json();default:if(o===void 0)return l.text();{const A=/charset="?([^;"\s]*)"?/i.exec(o),c=A&&A[1]?A[1].toLowerCase():void 0,h=new TextDecoder(c);return l.arrayBuffer().then(p=>h.decode(p))}}}).then(l=>{Ua.add(t,l);const u=Pn[t];delete Pn[t];for(let A=0,c=u.length;A<c;A++){const h=u[A];h.onLoad&&h.onLoad(l)}}).catch(l=>{const u=Pn[t];if(u===void 0)throw this.manager.itemError(t),l;delete Pn[t];for(let A=0,c=u.length;A<c;A++){const h=u[A];h.onError&&h.onError(l)}this.manager.itemError(t)}).finally(()=>{this.manager.itemEnd(t)}),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}class pL extends hA{constructor(t){super(t)}load(t,e,i,r){this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const a=this,f=Ua.get(t);if(f!==void 0)return a.manager.itemStart(t),setTimeout(function(){e&&e(f),a.manager.itemEnd(t)},0),f;const o=Wo("img");function s(){u(),Ua.add(t,this),e&&e(this),a.manager.itemEnd(t)}function l(A){u(),r&&r(A),a.manager.itemError(t),a.manager.itemEnd(t)}function u(){o.removeEventListener("load",s,!1),o.removeEventListener("error",l,!1)}return o.addEventListener("load",s,!1),o.addEventListener("error",l,!1),t.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(o.crossOrigin=this.crossOrigin),a.manager.itemStart(t),o.src=t,o}}class gL extends hA{constructor(t){super(t)}load(t,e,i,r){const a=new je,f=new pL(this.manager);return f.setCrossOrigin(this.crossOrigin),f.setPath(this.path),f.load(t,function(o){a.image=o,a.needsUpdate=!0,e!==void 0&&e(a)},i,r),a}}class Rc extends ce{constructor(t,e=1){super(),this.isLight=!0,this.type="Light",this.color=new Rt(t),this.intensity=e}dispose(){}copy(t,e){return super.copy(t,e),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,this.groundColor!==void 0&&(e.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(e.object.distance=this.distance),this.angle!==void 0&&(e.object.angle=this.angle),this.decay!==void 0&&(e.object.decay=this.decay),this.penumbra!==void 0&&(e.object.penumbra=this.penumbra),this.shadow!==void 0&&(e.object.shadow=this.shadow.toJSON()),e}}const Zh=new Kt,fm=new H,dm=new H;class wd{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new xt(512,512),this.map=null,this.mapPass=null,this.matrix=new Kt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new dd,this._frameExtents=new xt(1,1),this._viewportCount=1,this._viewports=[new pe(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,i=this.matrix;fm.setFromMatrixPosition(t.matrixWorld),e.position.copy(fm),dm.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(dm),e.updateMatrixWorld(),Zh.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Zh),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(Zh)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const t={};return this.bias!==0&&(t.bias=this.bias),this.normalBias!==0&&(t.normalBias=this.normalBias),this.radius!==1&&(t.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class mL extends wd{constructor(){super(new ui(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(t){const e=this.camera,i=Ma*2*t.angle*this.focus,r=this.mapSize.width/this.mapSize.height,a=t.distance||e.far;(i!==e.fov||r!==e.aspect||a!==e.far)&&(e.fov=i,e.aspect=r,e.far=a,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}class vL extends Rc{constructor(t,e,i=0,r=Math.PI/3,a=0,f=2){super(t,e),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(ce.DEFAULT_UP),this.updateMatrix(),this.target=new ce,this.distance=i,this.angle=r,this.penumbra=a,this.decay=f,this.map=null,this.shadow=new mL}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}const pm=new Kt,so=new H,tu=new H;class wL extends wd{constructor(){super(new ui(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new xt(4,2),this._viewportCount=6,this._viewports=[new pe(2,1,1,1),new pe(0,1,1,1),new pe(3,1,1,1),new pe(1,1,1,1),new pe(3,0,1,1),new pe(1,0,1,1)],this._cubeDirections=[new H(1,0,0),new H(-1,0,0),new H(0,0,1),new H(0,0,-1),new H(0,1,0),new H(0,-1,0)],this._cubeUps=[new H(0,1,0),new H(0,1,0),new H(0,1,0),new H(0,1,0),new H(0,0,1),new H(0,0,-1)]}updateMatrices(t,e=0){const i=this.camera,r=this.matrix,a=t.distance||i.far;a!==i.far&&(i.far=a,i.updateProjectionMatrix()),so.setFromMatrixPosition(t.matrixWorld),i.position.copy(so),tu.copy(i.position),tu.add(this._cubeDirections[e]),i.up.copy(this._cubeUps[e]),i.lookAt(tu),i.updateMatrixWorld(),r.makeTranslation(-so.x,-so.y,-so.z),pm.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(pm)}}class _L extends Rc{constructor(t,e,i=0,r=2){super(t,e),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=r,this.shadow=new wL}get power(){return this.intensity*4*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}class yL extends wd{constructor(){super(new AA(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class wo extends Rc{constructor(t,e){super(t,e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(ce.DEFAULT_UP),this.updateMatrix(),this.target=new ce,this.shadow=new yL}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}class xL extends Rc{constructor(t,e){super(t,e),this.isAmbientLight=!0,this.type="AmbientLight"}}class nf{static decodeText(t){if(typeof TextDecoder<"u")return new TextDecoder().decode(t);let e="";for(let i=0,r=t.length;i<r;i++)e+=String.fromCharCode(t[i]);try{return decodeURIComponent(escape(e))}catch{return e}}static extractUrlBase(t){const e=t.lastIndexOf("/");return e===-1?"./":t.slice(0,e+1)}static resolveURL(t,e){return typeof t!="string"||t===""?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}}class CL extends hA{constructor(t){super(t),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,e,i,r){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const a=this,f=Ua.get(t);if(f!==void 0)return a.manager.itemStart(t),setTimeout(function(){e&&e(f),a.manager.itemEnd(t)},0),f;const o={};o.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",o.headers=this.requestHeader,fetch(t,o).then(function(s){return s.blob()}).then(function(s){return createImageBitmap(s,Object.assign(a.options,{colorSpaceConversion:"none"}))}).then(function(s){Ua.add(t,s),e&&e(s),a.manager.itemEnd(t)}).catch(function(s){r&&r(s),a.manager.itemError(t),a.manager.itemEnd(t)}),a.manager.itemStart(t)}}class uA{constructor(t,e,i=0,r=1/0){this.ray=new Dc(t,e),this.near=i,this.far=r,this.camera=null,this.layers=new fd,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}intersectObject(t,e=!0,i=[]){return rf(t,this,i,e),i.sort(gm),i}intersectObjects(t,e=!0,i=[]){for(let r=0,a=t.length;r<a;r++)rf(t[r],this,i,e);return i.sort(gm),i}}function gm(n,t){return n.distance-t.distance}function rf(n,t,e,i){if(n.layers.test(t.layers)&&n.raycast(t,e),i===!0){const r=n.children;for(let a=0,f=r.length;a<f;a++)rf(r[a],t,e,!0)}}const mm=new H,ol=new H;class vm{constructor(t=new H,e=new H){this.start=t,this.end=e}set(t,e){return this.start.copy(t),this.end.copy(e),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,e){return this.delta(e).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,e){mm.subVectors(t,this.start),ol.subVectors(this.end,this.start);const i=ol.dot(ol);let a=ol.dot(mm)/i;return e&&(a=Je(a,0,1)),a}closestPointToPoint(t,e,i){const r=this.closestPointToPointParameter(t,e);return this.delta(i).multiplyScalar(r).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const Al=new Qi;class bL extends Oc{constructor(t,e=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(8*3),a=new ke;a.setIndex(new Oe(i,1)),a.setAttribute("position",new Oe(r,3)),super(a,new lA({color:e,toneMapped:!1})),this.object=t,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(t){if(t!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&Al.setFromObject(this.object),Al.isEmpty())return;const e=Al.min,i=Al.max,r=this.geometry.attributes.position,a=r.array;a[0]=i.x,a[1]=i.y,a[2]=i.z,a[3]=e.x,a[4]=i.y,a[5]=i.z,a[6]=e.x,a[7]=e.y,a[8]=i.z,a[9]=i.x,a[10]=e.y,a[11]=i.z,a[12]=i.x,a[13]=i.y,a[14]=e.z,a[15]=e.x,a[16]=i.y,a[17]=e.z,a[18]=e.x,a[19]=e.y,a[20]=e.z,a[21]=i.x,a[22]=e.y,a[23]=e.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(t){return this.object=t,this.update(),this}copy(t,e){return super.copy(t,e),this.object=t.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:hd}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=hd);function wm(n,t){if(t===BE)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),n;if(t===qu||t===$0){let e=n.getIndex();if(e===null){const f=[],o=n.getAttribute("position");if(o!==void 0){for(let s=0;s<o.count;s++)f.push(s);n.setIndex(f),e=n.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),n}const i=e.count-2,r=[];if(t===qu)for(let f=1;f<=i;f++)r.push(e.getX(0)),r.push(e.getX(f)),r.push(e.getX(f+1));else for(let f=0;f<i;f++)f%2===0?(r.push(e.getX(f)),r.push(e.getX(f+1)),r.push(e.getX(f+2))):(r.push(e.getX(f+2)),r.push(e.getX(f+1)),r.push(e.getX(f)));r.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const a=n.clone();return a.setIndex(r),a.clearGroups(),a}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),n}class BL extends hA{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new FL(e)}),this.register(function(e){return new QL(e)}),this.register(function(e){return new RL(e)}),this.register(function(e){return new HL(e)}),this.register(function(e){return new LL(e)}),this.register(function(e){return new IL(e)}),this.register(function(e){return new DL(e)}),this.register(function(e){return new PL(e)}),this.register(function(e){return new TL(e)}),this.register(function(e){return new OL(e)}),this.register(function(e){return new UL(e)}),this.register(function(e){return new EL(e)}),this.register(function(e){return new kL(e)}),this.register(function(e){return new NL(e)})}load(t,e,i,r){const a=this;let f;this.resourcePath!==""?f=this.resourcePath:this.path!==""?f=this.path:f=nf.extractUrlBase(t),this.manager.itemStart(t);const o=function(l){r?r(l):console.error(l),a.manager.itemError(t),a.manager.itemEnd(t)},s=new Ew(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,function(l){try{a.parse(l,f,function(u){e(u),a.manager.itemEnd(t)},o)}catch(u){o(u)}},i,o)}setDRACOLoader(t){return this.dracoLoader=t,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return this.pluginCallbacks.indexOf(t)===-1&&this.pluginCallbacks.push(t),this}unregister(t){return this.pluginCallbacks.indexOf(t)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,e,i,r){let a;const f={},o={},s=new TextDecoder;if(typeof t=="string")a=JSON.parse(t);else if(t instanceof ArrayBuffer)if(s.decode(new Uint8Array(t,0,4))===Mw){try{f[ne.KHR_BINARY_GLTF]=new VL(t)}catch(A){r&&r(A);return}a=JSON.parse(f[ne.KHR_BINARY_GLTF].content)}else a=JSON.parse(s.decode(t));else a=t;if(a.asset===void 0||a.asset.version[0]<2){r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const l=new eI(a,{path:e||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let u=0;u<this.pluginCallbacks.length;u++){const A=this.pluginCallbacks[u](l);o[A.name]=A,f[A.name]=!0}if(a.extensionsUsed)for(let u=0;u<a.extensionsUsed.length;++u){const A=a.extensionsUsed[u],c=a.extensionsRequired||[];switch(A){case ne.KHR_MATERIALS_UNLIT:f[A]=new ML;break;case ne.KHR_DRACO_MESH_COMPRESSION:f[A]=new zL(a,this.dracoLoader);break;case ne.KHR_TEXTURE_TRANSFORM:f[A]=new GL;break;case ne.KHR_MESH_QUANTIZATION:f[A]=new WL;break;default:c.indexOf(A)>=0&&o[A]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+A+'".')}}l.setExtensions(f),l.setPlugins(o),l.parse(i,r)}parseAsync(t,e){const i=this;return new Promise(function(r,a){i.parse(t,e,r,a)})}}function SL(){let n={};return{get:function(t){return n[t]},add:function(t,e){n[t]=e},remove:function(t){delete n[t]},removeAll:function(){n={}}}}const ne={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class EL{constructor(t){this.parser=t,this.name=ne.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const t=this.parser,e=this.parser.json.nodes||[];for(let i=0,r=e.length;i<r;i++){const a=e[i];a.extensions&&a.extensions[this.name]&&a.extensions[this.name].light!==void 0&&t._addNodeRef(this.cache,a.extensions[this.name].light)}}_loadLight(t){const e=this.parser,i="light:"+t;let r=e.cache.get(i);if(r)return r;const a=e.json,s=((a.extensions&&a.extensions[this.name]||{}).lights||[])[t];let l;const u=new Rt(16777215);s.color!==void 0&&u.fromArray(s.color);const A=s.range!==void 0?s.range:0;switch(s.type){case"directional":l=new wo(u),l.target.position.set(0,0,-1),l.add(l.target);break;case"point":l=new _L(u),l.distance=A;break;case"spot":l=new vL(u),l.distance=A,s.spot=s.spot||{},s.spot.innerConeAngle=s.spot.innerConeAngle!==void 0?s.spot.innerConeAngle:0,s.spot.outerConeAngle=s.spot.outerConeAngle!==void 0?s.spot.outerConeAngle:Math.PI/4,l.angle=s.spot.outerConeAngle,l.penumbra=1-s.spot.innerConeAngle/s.spot.outerConeAngle,l.target.position.set(0,0,-1),l.add(l.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+s.type)}return l.position.set(0,0,0),l.decay=2,Ar(l,s),s.intensity!==void 0&&(l.intensity=s.intensity),l.name=e.createUniqueName(s.name||"light_"+t),r=Promise.resolve(l),e.cache.add(i,r),r}getDependency(t,e){if(t==="light")return this._loadLight(e)}createNodeAttachment(t){const e=this,i=this.parser,a=i.json.nodes[t],o=(a.extensions&&a.extensions[this.name]||{}).light;return o===void 0?null:this._loadLight(o).then(function(s){return i._getNodeRef(e.cache,o,s)})}}class ML{constructor(){this.name=ne.KHR_MATERIALS_UNLIT}getMaterialType(){return vn}extendParams(t,e,i){const r=[];t.color=new Rt(1,1,1),t.opacity=1;const a=e.pbrMetallicRoughness;if(a){if(Array.isArray(a.baseColorFactor)){const f=a.baseColorFactor;t.color.fromArray(f),t.opacity=f[3]}a.baseColorTexture!==void 0&&r.push(i.assignTexture(t,"map",a.baseColorTexture,le))}return Promise.all(r)}}class TL{constructor(t){this.parser=t,this.name=ne.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(t,e){const r=this.parser.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const a=r.extensions[this.name].emissiveStrength;return a!==void 0&&(e.emissiveIntensity=a),Promise.resolve()}}class FL{constructor(t){this.parser=t,this.name=ne.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:gs}extendMaterialParams(t,e){const i=this.parser,r=i.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const a=[],f=r.extensions[this.name];if(f.clearcoatFactor!==void 0&&(e.clearcoat=f.clearcoatFactor),f.clearcoatTexture!==void 0&&a.push(i.assignTexture(e,"clearcoatMap",f.clearcoatTexture)),f.clearcoatRoughnessFactor!==void 0&&(e.clearcoatRoughness=f.clearcoatRoughnessFactor),f.clearcoatRoughnessTexture!==void 0&&a.push(i.assignTexture(e,"clearcoatRoughnessMap",f.clearcoatRoughnessTexture)),f.clearcoatNormalTexture!==void 0&&(a.push(i.assignTexture(e,"clearcoatNormalMap",f.clearcoatNormalTexture)),f.clearcoatNormalTexture.scale!==void 0)){const o=f.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new xt(o,o)}return Promise.all(a)}}class UL{constructor(t){this.parser=t,this.name=ne.KHR_MATERIALS_IRIDESCENCE}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:gs}extendMaterialParams(t,e){const i=this.parser,r=i.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const a=[],f=r.extensions[this.name];return f.iridescenceFactor!==void 0&&(e.iridescence=f.iridescenceFactor),f.iridescenceTexture!==void 0&&a.push(i.assignTexture(e,"iridescenceMap",f.iridescenceTexture)),f.iridescenceIor!==void 0&&(e.iridescenceIOR=f.iridescenceIor),e.iridescenceThicknessRange===void 0&&(e.iridescenceThicknessRange=[100,400]),f.iridescenceThicknessMinimum!==void 0&&(e.iridescenceThicknessRange[0]=f.iridescenceThicknessMinimum),f.iridescenceThicknessMaximum!==void 0&&(e.iridescenceThicknessRange[1]=f.iridescenceThicknessMaximum),f.iridescenceThicknessTexture!==void 0&&a.push(i.assignTexture(e,"iridescenceThicknessMap",f.iridescenceThicknessTexture)),Promise.all(a)}}class LL{constructor(t){this.parser=t,this.name=ne.KHR_MATERIALS_SHEEN}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:gs}extendMaterialParams(t,e){const i=this.parser,r=i.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const a=[];e.sheenColor=new Rt(0,0,0),e.sheenRoughness=0,e.sheen=1;const f=r.extensions[this.name];return f.sheenColorFactor!==void 0&&e.sheenColor.fromArray(f.sheenColorFactor),f.sheenRoughnessFactor!==void 0&&(e.sheenRoughness=f.sheenRoughnessFactor),f.sheenColorTexture!==void 0&&a.push(i.assignTexture(e,"sheenColorMap",f.sheenColorTexture,le)),f.sheenRoughnessTexture!==void 0&&a.push(i.assignTexture(e,"sheenRoughnessMap",f.sheenRoughnessTexture)),Promise.all(a)}}class IL{constructor(t){this.parser=t,this.name=ne.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:gs}extendMaterialParams(t,e){const i=this.parser,r=i.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const a=[],f=r.extensions[this.name];return f.transmissionFactor!==void 0&&(e.transmission=f.transmissionFactor),f.transmissionTexture!==void 0&&a.push(i.assignTexture(e,"transmissionMap",f.transmissionTexture)),Promise.all(a)}}class DL{constructor(t){this.parser=t,this.name=ne.KHR_MATERIALS_VOLUME}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:gs}extendMaterialParams(t,e){const i=this.parser,r=i.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const a=[],f=r.extensions[this.name];e.thickness=f.thicknessFactor!==void 0?f.thicknessFactor:0,f.thicknessTexture!==void 0&&a.push(i.assignTexture(e,"thicknessMap",f.thicknessTexture)),e.attenuationDistance=f.attenuationDistance||1/0;const o=f.attenuationColor||[1,1,1];return e.attenuationColor=new Rt(o[0],o[1],o[2]),Promise.all(a)}}class PL{constructor(t){this.parser=t,this.name=ne.KHR_MATERIALS_IOR}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:gs}extendMaterialParams(t,e){const r=this.parser.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const a=r.extensions[this.name];return e.ior=a.ior!==void 0?a.ior:1.5,Promise.resolve()}}class OL{constructor(t){this.parser=t,this.name=ne.KHR_MATERIALS_SPECULAR}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:gs}extendMaterialParams(t,e){const i=this.parser,r=i.json.materials[t];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const a=[],f=r.extensions[this.name];e.specularIntensity=f.specularFactor!==void 0?f.specularFactor:1,f.specularTexture!==void 0&&a.push(i.assignTexture(e,"specularIntensityMap",f.specularTexture));const o=f.specularColorFactor||[1,1,1];return e.specularColor=new Rt(o[0],o[1],o[2]),f.specularColorTexture!==void 0&&a.push(i.assignTexture(e,"specularColorMap",f.specularColorTexture,le)),Promise.all(a)}}class QL{constructor(t){this.parser=t,this.name=ne.KHR_TEXTURE_BASISU}loadTexture(t){const e=this.parser,i=e.json,r=i.textures[t];if(!r.extensions||!r.extensions[this.name])return null;const a=r.extensions[this.name],f=e.options.ktx2Loader;if(!f){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return e.loadTextureImage(t,a.source,f)}}class RL{constructor(t){this.parser=t,this.name=ne.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){const e=this.name,i=this.parser,r=i.json,a=r.textures[t];if(!a.extensions||!a.extensions[e])return null;const f=a.extensions[e],o=r.images[f.source];let s=i.textureLoader;if(o.uri){const l=i.options.manager.getHandler(o.uri);l!==null&&(s=l)}return this.detectSupport().then(function(l){if(l)return i.loadTextureImage(t,f.source,s);if(r.extensionsRequired&&r.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){const e=new Image;e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",e.onload=e.onerror=function(){t(e.height===1)}})),this.isSupported}}class HL{constructor(t){this.parser=t,this.name=ne.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(t){const e=this.name,i=this.parser,r=i.json,a=r.textures[t];if(!a.extensions||!a.extensions[e])return null;const f=a.extensions[e],o=r.images[f.source];let s=i.textureLoader;if(o.uri){const l=i.options.manager.getHandler(o.uri);l!==null&&(s=l)}return this.detectSupport().then(function(l){if(l)return i.loadTextureImage(t,f.source,s);if(r.extensionsRequired&&r.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){const e=new Image;e.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",e.onload=e.onerror=function(){t(e.height===1)}})),this.isSupported}}class kL{constructor(t){this.name=ne.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){const e=this.parser.json,i=e.bufferViews[t];if(i.extensions&&i.extensions[this.name]){const r=i.extensions[this.name],a=this.parser.getDependency("buffer",r.buffer),f=this.parser.options.meshoptDecoder;if(!f||!f.supported){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return a.then(function(o){const s=r.byteOffset||0,l=r.byteLength||0,u=r.count,A=r.byteStride,c=new Uint8Array(o,s,l);return f.decodeGltfBufferAsync?f.decodeGltfBufferAsync(u,A,c,r.mode,r.filter).then(function(h){return h.buffer}):f.ready.then(function(){const h=new ArrayBuffer(u*A);return f.decodeGltfBuffer(new Uint8Array(h),u,A,c,r.mode,r.filter),h})})}else return null}}class NL{constructor(t){this.name=ne.EXT_MESH_GPU_INSTANCING,this.parser=t}createNodeMesh(t){const e=this.parser.json,i=e.nodes[t];if(!i.extensions||!i.extensions[this.name]||i.mesh===void 0)return null;const r=e.meshes[i.mesh];for(const l of r.primitives)if(l.mode!==Ni.TRIANGLES&&l.mode!==Ni.TRIANGLE_STRIP&&l.mode!==Ni.TRIANGLE_FAN&&l.mode!==void 0)return null;const f=i.extensions[this.name].attributes,o=[],s={};for(const l in f)o.push(this.parser.getDependency("accessor",f[l]).then(u=>(s[l]=u,s[l])));return o.length<1?null:(o.push(this.parser.createNodeMesh(t)),Promise.all(o).then(l=>{const u=l.pop(),A=u.isGroup?u.children:[u],c=l[0].count,h=[];for(const p of A){const m=new Kt,d=new H,g=new De,v=new H(1,1,1),w=new JU(p.geometry,p.material,c);for(let _=0;_<c;_++)s.TRANSLATION&&d.fromBufferAttribute(s.TRANSLATION,_),s.ROTATION&&g.fromBufferAttribute(s.ROTATION,_),s.SCALE&&v.fromBufferAttribute(s.SCALE,_),w.setMatrixAt(_,m.compose(d,g,v));for(const _ in s)_!=="TRANSLATION"&&_!=="ROTATION"&&_!=="SCALE"&&p.geometry.setAttribute(_,s[_]);ce.prototype.copy.call(w,p),this.parser.assignFinalMaterial(w),h.push(w)}return u.isGroup?(u.clear(),u.add(...h),u):h[0]}))}}const Mw="glTF",ao=12,_m={JSON:1313821514,BIN:5130562};class VL{constructor(t){this.name=ne.KHR_BINARY_GLTF,this.content=null,this.body=null;const e=new DataView(t,0,ao),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(t.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==Mw)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const r=this.header.length-ao,a=new DataView(t,ao);let f=0;for(;f<r;){const o=a.getUint32(f,!0);f+=4;const s=a.getUint32(f,!0);if(f+=4,s===_m.JSON){const l=new Uint8Array(t,ao+f,o);this.content=i.decode(l)}else if(s===_m.BIN){const l=ao+f;this.body=t.slice(l,l+o)}f+=o}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class zL{constructor(t,e){if(!e)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=ne.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=e,this.dracoLoader.preload()}decodePrimitive(t,e){const i=this.json,r=this.dracoLoader,a=t.extensions[this.name].bufferView,f=t.extensions[this.name].attributes,o={},s={},l={};for(const u in f){const A=sf[u]||u.toLowerCase();o[A]=f[u]}for(const u in t.attributes){const A=sf[u]||u.toLowerCase();if(f[u]!==void 0){const c=i.accessors[t.attributes[u]],h=pa[c.componentType];l[A]=h.name,s[A]=c.normalized===!0}}return e.getDependency("bufferView",a).then(function(u){return new Promise(function(A){r.decodeDracoFile(u,function(c){for(const h in c.attributes){const p=c.attributes[h],m=s[h];m!==void 0&&(p.normalized=m)}A(c)},o,l)})})}}class GL{constructor(){this.name=ne.KHR_TEXTURE_TRANSFORM}extendTexture(t,e){return(e.texCoord===void 0||e.texCoord===t.channel)&&e.offset===void 0&&e.rotation===void 0&&e.scale===void 0||(t=t.clone(),e.texCoord!==void 0&&(t.channel=e.texCoord),e.offset!==void 0&&t.offset.fromArray(e.offset),e.rotation!==void 0&&(t.rotation=e.rotation),e.scale!==void 0&&t.repeat.fromArray(e.scale),t.needsUpdate=!0),t}}class WL{constructor(){this.name=ne.KHR_MESH_QUANTIZATION}}class Tw extends cA{constructor(t,e,i,r){super(t,e,i,r)}copySampleValue_(t){const e=this.resultBuffer,i=this.sampleValues,r=this.valueSize,a=t*r*3+r;for(let f=0;f!==r;f++)e[f]=i[a+f];return e}interpolate_(t,e,i,r){const a=this.resultBuffer,f=this.sampleValues,o=this.valueSize,s=o*2,l=o*3,u=r-e,A=(i-e)/u,c=A*A,h=c*A,p=t*l,m=p-l,d=-2*h+3*c,g=h-c,v=1-d,w=g-c+A;for(let _=0;_!==o;_++){const y=f[m+_+o],C=f[m+_+s]*u,b=f[p+_+o],S=f[p+_]*u;a[_]=v*y+w*C+d*b+g*S}return a}}const KL=new De;class XL extends Tw{interpolate_(t,e,i,r){const a=super.interpolate_(t,e,i,r);return KL.fromArray(a).normalize().toArray(a),a}}const Ni={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},pa={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},ym={9728:Xe,9729:vi,9984:Yu,9985:Y0,9986:Wl,9987:As},xm={33071:Wi,33648:nc,10497:Ba},eu={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},sf={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},nr={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},jL={CUBICSPLINE:void 0,LINEAR:Ea,STEP:zo},iu={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function YL(n){return n.DefaultMaterial===void 0&&(n.DefaultMaterial=new Qc({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Wn})),n.DefaultMaterial}function oo(n,t,e){for(const i in e.extensions)n[i]===void 0&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[i]=e.extensions[i])}function Ar(n,t){t.extras!==void 0&&(typeof t.extras=="object"?Object.assign(n.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function qL(n,t,e){let i=!1,r=!1,a=!1;for(let l=0,u=t.length;l<u;l++){const A=t[l];if(A.POSITION!==void 0&&(i=!0),A.NORMAL!==void 0&&(r=!0),A.COLOR_0!==void 0&&(a=!0),i&&r&&a)break}if(!i&&!r&&!a)return Promise.resolve(n);const f=[],o=[],s=[];for(let l=0,u=t.length;l<u;l++){const A=t[l];if(i){const c=A.POSITION!==void 0?e.getDependency("accessor",A.POSITION):n.attributes.position;f.push(c)}if(r){const c=A.NORMAL!==void 0?e.getDependency("accessor",A.NORMAL):n.attributes.normal;o.push(c)}if(a){const c=A.COLOR_0!==void 0?e.getDependency("accessor",A.COLOR_0):n.attributes.color;s.push(c)}}return Promise.all([Promise.all(f),Promise.all(o),Promise.all(s)]).then(function(l){const u=l[0],A=l[1],c=l[2];return i&&(n.morphAttributes.position=u),r&&(n.morphAttributes.normal=A),a&&(n.morphAttributes.color=c),n.morphTargetsRelative=!0,n})}function $L(n,t){if(n.updateMorphTargets(),t.weights!==void 0)for(let e=0,i=t.weights.length;e<i;e++)n.morphTargetInfluences[e]=t.weights[e];if(t.extras&&Array.isArray(t.extras.targetNames)){const e=t.extras.targetNames;if(n.morphTargetInfluences.length===e.length){n.morphTargetDictionary={};for(let i=0,r=e.length;i<r;i++)n.morphTargetDictionary[e[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function JL(n){const t=n.extensions&&n.extensions[ne.KHR_DRACO_MESH_COMPRESSION];let e;return t?e="draco:"+t.bufferView+":"+t.indices+":"+Cm(t.attributes):e=n.indices+":"+Cm(n.attributes)+":"+n.mode,e}function Cm(n){let t="";const e=Object.keys(n).sort();for(let i=0,r=e.length;i<r;i++)t+=e[i]+":"+n[e[i]]+";";return t}function af(n){switch(n){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function ZL(n){return n.search(/\.jpe?g($|\?)/i)>0||n.search(/^data\:image\/jpeg/)===0?"image/jpeg":n.search(/\.webp($|\?)/i)>0||n.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const tI=new Kt;class eI{constructor(t={},e={}){this.json=t,this.extensions={},this.plugins={},this.options=e,this.cache=new SL,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,r=!1,a=-1;typeof navigator<"u"&&(i=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,r=navigator.userAgent.indexOf("Firefox")>-1,a=r?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||i||r&&a<98?this.textureLoader=new gL(this.options.manager):this.textureLoader=new CL(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Ew(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,e){const i=this,r=this.json,a=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(f){return f._markDefs&&f._markDefs()}),Promise.all(this._invokeAll(function(f){return f.beforeRoot&&f.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(f){const o={scene:f[0][r.scene||0],scenes:f[0],animations:f[1],cameras:f[2],asset:r.asset,parser:i,userData:{}};oo(a,o,r),Ar(o,r),Promise.all(i._invokeAll(function(s){return s.afterRoot&&s.afterRoot(o)})).then(function(){t(o)})}).catch(e)}_markDefs(){const t=this.json.nodes||[],e=this.json.skins||[],i=this.json.meshes||[];for(let r=0,a=e.length;r<a;r++){const f=e[r].joints;for(let o=0,s=f.length;o<s;o++)t[f[o]].isBone=!0}for(let r=0,a=t.length;r<a;r++){const f=t[r];f.mesh!==void 0&&(this._addNodeRef(this.meshCache,f.mesh),f.skin!==void 0&&(i[f.mesh].isSkinnedMesh=!0)),f.camera!==void 0&&this._addNodeRef(this.cameraCache,f.camera)}}_addNodeRef(t,e){e!==void 0&&(t.refs[e]===void 0&&(t.refs[e]=t.uses[e]=0),t.refs[e]++)}_getNodeRef(t,e,i){if(t.refs[e]<=1)return i;const r=i.clone(),a=(f,o)=>{const s=this.associations.get(f);s!=null&&this.associations.set(o,s);for(const[l,u]of f.children.entries())a(u,o.children[l])};return a(i,r),r.name+="_instance_"+t.uses[e]++,r}_invokeOne(t){const e=Object.values(this.plugins);e.push(this);for(let i=0;i<e.length;i++){const r=t(e[i]);if(r)return r}return null}_invokeAll(t){const e=Object.values(this.plugins);e.unshift(this);const i=[];for(let r=0;r<e.length;r++){const a=t(e[r]);a&&i.push(a)}return i}getDependency(t,e){const i=t+":"+e;let r=this.cache.get(i);if(!r){switch(t){case"scene":r=this.loadScene(e);break;case"node":r=this._invokeOne(function(a){return a.loadNode&&a.loadNode(e)});break;case"mesh":r=this._invokeOne(function(a){return a.loadMesh&&a.loadMesh(e)});break;case"accessor":r=this.loadAccessor(e);break;case"bufferView":r=this._invokeOne(function(a){return a.loadBufferView&&a.loadBufferView(e)});break;case"buffer":r=this.loadBuffer(e);break;case"material":r=this._invokeOne(function(a){return a.loadMaterial&&a.loadMaterial(e)});break;case"texture":r=this._invokeOne(function(a){return a.loadTexture&&a.loadTexture(e)});break;case"skin":r=this.loadSkin(e);break;case"animation":r=this._invokeOne(function(a){return a.loadAnimation&&a.loadAnimation(e)});break;case"camera":r=this.loadCamera(e);break;default:if(r=this._invokeOne(function(a){return a!=this&&a.getDependency&&a.getDependency(t,e)}),!r)throw new Error("Unknown type: "+t);break}this.cache.add(i,r)}return r}getDependencies(t){let e=this.cache.get(t);if(!e){const i=this,r=this.json[t+(t==="mesh"?"es":"s")]||[];e=Promise.all(r.map(function(a,f){return i.getDependency(t,f)})),this.cache.add(t,e)}return e}loadBuffer(t){const e=this.json.buffers[t],i=this.fileLoader;if(e.type&&e.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+e.type+" buffer type is not supported.");if(e.uri===void 0&&t===0)return Promise.resolve(this.extensions[ne.KHR_BINARY_GLTF].body);const r=this.options;return new Promise(function(a,f){i.load(nf.resolveURL(e.uri,r.path),a,void 0,function(){f(new Error('THREE.GLTFLoader: Failed to load buffer "'+e.uri+'".'))})})}loadBufferView(t){const e=this.json.bufferViews[t];return this.getDependency("buffer",e.buffer).then(function(i){const r=e.byteLength||0,a=e.byteOffset||0;return i.slice(a,a+r)})}loadAccessor(t){const e=this,i=this.json,r=this.json.accessors[t];if(r.bufferView===void 0&&r.sparse===void 0){const f=eu[r.type],o=pa[r.componentType],s=r.normalized===!0,l=new o(r.count*f);return Promise.resolve(new Oe(l,f,s))}const a=[];return r.bufferView!==void 0?a.push(this.getDependency("bufferView",r.bufferView)):a.push(null),r.sparse!==void 0&&(a.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),a.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(a).then(function(f){const o=f[0],s=eu[r.type],l=pa[r.componentType],u=l.BYTES_PER_ELEMENT,A=u*s,c=r.byteOffset||0,h=r.bufferView!==void 0?i.bufferViews[r.bufferView].byteStride:void 0,p=r.normalized===!0;let m,d;if(h&&h!==A){const g=Math.floor(c/h),v="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+g+":"+r.count;let w=e.cache.get(v);w||(m=new l(o,g*h,r.count*h/u),w=new ww(m,h/u),e.cache.add(v,w)),d=new Ko(w,s,c%h/u,p)}else o===null?m=new l(r.count*s):m=new l(o,c,r.count*s),d=new Oe(m,s,p);if(r.sparse!==void 0){const g=eu.SCALAR,v=pa[r.sparse.indices.componentType],w=r.sparse.indices.byteOffset||0,_=r.sparse.values.byteOffset||0,y=new v(f[1],w,r.sparse.count*g),C=new l(f[2],_,r.sparse.count*s);o!==null&&(d=new Oe(d.array.slice(),d.itemSize,d.normalized));for(let b=0,S=y.length;b<S;b++){const B=y[b];if(d.setX(B,C[b*s]),s>=2&&d.setY(B,C[b*s+1]),s>=3&&d.setZ(B,C[b*s+2]),s>=4&&d.setW(B,C[b*s+3]),s>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return d})}loadTexture(t){const e=this.json,i=this.options,a=e.textures[t].source,f=e.images[a];let o=this.textureLoader;if(f.uri){const s=i.manager.getHandler(f.uri);s!==null&&(o=s)}return this.loadTextureImage(t,a,o)}loadTextureImage(t,e,i){const r=this,a=this.json,f=a.textures[t],o=a.images[e],s=(o.uri||o.bufferView)+":"+f.sampler;if(this.textureCache[s])return this.textureCache[s];const l=this.loadImageSource(e,i).then(function(u){u.flipY=!1,u.name=f.name||o.name||"",u.name===""&&typeof o.uri=="string"&&o.uri.startsWith("data:image/")===!1&&(u.name=o.uri);const c=(a.samplers||{})[f.sampler]||{};return u.magFilter=ym[c.magFilter]||vi,u.minFilter=ym[c.minFilter]||As,u.wrapS=xm[c.wrapS]||Ba,u.wrapT=xm[c.wrapT]||Ba,r.associations.set(u,{textures:t}),u}).catch(function(){return null});return this.textureCache[s]=l,l}loadImageSource(t,e){const i=this,r=this.json,a=this.options;if(this.sourceCache[t]!==void 0)return this.sourceCache[t].then(A=>A.clone());const f=r.images[t],o=self.URL||self.webkitURL;let s=f.uri||"",l=!1;if(f.bufferView!==void 0)s=i.getDependency("bufferView",f.bufferView).then(function(A){l=!0;const c=new Blob([A],{type:f.mimeType});return s=o.createObjectURL(c),s});else if(f.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");const u=Promise.resolve(s).then(function(A){return new Promise(function(c,h){let p=c;e.isImageBitmapLoader===!0&&(p=function(m){const d=new je(m);d.needsUpdate=!0,c(d)}),e.load(nf.resolveURL(A,a.path),p,void 0,h)})}).then(function(A){return l===!0&&o.revokeObjectURL(s),A.userData.mimeType=f.mimeType||ZL(f.uri),A}).catch(function(A){throw console.error("THREE.GLTFLoader: Couldn't load texture",s),A});return this.sourceCache[t]=u,u}assignTexture(t,e,i,r){const a=this;return this.getDependency("texture",i.index).then(function(f){if(!f)return null;if(i.texCoord!==void 0&&i.texCoord>0&&(f=f.clone(),f.channel=i.texCoord),a.extensions[ne.KHR_TEXTURE_TRANSFORM]){const o=i.extensions!==void 0?i.extensions[ne.KHR_TEXTURE_TRANSFORM]:void 0;if(o){const s=a.associations.get(f);f=a.extensions[ne.KHR_TEXTURE_TRANSFORM].extendTexture(f,o),a.associations.set(f,s)}}return r!==void 0&&(f.encoding=r),t[e]=f,f})}assignFinalMaterial(t){const e=t.geometry;let i=t.material;const r=e.attributes.tangent===void 0,a=e.attributes.color!==void 0,f=e.attributes.normal===void 0;if(t.isPoints){const o="PointsMaterial:"+i.uuid;let s=this.cache.get(o);s||(s=new Cw,Li.prototype.copy.call(s,i),s.color.copy(i.color),s.map=i.map,s.sizeAttenuation=!1,this.cache.add(o,s)),i=s}else if(t.isLine){const o="LineBasicMaterial:"+i.uuid;let s=this.cache.get(o);s||(s=new lA,Li.prototype.copy.call(s,i),s.color.copy(i.color),s.map=i.map,this.cache.add(o,s)),i=s}if(r||a||f){let o="ClonedMaterial:"+i.uuid+":";r&&(o+="derivative-tangents:"),a&&(o+="vertex-colors:"),f&&(o+="flat-shading:");let s=this.cache.get(o);s||(s=i.clone(),a&&(s.vertexColors=!0),f&&(s.flatShading=!0),r&&(s.normalScale&&(s.normalScale.y*=-1),s.clearcoatNormalScale&&(s.clearcoatNormalScale.y*=-1)),this.cache.add(o,s),this.associations.set(s,this.associations.get(i))),i=s}t.material=i}getMaterialType(){return Qc}loadMaterial(t){const e=this,i=this.json,r=this.extensions,a=i.materials[t];let f;const o={},s=a.extensions||{},l=[];if(s[ne.KHR_MATERIALS_UNLIT]){const A=r[ne.KHR_MATERIALS_UNLIT];f=A.getMaterialType(),l.push(A.extendParams(o,a,e))}else{const A=a.pbrMetallicRoughness||{};if(o.color=new Rt(1,1,1),o.opacity=1,Array.isArray(A.baseColorFactor)){const c=A.baseColorFactor;o.color.fromArray(c),o.opacity=c[3]}A.baseColorTexture!==void 0&&l.push(e.assignTexture(o,"map",A.baseColorTexture,le)),o.metalness=A.metallicFactor!==void 0?A.metallicFactor:1,o.roughness=A.roughnessFactor!==void 0?A.roughnessFactor:1,A.metallicRoughnessTexture!==void 0&&(l.push(e.assignTexture(o,"metalnessMap",A.metallicRoughnessTexture)),l.push(e.assignTexture(o,"roughnessMap",A.metallicRoughnessTexture))),f=this._invokeOne(function(c){return c.getMaterialType&&c.getMaterialType(t)}),l.push(Promise.all(this._invokeAll(function(c){return c.extendMaterialParams&&c.extendMaterialParams(t,o)})))}a.doubleSided===!0&&(o.side=Ui);const u=a.alphaMode||iu.OPAQUE;if(u===iu.BLEND?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,u===iu.MASK&&(o.alphaTest=a.alphaCutoff!==void 0?a.alphaCutoff:.5)),a.normalTexture!==void 0&&f!==vn&&(l.push(e.assignTexture(o,"normalMap",a.normalTexture)),o.normalScale=new xt(1,1),a.normalTexture.scale!==void 0)){const A=a.normalTexture.scale;o.normalScale.set(A,A)}return a.occlusionTexture!==void 0&&f!==vn&&(l.push(e.assignTexture(o,"aoMap",a.occlusionTexture)),a.occlusionTexture.strength!==void 0&&(o.aoMapIntensity=a.occlusionTexture.strength)),a.emissiveFactor!==void 0&&f!==vn&&(o.emissive=new Rt().fromArray(a.emissiveFactor)),a.emissiveTexture!==void 0&&f!==vn&&l.push(e.assignTexture(o,"emissiveMap",a.emissiveTexture,le)),Promise.all(l).then(function(){const A=new f(o);return a.name&&(A.name=a.name),Ar(A,a),e.associations.set(A,{materials:t}),a.extensions&&oo(r,A,a),A})}createUniqueName(t){return t}loadGeometries(t){const e=this,i=this.extensions,r=this.primitiveCache;function a(o){return i[ne.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(o,e).then(function(s){return bm(s,o,e)})}const f=[];for(let o=0,s=t.length;o<s;o++){const l=t[o],u=JL(l),A=r[u];if(A)f.push(A.promise);else{let c;l.extensions&&l.extensions[ne.KHR_DRACO_MESH_COMPRESSION]?c=a(l):c=bm(new ke,l,e),r[u]={primitive:l,promise:c},f.push(c)}}return Promise.all(f)}loadMesh(t){const e=this,i=this.json,r=this.extensions,a=i.meshes[t],f=a.primitives,o=[];for(let s=0,l=f.length;s<l;s++){const u=f[s].material===void 0?YL(this.cache):this.getDependency("material",f[s].material);o.push(u)}return o.push(e.loadGeometries(f)),Promise.all(o).then(function(s){const l=s.slice(0,s.length-1),u=s[s.length-1],A=[];for(let h=0,p=u.length;h<p;h++){const m=u[h],d=f[h];let g;const v=l[h];if(d.mode===Ni.TRIANGLES||d.mode===Ni.TRIANGLE_STRIP||d.mode===Ni.TRIANGLE_FAN||d.mode===void 0)g=a.isSkinnedMesh===!0?new jU(m,v):new yt(m,v),g.isSkinnedMesh===!0&&g.normalizeSkinWeights(),d.mode===Ni.TRIANGLE_STRIP?g.geometry=wm(g.geometry,$0):d.mode===Ni.TRIANGLE_FAN&&(g.geometry=wm(g.geometry,qu));else if(d.mode===Ni.LINES)g=new Oc(m,v);else if(d.mode===Ni.LINE_STRIP)g=new sn(m,v);else if(d.mode===Ni.LINE_LOOP)g=new ZU(m,v);else if(d.mode===Ni.POINTS)g=new tL(m,v);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+d.mode);Object.keys(g.geometry.morphAttributes).length>0&&$L(g,a),g.name=e.createUniqueName(a.name||"mesh_"+t),Ar(g,a),d.extensions&&oo(r,g,d),e.assignFinalMaterial(g),A.push(g)}for(let h=0,p=A.length;h<p;h++)e.associations.set(A[h],{meshes:t,primitives:h});if(A.length===1)return A[0];const c=new _i;e.associations.set(c,{meshes:t});for(let h=0,p=A.length;h<p;h++)c.add(A[h]);return c})}loadCamera(t){let e;const i=this.json.cameras[t],r=i[i.type];if(!r){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return i.type==="perspective"?e=new ui(ew.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):i.type==="orthographic"&&(e=new AA(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),i.name&&(e.name=this.createUniqueName(i.name)),Ar(e,i),Promise.resolve(e)}loadSkin(t){const e=this.json.skins[t],i=[];for(let r=0,a=e.joints.length;r<a;r++)i.push(this._loadNodeShallow(e.joints[r]));return e.inverseBindMatrices!==void 0?i.push(this.getDependency("accessor",e.inverseBindMatrices)):i.push(null),Promise.all(i).then(function(r){const a=r.pop(),f=r,o=[],s=[];for(let l=0,u=f.length;l<u;l++){const A=f[l];if(A){o.push(A);const c=new Kt;a!==null&&c.fromArray(a.array,l*16),s.push(c)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',e.joints[l])}return new gd(o,s)})}loadAnimation(t){const i=this.json.animations[t],r=i.name?i.name:"animation_"+t,a=[],f=[],o=[],s=[],l=[];for(let u=0,A=i.channels.length;u<A;u++){const c=i.channels[u],h=i.samplers[c.sampler],p=c.target,m=p.node,d=i.parameters!==void 0?i.parameters[h.input]:h.input,g=i.parameters!==void 0?i.parameters[h.output]:h.output;p.node!==void 0&&(a.push(this.getDependency("node",m)),f.push(this.getDependency("accessor",d)),o.push(this.getDependency("accessor",g)),s.push(h),l.push(p))}return Promise.all([Promise.all(a),Promise.all(f),Promise.all(o),Promise.all(s),Promise.all(l)]).then(function(u){const A=u[0],c=u[1],h=u[2],p=u[3],m=u[4],d=[];for(let g=0,v=A.length;g<v;g++){const w=A[g],_=c[g],y=h[g],C=p[g],b=m[g];if(w===void 0)continue;w.updateMatrix();let S;switch(nr[b.path]){case nr.weights:S=Xo;break;case nr.rotation:S=hs;break;case nr.position:case nr.scale:default:S=jo;break}const B=w.name?w.name:w.uuid,M=C.interpolation!==void 0?jL[C.interpolation]:Ea,z=[];nr[b.path]===nr.weights?w.traverse(function(P){P.morphTargetInfluences&&z.push(P.name?P.name:P.uuid)}):z.push(B);let G=y.array;if(y.normalized){const P=af(G.constructor),R=new Float32Array(G.length);for(let W=0,K=G.length;W<K;W++)R[W]=G[W]*P;G=R}for(let P=0,R=z.length;P<R;P++){const W=new S(z[P]+"."+nr[b.path],_.array,G,M);C.interpolation==="CUBICSPLINE"&&(W.createInterpolant=function(tt){const j=this instanceof hs?XL:Tw;return new j(this.times,this.values,this.getValueSize()/3,tt)},W.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),d.push(W)}}return new lL(r,void 0,d)})}createNodeMesh(t){const e=this.json,i=this,r=e.nodes[t];return r.mesh===void 0?null:i.getDependency("mesh",r.mesh).then(function(a){const f=i._getNodeRef(i.meshCache,r.mesh,a);return r.weights!==void 0&&f.traverse(function(o){if(o.isMesh)for(let s=0,l=r.weights.length;s<l;s++)o.morphTargetInfluences[s]=r.weights[s]}),f})}loadNode(t){const e=this.json,i=this,r=e.nodes[t],a=i._loadNodeShallow(t),f=[],o=r.children||[];for(let l=0,u=o.length;l<u;l++)f.push(i.getDependency("node",o[l]));const s=r.skin===void 0?Promise.resolve(null):i.getDependency("skin",r.skin);return Promise.all([a,Promise.all(f),s]).then(function(l){const u=l[0],A=l[1],c=l[2];c!==null&&u.traverse(function(h){h.isSkinnedMesh&&h.bind(c,tI)});for(let h=0,p=A.length;h<p;h++)u.add(A[h]);return u})}_loadNodeShallow(t){const e=this.json,i=this.extensions,r=this;if(this.nodeCache[t]!==void 0)return this.nodeCache[t];const a=e.nodes[t],f=a.name?r.createUniqueName(a.name):"",o=[],s=r._invokeOne(function(l){return l.createNodeMesh&&l.createNodeMesh(t)});return s&&o.push(s),a.camera!==void 0&&o.push(r.getDependency("camera",a.camera).then(function(l){return r._getNodeRef(r.cameraCache,a.camera,l)})),r._invokeAll(function(l){return l.createNodeAttachment&&l.createNodeAttachment(t)}).forEach(function(l){o.push(l)}),this.nodeCache[t]=Promise.all(o).then(function(l){let u;if(a.isBone===!0?u=new xw:l.length>1?u=new _i:l.length===1?u=l[0]:u=new ce,u!==l[0])for(let A=0,c=l.length;A<c;A++)u.add(l[A]);if(a.name&&(u.name=f),Ar(u,a),a.extensions&&oo(i,u,a),a.matrix!==void 0){const A=new Kt;A.fromArray(a.matrix),u.applyMatrix4(A)}else a.translation!==void 0&&u.position.fromArray(a.translation),a.rotation!==void 0&&u.quaternion.fromArray(a.rotation),a.scale!==void 0&&u.scale.fromArray(a.scale);return r.associations.has(u)||r.associations.set(u,{}),r.associations.get(u).nodes=t,u}),this.nodeCache[t]}loadScene(t){const e=this.extensions,i=this.json.scenes[t],r=this,a=new _i;i.name&&(a.name=r.createUniqueName(i.name)),Ar(a,i),i.extensions&&oo(e,a,i);const f=i.nodes||[],o=[];for(let s=0,l=f.length;s<l;s++)o.push(r.getDependency("node",f[s]));return Promise.all(o).then(function(s){for(let u=0,A=s.length;u<A;u++)a.add(s[u]);const l=u=>{const A=new Map;for(const[c,h]of r.associations)(c instanceof Li||c instanceof je)&&A.set(c,h);return u.traverse(c=>{const h=r.associations.get(c);h!=null&&A.set(c,h)}),A};return r.associations=l(a),a})}}function iI(n,t,e){const i=t.attributes,r=new Qi;if(i.POSITION!==void 0){const o=e.json.accessors[i.POSITION],s=o.min,l=o.max;if(s!==void 0&&l!==void 0){if(r.set(new H(s[0],s[1],s[2]),new H(l[0],l[1],l[2])),o.normalized){const u=af(pa[o.componentType]);r.min.multiplyScalar(u),r.max.multiplyScalar(u)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const a=t.targets;if(a!==void 0){const o=new H,s=new H;for(let l=0,u=a.length;l<u;l++){const A=a[l];if(A.POSITION!==void 0){const c=e.json.accessors[A.POSITION],h=c.min,p=c.max;if(h!==void 0&&p!==void 0){if(s.setX(Math.max(Math.abs(h[0]),Math.abs(p[0]))),s.setY(Math.max(Math.abs(h[1]),Math.abs(p[1]))),s.setZ(Math.max(Math.abs(h[2]),Math.abs(p[2]))),c.normalized){const m=af(pa[c.componentType]);s.multiplyScalar(m)}o.max(s)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(o)}n.boundingBox=r;const f=new Cn;r.getCenter(f.center),f.radius=r.min.distanceTo(r.max)/2,n.boundingSphere=f}function bm(n,t,e){const i=t.attributes,r=[];function a(f,o){return e.getDependency("accessor",f).then(function(s){n.setAttribute(o,s)})}for(const f in i){const o=sf[f]||f.toLowerCase();o in n.attributes||r.push(a(i[f],o))}if(t.indices!==void 0&&!n.index){const f=e.getDependency("accessor",t.indices).then(function(o){n.setIndex(o)});r.push(f)}return Ar(n,t),iI(n,t,e),Promise.all(r).then(function(){return t.targets!==void 0?qL(n,t.targets,e):n})}function nI(n,t){return new Promise((e,i)=>{new BL().load(n,function(a){e(a)},function(a){t==null||t(a)},function(a){i(a)})})}function rI(...n){let t=Fw(...n),e=new Cn;return t.isEmpty()?(e.makeEmpty(),e):(t.getBoundingSphere(e),e)}function Fw(...n){let t=new Qi;t.makeEmpty();let e=i=>{if(i.visible){if(i.isMesh)t.expandByObject(i);else if(i.children)for(let r of i.children)e(r)}};for(let i of n)e(i);return t}class sI{constructor(){x(this,"isIOS",!1);x(this,"isAndroid",!1);x(this,"isPC",!1);x(this,"isIPad",!1);x(this,"deviceInfo")}}function aI(){let n=new sI,t=navigator.userAgent.toLocaleLowerCase();return t.indexOf("ipad")!=-1?(n.isIPad=!0,n.isIOS=!0):t.includes("ios")?n.isIOS=!0:t.includes("android")?n.isAndroid=!0:n.isPC=!0,n}class oI{constructor(){x(this,"_timeout",null)}run(t,e,i=3e3){this._timeout!=null&&clearTimeout(this._timeout),t(),this._timeout=setTimeout(e,i)}}let Fr=rc,sc=new Fr({color:"green",name:"Plate"}),Po=new Fr({color:"red",name:"Stiffener"}),Uw=new Fr({color:"#0b89b3",name:"Shell Plate"}),Lw=new Fr({color:"cyan",name:"Bracket"}),Rn=new Fr({color:"#006BAD",name:"Struct"}),ae=new Fr({color:"#B37A00",name:"Pipe"}),AI=new Fr({color:"#8E3900",name:"Equipment"}),Iw=new Fr({color:"#B37A00",name:"Default"});const lI={HPLATE:sc,HSTIFF:Po,CPLATE:Uw,HBRCKT:Lw,HFLANG:Po,HCLIP:sc,EQUI:AI,STRUCT:Rn,PANE:Rn,SCTN:Rn,GENSEC:Rn,PIPE:ae,PSPOOL:ae,BRAN:ae,FLAN:ae,BEND:ae,ATTA:ae,GASK:ae,ELBO:ae,UNIO:ae,PCOM:ae,REDU:ae,TEE:ae,WELD:ae,CAP:ae,TUBI:ae,PPIECE:ae,VALV:ae};for(let n of Object.values(lI))break;const cI=`
#include <clipping_planes_pars_vertex>

void main() {

  #include <begin_vertex>

  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  #include <project_vertex>
  #include <clipping_planes_vertex>

}
`,hI=`
uniform vec3 frontColor;
uniform vec3 backColor;

#include <clipping_planes_pars_fragment>
void main() {
  #include <clipping_planes_fragment>

  gl_FragColor = ( gl_FrontFacing ) ? vec4(frontColor,1.0 ) : vec4(backColor,1.0 );
}
`;new Kn({uniforms:{frontColor:{value:new Rt(255,0,0)},backColor:{value:new Rt(0,0,255)}},vertexShader:cI,fragmentShader:hI,clipping:!0,side:Ui});class uI{constructor(){x(this,"sender")}}class fI extends uI{constructor(){super(...arguments);x(this,"cancelled",!1)}cancel(){this.cancelled=!0}}class Ot{constructor(){x(this,"callbacks",[])}add(t){this.callbacks.push(t)}dispatch(t){for(let e of this.callbacks)e==null||e(t)}remove(t){const e=this.callbacks.indexOf(t);e!=-1&&this.callbacks.splice(e,1)}removeAll(){this.callbacks=[]}}class dI extends fI{constructor(){super(...arguments);x(this,"intersectPoint");x(this,"intersectModel");x(this,"intersect");x(this,"mouse");x(this,"button")}}class pI{constructor(){x(this,"materials")}}class gI{constructor(){x(this,"intersections")}}var ts=Object.freeze({Linear:Object.freeze({None:function(n){return n},In:function(n){return this.None(n)},Out:function(n){return this.None(n)},InOut:function(n){return this.None(n)}}),Quadratic:Object.freeze({In:function(n){return n*n},Out:function(n){return n*(2-n)},InOut:function(n){return(n*=2)<1?.5*n*n:-.5*(--n*(n-2)-1)}}),Cubic:Object.freeze({In:function(n){return n*n*n},Out:function(n){return--n*n*n+1},InOut:function(n){return(n*=2)<1?.5*n*n*n:.5*((n-=2)*n*n+2)}}),Quartic:Object.freeze({In:function(n){return n*n*n*n},Out:function(n){return 1- --n*n*n*n},InOut:function(n){return(n*=2)<1?.5*n*n*n*n:-.5*((n-=2)*n*n*n-2)}}),Quintic:Object.freeze({In:function(n){return n*n*n*n*n},Out:function(n){return--n*n*n*n*n+1},InOut:function(n){return(n*=2)<1?.5*n*n*n*n*n:.5*((n-=2)*n*n*n*n+2)}}),Sinusoidal:Object.freeze({In:function(n){return 1-Math.sin((1-n)*Math.PI/2)},Out:function(n){return Math.sin(n*Math.PI/2)},InOut:function(n){return .5*(1-Math.sin(Math.PI*(.5-n)))}}),Exponential:Object.freeze({In:function(n){return n===0?0:Math.pow(1024,n-1)},Out:function(n){return n===1?1:1-Math.pow(2,-10*n)},InOut:function(n){return n===0?0:n===1?1:(n*=2)<1?.5*Math.pow(1024,n-1):.5*(-Math.pow(2,-10*(n-1))+2)}}),Circular:Object.freeze({In:function(n){return 1-Math.sqrt(1-n*n)},Out:function(n){return Math.sqrt(1- --n*n)},InOut:function(n){return(n*=2)<1?-.5*(Math.sqrt(1-n*n)-1):.5*(Math.sqrt(1-(n-=2)*n)+1)}}),Elastic:Object.freeze({In:function(n){return n===0?0:n===1?1:-Math.pow(2,10*(n-1))*Math.sin((n-1.1)*5*Math.PI)},Out:function(n){return n===0?0:n===1?1:Math.pow(2,-10*n)*Math.sin((n-.1)*5*Math.PI)+1},InOut:function(n){return n===0?0:n===1?1:(n*=2,n<1?-.5*Math.pow(2,10*(n-1))*Math.sin((n-1.1)*5*Math.PI):.5*Math.pow(2,-10*(n-1))*Math.sin((n-1.1)*5*Math.PI)+1)}}),Back:Object.freeze({In:function(n){var t=1.70158;return n===1?1:n*n*((t+1)*n-t)},Out:function(n){var t=1.70158;return n===0?0:--n*n*((t+1)*n+t)+1},InOut:function(n){var t=2.5949095;return(n*=2)<1?.5*(n*n*((t+1)*n-t)):.5*((n-=2)*n*((t+1)*n+t)+2)}}),Bounce:Object.freeze({In:function(n){return 1-ts.Bounce.Out(1-n)},Out:function(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375},InOut:function(n){return n<.5?ts.Bounce.In(n*2)*.5:ts.Bounce.Out(n*2-1)*.5+.5}}),generatePow:function(n){return n===void 0&&(n=4),n=n<Number.EPSILON?Number.EPSILON:n,n=n>1e4?1e4:n,{In:function(t){return Math.pow(t,n)},Out:function(t){return 1-Math.pow(1-t,n)},InOut:function(t){return t<.5?Math.pow(t*2,n)/2:(1-Math.pow(2-t*2,n))/2+.5}}}}),_o=function(){return performance.now()},mI=function(){function n(){this._tweens={},this._tweensAddedDuringUpdate={}}return n.prototype.getAll=function(){var t=this;return Object.keys(this._tweens).map(function(e){return t._tweens[e]})},n.prototype.removeAll=function(){this._tweens={}},n.prototype.add=function(t){this._tweens[t.getId()]=t,this._tweensAddedDuringUpdate[t.getId()]=t},n.prototype.remove=function(t){delete this._tweens[t.getId()],delete this._tweensAddedDuringUpdate[t.getId()]},n.prototype.update=function(t,e){t===void 0&&(t=_o()),e===void 0&&(e=!1);var i=Object.keys(this._tweens);if(i.length===0)return!1;for(;i.length>0;){this._tweensAddedDuringUpdate={};for(var r=0;r<i.length;r++){var a=this._tweens[i[r]],f=!e;a&&a.update(t,f)===!1&&!e&&delete this._tweens[i[r]]}i=Object.keys(this._tweensAddedDuringUpdate)}return!0},n}(),aa={Linear:function(n,t){var e=n.length-1,i=e*t,r=Math.floor(i),a=aa.Utils.Linear;return t<0?a(n[0],n[1],i):t>1?a(n[e],n[e-1],e-i):a(n[r],n[r+1>e?e:r+1],i-r)},Bezier:function(n,t){for(var e=0,i=n.length-1,r=Math.pow,a=aa.Utils.Bernstein,f=0;f<=i;f++)e+=r(1-t,i-f)*r(t,f)*n[f]*a(i,f);return e},CatmullRom:function(n,t){var e=n.length-1,i=e*t,r=Math.floor(i),a=aa.Utils.CatmullRom;return n[0]===n[e]?(t<0&&(r=Math.floor(i=e*(1+t))),a(n[(r-1+e)%e],n[r],n[(r+1)%e],n[(r+2)%e],i-r)):t<0?n[0]-(a(n[0],n[0],n[1],n[1],-i)-n[0]):t>1?n[e]-(a(n[e],n[e],n[e-1],n[e-1],i-e)-n[e]):a(n[r?r-1:0],n[r],n[e<r+1?e:r+1],n[e<r+2?e:r+2],i-r)},Utils:{Linear:function(n,t,e){return(t-n)*e+n},Bernstein:function(n,t){var e=aa.Utils.Factorial;return e(n)/e(t)/e(n-t)},Factorial:function(){var n=[1];return function(t){var e=1;if(n[t])return n[t];for(var i=t;i>1;i--)e*=i;return n[t]=e,e}}(),CatmullRom:function(n,t,e,i,r){var a=(e-n)*.5,f=(i-t)*.5,o=r*r,s=r*o;return(2*t-2*e+a+f)*s+(-3*t+3*e-2*a-f)*o+a*r+t}}},vI=function(){function n(){}return n.nextId=function(){return n._nextId++},n._nextId=0,n}(),of=new mI,Dw=function(){function n(t,e){e===void 0&&(e=of),this._object=t,this._group=e,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._isDynamic=!1,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=ts.Linear.None,this._interpolationFunction=aa.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._id=vI.nextId(),this._isChainStopped=!1,this._propertiesAreSetUp=!1,this._goToEnd=!1}return n.prototype.getId=function(){return this._id},n.prototype.isPlaying=function(){return this._isPlaying},n.prototype.isPaused=function(){return this._isPaused},n.prototype.to=function(t,e){if(e===void 0&&(e=1e3),this._isPlaying)throw new Error("Can not call Tween.to() while Tween is already started or paused. Stop the Tween first.");return this._valuesEnd=t,this._propertiesAreSetUp=!1,this._duration=e,this},n.prototype.duration=function(t){return t===void 0&&(t=1e3),this._duration=t,this},n.prototype.dynamic=function(t){return t===void 0&&(t=!1),this._isDynamic=t,this},n.prototype.start=function(t,e){if(t===void 0&&(t=_o()),e===void 0&&(e=!1),this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed){this._reversed=!1;for(var i in this._valuesStartRepeat)this._swapEndStartRepeatValues(i),this._valuesStart[i]=this._valuesStartRepeat[i]}if(this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=t,this._startTime+=this._delayTime,!this._propertiesAreSetUp||e){if(this._propertiesAreSetUp=!0,!this._isDynamic){var r={};for(var a in this._valuesEnd)r[a]=this._valuesEnd[a];this._valuesEnd=r}this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,e)}return this},n.prototype.startFromCurrentValues=function(t){return this.start(t,!0)},n.prototype._setupProperties=function(t,e,i,r,a){for(var f in i){var o=t[f],s=Array.isArray(o),l=s?"array":typeof o,u=!s&&Array.isArray(i[f]);if(!(l==="undefined"||l==="function")){if(u){var A=i[f];if(A.length===0)continue;for(var c=[o],h=0,p=A.length;h<p;h+=1){var m=this._handleRelativeValue(o,A[h]);if(isNaN(m)){u=!1,console.warn("Found invalid interpolation list. Skipping.");break}c.push(m)}u&&(i[f]=c)}if((l==="object"||s)&&o&&!u){e[f]=s?[]:{};var d=o;for(var g in d)e[f][g]=d[g];r[f]=s?[]:{};var A=i[f];if(!this._isDynamic){var v={};for(var g in A)v[g]=A[g];i[f]=A=v}this._setupProperties(d,e[f],A,r[f],a)}else(typeof e[f]>"u"||a)&&(e[f]=o),s||(e[f]*=1),u?r[f]=i[f].slice().reverse():r[f]=e[f]||0}}},n.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},n.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},n.prototype.pause=function(t){return t===void 0&&(t=_o()),this._isPaused||!this._isPlaying?this:(this._isPaused=!0,this._pauseStart=t,this._group&&this._group.remove(this),this)},n.prototype.resume=function(t){return t===void 0&&(t=_o()),!this._isPaused||!this._isPlaying?this:(this._isPaused=!1,this._startTime+=t-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this)},n.prototype.stopChainedTweens=function(){for(var t=0,e=this._chainedTweens.length;t<e;t++)this._chainedTweens[t].stop();return this},n.prototype.group=function(t){return t===void 0&&(t=of),this._group=t,this},n.prototype.delay=function(t){return t===void 0&&(t=0),this._delayTime=t,this},n.prototype.repeat=function(t){return t===void 0&&(t=0),this._initialRepeat=t,this._repeat=t,this},n.prototype.repeatDelay=function(t){return this._repeatDelayTime=t,this},n.prototype.yoyo=function(t){return t===void 0&&(t=!1),this._yoyo=t,this},n.prototype.easing=function(t){return t===void 0&&(t=ts.Linear.None),this._easingFunction=t,this},n.prototype.interpolation=function(t){return t===void 0&&(t=aa.Linear),this._interpolationFunction=t,this},n.prototype.chain=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._chainedTweens=t,this},n.prototype.onStart=function(t){return this._onStartCallback=t,this},n.prototype.onEveryStart=function(t){return this._onEveryStartCallback=t,this},n.prototype.onUpdate=function(t){return this._onUpdateCallback=t,this},n.prototype.onRepeat=function(t){return this._onRepeatCallback=t,this},n.prototype.onComplete=function(t){return this._onCompleteCallback=t,this},n.prototype.onStop=function(t){return this._onStopCallback=t,this},n.prototype.update=function(t,e){if(t===void 0&&(t=_o()),e===void 0&&(e=!0),this._isPaused)return!0;var i,r,a=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(t>a)return!1;e&&this.start(t,!0)}if(this._goToEnd=!1,t<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),this._onEveryStartCallbackFired===!1&&(this._onEveryStartCallback&&this._onEveryStartCallback(this._object),this._onEveryStartCallbackFired=!0),r=(t-this._startTime)/this._duration,r=this._duration===0||r>1?1:r;var f=this._easingFunction(r);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,f),this._onUpdateCallback&&this._onUpdateCallback(this._object,r),r===1)if(this._repeat>0){isFinite(this._repeat)&&this._repeat--;for(i in this._valuesStartRepeat)!this._yoyo&&typeof this._valuesEnd[i]=="string"&&(this._valuesStartRepeat[i]=this._valuesStartRepeat[i]+parseFloat(this._valuesEnd[i])),this._yoyo&&this._swapEndStartRepeatValues(i),this._valuesStart[i]=this._valuesStartRepeat[i];return this._yoyo&&(this._reversed=!this._reversed),this._repeatDelayTime!==void 0?this._startTime=t+this._repeatDelayTime:this._startTime=t+this._delayTime,this._onRepeatCallback&&this._onRepeatCallback(this._object),this._onEveryStartCallbackFired=!1,!0}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var o=0,s=this._chainedTweens.length;o<s;o++)this._chainedTweens[o].start(this._startTime+this._duration,!1);return this._isPlaying=!1,!1}return!0},n.prototype._updateProperties=function(t,e,i,r){for(var a in i)if(e[a]!==void 0){var f=e[a]||0,o=i[a],s=Array.isArray(t[a]),l=Array.isArray(o),u=!s&&l;u?t[a]=this._interpolationFunction(o,r):typeof o=="object"&&o?this._updateProperties(t[a],f,o,r):(o=this._handleRelativeValue(f,o),typeof o=="number"&&(t[a]=f+(o-f)*r))}},n.prototype._handleRelativeValue=function(t,e){return typeof e!="string"?e:e.charAt(0)==="+"||e.charAt(0)==="-"?t+parseFloat(e):parseFloat(e)},n.prototype._swapEndStartRepeatValues=function(t){var e=this._valuesStartRepeat[t],i=this._valuesEnd[t];typeof i=="string"?this._valuesStartRepeat[t]=this._valuesStartRepeat[t]+parseFloat(i):this._valuesStartRepeat[t]=this._valuesEnd[t],this._valuesEnd[t]=e},n}(),xn=of;xn.getAll.bind(xn);xn.removeAll.bind(xn);xn.add.bind(xn);xn.remove.bind(xn);xn.update.bind(xn);const ni=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],wI=Math.PI/180;function _I(){const n=Math.random()*4294967295|0,t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(ni[n&255]+ni[n>>8&255]+ni[n>>16&255]+ni[n>>24&255]+"-"+ni[t&255]+ni[t>>8&255]+"-"+ni[t>>16&15|64]+ni[t>>24&255]+"-"+ni[e&63|128]+ni[e>>8&255]+"-"+ni[e>>16&255]+ni[e>>24&255]+ni[i&255]+ni[i>>8&255]+ni[i>>16&255]+ni[i>>24&255]).toLowerCase()}function Pw(n,t,e){return Math.max(t,Math.min(e,n))}function Yo(n){return n*wI}let Af=1;function yI(n,t=300){let e=n.controls,i=n.perspectiveCamera,r=n.orthographicCamera,a=n.option.camera.pcamera;e.enabled=!1;let f=e.cameraDistance,o=a.fov,s=Math.tan(o*Math.PI/180/2)*f,l=s/Math.tan(Yo(Af*.5)),u=i.far,A=i.near,c=u-A,h=i.far-f,p=new Dw({cdist:f,fov:o});p.easing(ts.Quadratic.InOut),p.to({cdist:l,fov:Af},t),p.onUpdate(d=>{let g=d.fov,v=s/Math.tan(Yo(.5*g));e.cameraDistance=v,i.fov=g,i.far=v+h,i.near=i.far-c,i.updateProjectionMatrix(),e.mount.updateWorldMatrix(!0,!0),n.cameraParamsChangedEvent.dispatch({camera:i,sender:n})}),p.onComplete(d=>{n.onAnimateEvent.remove(m),n.camera=r,e.fov=o,i.fov=o,i.near=a.near,i.far=a.far,i.updateProjectionMatrix(),e.cameraDistance=f,n.render(),n.cameraParamsChangedEvent.dispatch({camera:r,sender:n}),e.enabled=!0,p=null}),p.start();let m=()=>{console.log("tween update once"),p.update()};n.onAnimateEvent.add(m)}function xI(n,t=300){let e=n.controls,i=n.perspectiveCamera;e.enabled=!1;let r=n.option.camera.pcamera,a=e.cameraDistance,f=r.fov,o=Math.tan(f*Math.PI/180/2)*a,s=i.far,l=i.near,u=s-l,A=i.far-a;n.camera=i,n.cameraParamsChangedEvent.dispatch({camera:i,sender:n});let c=new Dw({fov:Af}),h=()=>{console.log("tween update 1"),c.update()};c.easing(ts.Quadratic.InOut),c.to({fov:f},t),c.onUpdate(p=>{let m=p.fov,d=o/Math.tan(Yo(.5*m));e.cameraDistance=d,i.fov=m,i.far=d+A,i.near=i.far-u,i.updateProjectionMatrix(),e.mount.updateWorldMatrix(!0,!0),n.cameraParamsChangedEvent.dispatch({camera:i,sender:n})}),c.onComplete(p=>{e.fov=f,i.fov=f,i.near=r.near,i.far=r.far,i.updateProjectionMatrix(),e.cameraDistance=a,n.cameraParamsChangedEvent.dispatch({camera:i,sender:n}),n.onAnimateEvent.remove(h),e.enabled=!0,c=null}),c.start(),n.onAnimateEvent.add(h)}function CI(n,t=300){t<0&&(t=0),t==0?(n.camera==n.perspectiveCamera?n.camera=n.orthographicCamera:n.camera=n.perspectiveCamera,n.render()):n.camera==n.perspectiveCamera?yI(n,t):xI(n,t)}let bI=class extends ce{constructor(e,i){super();x(this,"changeViewDirectionEvent");x(this,"offsetX",0);x(this,"offsetY",0);x(this,"dim",128);this.changeViewDirectionEvent=new Ot,this.isViewHelper=!0,this.animating=!1,this.center=new H;const r=new Rt("#ffffff"),a=new Rt("red"),f=new Rt("green"),o=new Rt("blue"),s=[],l=new uA,u=new xt;new ce;const A=new AA(-2,2,2,-2,0,4);A.position.set(0,0,2);const c=new Te(.8,.05,.05).translate(.4,0,0),h=new yt(c,B(a)),p=new yt(c,B(f)),m=new yt(c,B(o));p.rotation.z=Math.PI/2,m.rotation.y=-Math.PI/2,this.add(h),this.add(m),this.add(p);const d=new Hs(M(a,"X"));d.userData.type="posX";const g=new Hs(M(f,"Y"));g.userData.type="posY";const v=new Hs(M(o,"Z"));v.userData.type="posZ";const w=new Hs(M(a));w.userData.type="negX";const _=new Hs(M(f));_.userData.type="negY";const y=new Hs(M(o));y.userData.type="negZ",d.position.x=1,g.position.y=1,v.position.z=1,w.position.x=-1,w.scale.setScalar(.8),_.position.y=-1,_.scale.setScalar(.8),y.position.z=-1,y.scale.setScalar(.8),this.add(d),this.add(g),this.add(v),this.add(w),this.add(_),this.add(y),s.push(d),s.push(g),s.push(v),s.push(w),s.push(_),s.push(y);const C=new H;this.render=function(z){this.quaternion.copy(e.quaternion).invert(),this.updateMatrixWorld(),C.set(0,0,1),C.applyQuaternion(e.quaternion);const G=this.offsetX,P=this.offsetY,R=this.dim;z.clearDepth(),z.getViewport(b),z.setViewport(G,P,R,R),z.render(this,A),z.setViewport(b.x,b.y,b.z,b.w)},new H;const b=new pe;this.handleClick=function(z){let G=this.dim;const P=i.getBoundingClientRect(),R=P.left+this.offsetX,W=P.top+(i.offsetHeight-G-this.offsetY);u.x=(z.clientX-R)/G*2-1,u.y=-((z.clientY-W)/G)*2+1,l.setFromCamera(u,A);const K=l.intersectObjects(s);if(K.length>0){const j=K[0].object;return S(j,this.center,this),this.animating=!0,!0}else return!1},this.update=function(z){},this.dispose=function(){c.dispose(),h.material.dispose(),p.material.dispose(),m.material.dispose(),d.material.map.dispose(),g.material.map.dispose(),v.material.map.dispose(),w.material.map.dispose(),_.material.map.dispose(),y.material.map.dispose(),d.material.dispose(),g.material.dispose(),v.material.dispose(),w.material.dispose(),_.material.dispose(),y.material.dispose()};function S(z,G,P){switch(z.userData.type){case"posX":P.changeViewDirectionEvent.dispatch({dir:"x"});break;case"posY":P.changeViewDirectionEvent.dispatch({dir:"y"});break;case"posZ":P.changeViewDirectionEvent.dispatch({dir:"z"});break;case"negX":P.changeViewDirectionEvent.dispatch({dir:"-x"});break;case"negY":P.changeViewDirectionEvent.dispatch({dir:"-y"});break;case"negZ":P.changeViewDirectionEvent.dispatch({dir:"-z"});break;default:console.error("ViewHelper: Invalid axis.")}}function B(z){return new vn({color:z,toneMapped:!1})}function M(z,G=null){const P=document.createElement("canvas");P.width=64,P.height=64;const R=P.getContext("2d");R.beginPath(),R.arc(32,32,20,0,2*Math.PI),R.closePath(),R.fillStyle=r.getStyle(),R.fill(),R.beginPath(),R.arc(32,32,16,0,2*Math.PI),R.closePath(),R.fillStyle=z.getStyle(),R.fill(),G!==null&&(R.font="24px Arial",R.textAlign="center",R.fillStyle="#ffffff",R.fillText(G,32,41));const W=new eL(P);return new _w({map:W,toneMapped:!1})}}};class BI extends bI{constructor(e,i){super(e,i);x(this,"dom");x(this,"onPointerDown",e=>{e.stopPropagation()});x(this,"onPointerUp",e=>{e.stopPropagation(),this.handleClick(e)});x(this,"_enabled",!1);let r=document.createElement("div");r.style.position="absolute",r.style.border="none",r.style.zIndex="999",r.style.cursor="pointer",r.style.pointerEvents="none",this.dom=r,i.appendChild(r),this.enabled=!0}update(){throw new Error("Method not implemented.")}render(e){throw new Error("Method not implemented.")}setOffset(e,i){this.offsetX=e,this.offsetY=i,this.dom.style.left=e+"px",this.dom.style.width=this.dim+"px",this.dom.style.bottom=i+"px",this.dom.style.height=this.dim+"px"}get enabled(){return this._enabled}set enabled(e){e!=this._enabled&&(e?(this.dom.addEventListener("pointerdown",this.onPointerDown),this.dom.addEventListener("pointerup",this.onPointerUp),this.dom.style.pointerEvents=""):(this.dom.removeEventListener("pointerdown",this.onPointerDown),this.dom.removeEventListener("pointerup",this.onPointerUp),this.dom.style.pointerEvents="none"),this._enabled=e)}}const nu=.5*Math.PI/180,Ye={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4},ru={LEFT:_h.ROTATE,MIDDLE:_h.DOLLY,RIGHT:_h.PAN};class SI{constructor(t){x(this,"_needsUpdate",!0);x(this,"_camera");x(this,"dom");x(this,"eps",1e-4);x(this,"target");x(this,"minCameraDistance",2);x(this,"maxCameraDistance",5e4);x(this,"targetCameraDistance",10);x(this,"_state");x(this,"screen");x(this,"_moveCurr",new xt);x(this,"_movePrev",new xt);x(this,"_panEnd",new xt);x(this,"_panStart",new xt);x(this,"_touchZoomDistanceStart",0);x(this,"_touchZoomDistanceEnd",0);x(this,"noRotate",!1);x(this,"noPan",!1);x(this,"noZoom",!1);x(this,"update");x(this,"_zoomSpeed",1);x(this,"zoomSpeed",1);x(this,"rotateSpeed",1);x(this,"panSpeed",1);x(this,"_rotateSpeed",1);x(this,"changedEvent");x(this,"changeStartEvent");x(this,"changeEndEvent");x(this,"holder");x(this,"_holder",new ce);x(this,"mount");x(this,"controlParamChangedEvent");x(this,"vp");x(this,"_prevTouch1");x(this,"_prevTouch2");x(this,"touchstart",t=>{if(t.preventDefault(),this.vp.log("touchstart"),this.enabled!==!1)switch(t.touches.length){case 1:this._state=Ye.TOUCH_ROTATE,this._moveCurr.copy(this.getMouseOnCircle(t.touches[0].pageX,t.touches[0].pageY)),this._movePrev.copy(this._moveCurr);break;default:let f=t.touches[0],o=t.touches[1];this._prevTouch1={pageX:f.pageX,pageY:f.pageY},this._prevTouch2={pageX:o.pageX,pageY:o.pageY},this._state=Ye.TOUCH_ZOOM_PAN;var e=t.touches[0].pageX-t.touches[1].pageX,i=t.touches[0].pageY-t.touches[1].pageY;this._touchZoomDistanceEnd=this._touchZoomDistanceStart=Math.sqrt(e*e+i*i);var r=(t.touches[0].pageX+t.touches[1].pageX)/2,a=(t.touches[0].pageY+t.touches[1].pageY)/2;this._panStart.copy(this.getMouseOnScreen(r,a)),this._panEnd.copy(this._panStart);break}});x(this,"_tmpV21",new xt);x(this,"_tmpV22",new xt);x(this,"touchmove",t=>{if(this.vp.log("touchmove"),t.preventDefault(),this.enabled!==!1)switch(t.touches.length){case 1:if(this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this.getMouseOnCircle(t.touches[0].pageX,t.touches[0].pageY)),this._moveDirection.set(this._moveCurr.x-this._movePrev.x,this._moveCurr.y-this._movePrev.y),this._moveDirection.lengthSq()){this._holder.position.copy(this.holder.position),this._holder.quaternion.copy(this.holder.quaternion);let a=-this._moveDirection.x*10*this._rotateSpeed,f=-this._moveDirection.y*10*this._rotateSpeed;if(this.style=="free")this._holder.rotateZ(-this._moveDirection.x*10*this._rotateSpeed*2),this._holder.rotateY(-this._moveDirection.y*10*this._rotateSpeed*2);else if(this.style=="nature")if(Math.abs(f)<Math.abs(a)){this._holder.getWorldDirection(this.__zdir);let o=this.__zdir.z>0?1:-1;this._holder.rotateOnWorldAxis(this.ez,this._moveDirection.x*10*this._rotateSpeed*o*2)}else this._holder.rotateY(this._moveDirection.y*10*this._rotateSpeed*2);this._targetQ.copy(this._holder.quaternion)}break;default:this._targetQ.copy(this.holder.quaternion);let r=!0;{let a=t.touches[0],f=t.touches[1],o=this._prevTouch1,s=this._prevTouch2,l=a.pageX-o.pageX,u=a.pageY-o.pageY,A=f.pageX-s.pageX,c=f.pageY-s.pageY;this._tmpV21.set(l,u),this._tmpV22.set(A,c);let h=this._tmpV21.angleTo(this._tmpV22)*ew.RAD2DEG;h!==90&&h<10&&(r=!1),this.vp.log(l,u,A,c,h.toFixed(0))}if(r){let a=t.touches[0].pageX-t.touches[1].pageX,f=t.touches[0].pageY-t.touches[1].pageY;this._touchZoomDistanceEnd=Math.sqrt(a*a+f*f);let o=1-(this._touchZoomDistanceEnd-this._touchZoomDistanceStart)/this._touchZoomDistanceStart*this.zoomSpeed;this.targetCameraDistance=this.cameraDistance*o,this._touchZoomDistanceStart=this._touchZoomDistanceEnd}else{let a=t.touches[0].pageX-t.touches[1].pageX,f=t.touches[0].pageY-t.touches[1].pageY;this._touchZoomDistanceEnd=Math.sqrt(a*a+f*f),this._touchZoomDistanceStart=this._touchZoomDistanceEnd;var e=(t.touches[0].pageX+t.touches[1].pageX)/2,i=(t.touches[0].pageY+t.touches[1].pageY)/2;this._panEnd.copy(this.getMouseOnScreen(e,i));let o=this.screen.width/this.screen.height;if(this._mouseChange.copy(this._panEnd).sub(this._panStart),this._mouseChange.lengthSq()){let l=Math.tan(Yo(this.fov*.5))*this.cameraDistance*2/this.camera.zoom*.01;this._holder.position.copy(this.holder.position),this._holder.quaternion.copy(this.holder.quaternion),this._holder.translateY(this._mouseChange.x*this.panSpeed*4*o*l),this._holder.translateZ(this._mouseChange.y*this.panSpeed*4*l),this.target.copy(this._holder.position)}}break}});x(this,"lastTouchEnd",0);x(this,"touchend",t=>{if(t.preventDefault(),this.vp.log("touchend"),this.enabled===!1)return;let e=Date.now(),i=e-this.lastTouchEnd;if(this.lastTouchEnd=e,this.vp.log("touch end diff",i),i<=300&&i>50){this.vp.log("double touch",i),this.vp.zoomToSelection();return}switch(t.touches.length){case 0:this._state=Ye.NONE;break;case 1:this._state=Ye.TOUCH_ROTATE,this._moveCurr.copy(this.getMouseOnCircle(t.touches[0].pageX,t.touches[0].pageY)),this._movePrev.copy(this._moveCurr);break}});x(this,"_targetEuler",new Cr(0,0,0));x(this,"_targetQ",new De);x(this,"_mountWorldQuaternion",new De);x(this,"_mouseDown",!1);x(this,"_mouseMoving",!1);x(this,"_vector",new xt);x(this,"_vector2",new xt);x(this,"_vector2ms",new xt);x(this,"ez",new H(0,0,1));x(this,"ey",new H(0,1,0));x(this,"__zdir",new H);x(this,"_style","nature");x(this,"_touchZoomDistanceStart",0);x(this,"_touchZoomDistanceEnd",0);x(this,"_zoomStart",new xt);x(this,"_zoomEnd",new xt);x(this,"fov",30);x(this,"_mouseScrolling",!1);x(this,"__zoomToFitPreciseVectorCache",new H);x(this,"_moveDirection",new xt);x(this,"_mouseChange",new xt);x(this,"_staticMoving",!1);x(this,"dynamicDampingFactor",.2);x(this,"_enabled",!0);x(this,"_zoomChanged",!0);x(this,"_rotChanged",!0);x(this,"_posChanged",!0);x(this,"_lastChangedStatus",!1);x(this,"_hasChangeOld",!1);x(this,"__handle");this.vp=t,this.controlParamChangedEvent=new Ot,this.staticMoving=!1,this.changedEvent=new Ot,this.changeStartEvent=new Ot,this.changeEndEvent=new Ot,this._state=Ye.NONE,this.dom=t.container,this.holder=new _i,this.target=new H,this.screen={left:0,top:0,width:0,hwidth:0,height:0};let e=new _i;this.holder.attach(e),this.mount=e,this.update=this._update,this.dom.addEventListener("wheel",this.mousewheel.bind(this)),this.dom.addEventListener("pointerdown",this.onPointerDown.bind(this)),this.dom.addEventListener("touchstart",this.touchstart),this.dom.addEventListener("touchend",this.touchend),this.dom.addEventListener("touchmove",this.touchmove),this.dom.addEventListener("pointermove",this.onPointerMove.bind(this)),this.dom.addEventListener("pointerup",this.onPointerUp.bind(this)),window.addEventListener("click",this.onWindowPointerUp.bind(this)),this.dom.addEventListener("contextmenu",i=>{this.enabled&&i.preventDefault()}),this.updateScreenSize(),this.cameraDistance=10,this.lookAtDir("iso"),t.camera&&(this.camera=t.camera),this.enabled=!0,t.cameraChangedEvent.add(i=>{this.camera=t.camera})}get targetEuler(){return this._targetEuler.setFromQuaternion(this._targetQ)}set targetEuler(t){this._targetEuler=t,this._targetQ.setFromEuler(t)}get targetQ(){return this._targetQ}set targetQ(t){this._targetQ.copy(t)}get needsUpdate(){return this._needsUpdate}set needsUpdate(t){t&&this.changedEvent.dispatch(),this._needsUpdate=t}get camera(){return this._camera}set camera(t){t.parent&&t.parent.remove(t),t.position.set(0,0,0),t.up.set(0,0,1),t.lookAt(1,0,0),this.mount.add(t),this.holder.updateWorldMatrix(!0,!0),this._camera=t}updateScreenSize(){let t=this;var e=t.dom.getBoundingClientRect(),i=t.dom.ownerDocument.documentElement;t.screen.left=e.left+window.scrollX-i.clientLeft,t.screen.top=e.top+window.scrollY-i.clientTop,t.screen.width=e.width,t.screen.hwidth=e.width*.5,t.screen.height=e.height,console.log(344,e.left,e.top,e.width,e.height),console.log(345,this.screen.left,this.screen.top,this.screen.width,this.screen.height)}updateScreenSize1(){let t=this;var e=t.dom.getBoundingClientRect();t.dom.ownerDocument.documentElement,t.screen.left=e.left,t.screen.top=e.top,t.screen.width=e.width,t.screen.hwidth=e.width*.5,t.screen.height=e.height,console.log(345,e.left,e.top,this.screen.width,this.screen.height)}get quaternion(){return this.camera.getWorldQuaternion(this._mountWorldQuaternion)}onPointerDown(t){if(this.enabled!==!1)switch(t.preventDefault(),t.pointerType){case"mouse":case"pen":this.onMouseDown(t);break}}onPointerUp(t){if(this.enabled!==!1){switch(t.pointerType){case"mouse":case"pen":this.onMouseUp(t);break}t.preventDefault()}}onWindowPointerUp(t){if(this.enabled!==!1)switch(t.pointerType){case"mouse":case"pen":this.onMouseUp(t);break}}get _mouseDownAndMoving(){return this._mouseMoving&&this._mouseDown}onPointerMove(t){if(this.enabled!==!1)switch(t.preventDefault(),t.pointerType){case"mouse":case"pen":this.onMouseMove(t);break}}getMouseOnCircle(t,e){let i=this;return this._vector.set((t-i.screen.hwidth-i.screen.left)/i.screen.hwidth,(i.screen.height+2*(i.screen.top-e))/i.screen.width),this._vector}getMouseOnScreen(t,e){let i=this;return this._vector2.set((t-i.screen.left)/i.screen.width,(e-i.screen.top)/i.screen.height),this._vector2}getMouseOnScreen2(t,e){return this._vector2ms.set(t/this.dom.clientWidth,e/this.dom.clientHeight),this._vector2ms}onMouseDown(t){this._mouseDown=!0,t.preventDefault();let e=this._state;if(e===Ye.NONE)switch(t.button){case ru.LEFT:e=Ye.ROTATE;break;case ru.MIDDLE:e=Ye.ZOOM;break;case ru.RIGHT:e=Ye.PAN;break;default:e=Ye.NONE}this._state=e;var i=e;i===Ye.ROTATE&&!this.noRotate?(this._moveCurr.copy(this.getMouseOnCircle(t.pageX,t.pageY)),this._movePrev.copy(this._moveCurr)):i===Ye.ZOOM&&!this.noZoom||i===Ye.PAN&&!this.noPan&&(this._panStart.copy(this.getMouseOnScreen2(t.clientX,t.clientY)),this._panEnd.copy(this._panStart))}get style(){return this._style}set style(t){t!=this._style&&(this._style=t,t=="nature"&&this.lookAtDir("iso"),this.controlParamChangedEvent.dispatch(this))}onMouseMove(t){this._mouseMoving=!0,t.preventDefault();var e=this._state;let i=this.screen.width/this.screen.height;if(e===Ye.ROTATE&&!this.noRotate){if(this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this.getMouseOnCircle(t.pageX,t.pageY)),this._moveDirection.set(this._moveCurr.x-this._movePrev.x,this._moveCurr.y-this._movePrev.y),this._moveDirection.lengthSq()){this._holder.position.copy(this.holder.position),this._holder.quaternion.copy(this.holder.quaternion);let r=-this._moveDirection.x*10*this._rotateSpeed,a=-this._moveDirection.y*10*this._rotateSpeed;if(this.style=="free")this._holder.rotateZ(-this._moveDirection.x*10*this._rotateSpeed),this._holder.rotateY(-this._moveDirection.y*10*this._rotateSpeed);else if(this.style=="nature")if(Math.abs(a)<Math.abs(r)){this._holder.getWorldDirection(this.__zdir);let f=this.__zdir.z>0?1:-1;this._holder.rotateOnWorldAxis(this.ez,-this._moveDirection.x*10*this._rotateSpeed*f)}else this._holder.rotateY(-this._moveDirection.y*10*this._rotateSpeed);this._targetQ.copy(this._holder.quaternion)}this._movePrev.copy(this._moveCurr)}else if(!(e===Ye.ZOOM&&!this.noZoom)){if(e===Ye.PAN&&!this.noPan){if(this._panEnd.copy(this.getMouseOnScreen2(t.clientX,t.clientY)),this._mouseChange.copy(this._panEnd).sub(this._panStart),console.log("panEnd"),this._mouseChange.lengthSq()){let a=Math.tan(Yo(this.fov*.5))*this.cameraDistance*2/this.camera.zoom;this._holder.position.copy(this.holder.position),this._holder.quaternion.copy(this.holder.quaternion),this._holder.translateY(this._mouseChange.x*this.panSpeed*i*a),this._holder.translateZ(this._mouseChange.y*this.panSpeed*a),this.target.copy(this._holder.position)}this._panStart.copy(this._panEnd)}}}onMouseUp(t){this._mouseDown=!1,t==null||t.preventDefault(),this._state=Ye.NONE}get _mouseInControl(){return this._mouseScrolling||this._mouseDownAndMoving}mousewheel(t){if(this.enabled===!1||this.noZoom===!0)return;switch(t.deltaMode){case 2:this._zoomStart.y-=t.deltaY*.25;break;case 1:this._zoomStart.y-=t.deltaY*.1;break;default:this._zoomStart.y-=t.deltaY*.0025;break}let e=1+(this._zoomEnd.y-this._zoomStart.y)*this._zoomSpeed;this.targetCameraDistance=this.cameraDistance*e,this._zoomStart.copy(this._zoomEnd)}lookAtDir(t){let e=new Cr,i=Math.PI*.5,r=Math.PI;switch(t){case"x":e.set(0,0,0);break;case"y":e.set(0,0,i);break;case"z":e.set(-i,0,-i);break;case"-x":e.set(0,0,-r);break;case"-y":e.set(0,-0,-i);break;case"-z":e.set(-i,0,i);break;case"iso":e.set(-.36,.36,.82);break;default:console.warn("invalid dir")}new De().setFromEuler(e),this.targetEuler=e}zoomToFitPrecise(...t){let e=Fw(...t);if(e.isEmpty())return;let i=this.camera,r=e.min.x,a=e.min.y,f=e.min.z,o=e.max.x,s=e.max.y,l=e.max.z,u=[r,o],A=[a,s],c=[f,l],h=1/0,p=1/0,m=-1/0,d=-1/0,g=this.__zoomToFitPreciseVectorCache;for(let _ of u)for(let y of A)for(let C of c){g.set(_,y,C),g.project(i),console.log("xy",g.x,g.y);let b=.5*(g.x+1),S=.5*(g.y-1);g.x>m&&(m=b),g.x<h&&(h=b),g.y>d&&(d=S),g.y<p&&(p=S)}let v=m-h,w=d-p;console.log("duv",v,w),w>v?this.targetCameraDistance*=w:this.targetCameraDistance*=v,this.targetCameraDistance*=1.05,this.target.set(.5*(r+o),.5*(a+s),.5*(f+l)),this.update()}zoomToFit(...t){let e=rI(...t);if(e.isEmpty())return;let i;this.camera.isPerspectiveCamera?(i=e.radius*1/Math.sin(this.camera.fov*nu)*this.camera.zoom,this.camera.aspect<1&&(i/=this.camera.aspect)):(i=e.radius*1.05/Math.tan(this.fov*nu)*this.camera.zoom,this.screen.height>this.screen.width&&(i=i*this.screen.height/this.screen.width)),i==this.targetCameraDistance?(this.targetCameraDistance=i*.9,setTimeout(()=>{this.targetCameraDistance=i},100)):this.targetCameraDistance=i,this.target.copy(e.center),this.update()}get cameraDistance(){return-this.mount.position.x}set cameraDistance(t){if(t>0){let e=this.camera;if(!e)this.mount.position.x=-t;else if(e.isPerspectiveCamera)this.mount.position.x=-t;else if(e.isOrthographicCamera){this.mount.position.x=-t;let i=t*Math.tan(this.fov*nu),r;r=i/e.top,e.top=i,e.bottom=-i,e.left*=r,e.right*=r,e.updateProjectionMatrix()}}}get staticMoving(){return this._staticMoving}set staticMoving(t){this._staticMoving=t,this.config()}config(){this.staticMoving?(this.dynamicDampingFactor=1,this._zoomSpeed=.2*this.zoomSpeed,this.panSpeed=1,this._rotateSpeed=.2*this.rotateSpeed,this._updateFunc=this._update):(this.dynamicDampingFactor=.2,this._zoomSpeed=this.zoomSpeed,this.panSpeed=1/this.dynamicDampingFactor,this._rotateSpeed=this.rotateSpeed,this._updateFunc=this._update)}resetTargetToHolder(){this.targetCameraDistance=this.cameraDistance,this.target.copy(this.holder.position),this._targetQ.copy(this.holder.quaternion),this.reset()}reset(){this._zoomStart.copy(this._zoomEnd),this._movePrev.copy(this._moveCurr),this._panStart.copy(this._panEnd)}resetHolderToTarget(){this.cameraDistance=this.targetCameraDistance,this.holder.position.copy(this.target),this.holder.quaternion.copy(this._targetQ),this.reset()}get enabled(){return this._enabled}set enabled(t){this._enabled=t}_updateNone(){}_hasChange(){return!(this.cameraDistance==this.targetCameraDistance&&this.holder.quaternion.equals(this._targetQ)&&this.holder.position.equals(this.target))}_updateHasChangeOld(t){this._hasChangeOld!==t&&(this.__handle&&clearTimeout(this.__handle),this._hasChangeOld=t,t?this.changeStartEvent.dispatch():this.changeEndEvent.dispatch())}_update(){this.needsUpdate=!1;let t=this._hasChange();if(this._updateHasChangeOld(t),!t)return;if(this.noZoom===!0)this._zoomChanged=!1;else{let i=(this.targetCameraDistance-this.cameraDistance)*this.dynamicDampingFactor,r=this.cameraDistance;Math.abs(i)<this.eps?r=this.targetCameraDistance:r+=i,r>this.maxCameraDistance?this.targetCameraDistance=this.maxCameraDistance:r<this.minCameraDistance&&(this.targetCameraDistance=this.minCameraDistance),r==this.cameraDistance?this._zoomChanged=!1:(this._zoomChanged=!0,this.cameraDistance=r)}this.noRotate?this._rotChanged=!1:this.holder.quaternion.angleTo(this._targetQ)<this.eps?(this.holder.quaternion.copy(this._targetQ),this._rotChanged=!1):(this._rotChanged=!0,this.holder.quaternion.slerp(this._targetQ,this.dynamicDampingFactor)),this.noPan?this._posChanged=!1:this.holder.position.distanceToSquared(this.target)<this.eps?(this.holder.position.copy(this.target),this._posChanged=!1):(this.holder.position.lerp(this.target,this.dynamicDampingFactor),this._posChanged=!0);let e=this._posChanged||this._zoomChanged||this._rotChanged;this._lastChangedStatus!=e&&(this._lastChangedStatus=e),e&&(this.needsUpdate=!0)}}var EI=`
attribute vec3 aN0;
attribute vec3 aN1;
attribute vec4 aOtherVert;
uniform float uAngleThresh;
uniform int uOutline;

varying vec4 vDebug;

void main() {
	vec4 mv = modelViewMatrix * vec4( position , 1. );
	
	gl_Position = projectionMatrix * mv;
	gl_Position.z -= 0.0000001;//0.001; //wtf?

	vec3 viewDir = normalize(-mv.xyz);
	
	//check for null normals
	float l0 = length(aN0); 
	float l1 = length(aN1);

	if(l0*l1 < 0.0001) return; //end of mesh

	float dd = dot(normalize(aN0),normalize(aN1));

	if(acos(dd) > uAngleThresh) return;
	
	//find point
	bool isOther = aOtherVert.w > 0.5;
	vec3 a;
	vec3 b;

	if(isOther){
		a = aOtherVert.xyz;
		b = position;
	} else {
		a = position;
		b = aOtherVert.xyz;
	}

	vec3 ld = normalize(b - a);
	vec3 camToEdge = cameraPosition - a;
	float f = dot(camToEdge,ld);
	vec3 p = a + ld * f;
	p = normalize(p-cameraPosition);

	vec3 vp =  ( modelViewMatrix * vec4(p,   0.) ).xyz;
	vec3 vN0 = ( modelViewMatrix * vec4(aN0, 0.) ).xyz;
	vec3 vN1 = ( modelViewMatrix * vec4(aN1, 0.) ).xyz;

	vDebug.x = sign(dot(vN0,viewDir));
	vDebug.y = sign(dot(vN1,viewDir));

	bool outline = sign(dot(vN0,viewDir)) * sign(dot(vN1,viewDir)) < 0.;
	
	if(uOutline == 1 && outline) return;

	gl_Position.z = -2000.; //wtf?
}
`,MI=`
uniform vec3 uColor;
varying vec4 vDebug;

void main(){
  gl_FragColor = vec4(uColor,1.);
}
`;class Ow extends Kn{constructor(t=0,e=!0,i="#ffffff"){super({vertexShader:EI,fragmentShader:MI,uniforms:{uAngleThresh:{value:0},uOutline:{value:0},uColor:{value:new Rt}}}),this._angleThreshold=t,this.angleThreshold=t,this.outline=e,this.color.setStyle(i)}set angleThreshold(t){this._angleThreshold=t,this.uniforms.uAngleThresh.value=t/180*Math.PI%Math.PI}get angleThreshold(){return this._angleThreshold}set outline(t){this.uniforms.uOutline.value=Number(t)}get outline(){return!!this.uniforms.uOutline.value}get color(){return this.uniforms.uColor.value}}const Bm=new H,TI=1e3;class FI extends Oc{constructor(t,e=new Ow){super(new ke,e),this._extractGeometry(t.geometry)}_extractGeometry(t){const{vArray:e,n0Array:i,n1Array:r,otherVertArray:a}=t.index?this._extractIndexed(t):this._extractSoup(t),f=this.geometry;f.setAttribute("position",new Oe(new Float32Array(e),3)),f.setAttribute("aN0",new Oe(new Float32Array(i),3)),f.setAttribute("aN1",new Oe(new Float32Array(r),3)),f.setAttribute("aOtherVert",new Oe(new Float32Array(a),4))}_extractIndexed(t){const{weldedIndices:e,weldedVertices:i}=this._weldIndexed(t.index,t.attributes.position),r=this._extractEdgesFromIndex(e,i),a=[],f=[],o=[],s=[],l=new Te(.1,.1,.1),u=new vn({color:"red"});for(let A=0;A<i.length/3;A++)new yt(l,u).position.fromArray(i,A*3);return r.forEach(({a:A,b:c,n0:h,n1:p},m)=>{const d=(g,v,w)=>{const _=g*3;f.push(...v.toArray()),o.push(...w.toArray());for(let y=0;y<3;y++)a.push(i[_+y])};d(A,h,p),d(c,h,p);for(let g=0;g<3;g++)s.push(i[c*3+g]);s.push(0);for(let g=0;g<3;g++)s.push(i[A*3+g]);s.push(1)}),{vArray:a,n0Array:f,n1Array:o,otherVertArray:s}}_weldIndexed(t,e){const i={},r={},a=[],f=[];for(let o=0,s=0;o<e.count;o++){const l=o*3,A=[e.array[l],e.array[l+1],e.array[l+2]].map(c=>Math.round(c*TI)).join(":");i[A]===void 0&&(i[A]=s++,a.push(e.array[l],e.array[l+1],e.array[l+2])),r[o]=i[A]}for(let o=0;o<t.count;o+=3)for(let s=0;s<3;s++){const l=t.array[o+s];f.push(r[l])}return{weldedVertices:a,weldedIndices:f}}_extractEdgesFromIndex(t,e){const i=[],r=new H,a=new H,f=new H;for(let A=0;A<t.length;){const c=new H;r.fromArray(e,t[A++]*3),a.fromArray(e,t[A++]*3),f.fromArray(e,t[A++]*3),c.crossVectors(a.sub(r),f.sub(r)),i.push(c.normalize())}const o={},s=[];for(let A=0;A<t.length/3;A++){const c=A*3;for(let h=0;h<3;h++){const p=(h+1)%3,m=t[c+h],d=t[c+p];o[m]||(o[m]={}),o[m][d]=A,s.push([m,d])}}const l=[],u={};return s.forEach(([A,c])=>{if(u[A]||(u[A]={}),u[c]||(u[c]={}),u[A][c])return;const h=o[A][c],p=o[c][A],m=h!==void 0&&p!==void 0,d=m?i[h]:Bm,g=m?i[p]:Bm;l.push({a:A,b:c,n0:d,n1:g}),u[A][c]=!0,u[c][A]=!0}),l}_extractSoup(t){const e=t.attributes.position.count;for(let o=0;o<e;o++)t.attributes.position.array;return{vArray:[],n0Array:[],n1Array:[],otherVertArray:[]}}}class UI{static isWebGLAvailable(){try{const t=document.createElement("canvas");return!!(window.WebGLRenderingContext&&(t.getContext("webgl")||t.getContext("experimental-webgl")))}catch{return!1}}static isWebGL2Available(){try{const t=document.createElement("canvas");return!!(window.WebGL2RenderingContext&&t.getContext("webgl2"))}catch{return!1}}static getWebGLErrorMessage(){return this.getErrorMessage(1)}static getWebGL2ErrorMessage(){return this.getErrorMessage(2)}static getErrorMessage(t){const e={1:"WebGL",2:"WebGL 2"},i={1:window.WebGLRenderingContext,2:window.WebGL2RenderingContext};let r='Your $0 does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">$1</a>';const a=document.createElement("div");return a.id="webglmessage",a.style.fontFamily="monospace",a.style.fontSize="13px",a.style.fontWeight="normal",a.style.textAlign="center",a.style.background="#fff",a.style.color="#000",a.style.padding="1.5em",a.style.width="400px",a.style.margin="5em auto 0",i[t]?r=r.replace("$0","graphics card"):r=r.replace("$0","browser"),r=r.replace("$1",e[t]),a.innerHTML=r,a}}const su=UI;class LI{constructor(t,e=new _d){x(this,"stats");x(this,"renderOnDemand",!0);x(this,"container");x(this,"perspectiveCamera");x(this,"orthographicCamera");x(this,"_camera");x(this,"scene");x(this,"renderer");x(this,"controls");x(this,"option");x(this,"viewHelper");x(this,"raycaster",new uA);x(this,"mouse",new xt);x(this,"renderFunc",this._render);x(this,"rootGroup");x(this,"renderTarget");x(this,"outlineMat");x(this,"overrideMaterial",!1);x(this,"useConditionalEdge",!1);x(this,"ambientLight");x(this,"light1");x(this,"light2");x(this,"light3");x(this,"light4");x(this,"allowSelect",!0);x(this,"modelClickedEvent");x(this,"selectionChangedEvent");x(this,"cameraChangedEvent");x(this,"cameraParamsChangedEvent");x(this,"afterModelsAddEvent");x(this,"beforeModelsAddEvent");x(this,"beforeRenderEvent");x(this,"afterRenderEvent");x(this,"verbose",!1);x(this,"beforeRayCastEvent");x(this,"resizeEvent");x(this,"beginAnimateEvent");x(this,"endAnimateEvent");x(this,"materialStoreChangedEvent");x(this,"afterRayCastEvent");x(this,"changeStartEvent");x(this,"changeEndEvent");x(this,"changedEvent");x(this,"beforeSelectionChangeEvent");x(this,"onAnimateEvent");x(this,"logEvent");x(this,"updateViewHelperLocation",()=>{this.viewHelper.setOffset(this.getViewHelperOffsetX(),this.getViewHelperOffsetY())});x(this,"getViewHelperOffsetX",()=>this.screenWidth-this.viewHelper.dim);x(this,"getViewHelperOffsetY",()=>0);x(this,"enabledStatusChanged",new Ot);x(this,"_enabled",!0);x(this,"lastMouse",new xt);x(this,"onPointerDown",t=>{this.lastMouse.x=t.offsetX/this.screenWidth*2-1,this.lastMouse.y=-(t.offsetY/this.screenHeight)*2+1});x(this,"onPointerUp",t=>{if(t.isPrimary===!1)return;if(this.mouse.x=t.offsetX/this.screenWidth*2-1,this.mouse.y=-(t.offsetY/this.screenHeight)*2+1,this.mouse.distanceToSquared(this.lastMouse)>.01){this.lastMouse.copy(this.mouse);return}this.lastMouse.copy(this.mouse),this.beforeRayCastEvent.dispatch(),this.raycaster.setFromCamera(this.mouse,this.camera);const i=this.raycaster.intersectObject(this.rootGroup,!0);let r=new gI;r.intersections=i,this.afterRayCastEvent.dispatch(r);let a=[],f,o;if(i&&i.length>0)for(let s of i){const l=s.object;if(l.isMesh&&l.visible){a.push(l),f=s.point,o=s;break}}{let s=new dI;if(s.button=t.button,s.intersectModel=a?a[0]:void 0,s.intersectPoint=f,s.intersect=o,s.mouse=new xt(t.offsetX,t.offsetY),this.modelClickedEvent.dispatch(s),s.cancelled){console.log("vp click event cancelled");return}}this.selectModels(...a)});x(this,"_selectedObjects",[]);x(this,"ondbclick",t=>{this.zoomToSelection()});x(this,"_orginalMaterialStatus",{});x(this,"_selectedMaterial");x(this,"_isolated",!1);x(this,"screenWidth");x(this,"screenHeight");x(this,"edgeMaterial",new lA({color:0,linewidth:1,visible:!0,transparent:!0,opacity:.2,depthWrite:!1}));x(this,"materialStore",{});x(this,"__changing");x(this,"keepChanging",!1);x(this,"renderInfo");x(this,"_renderRequest",!1);x(this,"_cameraWorldPos",new H);x(this,"_camToTestPointDir",new H);x(this,"_visibleCheckIntersects",[]);x(this,"_pointVisibleCheckEPS",.1);x(this,"maxZoom",8);x(this,"minZoom",.1);x(this,"objectVisibilityChangedEvent",new Ot);x(this,"_toScreenVectorCache",new H);if(this.stats={drawcall:0,triangles:0,materials:0,lines:0,points:0,mesh:0,modelTriangles:0},this.logEvent=new Ot,this.modelClickedEvent=new Ot,this.selectionChangedEvent=new Ot,this.beforeSelectionChangeEvent=new Ot,this.cameraChangedEvent=new Ot,this.cameraParamsChangedEvent=new Ot,this.beforeModelsAddEvent=new Ot,this.afterModelsAddEvent=new Ot,this.beforeRayCastEvent=new Ot,this.afterRayCastEvent=new Ot,this.beforeRenderEvent=new Ot,this.afterRenderEvent=new Ot,this.resizeEvent=new Ot,this.beginAnimateEvent=new Ot,this.onAnimateEvent=new Ot,this.endAnimateEvent=new Ot,this.materialStoreChangedEvent=new Ot,this.changeStartEvent=new Ot,this.changedEvent=new Ot,this.changeEndEvent=new Ot,this.option=e,this.selectedObjects=[],typeof t=="string"?this.container=document.getElementById(t):this.container=t,this.container==null){console.error(`invalid domId "${t}"`);return}if(su.isWebGL2Available()===!1){this.container.appendChild(su.getWebGL2ErrorMessage()),document.body.appendChild(su.getWebGL2ErrorMessage());return}this.init()}clear(){this.rootGroup.clear(),this.materialStore={},this.updateStats()}log(...t){this.logEvent.dispatch(t)}init(){var v;this.initSize(),this.outlineMat=new Ow(60,!0,"black"),this.raycaster.near=0,this.raycaster.far=1e3;let t=this.screenWidth,e=this.screenHeight;const i=400;let r=t/e,a=this.option.camera.pcamera;this.perspectiveCamera=new ui(a.fov,r,a.near,a.far);let f=this.option.camera.ocamera;this.orthographicCamera=new AA(i*r/-2,i*r/2,i/2,i/-2,f.near,f.far),this.perspectiveCamera.zoom=a.zoom,this.orthographicCamera.zoom=f.zoom,this.perspectiveCamera.updateProjectionMatrix(),this.orthographicCamera.updateProjectionMatrix();let o=new KU;this.option.backgroundColor!="transparent"?o.background=new Rt(this.option.backgroundColor):o.background=null,this.scene=o,this.rootGroup=new _i,o.add(this.rootGroup);const s=new xL(16777215,.372);o.add(s),this.ambientLight=s;const l=new wo(16777215,.774);l.position.set(1,1,1),o.add(l),this.light1=l;const u=new wo(16777215,.867);u.position.set(-1,-1,-1),o.add(u),this.light2=u;const A=new wo(16777215,.45);A.position.set(-1,-1,1),o.add(A),this.light3=A;const c=new wo(16777215,.675);c.position.set(-1,1,1),o.add(c),this.light4=c,this.container;let h=this.option.backgroundColor=="transparent",p=new vw({antialias:this.option.antialias,alpha:h,preserveDrawingBuffer:!0});p.info.autoReset=!1,h&&p.setClearAlpha(0),p.setSize(t,e),p.setPixelRatio(window.devicePixelRatio);const m=new SI(this);this.controls=m,this.controls.lookAtDir("iso"),this.renderer=p,this.renderInfo=this.renderer.info.render,this.container.appendChild(p.domElement);const d=p.getDrawingBufferSize(new xt);this.renderTarget=new xr(d.width,d.height,{samples:128,stencilBuffer:!0}),this.viewHelper=new BI(this.controls,this.container),(v=this.updateViewHelperLocation)==null||v.call(this),this.viewHelper.changeViewDirectionEvent.add(w=>{this.controls.lookAtDir(w.dir)}),this.camera=this.option.camera.type==oa.perspective?this.perspectiveCamera:this.orthographicCamera,this.container.addEventListener("pointerup",this.onPointerUp),this.container.addEventListener("pointerdown",this.onPointerDown),this.container.addEventListener("dblclick",this.ondbclick),new ResizeObserver(this.handleResize.bind(this)).observe(this.container),this.selectedMaterial=new rc({color:12844800,flatShading:!1}),m.changeStartEvent.add(()=>{this._startChange()}),m.changeEndEvent.add(()=>{this._endChange()}),this.option.startAnimation&&this.startAnimation()}get enabled(){return this._enabled}set enabled(t){t!=this._enabled&&(this.controls.enabled=t,this.viewHelper.enabled=t,t?(this.container.addEventListener("pointerup",this.onPointerUp),this.container.addEventListener("pointerdown",this.onPointerDown),this.container.addEventListener("dblclick",this.ondbclick)):(this.container.removeEventListener("pointerup",this.onPointerUp),this.container.removeEventListener("pointerdown",this.onPointerDown),this.container.removeEventListener("dblclick",this.ondbclick)),this._enabled=t,this.enabledStatusChanged.dispatch(t))}handleResize(){var s;this.initSize();let t=this,e=this.screenWidth,i=this.screenHeight,r=e/i;this.perspectiveCamera.aspect=r,this.perspectiveCamera.updateProjectionMatrix();let a=this.orthographicCamera;var f=2*a.top/i;a.left=-.5*f*e,a.right=.5*f*e,a.top=.5*f*i,a.bottom=-.5*f*i,this.orthographicCamera.updateProjectionMatrix(),this.renderer.setSize(e,i),t.controls.updateScreenSize();const o=this.renderer.getPixelRatio();this.renderTarget.setSize(e*o,i*o),(s=this.updateViewHelperLocation)==null||s.call(this),this.resizeEvent.dispatch({w:e,h:i}),this.render()}_endChange(){this.log("end change."),this.render()}_startChange(){this.log("start change")}get selectedObjects(){return this._selectedObjects}set selectedObjects(t){this.beforeSelectionChangeEvent.dispatch({models:t}),this._selectedObjects=t,this.selectionChangedEvent.dispatch({models:t,sender:this})}unhighlightObjects(t){if(!t)return;let e=this._orginalMaterialStatus,i=this;function r(a){if(a.isMesh){let f=e[a.id];f?a.material=f:i.warn("old mat n/a");return}if(a.children)for(let f of a.children)r(f)}for(let a of t)r(a)}warn(...t){console.warn(...t)}get selectedMaterial(){return this._selectedMaterial}set selectedMaterial(t){this._selectedMaterial=t}unhighlightAll(){for(let i of Object.keys(this._orginalMaterialStatus)){var t=this.rootGroup.getObjectById(i);if(t){var e=this._orginalMaterialStatus[i];e&&(t.material=e)}}this._orginalMaterialStatus={}}highlightObjects(t){let e=this.selectedMaterial;this._orginalMaterialStatus={};let i=this._orginalMaterialStatus;function r(a){if(a.isMesh){let f=a.material;i[a.id]=f,a.material=e;return}if(a.children)for(let f of a.children)r(f)}for(let a of t)r(a)}selectModels(...t){this.unhighlightObjects(this.selectedObjects),this.allowSelect?t?(this.selectedObjects=t,this.highlightObjects(t),console.log(this.selectedObjects)):this.selectedObjects=[]:this.selectedObjects=[],this.render()}get isolated(){return this._isolated}set isolated(t){t?this.isolate():this.cancelIsolation(),this.render()}isolate(){this.edgeMaterial.transparent=!0,this.edgeMaterial.opacity=.05,this.edgeMaterial.needsUpdate=!0;for(let t of Object.values(this.materialStore)){let e=t.currentMaterial;e.transparent=!0,e.opacity=.05,e.needsUpdate=!0,e.depthWrite=!1,e.side=Ui}this._isolated=!0}cancelIsolation(){for(let t of Object.values(this.materialStore)){let e=t.currentMaterial;e.transparent=!1,e.opacity=1,e.depthWrite=!0,e.side=null,e.needsUpdate=!0}this.edgeMaterial.transparent=!0,this.edgeMaterial.opacity=.2,this.edgeMaterial.needsUpdate=!0,this._isolated=!1}initSize(){this.screenWidth=this.container.offsetWidth,this.screenHeight=this.container.offsetHeight}get camera(){return this._camera}get target(){if(this.controls)return this.controls.target}set camera(t){this._camera=t,this.cameraChangedEvent.dispatch({camera:t,sender:this})}addTestMesh(){const t=new qe(0,10,30,4,1),e=new rc({color:16777215,flatShading:!0});for(let i=0;i<10;i++){const r=new yt(t,e);r.position.x=(Math.random()-.5)*100,r.position.y=(Math.random()-.5)*100,r.position.z=(Math.random()-.5)*100,r.updateMatrix(),r.matrixAutoUpdate=!1,this.addModeltoObject(r,this.rootGroup)}this.zoomToFit()}addEdgeForMesh(t,e){if((!t||!t.isMesh)&&console.warn("unable to add edge, input is not mesh"),this.useConditionalEdge){t.parent;let a=new FI(t,this.outlineMat);t.add(a);return}const i=new iL(t.geometry,this.option.edgeAngleThresholdDegree),r=new Oc(i,this.edgeMaterial);t.add(r)}registerMaterial(t){if(t&&t.isMaterial){let e=this.materialStore[t.uuid];if(e)return e;e=new QI,e.currentMaterial=t,e.originalMaterial=t.clone();let i=new pI;return i.materials=[t],this.materialStoreChangedEvent.dispatch(i),this.materialStore[t.uuid]=e,e}}addModels(...t){console.log("addModels call 1"),this.beforeModelsAddEvent.dispatch({models:t,sender:this});for(let e of t)this.addModeltoObject(e,this.rootGroup);return this.updateStats(),this.render(),this.afterModelsAddEvent.dispatch({models:t,sender:this}),t}updateStats(){let t=0,e=0;this.rootGroup.traverse(i=>{i.isMesh&&(e+=i.geometry.index.count,t++)}),this.stats.materials=Object.keys(this.materialStore).length,this.stats.mesh=t,this.stats.modelTriangles=e}addModeltoObject(t,e){let i=t;i.traverse(r=>{if(r.isMesh){this.overrideMaterial&&(r.material=this._getOverrideMaterial(r));let a=this.registerMaterial(r.material);this.option.showEdge&&this.addEdgeForMesh(r,a)}}),e.add(i)}get fov(){return this.perspectiveCamera.fov}_getOverrideMaterial(t){return Iw}get changing(){return this.__changing}set changing(t){t!=this.__changing&&(this.__changing=t,t?(console.log("tv change start"),this.changeStartEvent.dispatch()):(console.log("tv change end"),this.changeEndEvent.dispatch()))}_updateChanging(){this.changing=this.controls.needsUpdate||this.keepChanging||this._renderRequest,this._renderRequest=!1,this.changing&&this.changedEvent.dispatch()}startAnimation(){var t;(t=this.renderer)==null||t.setAnimationLoop(this.animate.bind(this))}stopAnimation(){var t;(t=this.renderer)==null||t.setAnimationLoop(null)}animate(){var t,e;this.beginAnimateEvent.dispatch(),(t=this.controls)==null||t.update(),this.onAnimateEvent.dispatch(),this._updateChanging(),this.changing&&((e=this.viewHelper)==null||e.update(),this.render()),this.endAnimateEvent.dispatch()}toggleCameraType(){CI(this,100)}_recordStats(){this.stats.triangles=this.renderInfo.triangles,this.stats.drawcall=this.renderInfo.calls,this.stats.lines=this.renderInfo.lines,this.stats.points=this.renderInfo.points}_render(){this.renderer.render(this.scene,this._camera)}requestRender(){this._renderRequest=!0}render(){this.beforeRenderEvent.dispatch(),this.renderInternal(),this.afterRenderEvent.dispatch()}renderInternal(){this.renderer.info.reset(),this.renderFunc(),this._recordStats(),this.renderer.autoClear=!1,this.viewHelper.render(this.renderer),this.renderer.autoClear=!0}zoomToSelection(){this.selectedObjects&&this.selectedObjects.length>0?(this.controls.zoomToFit(...this.selectedObjects),this.render()):this.zoomToFit()}zoomToFit(){console.log("zoom to fit 1"),this.controls.zoomToFit(this.rootGroup),this.render()}get pointVisibleCheckEPS(){return this._pointVisibleCheckEPS}set pointVisibleCheckEPS(t){if(t<=0){console.warn("invalid pointVisibleCheckEPS, value must greater than zero");return}this._pointVisibleCheckEPS=t}isPointVisible(t,e){if(e==null&&(e=this.pointVisibleCheckEPS),this._visibleCheckIntersects.length=0,this.camera.getWorldPosition(this._cameraWorldPos),this._camToTestPointDir.subVectors(t,this._cameraWorldPos),this.raycaster.set(this._cameraWorldPos,this._camToTestPointDir),this.raycaster.intersectObject(this.rootGroup,!0,this._visibleCheckIntersects),this._visibleCheckIntersects&&this._visibleCheckIntersects.length>0){console.log("774 visbile intersect got");for(let i of this._visibleCheckIntersects)if(i.object.visible){console.log("774 intersect object is visible");let r=t.distanceTo(this._cameraWorldPos),a=i.distance,f=Math.abs(r-a);return console.log("774 diff",f,"eps",e),f<e?(console.log("774 TRUE",f),!0):(console.log("774 False !!!!!!!",f),!1)}}return console.log("774, no intersection"),!0}get zoom(){return this.perspectiveCamera.zoom}set zoom(t){t>this.maxZoom?(t=this.maxZoom,console.log("max zoomed.")):t<this.minZoom&&(t=this.minZoom,console.log("min zoomed.")),this.perspectiveCamera.zoom=t,this.perspectiveCamera.updateProjectionMatrix(),this.orthographicCamera.zoom=t,this.orthographicCamera.updateProjectionMatrix(),this.render()}getObjectByUUID(t){return this.rootGroup.getObjectByProperty("uuid",t)}ensureObjectVisible(t,e,i=!1){if(!t)return;function r(f){f&&f.parent&&(f.visible=!0,f.parent&&r(f.parent))}function a(f,o){if(f.children&&f.children.length>0)for(let s of f.children)s.visible=o,a(s,o)}e?(t.visible=e,r(t),a(t,e)):(t.visible=e,a(t,e)),i&&this.objectVisibilityChangedEvent.dispatch(t)}zoomIn(){this.zoom*=.9}zoomOut(){this.zoom*=1.1}toScreenVector(t,e){let i=this._toScreenVectorCache;return i.copy(t),i.project(this.camera),e.x=(i.x+1)/2*this.screenWidth,e.y=-(i.y-1)/2*this.screenHeight,e}}class _d{constructor(){x(this,"antialias",!0);x(this,"startAnimation",!0);x(this,"selectionStyle",lf.outline);x(this,"backgroundColor","transparent");x(this,"edgeAngleThresholdDegree",40);x(this,"camera",new oa);x(this,"passOption",new II);x(this,"showEdge",!0);x(this,"showToolbar",!0);x(this,"useGUI",!0);x(this,"showGUI",!1);x(this,"useStats")}}const jd=class{constructor(){x(this,"type",jd.orthographic);x(this,"ocamera",new PI);x(this,"pcamera",new OI)}};let oa=jd;x(oa,"perspective","perspective"),x(oa,"orthographic","orthographic");class II{constructor(){x(this,"render",!0);x(this,"ssao",!1);x(this,"sao",new DI);x(this,"outline",!1);x(this,"fxaa",!0);x(this,"smaa",!1);x(this,"ssaa",!1);x(this,"taa",!1);x(this,"copy",!0)}}class DI{constructor(){x(this,"enabled",!0);x(this,"scale",1)}}class PI{constructor(){x(this,"near",.5);x(this,"far",1e3);x(this,"zoom",2)}}class OI{constructor(){x(this,"_fov",45);x(this,"near",.5);x(this,"far",1e3);x(this,"zoom",2)}get fov(){return this._fov}set fov(t){t>120&&(t=120),t<10&&(t=10),this._fov=t}}class lf{}x(lf,"outline","outline"),x(lf,"material","material");class QI{constructor(){x(this,"currentMaterial");x(this,"originalMaterial");x(this,"edgeMaterial");x(this,"edgeColor")}}const cf={},Qw=[];function Wt(n,t){if(Array.isArray(n)){for(const e of n)Wt(e,t);return}if(typeof n=="object"){for(const e in n)Wt(e,n[e]);return}Rw(Object.getOwnPropertyNames(t)),cf[n]=Object.assign(cf[n]||{},t)}function xi(n){return cf[n]||{}}function RI(){return[...new Set(Qw)]}function Rw(n){Qw.push(...n)}function yd(n,t){let e;const i=n.length,r=[];for(e=0;e<i;e++)r.push(t(n[e]));return r}function HI(n,t){let e;const i=n.length,r=[];for(e=0;e<i;e++)t(n[e])&&r.push(n[e]);return r}function au(n){return n%360*Math.PI/180}function ll(n){return n.toLowerCase().replace(/-(.)/g,function(t,e){return e.toUpperCase()})}function kI(n){return n.replace(/([A-Z])/g,function(t,e){return"-"+e.toLowerCase()})}function Hw(n){return n.charAt(0).toUpperCase()+n.slice(1)}function za(n,t,e,i){return(t==null||e==null)&&(i=i||n.bbox(),t==null?t=i.width/i.height*e:e==null&&(e=i.height/i.width*t)),{width:t,height:e}}function hf(n,t){const e=n.origin;let i=n.ox!=null?n.ox:n.originX!=null?n.originX:"center",r=n.oy!=null?n.oy:n.originY!=null?n.originY:"center";e!=null&&([i,r]=Array.isArray(e)?e:typeof e=="object"?[e.x,e.y]:[e,e]);const a=typeof i=="string",f=typeof r=="string";if(a||f){const{height:o,width:s,x:l,y:u}=t.bbox();a&&(i=i.includes("left")?l:i.includes("right")?l+s:l+s/2),f&&(r=r.includes("top")?u:r.includes("bottom")?u+o:u+o/2)}return[i,r]}const xd="http://www.w3.org/2000/svg",NI="http://www.w3.org/1999/xhtml",cl="http://www.w3.org/2000/xmlns/",fA="http://www.w3.org/1999/xlink",VI="http://svgjs.dev/svgjs",se={window:typeof window>"u"?null:window,document:typeof document>"u"?null:document};class Cd{}const es={},bd="___SYMBOL___ROOT___";function qo(n,t=xd){return se.document.createElementNS(t,n)}function fi(n,t=!1){if(n instanceof Cd)return n;if(typeof n=="object")return ou(n);if(n==null)return new es[bd];if(typeof n=="string"&&n.charAt(0)!=="<")return ou(se.document.querySelector(n));const e=t?se.document.createElement("div"):qo("svg");return e.innerHTML=n,n=ou(e.firstChild),e.removeChild(e.firstChild),n}function Ce(n,t){return t&&t.ownerDocument&&t instanceof t.ownerDocument.defaultView.Node?t:qo(n)}function zi(n){if(!n)return null;if(n.instance instanceof Cd)return n.instance;if(n.nodeName==="#document-fragment")return new es.Fragment(n);let t=Hw(n.nodeName||"Dom");return t==="LinearGradient"||t==="RadialGradient"?t="Gradient":es[t]||(t="Dom"),new es[t](n)}let ou=zi;function re(n,t=n.name,e=!1){return es[t]=n,e&&(es[bd]=n),Rw(Object.getOwnPropertyNames(n.prototype)),n}function zI(n){return es[n]}let GI=1e3;function kw(n){return"Svgjs"+Hw(n)+GI++}function Nw(n){for(let t=n.children.length-1;t>=0;t--)Nw(n.children[t]);return n.id&&(n.id=kw(n.nodeName)),n}function $t(n,t){let e,i;for(n=Array.isArray(n)?n:[n],i=n.length-1;i>=0;i--)for(e in t)n[i].prototype[e]=t[e]}function xe(n){return function(...t){const e=t[t.length-1];return e&&e.constructor===Object&&!(e instanceof Array)?n.apply(this,t.slice(0,-1)).attr(e):n.apply(this,t)}}function WI(){return this.parent().children()}function KI(){return this.parent().index(this)}function XI(){return this.siblings()[this.position()+1]}function jI(){return this.siblings()[this.position()-1]}function YI(){const n=this.position();return this.parent().add(this.remove(),n+1),this}function qI(){const n=this.position();return this.parent().add(this.remove(),n?n-1:0),this}function $I(){return this.parent().add(this.remove()),this}function JI(){return this.parent().add(this.remove(),0),this}function ZI(n){n=fi(n),n.remove();const t=this.position();return this.parent().add(n,t),this}function tD(n){n=fi(n),n.remove();const t=this.position();return this.parent().add(n,t+1),this}function eD(n){return n=fi(n),n.before(this),this}function iD(n){return n=fi(n),n.after(this),this}Wt("Dom",{siblings:WI,position:KI,next:XI,prev:jI,forward:YI,backward:qI,front:$I,back:JI,before:ZI,after:tD,insertBefore:eD,insertAfter:iD});const Vw=/^([+-]?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?)([a-z%]*)$/i,nD=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,rD=/rgb\((\d+),(\d+),(\d+)\)/,sD=/(#[a-z_][a-z0-9\-_]*)/i,aD=/\)\s*,?\s*/,oD=/\s/g,Sm=/^#[a-f0-9]{3}$|^#[a-f0-9]{6}$/i,Em=/^rgb\(/,Mm=/^(\s+)?$/,Tm=/^[+-]?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,AD=/\.(jpg|jpeg|png|gif|svg)(\?[^=]+.*)?/i,Yn=/[\s,]+/,Bd=/[MLHVCSQTAZ]/i;function lD(){const n=this.attr("class");return n==null?[]:n.trim().split(Yn)}function cD(n){return this.classes().indexOf(n)!==-1}function hD(n){if(!this.hasClass(n)){const t=this.classes();t.push(n),this.attr("class",t.join(" "))}return this}function uD(n){return this.hasClass(n)&&this.attr("class",this.classes().filter(function(t){return t!==n}).join(" ")),this}function fD(n){return this.hasClass(n)?this.removeClass(n):this.addClass(n)}Wt("Dom",{classes:lD,hasClass:cD,addClass:hD,removeClass:uD,toggleClass:fD});function dD(n,t){const e={};if(arguments.length===0)return this.node.style.cssText.split(/\s*;\s*/).filter(function(i){return!!i.length}).forEach(function(i){const r=i.split(/\s*:\s*/);e[r[0]]=r[1]}),e;if(arguments.length<2){if(Array.isArray(n)){for(const i of n){const r=ll(i);e[i]=this.node.style[r]}return e}if(typeof n=="string")return this.node.style[ll(n)];if(typeof n=="object")for(const i in n)this.node.style[ll(i)]=n[i]==null||Mm.test(n[i])?"":n[i]}return arguments.length===2&&(this.node.style[ll(n)]=t==null||Mm.test(t)?"":t),this}function pD(){return this.css("display","")}function gD(){return this.css("display","none")}function mD(){return this.css("display")!=="none"}Wt("Dom",{css:dD,show:pD,hide:gD,visible:mD});function vD(n,t,e){if(n==null)return this.data(yd(HI(this.node.attributes,i=>i.nodeName.indexOf("data-")===0),i=>i.nodeName.slice(5)));if(n instanceof Array){const i={};for(const r of n)i[r]=this.data(r);return i}else if(typeof n=="object")for(t in n)this.data(t,n[t]);else if(arguments.length<2)try{return JSON.parse(this.attr("data-"+n))}catch{return this.attr("data-"+n)}else this.attr("data-"+n,t===null?null:e===!0||typeof t=="string"||typeof t=="number"?t:JSON.stringify(t));return this}Wt("Dom",{data:vD});function wD(n,t){if(typeof arguments[0]=="object")for(const e in n)this.remember(e,n[e]);else{if(arguments.length===1)return this.memory()[n];this.memory()[n]=t}return this}function _D(){if(arguments.length===0)this._memory={};else for(let n=arguments.length-1;n>=0;n--)delete this.memory()[arguments[n]];return this}function yD(){return this._memory=this._memory||{}}Wt("Dom",{remember:wD,forget:_D,memory:yD});function xD(n){return n.length===4?["#",n.substring(1,2),n.substring(1,2),n.substring(2,3),n.substring(2,3),n.substring(3,4),n.substring(3,4)].join(""):n}function CD(n){const t=Math.round(n),i=Math.max(0,Math.min(255,t)).toString(16);return i.length===1?"0"+i:i}function Vs(n,t){for(let e=t.length;e--;)if(n[t[e]]==null)return!1;return!0}function bD(n,t){const e=Vs(n,"rgb")?{_a:n.r,_b:n.g,_c:n.b,_d:0,space:"rgb"}:Vs(n,"xyz")?{_a:n.x,_b:n.y,_c:n.z,_d:0,space:"xyz"}:Vs(n,"hsl")?{_a:n.h,_b:n.s,_c:n.l,_d:0,space:"hsl"}:Vs(n,"lab")?{_a:n.l,_b:n.a,_c:n.b,_d:0,space:"lab"}:Vs(n,"lch")?{_a:n.l,_b:n.c,_c:n.h,_d:0,space:"lch"}:Vs(n,"cmyk")?{_a:n.c,_b:n.m,_c:n.y,_d:n.k,space:"cmyk"}:{_a:0,_b:0,_c:0,space:"rgb"};return e.space=t||e.space,e}function BD(n){return n==="lab"||n==="xyz"||n==="lch"}function Au(n,t,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?n+(t-n)*6*e:e<1/2?t:e<2/3?n+(t-n)*(2/3-e)*6:n}class he{constructor(...t){this.init(...t)}static isColor(t){return t&&(t instanceof he||this.isRgb(t)||this.test(t))}static isRgb(t){return t&&typeof t.r=="number"&&typeof t.g=="number"&&typeof t.b=="number"}static random(t="vibrant",e,i){const{random:r,round:a,sin:f,PI:o}=Math;if(t==="vibrant"){const s=24*r()+57,l=(83-45)*r()+45,u=360*r();return new he(s,l,u,"lch")}else if(t==="sine"){e=e??r();const s=a(80*f(2*o*e/.5+.01)+150),l=a(50*f(2*o*e/.5+4.6)+200),u=a(100*f(2*o*e/.5+2.3)+150);return new he(s,l,u)}else if(t==="pastel"){const s=8*r()+86,l=(26-9)*r()+9,u=360*r();return new he(s,l,u,"lch")}else if(t==="dark"){const s=10+10*r(),l=(125-75)*r()+86,u=360*r();return new he(s,l,u,"lch")}else if(t==="rgb"){const s=255*r(),l=255*r(),u=255*r();return new he(s,l,u)}else if(t==="lab"){const s=100*r(),l=256*r()-128,u=256*r()-128;return new he(s,l,u,"lab")}else if(t==="grey"){const s=255*r();return new he(s,s,s)}else throw new Error("Unsupported random color mode")}static test(t){return typeof t=="string"&&(Sm.test(t)||Em.test(t))}cmyk(){const{_a:t,_b:e,_c:i}=this.rgb(),[r,a,f]=[t,e,i].map(c=>c/255),o=Math.min(1-r,1-a,1-f);if(o===1)return new he(0,0,0,1,"cmyk");const s=(1-r-o)/(1-o),l=(1-a-o)/(1-o),u=(1-f-o)/(1-o);return new he(s,l,u,o,"cmyk")}hsl(){const{_a:t,_b:e,_c:i}=this.rgb(),[r,a,f]=[t,e,i].map(m=>m/255),o=Math.max(r,a,f),s=Math.min(r,a,f),l=(o+s)/2,u=o===s,A=o-s,c=u?0:l>.5?A/(2-o-s):A/(o+s),h=u?0:o===r?((a-f)/A+(a<f?6:0))/6:o===a?((f-r)/A+2)/6:o===f?((r-a)/A+4)/6:0;return new he(360*h,100*c,100*l,"hsl")}init(t=0,e=0,i=0,r=0,a="rgb"){if(t=t||0,this.space)for(const A in this.space)delete this[this.space[A]];if(typeof t=="number")a=typeof r=="string"?r:a,r=typeof r=="string"?0:r,Object.assign(this,{_a:t,_b:e,_c:i,_d:r,space:a});else if(t instanceof Array)this.space=e||(typeof t[3]=="string"?t[3]:t[4])||"rgb",Object.assign(this,{_a:t[0],_b:t[1],_c:t[2],_d:t[3]||0});else if(t instanceof Object){const A=bD(t,e);Object.assign(this,A)}else if(typeof t=="string")if(Em.test(t)){const A=t.replace(oD,""),[c,h,p]=rD.exec(A).slice(1,4).map(m=>parseInt(m));Object.assign(this,{_a:c,_b:h,_c:p,_d:0,space:"rgb"})}else if(Sm.test(t)){const A=m=>parseInt(m,16),[,c,h,p]=nD.exec(xD(t)).map(A);Object.assign(this,{_a:c,_b:h,_c:p,_d:0,space:"rgb"})}else throw Error("Unsupported string format, can't construct Color");const{_a:f,_b:o,_c:s,_d:l}=this,u=this.space==="rgb"?{r:f,g:o,b:s}:this.space==="xyz"?{x:f,y:o,z:s}:this.space==="hsl"?{h:f,s:o,l:s}:this.space==="lab"?{l:f,a:o,b:s}:this.space==="lch"?{l:f,c:o,h:s}:this.space==="cmyk"?{c:f,m:o,y:s,k:l}:{};Object.assign(this,u)}lab(){const{x:t,y:e,z:i}=this.xyz(),r=116*e-16,a=500*(t-e),f=200*(e-i);return new he(r,a,f,"lab")}lch(){const{l:t,a:e,b:i}=this.lab(),r=Math.sqrt(e**2+i**2);let a=180*Math.atan2(i,e)/Math.PI;return a<0&&(a*=-1,a=360-a),new he(t,r,a,"lch")}rgb(){if(this.space==="rgb")return this;if(BD(this.space)){let{x:t,y:e,z:i}=this;if(this.space==="lab"||this.space==="lch"){let{l:h,a:p,b:m}=this;if(this.space==="lch"){const{c:C,h:b}=this,S=Math.PI/180;p=C*Math.cos(S*b),m=C*Math.sin(S*b)}const d=(h+16)/116,g=p/500+d,v=d-m/200,w=16/116,_=.008856,y=7.787;t=.95047*(g**3>_?g**3:(g-w)/y),e=1*(d**3>_?d**3:(d-w)/y),i=1.08883*(v**3>_?v**3:(v-w)/y)}const r=t*3.2406+e*-1.5372+i*-.4986,a=t*-.9689+e*1.8758+i*.0415,f=t*.0557+e*-.204+i*1.057,o=Math.pow,s=.0031308,l=r>s?1.055*o(r,1/2.4)-.055:12.92*r,u=a>s?1.055*o(a,1/2.4)-.055:12.92*a,A=f>s?1.055*o(f,1/2.4)-.055:12.92*f;return new he(255*l,255*u,255*A)}else if(this.space==="hsl"){let{h:t,s:e,l:i}=this;if(t/=360,e/=100,i/=100,e===0)return i*=255,new he(i,i,i);const r=i<.5?i*(1+e):i+e-i*e,a=2*i-r,f=255*Au(a,r,t+1/3),o=255*Au(a,r,t),s=255*Au(a,r,t-1/3);return new he(f,o,s)}else if(this.space==="cmyk"){const{c:t,m:e,y:i,k:r}=this,a=255*(1-Math.min(1,t*(1-r)+r)),f=255*(1-Math.min(1,e*(1-r)+r)),o=255*(1-Math.min(1,i*(1-r)+r));return new he(a,f,o)}else return this}toArray(){const{_a:t,_b:e,_c:i,_d:r,space:a}=this;return[t,e,i,r,a]}toHex(){const[t,e,i]=this._clamped().map(CD);return`#${t}${e}${i}`}toRgb(){const[t,e,i]=this._clamped();return`rgb(${t},${e},${i})`}toString(){return this.toHex()}xyz(){const{_a:t,_b:e,_c:i}=this.rgb(),[r,a,f]=[t,e,i].map(g=>g/255),o=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92,s=a>.04045?Math.pow((a+.055)/1.055,2.4):a/12.92,l=f>.04045?Math.pow((f+.055)/1.055,2.4):f/12.92,u=(o*.4124+s*.3576+l*.1805)/.95047,A=(o*.2126+s*.7152+l*.0722)/1,c=(o*.0193+s*.1192+l*.9505)/1.08883,h=u>.008856?Math.pow(u,1/3):7.787*u+16/116,p=A>.008856?Math.pow(A,1/3):7.787*A+16/116,m=c>.008856?Math.pow(c,1/3):7.787*c+16/116;return new he(h,p,m,"xyz")}_clamped(){const{_a:t,_b:e,_c:i}=this.rgb(),{max:r,min:a,round:f}=Math,o=s=>r(0,a(f(s),255));return[t,e,i].map(o)}}class Pe{constructor(...t){this.init(...t)}clone(){return new Pe(this)}init(t,e){const i={x:0,y:0},r=Array.isArray(t)?{x:t[0],y:t[1]}:typeof t=="object"?{x:t.x,y:t.y}:{x:t,y:e};return this.x=r.x==null?i.x:r.x,this.y=r.y==null?i.y:r.y,this}toArray(){return[this.x,this.y]}transform(t){return this.clone().transformO(t)}transformO(t){kt.isMatrixLike(t)||(t=new kt(t));const{x:e,y:i}=this;return this.x=t.a*e+t.c*i+t.e,this.y=t.b*e+t.d*i+t.f,this}}function SD(n,t){return new Pe(n,t).transform(this.screenCTM().inverse())}function zs(n,t,e){return Math.abs(t-n)<(e||1e-6)}class kt{constructor(...t){this.init(...t)}static formatTransforms(t){const e=t.flip==="both"||t.flip===!0,i=t.flip&&(e||t.flip==="x")?-1:1,r=t.flip&&(e||t.flip==="y")?-1:1,a=t.skew&&t.skew.length?t.skew[0]:isFinite(t.skew)?t.skew:isFinite(t.skewX)?t.skewX:0,f=t.skew&&t.skew.length?t.skew[1]:isFinite(t.skew)?t.skew:isFinite(t.skewY)?t.skewY:0,o=t.scale&&t.scale.length?t.scale[0]*i:isFinite(t.scale)?t.scale*i:isFinite(t.scaleX)?t.scaleX*i:i,s=t.scale&&t.scale.length?t.scale[1]*r:isFinite(t.scale)?t.scale*r:isFinite(t.scaleY)?t.scaleY*r:r,l=t.shear||0,u=t.rotate||t.theta||0,A=new Pe(t.origin||t.around||t.ox||t.originX,t.oy||t.originY),c=A.x,h=A.y,p=new Pe(t.position||t.px||t.positionX||NaN,t.py||t.positionY||NaN),m=p.x,d=p.y,g=new Pe(t.translate||t.tx||t.translateX,t.ty||t.translateY),v=g.x,w=g.y,_=new Pe(t.relative||t.rx||t.relativeX,t.ry||t.relativeY),y=_.x,C=_.y;return{scaleX:o,scaleY:s,skewX:a,skewY:f,shear:l,theta:u,rx:y,ry:C,tx:v,ty:w,ox:c,oy:h,px:m,py:d}}static fromArray(t){return{a:t[0],b:t[1],c:t[2],d:t[3],e:t[4],f:t[5]}}static isMatrixLike(t){return t.a!=null||t.b!=null||t.c!=null||t.d!=null||t.e!=null||t.f!=null}static matrixMultiply(t,e,i){const r=t.a*e.a+t.c*e.b,a=t.b*e.a+t.d*e.b,f=t.a*e.c+t.c*e.d,o=t.b*e.c+t.d*e.d,s=t.e+t.a*e.e+t.c*e.f,l=t.f+t.b*e.e+t.d*e.f;return i.a=r,i.b=a,i.c=f,i.d=o,i.e=s,i.f=l,i}around(t,e,i){return this.clone().aroundO(t,e,i)}aroundO(t,e,i){const r=t||0,a=e||0;return this.translateO(-r,-a).lmultiplyO(i).translateO(r,a)}clone(){return new kt(this)}decompose(t=0,e=0){const i=this.a,r=this.b,a=this.c,f=this.d,o=this.e,s=this.f,l=i*f-r*a,u=l>0?1:-1,A=u*Math.sqrt(i*i+r*r),c=Math.atan2(u*r,u*i),h=180/Math.PI*c,p=Math.cos(c),m=Math.sin(c),d=(i*a+r*f)/l,g=a*A/(d*i-r)||f*A/(d*r+i),v=o-t+t*p*A+e*(d*p*A-m*g),w=s-e+t*m*A+e*(d*m*A+p*g);return{scaleX:A,scaleY:g,shear:d,rotate:h,translateX:v,translateY:w,originX:t,originY:e,a:this.a,b:this.b,c:this.c,d:this.d,e:this.e,f:this.f}}equals(t){if(t===this)return!0;const e=new kt(t);return zs(this.a,e.a)&&zs(this.b,e.b)&&zs(this.c,e.c)&&zs(this.d,e.d)&&zs(this.e,e.e)&&zs(this.f,e.f)}flip(t,e){return this.clone().flipO(t,e)}flipO(t,e){return t==="x"?this.scaleO(-1,1,e,0):t==="y"?this.scaleO(1,-1,0,e):this.scaleO(-1,-1,t,e||t)}init(t){const e=kt.fromArray([1,0,0,1,0,0]);return t=t instanceof Bn?t.matrixify():typeof t=="string"?kt.fromArray(t.split(Yn).map(parseFloat)):Array.isArray(t)?kt.fromArray(t):typeof t=="object"&&kt.isMatrixLike(t)?t:typeof t=="object"?new kt().transform(t):arguments.length===6?kt.fromArray([].slice.call(arguments)):e,this.a=t.a!=null?t.a:e.a,this.b=t.b!=null?t.b:e.b,this.c=t.c!=null?t.c:e.c,this.d=t.d!=null?t.d:e.d,this.e=t.e!=null?t.e:e.e,this.f=t.f!=null?t.f:e.f,this}inverse(){return this.clone().inverseO()}inverseO(){const t=this.a,e=this.b,i=this.c,r=this.d,a=this.e,f=this.f,o=t*r-e*i;if(!o)throw new Error("Cannot invert "+this);const s=r/o,l=-e/o,u=-i/o,A=t/o,c=-(s*a+u*f),h=-(l*a+A*f);return this.a=s,this.b=l,this.c=u,this.d=A,this.e=c,this.f=h,this}lmultiply(t){return this.clone().lmultiplyO(t)}lmultiplyO(t){const e=this,i=t instanceof kt?t:new kt(t);return kt.matrixMultiply(i,e,this)}multiply(t){return this.clone().multiplyO(t)}multiplyO(t){const e=this,i=t instanceof kt?t:new kt(t);return kt.matrixMultiply(e,i,this)}rotate(t,e,i){return this.clone().rotateO(t,e,i)}rotateO(t,e=0,i=0){t=au(t);const r=Math.cos(t),a=Math.sin(t),{a:f,b:o,c:s,d:l,e:u,f:A}=this;return this.a=f*r-o*a,this.b=o*r+f*a,this.c=s*r-l*a,this.d=l*r+s*a,this.e=u*r-A*a+i*a-e*r+e,this.f=A*r+u*a-e*a-i*r+i,this}scale(t,e,i,r){return this.clone().scaleO(...arguments)}scaleO(t,e=t,i=0,r=0){arguments.length===3&&(r=i,i=e,e=t);const{a,b:f,c:o,d:s,e:l,f:u}=this;return this.a=a*t,this.b=f*e,this.c=o*t,this.d=s*e,this.e=l*t-i*t+i,this.f=u*e-r*e+r,this}shear(t,e,i){return this.clone().shearO(t,e,i)}shearO(t,e=0,i=0){const{a:r,b:a,c:f,d:o,e:s,f:l}=this;return this.a=r+a*t,this.c=f+o*t,this.e=s+l*t-i*t,this}skew(t,e,i,r){return this.clone().skewO(...arguments)}skewO(t,e=t,i=0,r=0){arguments.length===3&&(r=i,i=e,e=t),t=au(t),e=au(e);const a=Math.tan(t),f=Math.tan(e),{a:o,b:s,c:l,d:u,e:A,f:c}=this;return this.a=o+s*a,this.b=s+o*f,this.c=l+u*a,this.d=u+l*f,this.e=A+c*a-r*a,this.f=c+A*f-i*f,this}skewX(t,e,i){return this.skew(t,0,e,i)}skewY(t,e,i){return this.skew(0,t,e,i)}toArray(){return[this.a,this.b,this.c,this.d,this.e,this.f]}toString(){return"matrix("+this.a+","+this.b+","+this.c+","+this.d+","+this.e+","+this.f+")"}transform(t){if(kt.isMatrixLike(t))return new kt(t).multiplyO(this);const e=kt.formatTransforms(t),i=this,{x:r,y:a}=new Pe(e.ox,e.oy).transform(i),f=new kt().translateO(e.rx,e.ry).lmultiplyO(i).translateO(-r,-a).scaleO(e.scaleX,e.scaleY).skewO(e.skewX,e.skewY).shearO(e.shear).rotateO(e.theta).translateO(r,a);if(isFinite(e.px)||isFinite(e.py)){const o=new Pe(r,a).transform(f),s=isFinite(e.px)?e.px-o.x:0,l=isFinite(e.py)?e.py-o.y:0;f.translateO(s,l)}return f.translateO(e.tx,e.ty),f}translate(t,e){return this.clone().translateO(t,e)}translateO(t,e){return this.e+=t||0,this.f+=e||0,this}valueOf(){return{a:this.a,b:this.b,c:this.c,d:this.d,e:this.e,f:this.f}}}function ED(){return new kt(this.node.getCTM())}function MD(){if(typeof this.isRoot=="function"&&!this.isRoot()){const n=this.rect(1,1),t=n.node.getScreenCTM();return n.remove(),new kt(t)}return new kt(this.node.getScreenCTM())}re(kt,"Matrix");function hr(){if(!hr.nodes){const n=fi().size(2,0);n.node.style.cssText=["opacity: 0","position: absolute","left: -100%","top: -100%","overflow: hidden"].join(";"),n.attr("focusable","false"),n.attr("aria-hidden","true");const t=n.path().node;hr.nodes={svg:n,path:t}}if(!hr.nodes.svg.node.parentNode){const n=se.document.body||se.document.documentElement;hr.nodes.svg.addTo(n)}return hr.nodes}function zw(n){return!n.width&&!n.height&&!n.x&&!n.y}function TD(n){return n===se.document||(se.document.documentElement.contains||function(t){for(;t.parentNode;)t=t.parentNode;return t===se.document}).call(se.document.documentElement,n)}class ai{constructor(...t){this.init(...t)}addOffset(){return this.x+=se.window.pageXOffset,this.y+=se.window.pageYOffset,new ai(this)}init(t){const e=[0,0,0,0];return t=typeof t=="string"?t.split(Yn).map(parseFloat):Array.isArray(t)?t:typeof t=="object"?[t.left!=null?t.left:t.x,t.top!=null?t.top:t.y,t.width,t.height]:arguments.length===4?[].slice.call(arguments):e,this.x=t[0]||0,this.y=t[1]||0,this.width=this.w=t[2]||0,this.height=this.h=t[3]||0,this.x2=this.x+this.w,this.y2=this.y+this.h,this.cx=this.x+this.w/2,this.cy=this.y+this.h/2,this}isNulled(){return zw(this)}merge(t){const e=Math.min(this.x,t.x),i=Math.min(this.y,t.y),r=Math.max(this.x+this.width,t.x+t.width)-e,a=Math.max(this.y+this.height,t.y+t.height)-i;return new ai(e,i,r,a)}toArray(){return[this.x,this.y,this.width,this.height]}toString(){return this.x+" "+this.y+" "+this.width+" "+this.height}transform(t){t instanceof kt||(t=new kt(t));let e=1/0,i=-1/0,r=1/0,a=-1/0;return[new Pe(this.x,this.y),new Pe(this.x2,this.y),new Pe(this.x,this.y2),new Pe(this.x2,this.y2)].forEach(function(o){o=o.transform(t),e=Math.min(e,o.x),i=Math.max(i,o.x),r=Math.min(r,o.y),a=Math.max(a,o.y)}),new ai(e,r,i-e,a-r)}}function Gw(n,t,e){let i;try{if(i=t(n.node),zw(i)&&!TD(n.node))throw new Error("Element not in the dom")}catch{i=e(n)}return i}function FD(){const e=Gw(this,r=>r.getBBox(),r=>{try{const a=r.clone().addTo(hr().svg).show(),f=a.node.getBBox();return a.remove(),f}catch(a){throw new Error(`Getting bbox of element "${r.node.nodeName}" is not possible: ${a.toString()}`)}});return new ai(e)}function UD(n){const i=Gw(this,a=>a.getBoundingClientRect(),a=>{throw new Error(`Getting rbox of element "${a.node.nodeName}" is not possible`)}),r=new ai(i);return n?r.transform(n.screenCTM().inverseO()):r.addOffset()}function LD(n,t){const e=this.bbox();return n>e.x&&t>e.y&&n<e.x+e.width&&t<e.y+e.height}Wt({viewbox:{viewbox(n,t,e,i){return n==null?new ai(this.attr("viewBox")):this.attr("viewBox",new ai(n,t,e,i))},zoom(n,t){let{width:e,height:i}=this.attr(["width","height"]);if((!e&&!i||typeof e=="string"||typeof i=="string")&&(e=this.node.clientWidth,i=this.node.clientHeight),!e||!i)throw new Error("Impossible to get absolute width and height. Please provide an absolute width and height attribute on the zooming element");const r=this.viewbox(),a=e/r.width,f=i/r.height,o=Math.min(a,f);if(n==null)return o;let s=o/n;s===1/0&&(s=Number.MAX_SAFE_INTEGER/100),t=t||new Pe(e/2/a+r.x,i/2/f+r.y);const l=new ai(r).transform(new kt({scale:s,origin:t}));return this.viewbox(l)}}});re(ai,"Box");class us extends Array{constructor(t=[],...e){if(super(t,...e),typeof t=="number")return this;this.length=0,this.push(...t)}}$t([us],{each(n,...t){return typeof n=="function"?this.map((e,i,r)=>n.call(e,e,i,r)):this.map(e=>e[n](...t))},toArray(){return Array.prototype.concat.apply([],this)}});const ID=["toArray","constructor","each"];us.extend=function(n){n=n.reduce((t,e)=>(ID.includes(e)||e[0]==="_"||(t[e]=function(...i){return this.each(e,...i)}),t),{}),$t([us],n)};function Ga(n,t){return new us(yd((t||se.document).querySelectorAll(n),function(e){return zi(e)}))}function DD(n){return Ga(n,this.node)}function PD(n){return zi(this.node.querySelector(n))}let OD=0;const Ww={};function Kw(n){let t=n.getEventHolder();return t===se.window&&(t=Ww),t.events||(t.events={}),t.events}function Sd(n){return n.getEventTarget()}function QD(n){let t=n.getEventHolder();t===se.window&&(t=Ww),t.events&&(t.events={})}function uf(n,t,e,i,r){const a=e.bind(i||n),f=fi(n),o=Kw(f),s=Sd(f);t=Array.isArray(t)?t:t.split(Yn),e._svgjsListenerId||(e._svgjsListenerId=++OD),t.forEach(function(l){const u=l.split(".")[0],A=l.split(".")[1]||"*";o[u]=o[u]||{},o[u][A]=o[u][A]||{},o[u][A][e._svgjsListenerId]=a,s.addEventListener(u,a,r||!1)})}function Aa(n,t,e,i){const r=fi(n),a=Kw(r),f=Sd(r);typeof e=="function"&&(e=e._svgjsListenerId,!e)||(t=Array.isArray(t)?t:(t||"").split(Yn),t.forEach(function(o){const s=o&&o.split(".")[0],l=o&&o.split(".")[1];let u,A;if(e)a[s]&&a[s][l||"*"]&&(f.removeEventListener(s,a[s][l||"*"][e],i||!1),delete a[s][l||"*"][e]);else if(s&&l){if(a[s]&&a[s][l]){for(A in a[s][l])Aa(f,[s,l].join("."),A);delete a[s][l]}}else if(l)for(o in a)for(u in a[o])l===u&&Aa(f,[o,l].join("."));else if(s){if(a[s]){for(u in a[s])Aa(f,[s,u].join("."));delete a[s]}}else{for(o in a)Aa(f,o);QD(r)}}))}function RD(n,t,e,i){const r=Sd(n);return t instanceof se.window.Event||(t=new se.window.CustomEvent(t,{detail:e,cancelable:!0,...i})),r.dispatchEvent(t),t}class dA extends Cd{addEventListener(){}dispatch(t,e,i){return RD(this,t,e,i)}dispatchEvent(t){const e=this.getEventHolder().events;if(!e)return!0;const i=e[t.type];for(const r in i)for(const a in i[r])i[r][a](t);return!t.defaultPrevented}fire(t,e,i){return this.dispatch(t,e,i),this}getEventHolder(){return this}getEventTarget(){return this}off(t,e,i){return Aa(this,t,e,i),this}on(t,e,i,r){return uf(this,t,e,i,r),this}removeEventListener(){}}re(dA,"EventTarget");function Fm(){}const yo={duration:400,ease:">",delay:0},HD={"fill-opacity":1,"stroke-opacity":1,"stroke-width":0,"stroke-linejoin":"miter","stroke-linecap":"butt",fill:"#000000",stroke:"#000000",opacity:1,x:0,y:0,cx:0,cy:0,width:0,height:0,r:0,rx:0,ry:0,offset:0,"stop-opacity":1,"stop-color":"#000000","text-anchor":"start"};class La extends Array{constructor(...t){super(...t),this.init(...t)}clone(){return new this.constructor(this)}init(t){return typeof t=="number"?this:(this.length=0,this.push(...this.parse(t)),this)}parse(t=[]){return t instanceof Array?t:t.trim().split(Yn).map(parseFloat)}toArray(){return Array.prototype.concat.apply([],this)}toSet(){return new Set(this)}toString(){return this.join(" ")}valueOf(){const t=[];return t.push(...this),t}}class Gt{constructor(...t){this.init(...t)}convert(t){return new Gt(this.value,t)}divide(t){return t=new Gt(t),new Gt(this/t,this.unit||t.unit)}init(t,e){return e=Array.isArray(t)?t[1]:e,t=Array.isArray(t)?t[0]:t,this.value=0,this.unit=e||"",typeof t=="number"?this.value=isNaN(t)?0:isFinite(t)?t:t<0?-34e37:34e37:typeof t=="string"?(e=t.match(Vw),e&&(this.value=parseFloat(e[1]),e[5]==="%"?this.value/=100:e[5]==="s"&&(this.value*=1e3),this.unit=e[5])):t instanceof Gt&&(this.value=t.valueOf(),this.unit=t.unit),this}minus(t){return t=new Gt(t),new Gt(this-t,this.unit||t.unit)}plus(t){return t=new Gt(t),new Gt(this+t,this.unit||t.unit)}times(t){return t=new Gt(t),new Gt(this*t,this.unit||t.unit)}toArray(){return[this.value,this.unit]}toJSON(){return this.toString()}toString(){return(this.unit==="%"?~~(this.value*1e8)/1e6:this.unit==="s"?this.value/1e3:this.value)+this.unit}valueOf(){return this.value}}const Xw=[];function kD(n){Xw.push(n)}function ND(n,t,e){if(n==null){n={},t=this.node.attributes;for(const i of t)n[i.nodeName]=Tm.test(i.nodeValue)?parseFloat(i.nodeValue):i.nodeValue;return n}else{if(n instanceof Array)return n.reduce((i,r)=>(i[r]=this.attr(r),i),{});if(typeof n=="object"&&n.constructor===Object)for(t in n)this.attr(t,n[t]);else if(t===null)this.node.removeAttribute(n);else{if(t==null)return t=this.node.getAttribute(n),t==null?HD[n]:Tm.test(t)?parseFloat(t):t;t=Xw.reduce((i,r)=>r(n,i,this),t),typeof t=="number"?t=new Gt(t):he.isColor(t)?t=new he(t):t.constructor===Array&&(t=new La(t)),n==="leading"?this.leading&&this.leading(t):typeof e=="string"?this.node.setAttributeNS(e,n,t.toString()):this.node.setAttribute(n,t.toString()),this.rebuild&&(n==="font-size"||n==="x")&&this.rebuild()}}return this}class br extends dA{constructor(t,e){super(),this.node=t,this.type=t.nodeName,e&&t!==e&&this.attr(e)}add(t,e){return t=fi(t),t.removeNamespace&&this.node instanceof se.window.SVGElement&&t.removeNamespace(),e==null?this.node.appendChild(t.node):t.node!==this.node.childNodes[e]&&this.node.insertBefore(t.node,this.node.childNodes[e]),this}addTo(t,e){return fi(t).put(this,e)}children(){return new us(yd(this.node.children,function(t){return zi(t)}))}clear(){for(;this.node.hasChildNodes();)this.node.removeChild(this.node.lastChild);return this}clone(t=!0){return this.writeDataToDom(),new this.constructor(Nw(this.node.cloneNode(t)))}each(t,e){const i=this.children();let r,a;for(r=0,a=i.length;r<a;r++)t.apply(i[r],[r,i]),e&&i[r].each(t,e);return this}element(t,e){return this.put(new br(qo(t),e))}first(){return zi(this.node.firstChild)}get(t){return zi(this.node.childNodes[t])}getEventHolder(){return this.node}getEventTarget(){return this.node}has(t){return this.index(t)>=0}html(t,e){return this.xml(t,e,NI)}id(t){return typeof t>"u"&&!this.node.id&&(this.node.id=kw(this.type)),this.attr("id",t)}index(t){return[].slice.call(this.node.childNodes).indexOf(t.node)}last(){return zi(this.node.lastChild)}matches(t){const e=this.node,i=e.matches||e.matchesSelector||e.msMatchesSelector||e.mozMatchesSelector||e.webkitMatchesSelector||e.oMatchesSelector||null;return i&&i.call(e,t)}parent(t){let e=this;if(!e.node.parentNode)return null;if(e=zi(e.node.parentNode),!t)return e;do if(typeof t=="string"?e.matches(t):e instanceof t)return e;while(e=zi(e.node.parentNode));return e}put(t,e){return t=fi(t),this.add(t,e),t}putIn(t,e){return fi(t).add(this,e)}remove(){return this.parent()&&this.parent().removeElement(this),this}removeElement(t){return this.node.removeChild(t.node),this}replace(t){return t=fi(t),this.node.parentNode&&this.node.parentNode.replaceChild(t.node,this.node),t}round(t=2,e=null){const i=10**t,r=this.attr(e);for(const a in r)typeof r[a]=="number"&&(r[a]=Math.round(r[a]*i)/i);return this.attr(r),this}svg(t,e){return this.xml(t,e,xd)}toString(){return this.id()}words(t){return this.node.textContent=t,this}wrap(t){const e=this.parent();if(!e)return this.addTo(t);const i=e.index(this);return e.put(t,i).put(this)}writeDataToDom(){return this.each(function(){this.writeDataToDom()}),this}xml(t,e,i){if(typeof t=="boolean"&&(i=e,e=t,t=null),t==null||typeof t=="function"){e=e??!0,this.writeDataToDom();let o=this;if(t!=null){if(o=zi(o.node.cloneNode(!0)),e){const s=t(o);if(o=s||o,s===!1)return""}o.each(function(){const s=t(this),l=s||this;s===!1?this.remove():s&&this!==l&&this.replace(l)},!0)}return e?o.node.outerHTML:o.node.innerHTML}e=e??!1;const r=qo("wrapper",i),a=se.document.createDocumentFragment();r.innerHTML=t;for(let o=r.children.length;o--;)a.appendChild(r.firstElementChild);const f=this.parent();return e?this.replace(a)&&f:this.add(a)}}$t(br,{attr:ND,find:DD,findOne:PD});re(br,"Dom");let Bn=class extends br{constructor(t,e){super(t,e),this.dom={},this.node.instance=this,t.hasAttribute("svgjs:data")&&this.setData(JSON.parse(t.getAttribute("svgjs:data"))||{})}center(t,e){return this.cx(t).cy(e)}cx(t){return t==null?this.x()+this.width()/2:this.x(t-this.width()/2)}cy(t){return t==null?this.y()+this.height()/2:this.y(t-this.height()/2)}defs(){const t=this.root();return t&&t.defs()}dmove(t,e){return this.dx(t).dy(e)}dx(t=0){return this.x(new Gt(t).plus(this.x()))}dy(t=0){return this.y(new Gt(t).plus(this.y()))}getEventHolder(){return this}height(t){return this.attr("height",t)}move(t,e){return this.x(t).y(e)}parents(t=this.root()){const e=typeof t=="string";e||(t=fi(t));const i=new us;let r=this;for(;(r=r.parent())&&r.node!==se.document&&r.nodeName!=="#document-fragment"&&(i.push(r),!(!e&&r.node===t.node||e&&r.matches(t)));)if(r.node===this.root().node)return null;return i}reference(t){if(t=this.attr(t),!t)return null;const e=(t+"").match(sD);return e?fi(e[1]):null}root(){const t=this.parent(zI(bd));return t&&t.root()}setData(t){return this.dom=t,this}size(t,e){const i=za(this,t,e);return this.width(new Gt(i.width)).height(new Gt(i.height))}width(t){return this.attr("width",t)}writeDataToDom(){return this.node.removeAttribute("svgjs:data"),Object.keys(this.dom).length&&this.node.setAttribute("svgjs:data",JSON.stringify(this.dom)),super.writeDataToDom()}x(t){return this.attr("x",t)}y(t){return this.attr("y",t)}};$t(Bn,{bbox:FD,rbox:UD,inside:LD,point:SD,ctm:ED,screenCTM:MD});re(Bn,"Element");const Ao={stroke:["color","width","opacity","linecap","linejoin","miterlimit","dasharray","dashoffset"],fill:["color","opacity","rule"],prefix:function(n,t){return t==="color"?n:n+"-"+t}};["fill","stroke"].forEach(function(n){const t={};let e;t[n]=function(i){if(typeof i>"u")return this.attr(n);if(typeof i=="string"||i instanceof he||he.isRgb(i)||i instanceof Bn)this.attr(n,i);else for(e=Ao[n].length-1;e>=0;e--)i[Ao[n][e]]!=null&&this.attr(Ao.prefix(n,Ao[n][e]),i[Ao[n][e]]);return this},Wt(["Element","Runner"],t)});Wt(["Element","Runner"],{matrix:function(n,t,e,i,r,a){return n==null?new kt(this):this.attr("transform",new kt(n,t,e,i,r,a))},rotate:function(n,t,e){return this.transform({rotate:n,ox:t,oy:e},!0)},skew:function(n,t,e,i){return arguments.length===1||arguments.length===3?this.transform({skew:n,ox:t,oy:e},!0):this.transform({skew:[n,t],ox:e,oy:i},!0)},shear:function(n,t,e){return this.transform({shear:n,ox:t,oy:e},!0)},scale:function(n,t,e,i){return arguments.length===1||arguments.length===3?this.transform({scale:n,ox:t,oy:e},!0):this.transform({scale:[n,t],ox:e,oy:i},!0)},translate:function(n,t){return this.transform({translate:[n,t]},!0)},relative:function(n,t){return this.transform({relative:[n,t]},!0)},flip:function(n="both",t="center"){return"xybothtrue".indexOf(n)===-1&&(t=n,n="both"),this.transform({flip:n,origin:t},!0)},opacity:function(n){return this.attr("opacity",n)}});Wt("radius",{radius:function(n,t=n){return(this._element||this).type==="radialGradient"?this.attr("r",new Gt(n)):this.rx(n).ry(t)}});Wt("Path",{length:function(){return this.node.getTotalLength()},pointAt:function(n){return new Pe(this.node.getPointAtLength(n))}});Wt(["Element","Runner"],{font:function(n,t){if(typeof n=="object"){for(t in n)this.font(t,n[t]);return this}return n==="leading"?this.leading(t):n==="anchor"?this.attr("text-anchor",t):n==="size"||n==="family"||n==="weight"||n==="stretch"||n==="variant"||n==="style"?this.attr("font-"+n,t):this.attr(n,t)}});const VD=["click","dblclick","mousedown","mouseup","mouseover","mouseout","mousemove","mouseenter","mouseleave","touchstart","touchmove","touchleave","touchend","touchcancel"].reduce(function(n,t){const e=function(i){return i===null?this.off(t):this.on(t,i),this};return n[t]=e,n},{});Wt("Element",VD);function zD(){return this.attr("transform",null)}function GD(){return(this.attr("transform")||"").split(aD).slice(0,-1).map(function(t){const e=t.trim().split("(");return[e[0],e[1].split(Yn).map(function(i){return parseFloat(i)})]}).reverse().reduce(function(t,e){return e[0]==="matrix"?t.lmultiply(kt.fromArray(e[1])):t[e[0]].apply(t,e[1])},new kt)}function WD(n,t){if(this===n)return this;const e=this.screenCTM(),i=n.screenCTM().inverse();return this.addTo(n,t).untransform().transform(i.multiply(e)),this}function KD(n){return this.toParent(this.root(),n)}function XD(n,t){if(n==null||typeof n=="string"){const r=new kt(this).decompose();return n==null?r:r[n]}kt.isMatrixLike(n)||(n={...n,origin:hf(n,this)});const e=t===!0?this:t||!1,i=new kt(e).transform(n);return this.attr("transform",i)}Wt("Element",{untransform:zD,matrixify:GD,toParent:WD,toRoot:KD,transform:XD});class Ci extends Bn{flatten(t=this,e){return this.each(function(){if(this instanceof Ci)return this.flatten().ungroup()}),this}ungroup(t=this.parent(),e=t.index(this)){return e=e===-1?t.children().length:e,this.each(function(i,r){return r[r.length-i-1].toParent(t,e)}),this.remove()}}re(Ci,"Container");class Ed extends Ci{constructor(t,e=t){super(Ce("defs",t),e)}flatten(){return this}ungroup(){return this}}re(Ed,"Defs");class Ri extends Bn{}re(Ri,"Shape");function Md(n){return this.attr("rx",n)}function Td(n){return this.attr("ry",n)}function jw(n){return n==null?this.cx()-this.rx():this.cx(n+this.rx())}function Yw(n){return n==null?this.cy()-this.ry():this.cy(n+this.ry())}function qw(n){return this.attr("cx",n)}function $w(n){return this.attr("cy",n)}function Jw(n){return n==null?this.rx()*2:this.rx(new Gt(n).divide(2))}function Zw(n){return n==null?this.ry()*2:this.ry(new Gt(n).divide(2))}var jD={__proto__:null,rx:Md,ry:Td,x:jw,y:Yw,cx:qw,cy:$w,width:Jw,height:Zw};class Hc extends Ri{constructor(t,e=t){super(Ce("ellipse",t),e)}size(t,e){const i=za(this,t,e);return this.rx(new Gt(i.width).divide(2)).ry(new Gt(i.height).divide(2))}}$t(Hc,jD);Wt("Container",{ellipse:xe(function(n=0,t=n){return this.put(new Hc).size(n,t).move(0,0)})});re(Hc,"Ellipse");class t_ extends br{constructor(t=se.document.createDocumentFragment()){super(t)}xml(t,e,i){if(typeof t=="boolean"&&(i=e,e=t,t=null),t==null||typeof t=="function"){const r=new br(qo("wrapper",i));return r.add(this.node.cloneNode(!0)),r.xml(!1,i)}return super.xml(t,!1,i)}}re(t_,"Fragment");function e_(n,t){return(this._element||this).type==="radialGradient"?this.attr({fx:new Gt(n),fy:new Gt(t)}):this.attr({x1:new Gt(n),y1:new Gt(t)})}function i_(n,t){return(this._element||this).type==="radialGradient"?this.attr({cx:new Gt(n),cy:new Gt(t)}):this.attr({x2:new Gt(n),y2:new Gt(t)})}var YD={__proto__:null,from:e_,to:i_};class pA extends Ci{constructor(t,e){super(Ce(t+"Gradient",typeof t=="string"?null:t),e)}attr(t,e,i){return t==="transform"&&(t="gradientTransform"),super.attr(t,e,i)}bbox(){return new ai}targets(){return Ga('svg [fill*="'+this.id()+'"]')}toString(){return this.url()}update(t){return this.clear(),typeof t=="function"&&t.call(this,this),this}url(){return'url("#'+this.id()+'")'}}$t(pA,YD);Wt({Container:{gradient(...n){return this.defs().gradient(...n)}},Defs:{gradient:xe(function(n,t){return this.put(new pA(n)).update(t)})}});re(pA,"Gradient");class $o extends Ci{constructor(t,e=t){super(Ce("pattern",t),e)}attr(t,e,i){return t==="transform"&&(t="patternTransform"),super.attr(t,e,i)}bbox(){return new ai}targets(){return Ga('svg [fill*="'+this.id()+'"]')}toString(){return this.url()}update(t){return this.clear(),typeof t=="function"&&t.call(this,this),this}url(){return'url("#'+this.id()+'")'}}Wt({Container:{pattern(...n){return this.defs().pattern(...n)}},Defs:{pattern:xe(function(n,t,e){return this.put(new $o).update(e).attr({x:0,y:0,width:n,height:t,patternUnits:"userSpaceOnUse"})})}});re($o,"Pattern");let kc=class extends Ri{constructor(t,e=t){super(Ce("image",t),e)}load(t,e){if(!t)return this;const i=new se.window.Image;return uf(i,"load",function(r){const a=this.parent($o);this.width()===0&&this.height()===0&&this.size(i.width,i.height),a instanceof $o&&a.width()===0&&a.height()===0&&a.size(this.width(),this.height()),typeof e=="function"&&e.call(this,r)},this),uf(i,"load error",function(){Aa(i)}),this.attr("href",i.src=t,fA)}};kD(function(n,t,e){return(n==="fill"||n==="stroke")&&AD.test(t)&&(t=e.root().defs().image(t)),t instanceof kc&&(t=e.root().defs().pattern(0,0,i=>{i.add(t)})),t});Wt({Container:{image:xe(function(n,t){return this.put(new kc).size(0,0).load(n,t)})}});re(kc,"Image");class Br extends La{bbox(){let t=-1/0,e=-1/0,i=1/0,r=1/0;return this.forEach(function(a){t=Math.max(a[0],t),e=Math.max(a[1],e),i=Math.min(a[0],i),r=Math.min(a[1],r)}),new ai(i,r,t-i,e-r)}move(t,e){const i=this.bbox();if(t-=i.x,e-=i.y,!isNaN(t)&&!isNaN(e))for(let r=this.length-1;r>=0;r--)this[r]=[this[r][0]+t,this[r][1]+e];return this}parse(t=[0,0]){const e=[];t instanceof Array?t=Array.prototype.concat.apply([],t):t=t.trim().split(Yn).map(parseFloat),t.length%2!==0&&t.pop();for(let i=0,r=t.length;i<r;i=i+2)e.push([t[i],t[i+1]]);return e}size(t,e){let i;const r=this.bbox();for(i=this.length-1;i>=0;i--)r.width&&(this[i][0]=(this[i][0]-r.x)*t/r.width+r.x),r.height&&(this[i][1]=(this[i][1]-r.y)*e/r.height+r.y);return this}toLine(){return{x1:this[0][0],y1:this[0][1],x2:this[1][0],y2:this[1][1]}}toString(){const t=[];for(let e=0,i=this.length;e<i;e++)t.push(this[e].join(","));return t.join(" ")}transform(t){return this.clone().transformO(t)}transformO(t){kt.isMatrixLike(t)||(t=new kt(t));for(let e=this.length;e--;){const[i,r]=this[e];this[e][0]=t.a*i+t.c*r+t.e,this[e][1]=t.b*i+t.d*r+t.f}return this}}const qD=Br;function $D(n){return n==null?this.bbox().x:this.move(n,this.bbox().y)}function JD(n){return n==null?this.bbox().y:this.move(this.bbox().x,n)}function ZD(n){const t=this.bbox();return n==null?t.width:this.size(n,t.height)}function t2(n){const t=this.bbox();return n==null?t.height:this.size(t.width,n)}var Fd={__proto__:null,MorphArray:qD,x:$D,y:JD,width:ZD,height:t2};class An extends Ri{constructor(t,e=t){super(Ce("line",t),e)}array(){return new Br([[this.attr("x1"),this.attr("y1")],[this.attr("x2"),this.attr("y2")]])}move(t,e){return this.attr(this.array().move(t,e).toLine())}plot(t,e,i,r){return t==null?this.array():(typeof e<"u"?t={x1:t,y1:e,x2:i,y2:r}:t=new Br(t).toLine(),this.attr(t))}size(t,e){const i=za(this,t,e);return this.attr(this.array().size(i.width,i.height).toLine())}}$t(An,Fd);Wt({Container:{line:xe(function(...n){return An.prototype.plot.apply(this.put(new An),n[0]!=null?n:[0,0,0,0])})}});re(An,"Line");class ac extends Ci{constructor(t,e=t){super(Ce("marker",t),e)}height(t){return this.attr("markerHeight",t)}orient(t){return this.attr("orient",t)}ref(t,e){return this.attr("refX",t).attr("refY",e)}toString(){return"url(#"+this.id()+")"}update(t){return this.clear(),typeof t=="function"&&t.call(this,this),this}width(t){return this.attr("markerWidth",t)}}Wt({Container:{marker(...n){return this.defs().marker(...n)}},Defs:{marker:xe(function(n,t,e){return this.put(new ac).size(n,t).ref(n/2,t/2).viewbox(0,0,n,t).attr("orient","auto").update(e)})},marker:{marker(n,t,e,i){let r=["marker"];return n!=="all"&&r.push(n),r=r.join("-"),n=arguments[1]instanceof ac?arguments[1]:this.defs().marker(t,e,i),this.attr(r,n)}}});re(ac,"Marker");function la(n,t){return function(e){return e==null?this[n]:(this[n]=e,t&&t.call(this),this)}}const e2={"-":function(n){return n},"<>":function(n){return-Math.cos(n*Math.PI)/2+.5},">":function(n){return Math.sin(n*Math.PI/2)},"<":function(n){return-Math.cos(n*Math.PI/2)+1},bezier:function(n,t,e,i){return function(r){return r<0?n>0?t/n*r:e>0?i/e*r:0:r>1?e<1?(1-i)/(1-e)*r+(i-e)/(1-e):n<1?(1-t)/(1-n)*r+(t-n)/(1-n):1:3*r*(1-r)**2*t+3*r**2*(1-r)*i+r**3}},steps:function(n,t="end"){t=t.split("-").reverse()[0];let e=n;return t==="none"?--e:t==="both"&&++e,(i,r=!1)=>{let a=Math.floor(i*n);const f=i*a%1===0;return(t==="start"||t==="both")&&++a,r&&f&&--a,i>=0&&a<0&&(a=0),i<=1&&a>e&&(a=e),a/e}}};class Ud{done(){return!1}}class ff extends Ud{constructor(t=yo.ease){super(),this.ease=e2[t]||t}step(t,e,i){return typeof t!="number"?i<1?t:e:t+(e-t)*this.ease(i)}}class oc extends Ud{constructor(t){super(),this.stepper=t}done(t){return t.done}step(t,e,i,r){return this.stepper(t,e,i,r)}}function Um(){const n=(this._duration||500)/1e3,t=this._overshoot||0,e=1e-10,i=Math.PI,r=Math.log(t/100+e),a=-r/Math.sqrt(i*i+r*r),f=3.9/(a*n);this.d=2*a*f,this.k=f*f}class i2 extends oc{constructor(t=500,e=0){super(),this.duration(t).overshoot(e)}step(t,e,i,r){if(typeof t=="string")return t;if(r.done=i===1/0,i===1/0)return e;if(i===0)return t;i>100&&(i=16),i/=1e3;const a=r.velocity||0,f=-this.d*a-this.k*(t-e),o=t+a*i+f*i*i/2;return r.velocity=a+f*i,r.done=Math.abs(e-o)+Math.abs(a)<.002,r.done?e:o}}$t(i2,{duration:la("_duration",Um),overshoot:la("_overshoot",Um)});class n2 extends oc{constructor(t=.1,e=.01,i=0,r=1e3){super(),this.p(t).i(e).d(i).windup(r)}step(t,e,i,r){if(typeof t=="string")return t;if(r.done=i===1/0,i===1/0)return e;if(i===0)return t;const a=e-t;let f=(r.integral||0)+a*i;const o=(a-(r.error||0))/i,s=this._windup;return s!==!1&&(f=Math.max(-s,Math.min(f,s))),r.error=a,r.integral=f,r.done=Math.abs(a)<.001,r.done?e:t+(this.P*a+this.I*f+this.D*o)}}$t(n2,{windup:la("_windup"),p:la("P"),i:la("I"),d:la("D")});const r2={M:2,L:2,H:1,V:1,C:6,S:4,Q:4,T:2,A:7,Z:0},df={M:function(n,t,e){return t.x=e.x=n[0],t.y=e.y=n[1],["M",t.x,t.y]},L:function(n,t){return t.x=n[0],t.y=n[1],["L",n[0],n[1]]},H:function(n,t){return t.x=n[0],["H",n[0]]},V:function(n,t){return t.y=n[0],["V",n[0]]},C:function(n,t){return t.x=n[4],t.y=n[5],["C",n[0],n[1],n[2],n[3],n[4],n[5]]},S:function(n,t){return t.x=n[2],t.y=n[3],["S",n[0],n[1],n[2],n[3]]},Q:function(n,t){return t.x=n[2],t.y=n[3],["Q",n[0],n[1],n[2],n[3]]},T:function(n,t){return t.x=n[0],t.y=n[1],["T",n[0],n[1]]},Z:function(n,t,e){return t.x=e.x,t.y=e.y,["Z"]},A:function(n,t){return t.x=n[5],t.y=n[6],["A",n[0],n[1],n[2],n[3],n[4],n[5],n[6]]}},lu="mlhvqtcsaz".split("");for(let n=0,t=lu.length;n<t;++n)df[lu[n]]=function(e){return function(i,r,a){if(e==="H")i[0]=i[0]+r.x;else if(e==="V")i[0]=i[0]+r.y;else if(e==="A")i[5]=i[5]+r.x,i[6]=i[6]+r.y;else for(let f=0,o=i.length;f<o;++f)i[f]=i[f]+(f%2?r.y:r.x);return df[e](i,r,a)}}(lu[n].toUpperCase());function s2(n){const t=n.segment[0];return df[t](n.segment.slice(1),n.p,n.p0)}function pf(n){return n.segment.length&&n.segment.length-1===r2[n.segment[0].toUpperCase()]}function a2(n,t){n.inNumber&&kr(n,!1);const e=Bd.test(t);if(e)n.segment=[t];else{const i=n.lastCommand,r=i.toLowerCase(),a=i===r;n.segment=[r==="m"?a?"l":"L":i]}return n.inSegment=!0,n.lastCommand=n.segment[0],e}function kr(n,t){if(!n.inNumber)throw new Error("Parser Error");n.number&&n.segment.push(parseFloat(n.number)),n.inNumber=t,n.number="",n.pointSeen=!1,n.hasExponent=!1,pf(n)&&gf(n)}function gf(n){n.inSegment=!1,n.absolute&&(n.segment=s2(n)),n.segments.push(n.segment)}function o2(n){if(!n.segment.length)return!1;const t=n.segment[0].toUpperCase()==="A",e=n.segment.length;return t&&(e===4||e===5)}function A2(n){return n.lastToken.toUpperCase()==="E"}function l2(n,t=!0){let e=0,i="";const r={segment:[],inNumber:!1,number:"",lastToken:"",inSegment:!1,segments:[],pointSeen:!1,hasExponent:!1,absolute:t,p0:new Pe,p:new Pe};for(;r.lastToken=i,i=n.charAt(e++);)if(!(!r.inSegment&&a2(r,i))){if(i==="."){if(r.pointSeen||r.hasExponent){kr(r,!1),--e;continue}r.inNumber=!0,r.pointSeen=!0,r.number+=i;continue}if(!isNaN(parseInt(i))){if(r.number==="0"||o2(r)){r.inNumber=!0,r.number=i,kr(r,!0);continue}r.inNumber=!0,r.number+=i;continue}if(i===" "||i===","){r.inNumber&&kr(r,!1);continue}if(i==="-"){if(r.inNumber&&!A2(r)){kr(r,!1),--e;continue}r.number+=i,r.inNumber=!0;continue}if(i.toUpperCase()==="E"){r.number+=i,r.hasExponent=!0;continue}if(Bd.test(i)){if(r.inNumber)kr(r,!1);else if(pf(r))gf(r);else throw new Error("parser Error");--e}}return r.inNumber&&kr(r,!1),r.inSegment&&pf(r)&&gf(r),r.segments}function c2(n){let t="";for(let e=0,i=n.length;e<i;e++)t+=n[e][0],n[e][1]!=null&&(t+=n[e][1],n[e][2]!=null&&(t+=" ",t+=n[e][2],n[e][3]!=null&&(t+=" ",t+=n[e][3],t+=" ",t+=n[e][4],n[e][5]!=null&&(t+=" ",t+=n[e][5],t+=" ",t+=n[e][6],n[e][7]!=null&&(t+=" ",t+=n[e][7])))));return t+" "}class fs extends La{bbox(){return hr().path.setAttribute("d",this.toString()),new ai(hr.nodes.path.getBBox())}move(t,e){const i=this.bbox();if(t-=i.x,e-=i.y,!isNaN(t)&&!isNaN(e))for(let r,a=this.length-1;a>=0;a--)r=this[a][0],r==="M"||r==="L"||r==="T"?(this[a][1]+=t,this[a][2]+=e):r==="H"?this[a][1]+=t:r==="V"?this[a][1]+=e:r==="C"||r==="S"||r==="Q"?(this[a][1]+=t,this[a][2]+=e,this[a][3]+=t,this[a][4]+=e,r==="C"&&(this[a][5]+=t,this[a][6]+=e)):r==="A"&&(this[a][6]+=t,this[a][7]+=e);return this}parse(t="M0 0"){return Array.isArray(t)&&(t=Array.prototype.concat.apply([],t).toString()),l2(t)}size(t,e){const i=this.bbox();let r,a;for(i.width=i.width===0?1:i.width,i.height=i.height===0?1:i.height,r=this.length-1;r>=0;r--)a=this[r][0],a==="M"||a==="L"||a==="T"?(this[r][1]=(this[r][1]-i.x)*t/i.width+i.x,this[r][2]=(this[r][2]-i.y)*e/i.height+i.y):a==="H"?this[r][1]=(this[r][1]-i.x)*t/i.width+i.x:a==="V"?this[r][1]=(this[r][1]-i.y)*e/i.height+i.y:a==="C"||a==="S"||a==="Q"?(this[r][1]=(this[r][1]-i.x)*t/i.width+i.x,this[r][2]=(this[r][2]-i.y)*e/i.height+i.y,this[r][3]=(this[r][3]-i.x)*t/i.width+i.x,this[r][4]=(this[r][4]-i.y)*e/i.height+i.y,a==="C"&&(this[r][5]=(this[r][5]-i.x)*t/i.width+i.x,this[r][6]=(this[r][6]-i.y)*e/i.height+i.y)):a==="A"&&(this[r][1]=this[r][1]*t/i.width,this[r][2]=this[r][2]*e/i.height,this[r][6]=(this[r][6]-i.x)*t/i.width+i.x,this[r][7]=(this[r][7]-i.y)*e/i.height+i.y);return this}toString(){return c2(this)}}const n_=n=>{const t=typeof n;return t==="number"?Gt:t==="string"?he.isColor(n)?he:Yn.test(n)?Bd.test(n)?fs:La:Vw.test(n)?Gt:mf:Ld.indexOf(n.constructor)>-1?n.constructor:Array.isArray(n)?La:t==="object"?Jo:mf};class Nr{constructor(t){this._stepper=t||new ff("-"),this._from=null,this._to=null,this._type=null,this._context=null,this._morphObj=null}at(t){return this._morphObj.morph(this._from,this._to,t,this._stepper,this._context)}done(){return this._context.map(this._stepper.done).reduce(function(e,i){return e&&i},!0)}from(t){return t==null?this._from:(this._from=this._set(t),this)}stepper(t){return t==null?this._stepper:(this._stepper=t,this)}to(t){return t==null?this._to:(this._to=this._set(t),this)}type(t){return t==null?this._type:(this._type=t,this)}_set(t){this._type||this.type(n_(t));let e=new this._type(t);return this._type===he&&(e=this._to?e[this._to[4]]():this._from?e[this._from[4]]():e),this._type===Jo&&(e=this._to?e.align(this._to):this._from?e.align(this._from):e),e=e.toConsumable(),this._morphObj=this._morphObj||new this._type,this._context=this._context||Array.apply(null,Array(e.length)).map(Object).map(function(i){return i.done=!0,i}),e}}class mf{constructor(...t){this.init(...t)}init(t){return t=Array.isArray(t)?t[0]:t,this.value=t,this}toArray(){return[this.value]}valueOf(){return this.value}}class gA{constructor(...t){this.init(...t)}init(t){return Array.isArray(t)&&(t={scaleX:t[0],scaleY:t[1],shear:t[2],rotate:t[3],translateX:t[4],translateY:t[5],originX:t[6],originY:t[7]}),Object.assign(this,gA.defaults,t),this}toArray(){const t=this;return[t.scaleX,t.scaleY,t.shear,t.rotate,t.translateX,t.translateY,t.originX,t.originY]}}gA.defaults={scaleX:1,scaleY:1,shear:0,rotate:0,translateX:0,translateY:0,originX:0,originY:0};const h2=(n,t)=>n[0]<t[0]?-1:n[0]>t[0]?1:0;class Jo{constructor(...t){this.init(...t)}align(t){const e=this.values;for(let i=0,r=e.length;i<r;++i){if(e[i+1]===t[i+1]){if(e[i+1]===he&&t[i+7]!==e[i+7]){const o=t[i+7],s=new he(this.values.splice(i+3,5))[o]().toArray();this.values.splice(i+3,0,...s)}i+=e[i+2]+2;continue}if(!t[i+1])return this;const a=new t[i+1]().toArray(),f=e[i+2]+3;e.splice(i,f,t[i],t[i+1],t[i+2],...a),i+=e[i+2]+2}return this}init(t){if(this.values=[],Array.isArray(t)){this.values=t.slice();return}t=t||{};const e=[];for(const i in t){const r=n_(t[i]),a=new r(t[i]).toArray();e.push([i,r,a.length,...a])}return e.sort(h2),this.values=e.reduce((i,r)=>i.concat(r),[]),this}toArray(){return this.values}valueOf(){const t={},e=this.values;for(;e.length;){const i=e.shift(),r=e.shift(),a=e.shift(),f=e.splice(0,a);t[i]=new r(f)}return t}}const Ld=[mf,gA,Jo];function u2(n=[]){Ld.push(...[].concat(n))}function f2(){$t(Ld,{to(n){return new Nr().type(this.constructor).from(this.toArray()).to(n)},fromArray(n){return this.init(n),this},toConsumable(){return this.toArray()},morph(n,t,e,i,r){const a=function(f,o){return i.step(f,t[o],e,r[o],r)};return this.fromArray(n.map(a))}})}class Wa extends Ri{constructor(t,e=t){super(Ce("path",t),e)}array(){return this._array||(this._array=new fs(this.attr("d")))}clear(){return delete this._array,this}height(t){return t==null?this.bbox().height:this.size(this.bbox().width,t)}move(t,e){return this.attr("d",this.array().move(t,e))}plot(t){return t==null?this.array():this.clear().attr("d",typeof t=="string"?t:this._array=new fs(t))}size(t,e){const i=za(this,t,e);return this.attr("d",this.array().size(i.width,i.height))}width(t){return t==null?this.bbox().width:this.size(t,this.bbox().height)}x(t){return t==null?this.bbox().x:this.move(t,this.bbox().y)}y(t){return t==null?this.bbox().y:this.move(this.bbox().x,t)}}Wa.prototype.MorphArray=fs;Wt({Container:{path:xe(function(n){return this.put(new Wa).plot(n||new fs)})}});re(Wa,"Path");function d2(){return this._array||(this._array=new Br(this.attr("points")))}function p2(){return delete this._array,this}function g2(n,t){return this.attr("points",this.array().move(n,t))}function m2(n){return n==null?this.array():this.clear().attr("points",typeof n=="string"?n:this._array=new Br(n))}function v2(n,t){const e=za(this,n,t);return this.attr("points",this.array().size(e.width,e.height))}var r_={__proto__:null,array:d2,clear:p2,move:g2,plot:m2,size:v2};class mA extends Ri{constructor(t,e=t){super(Ce("polygon",t),e)}}Wt({Container:{polygon:xe(function(n){return this.put(new mA).plot(n||new Br)})}});$t(mA,Fd);$t(mA,r_);re(mA,"Polygon");class vA extends Ri{constructor(t,e=t){super(Ce("polyline",t),e)}}Wt({Container:{polyline:xe(function(n){return this.put(new vA).plot(n||new Br)})}});$t(vA,Fd);$t(vA,r_);re(vA,"Polyline");class Nc extends Ri{constructor(t,e=t){super(Ce("rect",t),e)}}$t(Nc,{rx:Md,ry:Td});Wt({Container:{rect:xe(function(n,t){return this.put(new Nc).size(n,t)})}});re(Nc,"Rect");class cu{constructor(){this._first=null,this._last=null}first(){return this._first&&this._first.value}last(){return this._last&&this._last.value}push(t){const e=typeof t.next<"u"?t:{value:t,next:null,prev:null};return this._last?(e.prev=this._last,this._last.next=e,this._last=e):(this._last=e,this._first=e),e}remove(t){t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),t===this._last&&(this._last=t.prev),t===this._first&&(this._first=t.next),t.prev=null,t.next=null}shift(){const t=this._first;return t?(this._first=t.next,this._first&&(this._first.prev=null),this._last=this._first?this._last:null,t.value):null}}const oe={nextDraw:null,frames:new cu,timeouts:new cu,immediates:new cu,timer:()=>se.window.performance||se.window.Date,transforms:[],frame(n){const t=oe.frames.push({run:n});return oe.nextDraw===null&&(oe.nextDraw=se.window.requestAnimationFrame(oe._draw)),t},timeout(n,t){t=t||0;const e=oe.timer().now()+t,i=oe.timeouts.push({run:n,time:e});return oe.nextDraw===null&&(oe.nextDraw=se.window.requestAnimationFrame(oe._draw)),i},immediate(n){const t=oe.immediates.push(n);return oe.nextDraw===null&&(oe.nextDraw=se.window.requestAnimationFrame(oe._draw)),t},cancelFrame(n){n!=null&&oe.frames.remove(n)},clearTimeout(n){n!=null&&oe.timeouts.remove(n)},cancelImmediate(n){n!=null&&oe.immediates.remove(n)},_draw(n){let t=null;const e=oe.timeouts.last();for(;(t=oe.timeouts.shift())&&(n>=t.time?t.run():oe.timeouts.push(t),t!==e););let i=null;const r=oe.frames.last();for(;i!==r&&(i=oe.frames.shift());)i.run(n);let a=null;for(;a=oe.immediates.shift();)a();oe.nextDraw=oe.timeouts.first()||oe.frames.first()?se.window.requestAnimationFrame(oe._draw):null}},w2=function(n){const t=n.start,e=n.runner.duration(),i=t+e;return{start:t,duration:e,end:i,runner:n.runner}},_2=function(){const n=se.window;return(n.performance||n.Date).now()};class s_ extends dA{constructor(t=_2){super(),this._timeSource=t,this._startTime=0,this._speed=1,this._persist=0,this._nextFrame=null,this._paused=!0,this._runners=[],this._runnerIds=[],this._lastRunnerId=-1,this._time=0,this._lastSourceTime=0,this._lastStepTime=0,this._step=this._stepFn.bind(this,!1),this._stepImmediate=this._stepFn.bind(this,!0)}active(){return!!this._nextFrame}finish(){return this.time(this.getEndTimeOfTimeline()+1),this.pause()}getEndTime(){const t=this.getLastRunnerInfo(),e=t?t.runner.duration():0;return(t?t.start:this._time)+e}getEndTimeOfTimeline(){const t=this._runners.map(e=>e.start+e.runner.duration());return Math.max(0,...t)}getLastRunnerInfo(){return this.getRunnerInfoById(this._lastRunnerId)}getRunnerInfoById(t){return this._runners[this._runnerIds.indexOf(t)]||null}pause(){return this._paused=!0,this._continue()}persist(t){return t==null?this._persist:(this._persist=t,this)}play(){return this._paused=!1,this.updateTime()._continue()}reverse(t){const e=this.speed();if(t==null)return this.speed(-e);const i=Math.abs(e);return this.speed(t?-i:i)}schedule(t,e,i){if(t==null)return this._runners.map(w2);let r=0;const a=this.getEndTime();if(e=e||0,i==null||i==="last"||i==="after")r=a;else if(i==="absolute"||i==="start")r=e,e=0;else if(i==="now")r=this._time;else if(i==="relative"){const s=this.getRunnerInfoById(t.id);s&&(r=s.start+e,e=0)}else if(i==="with-last"){const s=this.getLastRunnerInfo();r=s?s.start:this._time}else throw new Error('Invalid value for the "when" parameter');t.unschedule(),t.timeline(this);const f=t.persist(),o={persist:f===null?this._persist:f,start:r+e,runner:t};return this._lastRunnerId=t.id,this._runners.push(o),this._runners.sort((s,l)=>s.start-l.start),this._runnerIds=this._runners.map(s=>s.runner.id),this.updateTime()._continue(),this}seek(t){return this.time(this._time+t)}source(t){return t==null?this._timeSource:(this._timeSource=t,this)}speed(t){return t==null?this._speed:(this._speed=t,this)}stop(){return this.time(0),this.pause()}time(t){return t==null?this._time:(this._time=t,this._continue(!0))}unschedule(t){const e=this._runnerIds.indexOf(t.id);return e<0?this:(this._runners.splice(e,1),this._runnerIds.splice(e,1),t.timeline(null),this)}updateTime(){return this.active()||(this._lastSourceTime=this._timeSource()),this}_continue(t=!1){return oe.cancelFrame(this._nextFrame),this._nextFrame=null,t?this._stepImmediate():this._paused?this:(this._nextFrame=oe.frame(this._step),this)}_stepFn(t=!1){const e=this._timeSource();let i=e-this._lastSourceTime;t&&(i=0);const r=this._speed*i+(this._time-this._lastStepTime);this._lastSourceTime=e,t||(this._time+=r,this._time=this._time<0?0:this._time),this._lastStepTime=this._time,this.fire("time",this._time);for(let f=this._runners.length;f--;){const o=this._runners[f],s=o.runner;this._time-o.start<=0&&s.reset()}let a=!1;for(let f=0,o=this._runners.length;f<o;f++){const s=this._runners[f],l=s.runner;let u=r;const A=this._time-s.start;if(A<=0){a=!0;continue}else A<u&&(u=A);if(!l.active())continue;l.step(u).done?s.persist!==!0&&l.duration()-l.time()+this._time+s.persist<this._time&&(l.unschedule(),--f,--o):a=!0}return a&&!(this._speed<0&&this._time===0)||this._runnerIds.length&&this._speed<0&&this._time>0?this._continue():(this.pause(),this.fire("finished")),this}}Wt({Element:{timeline:function(n){return n==null?(this._timeline=this._timeline||new s_,this._timeline):(this._timeline=n,this)}}});class Ii extends dA{constructor(t){super(),this.id=Ii.id++,t=t??yo.duration,t=typeof t=="function"?new oc(t):t,this._element=null,this._timeline=null,this.done=!1,this._queue=[],this._duration=typeof t=="number"&&t,this._isDeclarative=t instanceof oc,this._stepper=this._isDeclarative?t:new ff,this._history={},this.enabled=!0,this._time=0,this._lastTime=0,this._reseted=!0,this.transforms=new kt,this.transformId=1,this._haveReversed=!1,this._reverse=!1,this._loopsDone=0,this._swing=!1,this._wait=0,this._times=1,this._frameId=null,this._persist=this._isDeclarative?!0:null}static sanitise(t,e,i){let r=1,a=!1,f=0;return t=t||yo.duration,e=e||yo.delay,i=i||"last",typeof t=="object"&&!(t instanceof Ud)&&(e=t.delay||e,i=t.when||i,a=t.swing||a,r=t.times||r,f=t.wait||f,t=t.duration||yo.duration),{duration:t,delay:e,swing:a,times:r,wait:f,when:i}}active(t){return t==null?this.enabled:(this.enabled=t,this)}addTransform(t,e){return this.transforms.lmultiplyO(t),this}after(t){return this.on("finished",t)}animate(t,e,i){const r=Ii.sanitise(t,e,i),a=new Ii(r.duration);return this._timeline&&a.timeline(this._timeline),this._element&&a.element(this._element),a.loop(r).schedule(r.delay,r.when)}clearTransform(){return this.transforms=new kt,this}clearTransformsFromQueue(){(!this.done||!this._timeline||!this._timeline._runnerIds.includes(this.id))&&(this._queue=this._queue.filter(t=>!t.isTransform))}delay(t){return this.animate(0,t)}duration(){return this._times*(this._wait+this._duration)-this._wait}during(t){return this.queue(null,t)}ease(t){return this._stepper=new ff(t),this}element(t){return t==null?this._element:(this._element=t,t._prepareRunner(),this)}finish(){return this.step(1/0)}loop(t,e,i){return typeof t=="object"&&(e=t.swing,i=t.wait,t=t.times),this._times=t||1/0,this._swing=e||!1,this._wait=i||0,this._times===!0&&(this._times=1/0),this}loops(t){const e=this._duration+this._wait;if(t==null){const f=Math.floor(this._time/e),s=(this._time-f*e)/this._duration;return Math.min(f+s,this._times)}const i=Math.floor(t),r=t%1,a=e*i+this._duration*r;return this.time(a)}persist(t){return t==null?this._persist:(this._persist=t,this)}position(t){const e=this._time,i=this._duration,r=this._wait,a=this._times,f=this._swing,o=this._reverse;let s;if(t==null){const c=function(p){const m=f*Math.floor(p%(2*(r+i))/(r+i)),d=m&&!o||!m&&o,g=Math.pow(-1,d)*(p%(r+i))/i+d;return Math.max(Math.min(g,1),0)},h=a*(r+i)-r;return s=e<=0?Math.round(c(1e-5)):e<h?c(e):Math.round(c(h-1e-5)),s}const l=Math.floor(this.loops()),u=f&&l%2===0;return s=l+(u&&!o||o&&u?t:1-t),this.loops(s)}progress(t){return t==null?Math.min(1,this._time/this.duration()):this.time(t*this.duration())}queue(t,e,i,r){return this._queue.push({initialiser:t||Fm,runner:e||Fm,retarget:i,isTransform:r,initialised:!1,finished:!1}),this.timeline()&&this.timeline()._continue(),this}reset(){return this._reseted?this:(this.time(0),this._reseted=!0,this)}reverse(t){return this._reverse=t??!this._reverse,this}schedule(t,e,i){if(t instanceof s_||(i=e,e=t,t=this.timeline()),!t)throw Error("Runner cannot be scheduled without timeline");return t.schedule(this,e,i),this}step(t){if(!this.enabled)return this;t=t??16,this._time+=t;const e=this.position(),i=this._lastPosition!==e&&this._time>=0;this._lastPosition=e;const r=this.duration(),a=this._lastTime<=0&&this._time>0,f=this._lastTime<r&&this._time>=r;this._lastTime=this._time,a&&this.fire("start",this);const o=this._isDeclarative;this.done=!o&&!f&&this._time>=r,this._reseted=!1;let s=!1;return(i||o)&&(this._initialise(i),this.transforms=new kt,s=this._run(o?t:e),this.fire("step",this)),this.done=this.done||s&&o,f&&this.fire("finished",this),this}time(t){if(t==null)return this._time;const e=t-this._time;return this.step(e),this}timeline(t){return typeof t>"u"?this._timeline:(this._timeline=t,this)}unschedule(){const t=this.timeline();return t&&t.unschedule(this),this}_initialise(t){if(!(!t&&!this._isDeclarative))for(let e=0,i=this._queue.length;e<i;++e){const r=this._queue[e],a=this._isDeclarative||!r.initialised&&t;t=!r.finished,a&&t&&(r.initialiser.call(this),r.initialised=!0)}}_rememberMorpher(t,e){if(this._history[t]={morpher:e,caller:this._queue[this._queue.length-1]},this._isDeclarative){const i=this.timeline();i&&i.play()}}_run(t){let e=!0;for(let i=0,r=this._queue.length;i<r;++i){const a=this._queue[i],f=a.runner.call(this,t);a.finished=a.finished||f===!0,e=e&&a.finished}return e}_tryRetarget(t,e,i){if(this._history[t]){if(!this._history[t].caller.initialised){const a=this._queue.indexOf(this._history[t].caller);return this._queue.splice(a,1),!1}this._history[t].caller.retarget?this._history[t].caller.retarget.call(this,e,i):this._history[t].morpher.to(e),this._history[t].caller.finished=!1;const r=this.timeline();return r&&r.play(),!0}return!1}}Ii.id=0;class Ac{constructor(t=new kt,e=-1,i=!0){this.transforms=t,this.id=e,this.done=i}clearTransformsFromQueue(){}}$t([Ii,Ac],{mergeWith(n){return new Ac(n.transforms.lmultiply(this.transforms),n.id)}});const a_=(n,t)=>n.lmultiplyO(t),o_=n=>n.transforms;function y2(){const t=this._transformationRunners.runners.map(o_).reduce(a_,new kt);this.transform(t),this._transformationRunners.merge(),this._transformationRunners.length()===1&&(this._frameId=null)}class x2{constructor(){this.runners=[],this.ids=[]}add(t){if(this.runners.includes(t))return;const e=t.id+1;return this.runners.push(t),this.ids.push(e),this}clearBefore(t){const e=this.ids.indexOf(t+1)||1;return this.ids.splice(0,e,0),this.runners.splice(0,e,new Ac).forEach(i=>i.clearTransformsFromQueue()),this}edit(t,e){const i=this.ids.indexOf(t+1);return this.ids.splice(i,1,t+1),this.runners.splice(i,1,e),this}getByID(t){return this.runners[this.ids.indexOf(t+1)]}length(){return this.ids.length}merge(){let t=null;for(let e=0;e<this.runners.length;++e){const i=this.runners[e];if(t&&i.done&&t.done&&(!i._timeline||!i._timeline._runnerIds.includes(i.id))&&(!t._timeline||!t._timeline._runnerIds.includes(t.id))){this.remove(i.id);const a=i.mergeWith(t);this.edit(t.id,a),t=a,--e}else t=i}return this}remove(t){const e=this.ids.indexOf(t+1);return this.ids.splice(e,1),this.runners.splice(e,1),this}}Wt({Element:{animate(n,t,e){const i=Ii.sanitise(n,t,e),r=this.timeline();return new Ii(i.duration).loop(i).element(this).timeline(r.play()).schedule(i.delay,i.when)},delay(n,t){return this.animate(0,n,t)},_clearTransformRunnersBefore(n){this._transformationRunners.clearBefore(n.id)},_currentTransform(n){return this._transformationRunners.runners.filter(t=>t.id<=n.id).map(o_).reduce(a_,new kt)},_addRunner(n){this._transformationRunners.add(n),oe.cancelImmediate(this._frameId),this._frameId=oe.immediate(y2.bind(this))},_prepareRunner(){this._frameId==null&&(this._transformationRunners=new x2().add(new Ac(new kt(this))))}}});const C2=(n,t)=>n.filter(e=>!t.includes(e));$t(Ii,{attr(n,t){return this.styleAttr("attr",n,t)},css(n,t){return this.styleAttr("css",n,t)},styleAttr(n,t,e){if(typeof t=="string")return this.styleAttr(n,{[t]:e});let i=t;if(this._tryRetarget(n,i))return this;let r=new Nr(this._stepper).to(i),a=Object.keys(i);return this.queue(function(){r=r.from(this.element()[n](a))},function(f){return this.element()[n](r.at(f).valueOf()),r.done()},function(f){const o=Object.keys(f),s=C2(o,a);if(s.length){const u=this.element()[n](s),A=new Jo(r.from()).valueOf();Object.assign(A,u),r.from(A)}const l=new Jo(r.to()).valueOf();Object.assign(l,f),r.to(l),a=o,i=f}),this._rememberMorpher(n,r),this},zoom(n,t){if(this._tryRetarget("zoom",n,t))return this;let e=new Nr(this._stepper).to(new Gt(n));return this.queue(function(){e=e.from(this.element().zoom())},function(i){return this.element().zoom(e.at(i),t),e.done()},function(i,r){t=r,e.to(i)}),this._rememberMorpher("zoom",e),this},transform(n,t,e){if(t=n.relative||t,this._isDeclarative&&!t&&this._tryRetarget("transform",n))return this;const i=kt.isMatrixLike(n);e=n.affine!=null?n.affine:e??!i;const r=new Nr(this._stepper).type(e?gA:kt);let a,f,o,s,l;function u(){f=f||this.element(),a=a||hf(n,f),l=new kt(t?void 0:f),f._addRunner(this),t||f._clearTransformRunnersBefore(this)}function A(h){t||this.clearTransform();const{x:p,y:m}=new Pe(a).transform(f._currentTransform(this));let d=new kt({...n,origin:[p,m]}),g=this._isDeclarative&&o?o:l;if(e){d=d.decompose(p,m),g=g.decompose(p,m);const w=d.rotate,_=g.rotate,y=[w-360,w,w+360],C=y.map(B=>Math.abs(B-_)),b=Math.min(...C),S=C.indexOf(b);d.rotate=y[S]}t&&(i||(d.rotate=n.rotate||0),this._isDeclarative&&s&&(g.rotate=s)),r.from(g),r.to(d);const v=r.at(h);return s=v.rotate,o=new kt(v),this.addTransform(o),f._addRunner(this),r.done()}function c(h){(h.origin||"center").toString()!==(n.origin||"center").toString()&&(a=hf(h,f)),n={...h,origin:a}}return this.queue(u,A,c,!0),this._isDeclarative&&this._rememberMorpher("transform",r),this},x(n,t){return this._queueNumber("x",n)},y(n){return this._queueNumber("y",n)},dx(n=0){return this._queueNumberDelta("x",n)},dy(n=0){return this._queueNumberDelta("y",n)},dmove(n,t){return this.dx(n).dy(t)},_queueNumberDelta(n,t){if(t=new Gt(t),this._tryRetarget(n,t))return this;const e=new Nr(this._stepper).to(t);let i=null;return this.queue(function(){i=this.element()[n](),e.from(i),e.to(i+t)},function(r){return this.element()[n](e.at(r)),e.done()},function(r){e.to(i+new Gt(r))}),this._rememberMorpher(n,e),this},_queueObject(n,t){if(this._tryRetarget(n,t))return this;const e=new Nr(this._stepper).to(t);return this.queue(function(){e.from(this.element()[n]())},function(i){return this.element()[n](e.at(i)),e.done()}),this._rememberMorpher(n,e),this},_queueNumber(n,t){return this._queueObject(n,new Gt(t))},cx(n){return this._queueNumber("cx",n)},cy(n){return this._queueNumber("cy",n)},move(n,t){return this.x(n).y(t)},center(n,t){return this.cx(n).cy(t)},size(n,t){let e;return(!n||!t)&&(e=this._element.bbox()),n||(n=e.width/e.height*t),t||(t=e.height/e.width*n),this.width(n).height(t)},width(n){return this._queueNumber("width",n)},height(n){return this._queueNumber("height",n)},plot(n,t,e,i){if(arguments.length===4)return this.plot([n,t,e,i]);if(this._tryRetarget("plot",n))return this;const r=new Nr(this._stepper).type(this._element.MorphArray).to(n);return this.queue(function(){r.from(this._element.array())},function(a){return this._element.plot(r.at(a)),r.done()}),this._rememberMorpher("plot",r),this},leading(n){return this._queueNumber("leading",n)},viewbox(n,t,e,i){return this._queueObject("viewbox",new ai(n,t,e,i))},update(n){return typeof n!="object"?this.update({offset:arguments[0],color:arguments[1],opacity:arguments[2]}):(n.opacity!=null&&this.attr("stop-opacity",n.opacity),n.color!=null&&this.attr("stop-color",n.color),n.offset!=null&&this.attr("offset",n.offset),this)}});$t(Ii,{rx:Md,ry:Td,from:e_,to:i_});re(Ii,"Runner");class Id extends Ci{constructor(t,e=t){super(Ce("svg",t),e),this.namespace()}defs(){return this.isRoot()?zi(this.node.querySelector("defs"))||this.put(new Ed):this.root().defs()}isRoot(){return!this.node.parentNode||!(this.node.parentNode instanceof se.window.SVGElement)&&this.node.parentNode.nodeName!=="#document-fragment"}namespace(){return this.isRoot()?this.attr({xmlns:xd,version:"1.1"}).attr("xmlns:xlink",fA,cl).attr("xmlns:svgjs",VI,cl):this.root().namespace()}removeNamespace(){return this.attr({xmlns:null,version:null}).attr("xmlns:xlink",null,cl).attr("xmlns:svgjs",null,cl)}root(){return this.isRoot()?this:super.root()}}Wt({Container:{nested:xe(function(){return this.put(new Id)})}});re(Id,"Svg",!0);let Dd=class extends Ci{constructor(t,e=t){super(Ce("symbol",t),e)}};Wt({Container:{symbol:xe(function(){return this.put(new Dd)})}});re(Dd,"Symbol");function b2(n){return this._build===!1&&this.clear(),this.node.appendChild(se.document.createTextNode(n)),this}function B2(){return this.node.getComputedTextLength()}function S2(n,t=this.bbox()){return n==null?t.x:this.attr("x",this.attr("x")+n-t.x)}function E2(n,t=this.bbox()){return n==null?t.y:this.attr("y",this.attr("y")+n-t.y)}function M2(n,t,e=this.bbox()){return this.x(n,e).y(t,e)}function T2(n,t=this.bbox()){return n==null?t.cx:this.attr("x",this.attr("x")+n-t.cx)}function F2(n,t=this.bbox()){return n==null?t.cy:this.attr("y",this.attr("y")+n-t.cy)}function U2(n,t,e=this.bbox()){return this.cx(n,e).cy(t,e)}function L2(n){return this.attr("x",n)}function I2(n){return this.attr("y",n)}function D2(n,t){return this.ax(n).ay(t)}function P2(n){return this._build=!!n,this}var A_={__proto__:null,plain:b2,length:B2,x:S2,y:E2,move:M2,cx:T2,cy:F2,center:U2,ax:L2,ay:I2,amove:D2,build:P2};class on extends Ri{constructor(t,e=t){super(Ce("text",t),e),this.dom.leading=new Gt(1.3),this._rebuild=!0,this._build=!1}leading(t){return t==null?this.dom.leading:(this.dom.leading=new Gt(t),this.rebuild())}rebuild(t){if(typeof t=="boolean"&&(this._rebuild=t),this._rebuild){const e=this;let i=0;const r=this.dom.leading;this.each(function(a){const f=se.window.getComputedStyle(this.node).getPropertyValue("font-size"),o=r*new Gt(f);this.dom.newLined&&(this.attr("x",e.attr("x")),this.text()===`
`?i+=o:(this.attr("dy",a?o+i:0),i=0))}),this.fire("rebuild")}return this}setData(t){return this.dom=t,this.dom.leading=new Gt(t.leading||1.3),this}text(t){if(t===void 0){const e=this.node.childNodes;let i=0;t="";for(let r=0,a=e.length;r<a;++r){if(e[r].nodeName==="textPath"){r===0&&(i=1);continue}r!==i&&e[r].nodeType!==3&&zi(e[r]).dom.newLined===!0&&(t+=`
`),t+=e[r].textContent}return t}if(this.clear().build(!0),typeof t=="function")t.call(this,this);else{t=(t+"").split(`
`);for(let e=0,i=t.length;e<i;e++)this.newLine(t[e])}return this.build(!1).rebuild()}}$t(on,A_);Wt({Container:{text:xe(function(n=""){return this.put(new on).text(n)}),plain:xe(function(n=""){return this.put(new on).plain(n)})}});re(on,"Text");class Vc extends Ri{constructor(t,e=t){super(Ce("tspan",t),e),this._build=!1}dx(t){return this.attr("dx",t)}dy(t){return this.attr("dy",t)}newLine(){this.dom.newLined=!0;const t=this.parent();if(!(t instanceof on))return this;const e=t.index(this),i=se.window.getComputedStyle(this.node).getPropertyValue("font-size"),r=t.dom.leading*new Gt(i);return this.dy(e?r:0).attr("x",t.x())}text(t){return t==null?this.node.textContent+(this.dom.newLined?`
`:""):(typeof t=="function"?(this.clear().build(!0),t.call(this,this),this.build(!1)):this.plain(t),this)}}$t(Vc,A_);Wt({Tspan:{tspan:xe(function(n=""){const t=new Vc;return this._build||this.clear(),this.put(t).text(n)})},Text:{newLine:function(n=""){return this.tspan(n).newLine()}}});re(Vc,"Tspan");class wA extends Ri{constructor(t,e=t){super(Ce("circle",t),e)}radius(t){return this.attr("r",t)}rx(t){return this.attr("r",t)}ry(t){return this.rx(t)}size(t){return this.radius(new Gt(t).divide(2))}}$t(wA,{x:jw,y:Yw,cx:qw,cy:$w,width:Jw,height:Zw});Wt({Container:{circle:xe(function(n=0){return this.put(new wA).size(n).move(0,0)})}});re(wA,"Circle");class vf extends Ci{constructor(t,e=t){super(Ce("clipPath",t),e)}remove(){return this.targets().forEach(function(t){t.unclip()}),super.remove()}targets(){return Ga('svg [clip-path*="'+this.id()+'"]')}}Wt({Container:{clip:xe(function(){return this.defs().put(new vf)})},Element:{clipper(){return this.reference("clip-path")},clipWith(n){const t=n instanceof vf?n:this.parent().clip().add(n);return this.attr("clip-path",'url("#'+t.id()+'")')},unclip(){return this.attr("clip-path",null)}}});re(vf,"ClipPath");class l_ extends Bn{constructor(t,e=t){super(Ce("foreignObject",t),e)}}Wt({Container:{foreignObject:xe(function(n,t){return this.put(new l_).size(n,t)})}});re(l_,"ForeignObject");function O2(n,t){return this.children().forEach((e,i)=>{let r;try{r=e.bbox()}catch{return}const a=new kt(e),f=a.translate(n,t).transform(a.inverse()),o=new Pe(r.x,r.y).transform(f);e.move(o.x,o.y)}),this}function Q2(n){return this.dmove(n,0)}function R2(n){return this.dmove(0,n)}function H2(n,t=this.bbox()){return n==null?t.height:this.size(t.width,n,t)}function k2(n=0,t=0,e=this.bbox()){const i=n-e.x,r=t-e.y;return this.dmove(i,r)}function N2(n,t,e=this.bbox()){const i=za(this,n,t,e),r=i.width/e.width,a=i.height/e.height;return this.children().forEach((f,o)=>{const s=new Pe(e).transform(new kt(f).inverse());f.scale(r,a,s.x,s.y)}),this}function V2(n,t=this.bbox()){return n==null?t.width:this.size(n,t.height,t)}function z2(n,t=this.bbox()){return n==null?t.x:this.move(n,t.y,t)}function G2(n,t=this.bbox()){return n==null?t.y:this.move(t.x,n,t)}var c_={__proto__:null,dmove:O2,dx:Q2,dy:R2,height:H2,move:k2,size:N2,width:V2,x:z2,y:G2};class Pd extends Ci{constructor(t,e=t){super(Ce("g",t),e)}}$t(Pd,c_);Wt({Container:{group:xe(function(){return this.put(new Pd)})}});re(Pd,"G");let lc=class extends Ci{constructor(t,e=t){super(Ce("a",t),e)}target(t){return this.attr("target",t)}to(t){return this.attr("href",t,fA)}};$t(lc,c_);Wt({Container:{link:xe(function(n){return this.put(new lc).to(n)})},Element:{unlink(){const n=this.linker();if(!n)return this;const t=n.parent();if(!t)return this.remove();const e=t.index(n);return t.add(this,e),n.remove(),this},linkTo(n){let t=this.linker();return t||(t=new lc,this.wrap(t)),typeof n=="function"?n.call(t,t):t.to(n),this},linker(){const n=this.parent();return n&&n.node.nodeName.toLowerCase()==="a"?n:null}}});re(lc,"A");class wf extends Ci{constructor(t,e=t){super(Ce("mask",t),e)}remove(){return this.targets().forEach(function(t){t.unmask()}),super.remove()}targets(){return Ga('svg [mask*="'+this.id()+'"]')}}Wt({Container:{mask:xe(function(){return this.defs().put(new wf)})},Element:{masker(){return this.reference("mask")},maskWith(n){const t=n instanceof wf?n:this.parent().mask().add(n);return this.attr("mask",'url("#'+t.id()+'")')},unmask(){return this.attr("mask",null)}}});re(wf,"Mask");class h_ extends Bn{constructor(t,e=t){super(Ce("stop",t),e)}update(t){return(typeof t=="number"||t instanceof Gt)&&(t={offset:arguments[0],color:arguments[1],opacity:arguments[2]}),t.opacity!=null&&this.attr("stop-opacity",t.opacity),t.color!=null&&this.attr("stop-color",t.color),t.offset!=null&&this.attr("offset",new Gt(t.offset)),this}}Wt({Gradient:{stop:function(n,t,e){return this.put(new h_).update(n,t,e)}}});re(h_,"Stop");function W2(n,t){if(!n)return"";if(!t)return n;let e=n+"{";for(const i in t)e+=kI(i)+":"+t[i]+";";return e+="}",e}class _f extends Bn{constructor(t,e=t){super(Ce("style",t),e)}addText(t=""){return this.node.textContent+=t,this}font(t,e,i={}){return this.rule("@font-face",{fontFamily:t,src:e,...i})}rule(t,e){return this.addText(W2(t,e))}}Wt("Dom",{style(n,t){return this.put(new _f).rule(n,t)},fontface(n,t,e){return this.put(new _f).font(n,t,e)}});re(_f,"Style");class Od extends on{constructor(t,e=t){super(Ce("textPath",t),e)}array(){const t=this.track();return t?t.array():null}plot(t){const e=this.track();let i=null;return e&&(i=e.plot(t)),t==null?i:this}track(){return this.reference("href")}}Wt({Container:{textPath:xe(function(n,t){return n instanceof on||(n=this.text(n)),n.path(t)})},Text:{path:xe(function(n,t=!0){const e=new Od;n instanceof Wa||(n=this.defs().path(n)),e.attr("href","#"+n,fA);let i;if(t)for(;i=this.node.firstChild;)e.node.appendChild(i);return this.put(e)}),textPath(){return this.findOne("textPath")}},Path:{text:xe(function(n){return n instanceof on||(n=new on().addTo(this.parent()).text(n)),n.path(this)}),targets(){return Ga("svg textPath").filter(n=>(n.attr("href")||"").includes(this.id()))}}});Od.prototype.MorphArray=fs;re(Od,"TextPath");class u_ extends Ri{constructor(t,e=t){super(Ce("use",t),e)}use(t,e){return this.attr("href",(e||"")+"#"+t,fA)}}Wt({Container:{use:xe(function(n,t){return this.put(new u_).use(n,t)})}});re(u_,"Use");const f_=fi;$t([Id,Dd,kc,$o,ac],xi("viewbox"));$t([An,vA,mA,Wa],xi("marker"));$t(on,xi("Text"));$t(Wa,xi("Path"));$t(Ed,xi("Defs"));$t([on,Vc],xi("Tspan"));$t([Nc,Hc,pA,Ii],xi("radius"));$t(dA,xi("EventTarget"));$t(br,xi("Dom"));$t(Bn,xi("Element"));$t(Ri,xi("Shape"));$t([Ci,t_],xi("Container"));$t(pA,xi("Gradient"));$t(Ii,xi("Runner"));us.extend(RI());u2([Gt,he,ai,kt,La,Br,fs,Pe]);f2();function Lm(n,t,e,i,r){let a=n.clone().project(e);t.x=(a.x+1)/2*i,t.y=-(a.y-1)/2*r}class K2{constructor(t){x(this,"polygon");this.polygon=t.polygon("0,0 100,50 50,100").fill({color:"orange",opacity:.5}).stroke({width:1,color:"white"}),this.hide()}show(){this.polygon.show()}hide(){this.polygon.hide()}plot(t){this.polygon.plot(t)}}class X2{constructor(t){x(this,"edgeGroup");x(this,"edgeBgSymbol");x(this,"edgeSymbol");document.body.style.borderColor="red",this.edgeGroup=t.group(),this.edgeBgSymbol=this.edgeGroup.line(0,0,100,150).stroke({color:"white",width:4,linecap:"round"}),this.edgeBgSymbol.hide(),this.edgeSymbol=this.edgeGroup.line(0,0,100,150).stroke({color:"orange",width:2,linecap:"round"}),this.edgeSymbol.hide()}show(){this.edgeBgSymbol.show(),this.edgeSymbol.show()}hide(){this.edgeBgSymbol.hide(),this.edgeSymbol.hide()}plot(t){this.edgeBgSymbol.plot(t),this.edgeSymbol.plot(t)}}class j2{constructor(t){x(this,"group");let e=t.group();e.polygon([[0,0],[10,0],[5,-8.66],[0,0],[10,0]]).fill("none").stroke({color:"white",width:4}),e.polygon([[0,0],[10,0],[5,-8.66],[0,0],[10,0]]).fill("none").stroke({color:"orange",width:2}),this.group=e,this.hide()}show(){this.group.show()}hide(){this.group.hide()}center(t,e){this.group.center(t,e)}}class Y2{constructor(t){x(this,"_enabled",!1);x(this,"raycaster",new uA);x(this,"vp");x(this,"vertexSymbol");x(this,"edgeSymbol");x(this,"faceSymbol");x(this,"midPointSymbol");x(this,"enableStatusChanged");x(this,"snapVertex",!0);x(this,"snapEdgeMiddlePoint",!0);x(this,"snapEdgeNearestPoint",!0);x(this,"snapFace",!0);x(this,"vpClicked",t=>{var e,i,r,a;this._snapped&&((i=(e=t.intersect)==null?void 0:e.point)==null||i.copy(this._pointSnapped),(r=t.intersectPoint)==null||r.copy(this._pointSnapped)),console.log("intersect pt",(a=t.intersect)==null?void 0:a.point)});x(this,"onPointerMove",async t=>{this.enabled&&(this.vp.changing?this.hideAllSymbol():this.detect(t))});x(this,"onWheel",()=>{this.hideAllSymbol()});x(this,"vertexScreenPos",new xt);x(this,"_snapThresholdOnScreen",30);x(this,"_snapThresholdeOnScreenSquare",900);x(this,"v1",new H);x(this,"v2",new H);x(this,"v3",new H);x(this,"v1_scr",new xt);x(this,"v2_scr",new xt);x(this,"v3_scr",new xt);x(this,"intersectPoint_scr",new xt);x(this,"_edgeLine",new vm);x(this,"_edgeLineOri",new vm);x(this,"mouse",new xt);x(this,"detecting",!1);x(this,"_edgeCenter",new H);x(this,"_edgeCenter_scr",new xt);x(this,"_edgeClosestPoint",new H);x(this,"_edgeClosestPoint_scr",new xt);x(this,"_edgeStart_scr",new xt);x(this,"_edgeEnd_scr",new xt);x(this,"_pointSnapped",new H);x(this,"_snapped",!1);x(this,"_testPoint",new H);x(this,"visibleCheckEps",.001);x(this,"visibleCheckEnabled",!0);x(this,"_cornerA",new H);x(this,"_cornerB",new H);x(this,"_cornerC",new H);x(this,"_cornerD",new H);x(this,"_cornerA_scr",new xt);x(this,"_cornerB_scr",new xt);x(this,"_cornerC_scr",new xt);x(this,"_cornerD_scr",new xt);x(this,"_xdir",new H(1,0,0));x(this,"_ydir",new H(0,1,0));x(this,"_zdir",new H(0,0,1));x(this,"_udir",new H);x(this,"_vdir",new H);x(this,"_faceNormal",new H);x(this,"_faceEdge1",new H);x(this,"_faceEdge2",new H);this.vp=t,this.init(),this.enableStatusChanged=new Ot}init(){let t=this.vp;this.raycaster.near=0,this.raycaster.far=200;let e=document.createElement("div");e.id="snaplayer",e.style.position="absolute",e.style.left="0",e.style.right="0",e.style.bottom="0",e.style.top="0",e.style.pointerEvents="none",t.container.appendChild(e);let i=f_().addTo(e).size("100%","100%"),r=i.group();{var a=r.rect(10,10);a.fill("none"),a.stroke({color:"white",width:4})}{var a=r.rect(10,10);a.fill("none"),a.stroke({color:"orange",width:2})}r.hide(),this.vertexSymbol=r,this.edgeSymbol=new X2(i),this.faceSymbol=new K2(i),this.midPointSymbol=new j2(i),t.modelClickedEvent.add(this.vpClicked),this.enabled=!1}get enabled(){return this._enabled}set enabled(t){t!=this._enabled&&(t?this.attatch():(this.hideAllSymbol(),this.detach()),this._enabled=t,this.enableStatusChanged.dispatch(t))}attatch(){let t=this.vp;t.container.addEventListener("pointermove",this.onPointerMove),t.container.addEventListener("wheel",this.onWheel)}detach(){let t=this.vp;t.container.removeEventListener("pointermove",this.onPointerMove),t.container.removeEventListener("wheel",this.onWheel)}hideAllSymbol(){this.vertexSymbol.hide(),this.edgeSymbol.hide(),this.faceSymbol.hide(),this.midPointSymbol.hide()}showVertexSymbol(t){Lm(t,this.vertexScreenPos,this.vp.camera,this.vp.screenWidth,this.vp.screenHeight),this.showVertexSymbolOnScreen(this.vertexScreenPos)}showVertexSymbolOnScreen(t){this.vertexSymbol.center(t.x,t.y),this.vertexSymbol.show()}showMidPointSymbolOnScreen(t){this.midPointSymbol.center(t.x,t.y),this.midPointSymbol.show()}showEdgeSymbolOnScreen(t,e){this.edgeSymbol.plot([[t.x,t.y],[e.x,e.y]]),this.edgeSymbol.show()}showFaceSymbolOnScreen(){this.faceSymbol.plot([[this._cornerA_scr.x,this._cornerA_scr.y],[this._cornerB_scr.x,this._cornerB_scr.y],[this._cornerC_scr.x,this._cornerC_scr.y],[this._cornerD_scr.x,this._cornerD_scr.y]]),this.faceSymbol.show()}get snapThresholdOnScreen(){return this._snapThresholdOnScreen}set snapThresholdOnScreen(t){if(t<0)throw"invalid snapThresholdOnScreen value";this._snapThresholdOnScreen=t,this._snapThresholdeOnScreenSquare=t*t}get edgeSnapped(){return this._snapped?this._edgeLine:null}toScreenPosition(t,e){Lm(t,e,this.vp.camera,this.vp.screenWidth,this.vp.screenHeight)}get pointSnapped(){return this._snapped?this._pointSnapped:null}_isVertexFromEdge(t,e){if(e&&e.children){for(let i of e.children)if(i.isLine){let r=i.geometry.getAttribute("position");for(let a=0;a<r.count;a++)if(this._testPoint.fromBufferAttribute(r,a),e.localToWorld(this._testPoint),t.equals(this._testPoint))return!0}}return!1}isPointVisibleIfClipping(t){return this.vp.clippingHelper&&this.vp.clippingHelper.enabled?this.vp.clippingHelper.isPointInClippingBox(t):!0}visibleCheckOk(t){return this.visibleCheckEnabled?this.vp.isPointVisible(t,this.visibleCheckEps):!0}async detect(t){if(this._snapped=!1,this.detecting){console.log("reenter blocked");return}this.detecting=!0,this.mouse.x=t.offsetX/this.vp.screenWidth*2-1,this.mouse.y=-(t.offsetY/this.vp.screenHeight)*2+1,this.hideAllSymbol(),this.raycaster.setFromCamera(this.mouse,this.vp.camera);const e=this.raycaster.intersectObject(this.vp.rootGroup,!0);let i;if(e&&e.length>0)for(let r of e){const a=r.object;if(a.isMesh&&a.visible&&this.isPointVisibleIfClipping(r.point)){i=r;break}}if(i){let r=i.object,a=r.geometry.attributes.position;this.v1.fromBufferAttribute(a,i.face.a),r.localToWorld(this.v1),this.v2.fromBufferAttribute(a,i.face.b),r.localToWorld(this.v2),this.v3.fromBufferAttribute(a,i.face.c),r.localToWorld(this.v3),this._faceEdge1.subVectors(this.v2,this.v1),this._faceEdge2.subVectors(this.v3,this.v2),this._faceNormal.crossVectors(this._faceEdge1,this._faceEdge2);let f=i.point;this.toScreenPosition(f,this.intersectPoint_scr),this.toScreenPosition(this.v1,this.v1_scr),this.toScreenPosition(this.v2,this.v2_scr),this.toScreenPosition(this.v3,this.v3_scr);let o=this.intersectPoint_scr.distanceToSquared(this.v1_scr),s=this.intersectPoint_scr.distanceToSquared(this.v2_scr),l=this.intersectPoint_scr.distanceToSquared(this.v3_scr),u=this.v1,A=this.v1_scr,c=o;if(o>s&&(u=this.v2,A=this.v2_scr,c=s),l<c&&(u=this.v3,A=this.v3_scr,c=l),c<this._snapThresholdeOnScreenSquare&&this._isVertexFromEdge(u,r)&&this.visibleCheckOk(u)&&(this.showVertexSymbolOnScreen(A),this._pointSnapped.copy(u),this._snapped=!0),!this._snapped){let h,p=0,m=!1,d=!1;for(h of r.children){if(h.isLine){let g=h.geometry.getAttribute("position");for(let v=0;v<g.count&&p!=2;v+=2){this._edgeLine.start.fromBufferAttribute(g,v),this._edgeLine.end.fromBufferAttribute(g,v+1),h.localToWorld(this._edgeLine.start),h.localToWorld(this._edgeLine.end);let w=!0;if(this._edgeLineOri.copy(this._edgeLine),this.vp.clippingHelper&&this.vp.clippingHelper.enabled&&(this.vp.clippingHelper.intersectLine(this._edgeLine)||(w=!1)),w){this._edgeLine.getCenter(this._edgeCenter);let _=this._edgeLineOri.start,y=this._edgeLineOri.end;if(this.toScreenPosition(this._edgeCenter,this._edgeCenter_scr),this._edgeCenter_scr.distanceToSquared(this.intersectPoint_scr)<this._snapThresholdeOnScreenSquare){d=!0;break}let b=!1;if((_.equals(this.v1)||_.equals(this.v2)||_.equals(this.v3))&&(y.equals(this.v1)||y.equals(this.v2)||y.equals(this.v3))&&(b=!0,p++),b&&(this._edgeLine.closestPointToPoint(f,!0,this._edgeClosestPoint),this.toScreenPosition(this._edgeClosestPoint,this._edgeClosestPoint_scr),this._edgeClosestPoint_scr.distanceToSquared(this.intersectPoint_scr)<this._snapThresholdeOnScreenSquare)){m=!0;break}}}}if(m||d)break}m?(this.toScreenPosition(this._edgeLine.start,this._edgeStart_scr),this.toScreenPosition(this._edgeLine.end,this._edgeEnd_scr),(this.visibleCheckOk(this._edgeLine.start)||this.visibleCheckOk(this._edgeLine.end))&&(this.showEdgeSymbolOnScreen(this._edgeStart_scr,this._edgeEnd_scr),this._snapped=!0,this._pointSnapped.copy(this._edgeClosestPoint))):d&&this.visibleCheckOk(this._edgeCenter)&&(this.showMidPointSymbolOnScreen(this._edgeCenter_scr),this._snapped=!0,this._pointSnapped.copy(this._edgeCenter))}if(!this._snapped){let h=this._faceNormal;i.distance;let p=this.vp.controls.cameraDistance/200/this.vp.camera.zoom;if(h){let m=Math.abs(h.x),d=Math.abs(h.y),g=Math.abs(h.z),v="x",w=m;d<w&&(v="y",w=d),g<w&&(v="z"),v=="x"?this._udir.set(1,0,0):v=="y"?this._udir.set(0,1,0):this._udir.set(0,0,1),this._udir.projectOnPlane(h),this._vdir.crossVectors(this._udir,h),this._udir.setLength(p),this._vdir.setLength(p),this._cornerA.addVectors(f,this._udir),this._cornerA.add(this._vdir),this._cornerB.addVectors(f,this._udir),this._cornerB.sub(this._vdir),this._cornerC.subVectors(f,this._udir),this._cornerC.sub(this._vdir),this._cornerD.subVectors(f,this._udir),this._cornerD.add(this._vdir),this.toScreenPosition(this._cornerA,this._cornerA_scr),this.toScreenPosition(this._cornerB,this._cornerB_scr),this.toScreenPosition(this._cornerC,this._cornerC_scr),this.toScreenPosition(this._cornerD,this._cornerD_scr),this.showFaceSymbolOnScreen()}}}this.detecting=!1}}function Qd(n){let t=new q2,e=new Z2,i=n.controls;t.target=[i.target.x,i.target.y,i.target.z],t.targetEuler=[i.targetEuler.x,i.targetEuler.y,i.targetEuler.z],t.targetQ=[i.targetQ.x,i.targetQ.y,i.targetQ.z,i.targetQ.w],t.cameraDistance=i.cameraDistance,t.position=[i.holder.position.x,i.holder.position.y,i.holder.position.z],t.q=[i.holder.quaternion.x,i.holder.quaternion.y,i.holder.quaternion.z,i.holder.quaternion.w];let r=[];for(let s of i.holder.matrixWorld.elements)r.push(s);if(t.matrixWorld=r,e.controls=t,e.selectedObjectNames=n.selectedObjects.map(s=>s.name),n.clippingHelper){let s=new $2,l=n.clippingHelper;s.planes=[l.xmin,l.ymin,l.zmin,l.xmax,l.ymax,l.zmax],s.enabled=n.clippingHelper.enabled,s.clipBoxEnabled=n.clippingHelper.clippingBoxEnabled,e.clipping=s}e.camera=new J2,e.camera.cameraType=n.camera==n.perspectiveCamera?"p":"o",e.camera.zoom=n.camera.zoom,e.isolated=n.isolated;let a=new tP,f=[];function o(s){if(!s.visible){f.push(s.name);return}if(s.children)for(let l of s.children)o(l)}for(let s of n.rootGroup.children)o(s);return a.invisibleObjectNames=f,e.selection=a,e}function Rd(n,t){if(t.selectedObjectNames){let e=[];for(let i of t.selectedObjectNames){let r=n.rootGroup.getObjectByName(i);r&&e.push(r)}n.selectModels(...e)}if(t.clipping&&n.clippingHelper){let e=t.clipping.planes,i=n.clippingHelper;i.enabled=t.clipping.enabled,i.enabled&&e&&(i.setClipBox(e[0],e[1],e[2],e[3],e[4],e[5]),i.clippingBoxEnabled=t.clipping.clipBoxEnabled)}if(t.camera&&(n.camera=t.camera.cameraType=="p"?n.perspectiveCamera:n.orthographicCamera,n.camera.zoom=t.camera.zoom,n.camera.updateProjectionMatrix()),t.controls){let e=t.controls,i=e.targetEuler;e.targetQ,n.controls.target=new H(e.target[0],e.target[1],e.target[2]),n.controls.targetEuler=new Cr(i[0],i[1],i[2]),n.controls.holder.updateMatrix(),n.controls.holder.updateMatrixWorld(!0),n.controls.targetCameraDistance=e.cameraDistance}if(t.selection){for(let e of n.rootGroup.children)n.ensureObjectVisible(e,!0,!0);for(let e of t.selection.invisibleObjectNames){let i=n.rootGroup.getObjectByName(e);i&&n.ensureObjectVisible(i,!1,!0)}}n.isolated=t.isolated,n.render()}class q2{constructor(){x(this,"target");x(this,"targetEuler");x(this,"targetQ");x(this,"cameraDistance");x(this,"matrixWorld");x(this,"position");x(this,"q")}}class $2{constructor(){x(this,"enabled",!1);x(this,"planes");x(this,"clipBoxEnabled",!1)}}class J2{constructor(){x(this,"cameraType");x(this,"zoom")}}class Z2{constructor(){x(this,"controls");x(this,"selectedObjectNames");x(this,"clipping");x(this,"isolated",!1);x(this,"camera");x(this,"selection")}}class tP{constructor(){x(this,"invisibleObjectNames",[])}}const Qr=new uA,gi=new H,rr=new H,Be=new De,Im={X:new H(1,0,0),Y:new H(0,1,0),Z:new H(0,0,1)},hu={type:"change"},Dm={type:"mouseDown"},Pm={type:"mouseUp",mode:null},Om={type:"objectChange"};class eP extends ce{constructor(t,e,i=!1){super(),e===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),e=document),this.reverse=i,this.isTransformControls=!0,this.visible=!1,this.domElement=e,this.domElement.style.touchAction="none";const r=new oP(i);this._gizmo=r,this.add(r);const a=new AP;this._plane=a,this.add(a);const f=this;function o(w,_){let y=_;Object.defineProperty(f,w,{get:function(){return y!==void 0?y:_},set:function(C){y!==C&&(y=C,a[w]=C,r[w]=C,f.dispatchEvent({type:w+"-changed",value:C}),f.dispatchEvent(hu))}}),f[w]=_,a[w]=_,r[w]=_}o("camera",t),o("object",void 0),o("enabled",!0),o("axis",null),o("mode","translate"),o("translationSnap",null),o("rotationSnap",null),o("scaleSnap",null),o("space","world"),o("size",1),o("dragging",!1),o("showX",!0),o("showY",!0),o("showZ",!0);const s=new H,l=new H,u=new De,A=new De,c=new H,h=new De,p=new H,m=new H,d=new H,g=0,v=new H;o("worldPosition",s),o("worldPositionStart",l),o("worldQuaternion",u),o("worldQuaternionStart",A),o("cameraPosition",c),o("cameraQuaternion",h),o("pointStart",p),o("pointEnd",m),o("rotationAxis",d),o("rotationAngle",g),o("eye",v),this._offset=new H,this._startNorm=new H,this._endNorm=new H,this._cameraScale=new H,this._parentPosition=new H,this._parentQuaternion=new De,this._parentQuaternionInv=new De,this._parentScale=new H,this._worldScaleStart=new H,this._worldQuaternionInv=new De,this._worldScale=new H,this._positionStart=new H,this._quaternionStart=new De,this._scaleStart=new H,this._getPointer=iP.bind(this),this._onPointerDown=rP.bind(this),this._onPointerHover=nP.bind(this),this._onPointerMove=sP.bind(this),this._onPointerUp=aP.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(t){if(this.object===void 0||this.dragging===!0)return;Qr.setFromCamera(t,this.camera);const e=uu(this._gizmo.picker[this.mode],Qr);e?this.axis=e.object.name:this.axis=null}pointerDown(t){if(!(this.object===void 0||this.dragging===!0||t.button!==0)&&this.axis!==null){Qr.setFromCamera(t,this.camera);const e=uu(this._plane,Qr,!0);e&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(e.point).sub(this.worldPositionStart)),this.dragging=!0,Dm.mode=this.mode,this.dispatchEvent(Dm)}}pointerMove(t){const e=this.axis,i=this.mode,r=this.object;let a=this.space;if(i==="scale"?a="local":(e==="E"||e==="XYZE"||e==="XYZ")&&(a="world"),r===void 0||e===null||this.dragging===!1||t.button!==-1)return;Qr.setFromCamera(t,this.camera);const f=uu(this._plane,Qr,!0);if(f){if(this.pointEnd.copy(f.point).sub(this.worldPositionStart),i==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),a==="local"&&e!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),e.indexOf("X")===-1&&(this._offset.x=0),e.indexOf("Y")===-1&&(this._offset.y=0),e.indexOf("Z")===-1&&(this._offset.z=0),a==="local"&&e!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),r.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(a==="local"&&(r.position.applyQuaternion(Be.copy(this._quaternionStart).invert()),e.search("X")!==-1&&(r.position.x=Math.round(r.position.x/this.translationSnap)*this.translationSnap),e.search("Y")!==-1&&(r.position.y=Math.round(r.position.y/this.translationSnap)*this.translationSnap),e.search("Z")!==-1&&(r.position.z=Math.round(r.position.z/this.translationSnap)*this.translationSnap),r.position.applyQuaternion(this._quaternionStart)),a==="world"&&(r.parent&&r.position.add(gi.setFromMatrixPosition(r.parent.matrixWorld)),e.search("X")!==-1&&(r.position.x=Math.round(r.position.x/this.translationSnap)*this.translationSnap),e.search("Y")!==-1&&(r.position.y=Math.round(r.position.y/this.translationSnap)*this.translationSnap),e.search("Z")!==-1&&(r.position.z=Math.round(r.position.z/this.translationSnap)*this.translationSnap),r.parent&&r.position.sub(gi.setFromMatrixPosition(r.parent.matrixWorld))));else if(i==="scale"){if(e.search("XYZ")!==-1){let o=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(o*=-1),rr.set(o,o,o)}else gi.copy(this.pointStart),rr.copy(this.pointEnd),gi.applyQuaternion(this._worldQuaternionInv),rr.applyQuaternion(this._worldQuaternionInv),rr.divide(gi),e.search("X")===-1&&(rr.x=1),e.search("Y")===-1&&(rr.y=1),e.search("Z")===-1&&(rr.z=1);r.scale.copy(this._scaleStart).multiply(rr),this.scaleSnap&&(e.search("X")!==-1&&(r.scale.x=Math.round(r.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),e.search("Y")!==-1&&(r.scale.y=Math.round(r.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),e.search("Z")!==-1&&(r.scale.z=Math.round(r.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(i==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const o=20/this.worldPosition.distanceTo(gi.setFromMatrixPosition(this.camera.matrixWorld));e==="E"?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1):e==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(gi.copy(this.rotationAxis).cross(this.eye))*o):(e==="X"||e==="Y"||e==="Z")&&(this.rotationAxis.copy(Im[e]),gi.copy(Im[e]),a==="local"&&gi.applyQuaternion(this.worldQuaternion),this.rotationAngle=this._offset.dot(gi.cross(this.eye).normalize())*o),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),a==="local"&&e!=="E"&&e!=="XYZE"?(r.quaternion.copy(this._quaternionStart),r.quaternion.multiply(Be.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),r.quaternion.copy(Be.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),r.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(hu),this.dispatchEvent(Om)}}pointerUp(t){t.button===0&&(this.dragging&&this.axis!==null&&(Pm.mode=this.mode,this.dispatchEvent(Pm)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(t){t.geometry&&t.geometry.dispose(),t.material&&t.material.dispose()})}attach(t){return this.object=t,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(hu),this.dispatchEvent(Om),this.pointStart.copy(this.pointEnd))}getRaycaster(){return Qr}getMode(){return this.mode}setMode(t){this.mode=t}setTranslationSnap(t){this.translationSnap=t}setRotationSnap(t){this.rotationSnap=t}setScaleSnap(t){this.scaleSnap=t}setSize(t){this.size=t}setSpace(t){this.space=t}}function iP(n){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:n.button};{const t=this.domElement.getBoundingClientRect();return{x:(n.clientX-t.left)/t.width*2-1,y:-(n.clientY-t.top)/t.height*2+1,button:n.button}}}function nP(n){if(this.enabled)switch(n.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(n));break}}function rP(n){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(n.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(n)),this.pointerDown(this._getPointer(n)))}function sP(n){this.enabled&&this.pointerMove(this._getPointer(n))}function aP(n){this.enabled&&(this.domElement.releasePointerCapture(n.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(n)))}function uu(n,t,e){const i=t.intersectObject(n,!0);for(let r=0;r<i.length;r++)if(i[r].object.visible||e)return i[r];return!1}const hl=new Cr,ve=new H(0,1,0),Qm=new H(0,0,0),Rm=new Kt,ul=new De,Xl=new De,fn=new H,Hm=new Kt,xo=new H(1,0,0),Vr=new H(0,1,0),Co=new H(0,0,1),fl=new H,lo=new H,co=new H;class oP extends ce{constructor(t=!1){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new rc({depthTest:!0,depthWrite:!0,fog:!1,toneMapped:!1,transparent:!1}),i=new lA({depthTest:!0,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),r=e.clone();r.opacity=.15;const a=i.clone();a.opacity=.5;const f=e.clone();f.color.setHex(16711748);const o=e.clone();o.color.setHex(65349);const s=e.clone();s.color.setHex(22783);const l=e.clone();l.color.setHex(16711680),l.opacity=.5;const u=e.clone();u.color.setHex(65280),u.opacity=.5;const A=e.clone();A.color.setHex(255),A.opacity=.5;const c=e.clone();c.opacity=.25;const h=e.clone();h.color.setHex(16776960),h.opacity=.25,e.clone().color.setHex(16776960);const m=e.clone();m.color.setHex(7895160);const d=new qe(0,.06,.15,12);d.translate(0,.05,0);const g=new Te(.08,.08,.08);g.translate(0,.04,0);const v=new ke;v.setAttribute("position",new Se([0,0,0,1,0,0],3));const w=new qe(.0175,.0175,.5,6);w.translate(0,.25,0);function _(K,tt){const j=new Wr(K,.0075,3,64,tt*Math.PI*2);return j.rotateY(Math.PI/2),j.rotateX(Math.PI/2),j}function y(){const K=new ke;return K.setAttribute("position",new Se([0,0,0,1,1,1],3)),K}const C={XYZ:[[new yt(new sa(.1,0),c.clone()),[0,0,0]]],XY:[[new yt(new Te(.15,.15,.01),A.clone()),[.15,.15,0]]],YZ:[[new yt(new Te(.15,.15,.01),l.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new yt(new Te(.15,.15,.01),u.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]};t?(C.X=[[new yt(d,f),[-.5,0,0],[0,0,Math.PI/2]],[new yt(w,f),[0,0,0],[0,0,Math.PI/2]]],C.Y=[[new yt(d,o),[0,-.5,0],[Math.PI,0,0]],[new yt(w,o),null,[0,0,Math.PI]]],C.Z=[[new yt(d,s),[0,0,-.5],[-Math.PI/2,0,0]],[new yt(w,s),null,[-Math.PI/2,0,0]]]):(C.X=[[new yt(d,f),[.5,0,0],[0,0,-Math.PI/2]],[new yt(w,f),[0,0,0],[0,0,-Math.PI/2]]],C.Y=[[new yt(d,o),[0,.5,0]],[new yt(w,o)]],C.Z=[[new yt(d,s),[0,0,.5],[Math.PI/2,0,0]],[new yt(w,s),null,[Math.PI/2,0,0]]]);const b={X:[[new yt(new qe(.2,0,.6,4),r),[.3,0,0],[0,0,-Math.PI/2]],[new yt(new qe(.2,0,.6,4),r),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new yt(new qe(.2,0,.6,4),r),[0,.3,0]],[new yt(new qe(.2,0,.6,4),r),[0,-.3,0],[0,0,Math.PI]]],Z:[[new yt(new qe(.2,0,.6,4),r),[0,0,.3],[Math.PI/2,0,0]],[new yt(new qe(.2,0,.6,4),r),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new yt(new sa(.2,0),r)]],XY:[[new yt(new Te(.2,.2,.01),r),[.15,.15,0]]],YZ:[[new yt(new Te(.2,.2,.01),r),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new yt(new Te(.2,.2,.01),r),[.15,0,.15],[-Math.PI/2,0,0]]]},S={START:[[new yt(new sa(.01,2),a),null,null,null,"helper"]],END:[[new yt(new sa(.01,2),a),null,null,null,"helper"]],DELTA:[[new sn(y(),a),null,null,null,"helper"]],X:[[new sn(v,a.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new sn(v,a.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new sn(v,a.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},B={XYZE:[[new yt(_(.5,1),m),null,[0,Math.PI/2,0]]],X:[[new yt(_(.5,.5),f)]],Y:[[new yt(_(.5,.5),o),null,[0,0,-Math.PI/2]]],Z:[[new yt(_(.5,.5),s),null,[0,Math.PI/2,0]]],E:[[new yt(_(.75,1),h),null,[0,Math.PI/2,0]]]},M={AXIS:[[new sn(v,a.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},z={XYZE:[[new yt(new vd(.25,10,8),r)]],X:[[new yt(new Wr(.5,.1,4,24),r),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new yt(new Wr(.5,.1,4,24),r),[0,0,0],[Math.PI/2,0,0]]],Z:[[new yt(new Wr(.5,.1,4,24),r),[0,0,0],[0,0,-Math.PI/2]]],E:[[new yt(new Wr(.75,.1,2,24),r)]]},G={X:[[new yt(g,f),[.5,0,0],[0,0,-Math.PI/2]],[new yt(w,f),[0,0,0],[0,0,-Math.PI/2]],[new yt(g,f),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new yt(g,o),[0,.5,0]],[new yt(w,o)],[new yt(g,o),[0,-.5,0],[0,0,Math.PI]]],Z:[[new yt(g,s),[0,0,.5],[Math.PI/2,0,0]],[new yt(w,s),[0,0,0],[Math.PI/2,0,0]],[new yt(g,s),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new yt(new Te(.15,.15,.01),A),[.15,.15,0]]],YZ:[[new yt(new Te(.15,.15,.01),l),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new yt(new Te(.15,.15,.01),u),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new yt(new Te(.1,.1,.1),c.clone())]]},P={X:[[new yt(new qe(.2,0,.6,4),r),[.3,0,0],[0,0,-Math.PI/2]],[new yt(new qe(.2,0,.6,4),r),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new yt(new qe(.2,0,.6,4),r),[0,.3,0]],[new yt(new qe(.2,0,.6,4),r),[0,-.3,0],[0,0,Math.PI]]],Z:[[new yt(new qe(.2,0,.6,4),r),[0,0,.3],[Math.PI/2,0,0]],[new yt(new qe(.2,0,.6,4),r),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new yt(new Te(.2,.2,.01),r),[.15,.15,0]]],YZ:[[new yt(new Te(.2,.2,.01),r),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new yt(new Te(.2,.2,.01),r),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new yt(new Te(.2,.2,.2),r),[0,0,0]]]},R={X:[[new sn(v,a.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new sn(v,a.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new sn(v,a.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function W(K){const tt=new ce;for(const j in K)for(let E=K[j].length;E--;){const I=K[j][E][0].clone(),Q=K[j][E][1],D=K[j][E][2],k=K[j][E][3],U=K[j][E][4];I.name=j,I.tag=U,Q&&I.position.set(Q[0],Q[1],Q[2]),D&&I.rotation.set(D[0],D[1],D[2]),k&&I.scale.set(k[0],k[1],k[2]),I.updateMatrix();const T=I.geometry.clone();T.applyMatrix4(I.matrix),I.geometry=T,I.renderOrder=1/0,I.position.set(0,0,0),I.rotation.set(0,0,0),I.scale.set(1,1,1),tt.add(I)}return tt}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=W(C)),this.add(this.gizmo.rotate=W(B)),this.add(this.gizmo.scale=W(G)),this.add(this.picker.translate=W(b)),this.add(this.picker.rotate=W(z)),this.add(this.picker.scale=W(P)),this.add(this.helper.translate=W(S)),this.add(this.helper.rotate=W(M)),this.add(this.helper.scale=W(R)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(t){const i=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:Xl;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=!1,this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let r=[];r=r.concat(this.picker[this.mode].children),r=r.concat(this.gizmo[this.mode].children),r=r.concat(this.helper[this.mode].children);for(let a=0;a<r.length;a++){const f=r[a];f.visible=!0,f.rotation.set(0,0,0),f.position.copy(this.worldPosition);let o;if(this.camera.isOrthographicCamera?o=(this.camera.top-this.camera.bottom)/this.camera.zoom:o=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),f.scale.set(1,1,1).multiplyScalar(o*this.size/4),f.tag==="helper"){f.visible=!1,f.name==="AXIS"?(f.visible=!!this.axis,this.axis==="X"&&(Be.setFromEuler(hl.set(0,0,0)),f.quaternion.copy(i).multiply(Be),Math.abs(ve.copy(xo).applyQuaternion(i).dot(this.eye))>.9&&(f.visible=!1)),this.axis==="Y"&&(Be.setFromEuler(hl.set(0,0,Math.PI/2)),f.quaternion.copy(i).multiply(Be),Math.abs(ve.copy(Vr).applyQuaternion(i).dot(this.eye))>.9&&(f.visible=!1)),this.axis==="Z"&&(Be.setFromEuler(hl.set(0,Math.PI/2,0)),f.quaternion.copy(i).multiply(Be),Math.abs(ve.copy(Co).applyQuaternion(i).dot(this.eye))>.9&&(f.visible=!1)),this.axis==="XYZE"&&(Be.setFromEuler(hl.set(0,Math.PI/2,0)),ve.copy(this.rotationAxis),f.quaternion.setFromRotationMatrix(Rm.lookAt(Qm,ve,Vr)),f.quaternion.multiply(Be),f.visible=this.dragging),this.axis==="E"&&(f.visible=!1)):f.name==="START"?(f.position.copy(this.worldPositionStart),f.visible=this.dragging):f.name==="END"?(f.position.copy(this.worldPosition),f.visible=this.dragging):f.name==="DELTA"?(f.position.copy(this.worldPositionStart),f.quaternion.copy(this.worldQuaternionStart),gi.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),gi.applyQuaternion(this.worldQuaternionStart.clone().invert()),f.scale.copy(gi),f.visible=this.dragging):(f.quaternion.copy(i),this.dragging?f.position.copy(this.worldPositionStart):f.position.copy(this.worldPosition),this.axis&&(f.visible=this.axis.search(f.name)!==-1));continue}f.quaternion.copy(i),this.mode==="translate"||this.mode==="scale"?(f.name==="X"&&Math.abs(ve.copy(xo).applyQuaternion(i).dot(this.eye))>.99&&(f.scale.set(1e-10,1e-10,1e-10),f.visible=!1),f.name==="Y"&&Math.abs(ve.copy(Vr).applyQuaternion(i).dot(this.eye))>.99&&(f.scale.set(1e-10,1e-10,1e-10),f.visible=!1),f.name==="Z"&&Math.abs(ve.copy(Co).applyQuaternion(i).dot(this.eye))>.99&&(f.scale.set(1e-10,1e-10,1e-10),f.visible=!1),f.name==="XY"&&Math.abs(ve.copy(Co).applyQuaternion(i).dot(this.eye))<.2&&(f.scale.set(1e-10,1e-10,1e-10),f.visible=!1),f.name==="YZ"&&Math.abs(ve.copy(xo).applyQuaternion(i).dot(this.eye))<.2&&(f.scale.set(1e-10,1e-10,1e-10),f.visible=!1),f.name==="XZ"&&Math.abs(ve.copy(Vr).applyQuaternion(i).dot(this.eye))<.2&&(f.scale.set(1e-10,1e-10,1e-10),f.visible=!1)):this.mode==="rotate"&&(ul.copy(i),ve.copy(this.eye).applyQuaternion(Be.copy(i).invert()),f.name.search("E")!==-1&&f.quaternion.setFromRotationMatrix(Rm.lookAt(this.eye,Qm,Vr)),f.name==="X"&&(Be.setFromAxisAngle(xo,Math.atan2(-ve.y,ve.z)),Be.multiplyQuaternions(ul,Be),f.quaternion.copy(Be)),f.name==="Y"&&(Be.setFromAxisAngle(Vr,Math.atan2(ve.x,ve.z)),Be.multiplyQuaternions(ul,Be),f.quaternion.copy(Be)),f.name==="Z"&&(Be.setFromAxisAngle(Co,Math.atan2(ve.y,ve.x)),Be.multiplyQuaternions(ul,Be),f.quaternion.copy(Be))),f.visible=f.visible&&(f.name.indexOf("X")===-1||this.showX),f.visible=f.visible&&(f.name.indexOf("Y")===-1||this.showY),f.visible=f.visible&&(f.name.indexOf("Z")===-1||this.showZ),f.visible=f.visible&&(f.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),f.material._color=f.material._color||f.material.color.clone(),f.material._opacity=f.material._opacity||f.material.opacity,f.material.color.copy(f.material._color),f.material.opacity=f.material._opacity,this.enabled&&this.axis&&(f.name===this.axis||this.axis.split("").some(function(s){return f.name===s}))&&(f.material.color.setHex(16776960),f.material.opacity=1)}super.updateMatrixWorld(t)}}class AP extends yt{constructor(){super(new Fa(1e5,1e5,2,2),new vn({visible:!1,wireframe:!0,side:Ui,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(t){let e=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(e="local"),fl.copy(xo).applyQuaternion(e==="local"?this.worldQuaternion:Xl),lo.copy(Vr).applyQuaternion(e==="local"?this.worldQuaternion:Xl),co.copy(Co).applyQuaternion(e==="local"?this.worldQuaternion:Xl),ve.copy(lo),this.mode){case"translate":case"scale":switch(this.axis){case"X":ve.copy(this.eye).cross(fl),fn.copy(fl).cross(ve);break;case"Y":ve.copy(this.eye).cross(lo),fn.copy(lo).cross(ve);break;case"Z":ve.copy(this.eye).cross(co),fn.copy(co).cross(ve);break;case"XY":fn.copy(co);break;case"YZ":fn.copy(fl);break;case"XZ":ve.copy(co),fn.copy(lo);break;case"XYZ":case"E":fn.set(0,0,0);break}break;case"rotate":default:fn.set(0,0,0)}fn.length()===0?this.quaternion.copy(this.cameraQuaternion):(Hm.lookAt(gi.set(0,0,0),fn,ve),this.quaternion.setFromRotationMatrix(Hm)),super.updateMatrixWorld(t)}}class lP{constructor(t){x(this,"vp");x(this,"clipPlanes");x(this,"boxHelper");x(this,"box3");x(this,"_enabled",!1);x(this,"tc");x(this,"box");x(this,"xmin");x(this,"ymin");x(this,"zmin");x(this,"xmax");x(this,"ymax");x(this,"zmax");x(this,"xminPlane");x(this,"xmaxPlane");x(this,"yminPlane");x(this,"ymaxPlane");x(this,"zminPlane");x(this,"zmaxPlane");x(this,"pxmin");x(this,"pymin");x(this,"pzmin");x(this,"pxmax");x(this,"pymax");x(this,"pzmax");x(this,"boxMat");x(this,"highlightMat");x(this,"raycaster",new uA);x(this,"capGroup");x(this,"enableStatusChanged");x(this,"boxEnableStatusChanged");x(this,"_planeObjects",[]);x(this,"_planeGeom",new Fa(4e3,4e3));x(this,"_capInitDone",!1);x(this,"onBeforeRender",()=>{for(let t=0;t<this._planeObjects.length;t++){const e=this.clipPlanes[t],i=this._planeObjects[t];e.coplanarPoint(i.position),i.lookAt(-i.position.x+e.normal.x,i.position.y+e.normal.y,-i.position.z+e.normal.z)}});x(this,"onModelsAdd",t=>{});x(this,"afterVpRayCast",t=>{let e=t.intersections;if(e)for(this.box3.setFromObject(this.box);e.length>0;){let r=e[0].point;if(this.box3.containsPoint(r))break;e.shift()}});x(this,"mouse",new xt);x(this,"intersections",[]);x(this,"__lastTcAxis",null);x(this,"onMouseMove",t=>{this.clippingBoxEnabled&&(this.vp.render(),console.log("44555"))});x(this,"onControlMouseUp",t=>{this._working=!1,this._changing==!0&&(this._changing=!1,this._stopChange())});x(this,"_working",!1);x(this,"onControlMouseDown",t=>{this.vp.controls.enabled=!1,this._working=!0});x(this,"_changing",!1);x(this,"onControlChange",()=>{this._working&&(this._changing==!1&&(this._changing=!0,this._startChange()),this.update())});x(this,"_initDone",!1);x(this,"_boxCache",new Qi);x(this,"_clippingBoxEnabled",!0);x(this,"_intersectTarget",new H);this.enableStatusChanged=new Ot,this.boxEnableStatusChanged=new Ot,this.vp=t,this.box=new _i,this.box3=new Qi,this.boxHelper=new bL(this.box,"tomato"),t.scene.add(this.boxHelper),this.xmin=0,this.ymin=0,this.zmin=0,this.xmax=15,this.ymax=15,this.zmax=15,this.boxMat=new nL({color:61695,transparent:!1,opacity:10.1,depthWrite:!0}),this.xminPlane=new Fi(new H(1,0,0),this.xmin),this.xmaxPlane=new Fi(new H(-1,0,0),this.xmax),this.yminPlane=new Fi(new H(0,1,0),this.ymin),this.ymaxPlane=new Fi(new H(0,-1,0),this.ymax),this.zminPlane=new Fi(new H(0,0,1),this.zmin),this.zmaxPlane=new Fi(new H(0,0,-1),this.zmax),this.clipPlanes=[this.xminPlane,this.xmaxPlane,this.yminPlane,this.ymaxPlane,this.zmaxPlane,this.zminPlane],this.vp.renderer.localClippingEnabled=!1,t.selectedMaterial.clippingPlanes=this.clipPlanes,t.selectedMaterial.clipIntersection=!1,t.selectedMaterial.needsUpdate=!0,t.edgeMaterial.clippingPlanes=this.clipPlanes,t.edgeMaterial.needsUpdate=!0,t.materialStoreChangedEvent.add(e=>{for(let i of e.materials)i.clippingPlanes=this.clipPlanes,i.depthTest=!0,i.depthWrite=!0,i.clipIntersection=!1,i.needsUpdate=!0}),t.afterModelsAddEvent.add(this.onModelsAdd),this.capGroup=new _i,this.cap=!1}_initForCap(){this._planeObjects=[],this.capGroup.clear();let t=1;for(let e of this.clipPlanes){const i=new _i,r=createPlaneStencilGroup(this.vp.rootGroup,e,t),a=new Qc({color:15277667,metalness:.1,roughness:.75,clippingPlanes:this.clipPlanes.filter(o=>o!==e),stencilWrite:!0,stencilRef:0,stencilFunc:TE,stencilFail:Mh,stencilZFail:Mh,stencilZPass:Mh}),f=new yt(this._planeGeom,a);f.onAfterRender=function(o){o.clearStencil()},f.renderOrder=t+1.1,i.add(f),this._planeObjects.push(f),this.capGroup.add(i),this.capGroup.add(r),t++}this.vp.beforeRenderEvent.add(this.onBeforeRender)}initClipControl(){let t=(i,r,a=!1)=>{let f;return f=new eP(this.vp.camera,this.vp.container,a),f.enabled=!0,f.setSpace("world"),f.attach(i),f.showX=r=="x",f.showY=r=="y",f.showZ=r=="z",f.setSize(1),f.visible=!0,f.addEventListener("change",this.onControlChange),f.addEventListener("mouseUp",this.onControlMouseUp),f.addEventListener("mouseDown",this.onControlMouseDown),f},e=new _i;return e.add(t(this.pxmax,"x")),e.add(t(this.pxmin,"x",!0)),e.add(t(this.pymax,"y")),e.add(t(this.pymin,"y",!0)),e.add(t(this.pzmax,"z")),e.add(t(this.pzmin,"z",!0)),e.visible=!0,this.tc=e,this.vp.scene.add(this.tc),e}_stopChange(){this.vp.controls.enabled=!0,this.vp.keepChanging=!1}_startChange(){this.vp.controls.enabled=!1,this.vp.keepChanging=!0}update(){let t=this.pxmax.position.x,e=this.pxmin.position.x,i=this.pymax.position.y,r=this.pymin.position.y,a=this.pzmax.position.z,f=this.pzmin.position.z;this.setClipBox(e,r,f,t,i,a)}setClipBox(t,e,i,r,a,f){this.xmax=r,this.xmin=t,this.ymax=a,this.ymin=e,this.zmax=f,this.zmin=i,this.xminPlane.constant=-t,this.yminPlane.constant=-e,this.zminPlane.constant=-i,this.xmaxPlane.constant=r,this.ymaxPlane.constant=a,this.zmaxPlane.constant=f;let o=r-t,s=a-e,l=f-i,u=o!=0?o:1,A=s!=0?s:1,c=l!=0?l:1;this.pxmin.position.x=t,this.pxmin.position.y=e+.5*s,this.pxmin.position.z=i+.5*l,this.pxmin.scale.set(c,A,1),this.pxmax.position.x=r,this.pxmax.position.y=e+.5*s,this.pxmax.position.z=i+.5*l,this.pxmax.scale.set(c,A,1),this.pymin.position.y=e,this.pymin.position.x=t+.5*o,this.pymin.position.z=i+.5*l,this.pymin.scale.set(u,c,1),this.pymax.position.y=a,this.pymax.position.x=t+.5*o,this.pymax.position.z=i+.5*l,this.pymax.scale.set(u,c,1),this.pzmin.position.z=i,this.pzmin.position.x=t+.5*o,this.pzmin.position.y=e+.5*s,this.pzmin.scale.set(u,A,1),this.pzmax.position.z=f,this.pzmax.position.x=t+.5*o,this.pzmax.position.y=e+.5*s,this.pzmax.scale.set(u,A,1),this.boxHelper.update(),this.box3.setFromObject(this.box)}get enabled(){return this._enabled}set enabled(t){if(t!=this._enabled){this.init();for(let e of this.tc.children)e.enabled=t;t?(this._startClip(),this.clippingBoxEnabled=!0):(this._stopClip(),this.clippingBoxEnabled=!1),this._enabled=t,this.enableStatusChanged.dispatch(t),this.vp.render()}}init(){this._initDone||(this.createBox(),this.fit(),this.initClipControl(),this._initDone=!0)}_startClip(){this.tc.visible=!0,this.vp.renderer.localClippingEnabled=!0,this.vp.afterRayCastEvent.add(this.afterVpRayCast),this.vp.container.addEventListener("mousemove",this.onMouseMove),this.vp.render()}_stopClip(){this.boxHelper.visible=!1,this.tc.visible=!1,this.vp.renderer.localClippingEnabled=!1,this.vp.render(),this.vp.afterRayCastEvent.remove(this.afterVpRayCast),this.vp.container.removeEventListener("mousemove",this.onMouseMove)}createBox(){let t=this.boxMat;this.box.visible=!0;var e=new Fa(1,1);this.pxmin=new yt(e,t),this.pxmin.rotation.y=-Math.PI/2,this.box.add(this.pxmin),this.pxmax=new yt(e,t),this.pxmax.rotation.y=Math.PI/2,this.box.add(this.pxmax),this.pymin=new yt(e,t),this.pymin.rotation.x=Math.PI/2,this.box.add(this.pymin),this.pymax=new yt(e,t),this.pymax.rotation.x=-Math.PI/2,this.box.add(this.pymax),this.pzmin=new yt(e,t),this.pzmin.rotation.x=Math.PI,this.box.add(this.pzmin),this.pzmax=new yt(e,t),this.box.add(this.pzmax)}isPointInClippingBox(t){return this.box3.containsPoint(t)}get clippingBoxEnabled(){return this._clippingBoxEnabled}set clippingBoxEnabled(t){this.boxHelper.visible=t,this._clippingBoxEnabled=t,this.tc.visible=t;for(let e of this.tc.children)e.enabled=t;this.vp.render(),this.boxEnableStatusChanged.dispatch(t)}fit(t){t||(t=this.vp.rootGroup);let e=this._boxCache;e.makeEmpty(),e.expandByObject(t),e.isEmpty()&&(e.min.x=0,e.min.y=0,e.min.z=0,e.max.x=1,e.max.y=1,e.max.z=1);var i=.001;e.min.x-=i,e.min.y-=i,e.min.z-=i,e.max.x+=i,e.max.y+=i,e.max.z+=i,this.setClipBox(e.min.x,e.min.y,e.min.z,e.max.x,e.max.y,e.max.z),this.vp.render()}intersectLine(t){this.box3.setFromObject(this.box);let e=t.start,i=t.end,r=this.box3.containsPoint(e),a=this.box3.containsPoint(i);if(r&&a)return t;if(r||a)for(let f of this.clipPlanes){let o=f.intersectLine(t,this._intersectTarget);if(o)return r?t.end.copy(o):t.start.copy(o),t}return null}}class cP extends LI{constructor(e,i=new _d){super(e,i);x(this,"snapHelper");x(this,"clippingHelper");x(this,"passHelper");x(this,"coordsHelper");this.clippingHelper=new lP(this),this.snapHelper=new Y2(this)}isPointVisible(e,i){return this.clippingHelper&&this.clippingHelper.enabled&&!this.clippingHelper.isPointInClippingBox(e)?!1:super.isPointVisible(e,i)}getSceneInfo(){let e=Qd(this);return console.log("si",e),e}restoreSceneInfo(e){Rd(this,e)}}const km={HPLATE:sc,HSTIFF:Po,CSTIFF:Po,HBRCKT:Lw,CPLATE:Uw,HFLANG:Po,HCLIP:sc,FLAN:ae,BEND:ae,ATTA:ae,GASK:ae,ELBO:ae,UNIO:ae,PCOM:ae,REDU:ae,TEE:ae,CAP:ae,TUBI:ae,PPIECE:ae,VALV:ae,PSPOOL:ae,SCTN:Rn,GENSEC:Rn,PANE:Rn,PANEL:Rn,FITT:Rn,default:Iw};function hP(n){return km[n]??km.default}class uP{constructor(t=0,e=0,i=0,r=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=i,this._w=r}static slerpFlat(t,e,i,r,a,f,o){let s=i[r+0],l=i[r+1],u=i[r+2],A=i[r+3];const c=a[f+0],h=a[f+1],p=a[f+2],m=a[f+3];if(o===0){t[e+0]=s,t[e+1]=l,t[e+2]=u,t[e+3]=A;return}if(o===1){t[e+0]=c,t[e+1]=h,t[e+2]=p,t[e+3]=m;return}if(A!==m||s!==c||l!==h||u!==p){let d=1-o;const g=s*c+l*h+u*p+A*m,v=g>=0?1:-1,w=1-g*g;if(w>Number.EPSILON){const y=Math.sqrt(w),C=Math.atan2(y,g*v);d=Math.sin(d*C)/y,o=Math.sin(o*C)/y}const _=o*v;if(s=s*d+c*_,l=l*d+h*_,u=u*d+p*_,A=A*d+m*_,d===1-o){const y=1/Math.sqrt(s*s+l*l+u*u+A*A);s*=y,l*=y,u*=y,A*=y}}t[e]=s,t[e+1]=l,t[e+2]=u,t[e+3]=A}static multiplyQuaternionsFlat(t,e,i,r,a,f){const o=i[r],s=i[r+1],l=i[r+2],u=i[r+3],A=a[f],c=a[f+1],h=a[f+2],p=a[f+3];return t[e]=o*p+u*A+s*h-l*c,t[e+1]=s*p+u*c+l*A-o*h,t[e+2]=l*p+u*h+o*c-s*A,t[e+3]=u*p-o*A-s*c-l*h,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,i,r){return this._x=t,this._y=e,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){const i=t._x,r=t._y,a=t._z,f=t._order,o=Math.cos,s=Math.sin,l=o(i/2),u=o(r/2),A=o(a/2),c=s(i/2),h=s(r/2),p=s(a/2);switch(f){case"XYZ":this._x=c*u*A+l*h*p,this._y=l*h*A-c*u*p,this._z=l*u*p+c*h*A,this._w=l*u*A-c*h*p;break;case"YXZ":this._x=c*u*A+l*h*p,this._y=l*h*A-c*u*p,this._z=l*u*p-c*h*A,this._w=l*u*A+c*h*p;break;case"ZXY":this._x=c*u*A-l*h*p,this._y=l*h*A+c*u*p,this._z=l*u*p+c*h*A,this._w=l*u*A-c*h*p;break;case"ZYX":this._x=c*u*A-l*h*p,this._y=l*h*A+c*u*p,this._z=l*u*p-c*h*A,this._w=l*u*A+c*h*p;break;case"YZX":this._x=c*u*A+l*h*p,this._y=l*h*A+c*u*p,this._z=l*u*p-c*h*A,this._w=l*u*A-c*h*p;break;case"XZY":this._x=c*u*A-l*h*p,this._y=l*h*A-c*u*p,this._z=l*u*p+c*h*A,this._w=l*u*A+c*h*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+f)}return e!==!1&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const i=e/2,r=Math.sin(i);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,i=e[0],r=e[4],a=e[8],f=e[1],o=e[5],s=e[9],l=e[2],u=e[6],A=e[10],c=i+o+A;if(c>0){const h=.5/Math.sqrt(c+1);this._w=.25/h,this._x=(u-s)*h,this._y=(a-l)*h,this._z=(f-r)*h}else if(i>o&&i>A){const h=2*Math.sqrt(1+i-o-A);this._w=(u-s)/h,this._x=.25*h,this._y=(r+f)/h,this._z=(a+l)/h}else if(o>A){const h=2*Math.sqrt(1+o-i-A);this._w=(a-l)/h,this._x=(r+f)/h,this._y=.25*h,this._z=(s+u)/h}else{const h=2*Math.sqrt(1+A-i-o);this._w=(f-r)/h,this._x=(a+l)/h,this._y=(s+u)/h,this._z=.25*h}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(Pw(this.dot(t),-1,1)))}rotateTowards(t,e){const i=this.angleTo(t);if(i===0)return this;const r=Math.min(1,e/i);return this.slerp(t,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const i=t._x,r=t._y,a=t._z,f=t._w,o=e._x,s=e._y,l=e._z,u=e._w;return this._x=i*u+f*o+r*l-a*s,this._y=r*u+f*s+a*o-i*l,this._z=a*u+f*l+i*s-r*o,this._w=f*u-i*o-r*s-a*l,this._onChangeCallback(),this}slerp(t,e){if(e===0)return this;if(e===1)return this.copy(t);const i=this._x,r=this._y,a=this._z,f=this._w;let o=f*t._w+i*t._x+r*t._y+a*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=f,this._x=i,this._y=r,this._z=a,this;const s=1-o*o;if(s<=Number.EPSILON){const h=1-e;return this._w=h*f+e*this._w,this._x=h*i+e*this._x,this._y=h*r+e*this._y,this._z=h*a+e*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(s),u=Math.atan2(l,o),A=Math.sin((1-e)*u)/l,c=Math.sin(e*u)/l;return this._w=f*A+this._w*c,this._x=i*A+this._x*c,this._y=r*A+this._y*c,this._z=a*A+this._z*c,this._onChangeCallback(),this}slerpQuaternions(t,e,i){return this.copy(t).slerp(e,i)}random(){const t=Math.random(),e=Math.sqrt(1-t),i=Math.sqrt(t),r=2*Math.PI*Math.random(),a=2*Math.PI*Math.random();return this.set(e*Math.cos(r),i*Math.sin(a),i*Math.cos(a),e*Math.sin(r))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class is{constructor(t=0,e=0,i=0){is.prototype.isVector3=!0,this.x=t,this.y=e,this.z=i}set(t,e,i){return i===void 0&&(i=this.z),this.x=t,this.y=e,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(Nm.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(Nm.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,i=this.y,r=this.z,a=t.elements;return this.x=a[0]*e+a[3]*i+a[6]*r,this.y=a[1]*e+a[4]*i+a[7]*r,this.z=a[2]*e+a[5]*i+a[8]*r,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,i=this.y,r=this.z,a=t.elements,f=1/(a[3]*e+a[7]*i+a[11]*r+a[15]);return this.x=(a[0]*e+a[4]*i+a[8]*r+a[12])*f,this.y=(a[1]*e+a[5]*i+a[9]*r+a[13])*f,this.z=(a[2]*e+a[6]*i+a[10]*r+a[14])*f,this}applyQuaternion(t){const e=this.x,i=this.y,r=this.z,a=t.x,f=t.y,o=t.z,s=t.w,l=s*e+f*r-o*i,u=s*i+o*e-a*r,A=s*r+a*i-f*e,c=-a*e-f*i-o*r;return this.x=l*s+c*-a+u*-o-A*-f,this.y=u*s+c*-f+A*-a-l*-o,this.z=A*s+c*-o+l*-f-u*-a,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,i=this.y,r=this.z,a=t.elements;return this.x=a[0]*e+a[4]*i+a[8]*r,this.y=a[1]*e+a[5]*i+a[9]*r,this.z=a[2]*e+a[6]*i+a[10]*r,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const i=t.x,r=t.y,a=t.z,f=e.x,o=e.y,s=e.z;return this.x=r*s-a*o,this.y=a*f-i*s,this.z=i*o-r*f,this}projectOnVector(t){const e=t.lengthSq();if(e===0)return this.set(0,0,0);const i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return fu.copy(this).projectOnVector(t),this.sub(fu)}reflect(t){return this.sub(fu.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(Pw(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y,r=this.z-t.z;return e*e+i*i+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){const r=Math.sin(e)*t;return this.x=r*Math.sin(i),this.y=Math.cos(e)*t,this.z=r*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),r=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=r,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,e*4)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,e*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=(Math.random()-.5)*2,e=Math.random()*Math.PI*2,i=Math.sqrt(1-t**2);return this.x=i*Math.cos(e),this.y=i*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const fu=new is,Nm=new uP;function Ia(n,t,e,i){var r=n.clone().project(t);return r.x=(r.x+1)/2*e,r.y=-(r.y-1)/2*i,new xt(r.x,r.y)}function d_(n,t,e){var i=t.clone().sub(n),r=i.length();return i=i.normalize().multiplyScalar(r*e),n.clone().add(i)}class Hd{constructor(t,e,i,r){x(this,"svgElement");x(this,"refPoints");x(this,"viewport");x(this,"moveTo");x(this,"svg");this.svgElement=t,this.refPoints=e,this.viewport=i,this.svg=r,this.moveTo=()=>{this.update()}}update(){}dispose(){this.svgElement.remove()}}class Zo extends Hd{constructor(t,e,i,r,a){let f;t!=null?f=t:f=Ia(i,r.camera,r.screenWidth,r.screenHeight);const o=new wA({cx:f.x,cy:f.y,r:e.radius});o.stroke(e.stroke),o.fill(e.fill),super(o,[i],r,a)}update(){super.update();const t=Ia(this.refPoints[0],this.viewport.camera,this.viewport.screenWidth,this.viewport.screenHeight);this.svgElement.center(t.x,t.y)}}class fP extends Hd{constructor(e,i,r,a){if(i.length!=2)throw"create line failed: without 3d point";const f=i[0].distanceTo(i[1]),o=i.map(l=>Ia(l,r.camera,r.screenWidth,r.screenHeight)),s=new An({x1:o[0].x,y1:o[0].y,x2:o[1].x,y2:o[1].y});s.stroke(e);super(s,i,r,a);x(this,"distance",0);x(this,"midPoint");this.distance=f,this.midPoint=d_(i[0],i[1],.5)}update(){super.update();const e=this.refPoints.map(i=>Ia(i,this.viewport.camera,this.viewport.screenWidth,this.viewport.screenHeight));this.svgElement.attr({x1:e[0].x,y1:e[0].y,x2:e[1].x,y2:e[1].y})}}class dP extends Hd{constructor(e,i,r,a,f){const o={x1:e.x,y1:e.y,x2:e.x,y2:e.y},s=new An(o);s.stroke(i);super(s,[r],a,f);x(this,"endScreenVec");x(this,"svg");x(this,"offsetX");x(this,"onMouseMove",e=>{e.preventDefault(),this.endScreenVec.set(e.offsetX,e.offsetY);const i=Ia(this.refPoints[0],this.viewport.camera,this.viewport.screenWidth,this.viewport.screenHeight);this.svgElement.attr({x1:i.x,y1:i.y,x2:this.endScreenVec.x,y2:this.endScreenVec.y})});this.endScreenVec=e,f.mousemove(this.onMouseMove),this.svg=f}update(){super.update();const e=Ia(this.refPoints[0],this.viewport.camera,this.viewport.screenWidth,this.viewport.screenHeight);this.svgElement.attr({x1:e.x,y1:e.y,x2:this.endScreenVec.x,y2:this.endScreenVec.y})}dispose(){this.svg.mousemove(null),super.dispose()}}function Vm(n){return Math.round(parseFloat(n))}function zr(n,t,e){let i=document.createElement(n);return t&&(i.className=t),e&&(i.innerHTML=e),i}function cc(n,t,e,i){let r=zr(t,e,i);return n.appendChild(r),r}function Gs(n,t,e=""){return cc(n,"div",t,e)}function hc(n,t){t?n.style.display="block":n.style.display="none"}function pP(n){let t=getComputedStyle(n);return n.offsetWidth+Vm(t.marginLeft)+Vm(t.marginRight)}const gP={textColor:"white",background:"#202124",lineColor:"#0457c9",isDashed:!1},mP={textColor:"white",background:"#ec4545",lineColor:"rgb(204, 2, 27)",isDashed:!0},vP={textColor:"white",background:"#45c345",lineColor:"rgb(124, 207, 33)",isDashed:!0},wP={textColor:"white",background:"#5757da",lineColor:"rgb(74, 144, 226)",isDashed:!0};class _P{constructor(t,e,i,r){x(this,"pos");x(this,"dom");x(this,"pos2d");x(this,"viewport");this.pos2d=new xt,this.pos=e;let a=document.createElement("div");a.style.position="absolute",a.style.transform="translate(-50%, -50%)",a.style.top="0",a.style.left="0",a.className="measure-label",a.classList.add(i),a.innerText=t+" mm",this.dom=a,this.viewport=r}show(t){t?this.dom.style.display="block":this.dom.style.display="none"}update(){this.viewport.toScreenVector(this.pos,this.pos2d),this.dom.style.top=this.pos2d.y+"px",this.dom.style.left=this.pos2d.x+"px"}isOverlap(t){if(!t||!t.pos2d)return!1;const e=Math.abs(t.pos2d.x-this.pos2d.x),i=Math.abs(t.pos2d.y-this.pos2d.y),r=(this.dom.offsetWidth+t.dom.offsetWidth)/2,a=(this.dom.offsetHeight+t.dom.offsetHeight)/2;return!(i>a||e>r)}}class yP{constructor(t,e,i,r,a,f){x(this,"svg");x(this,"pointA");x(this,"pointB");x(this,"circleA");x(this,"circleB");x(this,"line");x(this,"xline");x(this,"yline");x(this,"zline");x(this,"xVec");x(this,"yVec");x(this,"id",_I());x(this,"isActive",!0);x(this,"onActive",new Ot);x(this,"inActive",new Ot);x(this,"domContainer");x(this,"label");x(this,"mainLabel");x(this,"xLabel");x(this,"yLabel");x(this,"zLabel");x(this,"viewport");x(this,"tool");x(this,"deleteBtn");x(this,"labelStack",!1);x(this,"cameraPosVec",new is);x(this,"sortableDom");var s,l,u;this.svg=i,this.domContainer=r,this.pointA=t,this.pointB=e,this.viewport=a,this.xVec=new is(t.x,e.y,t.z),this.yVec=new is(e.x,e.y,t.z),this.tool=f;const o={fill:{color:"#0457c9"},stroke:{color:"#fff",width:2},radius:7};this.circleA=new Zo(null,o,t,a,this.svg),this.circleB=new Zo(null,o,e,a,this.svg),t.distanceTo(this.xVec)>=.001&&(this.yline=new dl(vP,[t,this.xVec],a,i),this.yLabel=this.createTextLabels(t,this.xVec,"measure-label-y")),this.xVec.distanceTo(this.yVec)>=.001&&(this.xline=new dl(mP,[this.xVec,this.yVec],a,i),this.xLabel=this.createTextLabels(this.xVec,this.yVec,"measure-label-x")),this.yVec.distanceTo(e)>=.001&&(this.zline=new dl(wP,[this.yVec,e],a,i),this.zLabel=this.createTextLabels(this.yVec,e,"measure-label-z")),this.line=new dl(gP,[t,e],a,i,!0,!0),this.mainLabel=this.createTextLabels(t,e,"measure-label-main"),this.mainLabel.dom.addEventListener("pointerdown",A=>{A.stopPropagation(),this.active=!this.active}),this.deleteBtn=this.createBtn("./static/common/trash.svg"),this.deleteBtn.addEventListener("pointerdown",()=>{f.removeItem(this)}),this.mainLabel.dom.appendChild(this.deleteBtn),new wA({}),this.svg.add(this.circleA.svgElement),this.svg.add(this.circleB.svgElement),this.renderLabel(),this.sortableDom=[(s=this.yLabel)==null?void 0:s.dom,(l=this.xLabel)==null?void 0:l.dom,(u=this.zLabel)==null?void 0:u.dom,this.mainLabel.dom].filter(A=>A),this.active=!1}calCameraDistance(){return this.viewport.camera.getWorldPosition(this.cameraPosVec),this.mainLabel.pos.distanceTo(this.cameraPosVec)}createTextLabels(t,e,i){let r=d_(t,e,.5),a="~"+(t.distanceTo(e)*1e3).toFixed(0);const f=new _P(a,r,i,this.viewport);return this.domContainer.appendChild(f.dom),f.update(),f}createBtn(t){const e=document.createElement("div");return e.classList.add("measure-del-btn"),cc(e,"img","","").setAttribute("src",t),e}renderLabel(){var t,e,i;(t=this.xline)==null||t.renderRectLabel(),(e=this.yline)==null||e.renderRectLabel(),(i=this.zline)==null||i.renderRectLabel(),this.line.renderRectLabel()}get active(){return this.isActive}set active(t){t?(this.tool.items.forEach(e=>e.active=!1),this.tool.isDrawingLine&&this.tool.stopDraw(),this.select()):this.unSelect(),this.isActive=t}select(){var t,e,i,r,a,f;this.circleA.svgElement.show(),this.circleB.svgElement.show(),(t=this.xline)==null||t.show(),(e=this.yline)==null||e.show(),(i=this.zline)==null||i.show(),(r=this.xLabel)==null||r.show(!0),(a=this.yLabel)==null||a.show(!0),(f=this.zLabel)==null||f.show(!0),this.line.hideEndpointLine(),this.deleteBtn.style.display="block",this.update()}unSelect(){var t,e,i,r,a,f;this.circleA.svgElement.hide(),this.circleB.svgElement.hide(),(t=this.xline)==null||t.hide(),(e=this.yline)==null||e.hide(),(i=this.zline)==null||i.hide(),(r=this.xLabel)==null||r.show(!1),(a=this.yLabel)==null||a.show(!1),(f=this.zLabel)==null||f.show(!1),this.line.showEndpointLine(),this.deleteBtn.style.display="none"}isClicked(t,e){let i=!1;return i=this.line.isPointInside(t,e),i}dispose(){var t,e,i,r,a,f;this.active=!1,this.circleA.dispose(),this.circleB.dispose(),(t=this.xline)==null||t.dispose(),(e=this.yline)==null||e.dispose(),(i=this.zline)==null||i.dispose(),this.line.dispose(),(r=this.xLabel)==null||r.dom.remove(),(a=this.yLabel)==null||a.dom.remove(),(f=this.zLabel)==null||f.dom.remove(),this.mainLabel.dom.remove()}toJson(){return{pointA:{x:this.pointA.x,y:this.pointA.y,z:this.pointA.z},pointB:{x:this.pointB.x,y:this.pointB.y,z:this.pointB.z}}}update(){var i,r,a,f,o,s,l;this.circleA.update(),this.circleB.update(),(i=this.xline)==null||i.update(),(r=this.yline)==null||r.update(),(a=this.zline)==null||a.update(),this.line.update(),(f=this.mainLabel)==null||f.update(),(o=this.xLabel)==null||o.update(),(s=this.yLabel)==null||s.update(),(l=this.zLabel)==null||l.update(),[this.xLabel,this.yLabel,this.zLabel].some(u=>this.mainLabel.isOverlap(u))&&this.stackLabel()}stackLabel(){const t=this.mainLabel.dom,e=t.offsetHeight,i=t.style.left,r=this.mainLabel.pos2d.y;let a=0;const f=[this.xLabel,this.yLabel,this.zLabel];for(let o=0;o<f.length;o++){const s=f[o];s&&(a+=1,s.dom.style.left=i,s.dom.style.top=r-a*e+"px")}}}class dl extends fP{constructor(e,i,r,a,f=!1,o=!1){const s={color:e.lineColor,width:2,dasharray:e.isDashed?"6,4":""};super(s,i,r,a);x(this,"rect");x(this,"text");x(this,"clickable");x(this,"onClick",new Ot);x(this,"endPointLineA");x(this,"endPointLineB");x(this,"withEndline");x(this,"lineAttr");this.lineAttr=s,this.withEndline=o,this.withEndline&&(this.createEndpointLine(),this.svg.add(this.endPointLineA),this.svg.add(this.endPointLineB),this.hideEndpointLine()),a.add(this.svgElement)}formateDistance(e){return` ~ ${(e*1e3).toFixed(0)} mm `}renderRectLabel(){!this.rect||!this.text||(this.svg.add(this.rect.svgElement),this.svg.add(this.text.svgElement))}getLabel(){return this.rect}hide(){var e,i;this.svgElement.hide(),(e=this.rect)==null||e.svgElement.hide(),(i=this.text)==null||i.svgElement.hide()}show(){var e,i,r;this.svgElement.show(),(e=this.rect)==null||e.svgElement.show(),(i=this.text)==null||i.svgElement.show(),(r=this.text)==null||r.updatePos()}isPointInside(e,i){var f;if(!this.clickable&&this.distance==0)return!1;const r=this.svg.node.createSVGPoint();return r.x=e,r.y=i,!!((f=this.rect)!=null&&f.svgElement.inside(e,i)||this.svgElement.node.isPointInStroke(r))}getEndpointdxdy(){const i=this.svgElement.attr(),r=i.x1-i.x2,a=i.y1-i.y2,f=Math.atan2(a,r)+Math.PI*.5,o=10,s=o*Math.sin(f),l=o*Math.cos(f);return new xt(l,s)}createEndpointLine(){const e=this.getEndpointdxdy(),r=this.svgElement.attr();this.endPointLineA=new An({x1:r.x1+e.x,y1:r.y1+e.y,x2:r.x1-e.x,y2:r.y1-e.y}).stroke(this.lineAttr),this.endPointLineB=new An({x1:r.x2+e.x,y1:r.y2+e.y,x2:r.x2-e.x,y2:r.y2-e.y}).stroke(this.lineAttr)}updateEndpointLine(){const e=this.getEndpointdxdy(),r=this.svgElement.attr();this.endPointLineA.attr({x1:r.x1+e.x,y1:r.y1+e.y,x2:r.x1-e.x,y2:r.y1-e.y}),this.endPointLineB.attr({x1:r.x2+e.x,y1:r.y2+e.y,x2:r.x2-e.x,y2:r.y2-e.y})}showEndpointLine(){this.endPointLineA.show(),this.endPointLineB.show()}hideEndpointLine(){this.endPointLineA.hide(),this.endPointLineB.hide()}update(){var e,i;super.update(),this.withEndline&&this.updateEndpointLine(),(e=this.rect)==null||e.update(),(i=this.text)==null||i.updatePos()}dispose(){var e,i,r,a;super.dispose(),(e=this.rect)==null||e.dispose(),(i=this.text)==null||i.dispose(),(r=this.endPointLineA)==null||r.remove(),(a=this.endPointLineB)==null||a.remove()}}class p_{constructor(t){x(this,"drawBoard");x(this,"drawMenu");this.drawBoard=t}startDraw(){}endDraw(){}}class kd extends p_{constructor(e){super(e);x(this,"drawBoard");x(this,"items");this.drawBoard=e}addItem(e){this.items.push(e),this.drawBoard.addItem(e)}removeItem(e){const i=this.items.indexOf(e);i!=-1&&this.items.splice(i,1),this.drawBoard.removeItem(e)}clear(){this.items.forEach(e=>{this.drawBoard.removeItem(e)}),this.items=[]}}class xP extends kd{constructor(e,i){super(e);x(this,"viewport");x(this,"isDrawingLine",!1);x(this,"intersecPoints");x(this,"drawingLine");x(this,"drawingPoint");x(this,"clickScreenPoint",[]);x(this,"items",[]);x(this,"onDone",new Ot);x(this,"onDrawFinish",new Ot);x(this,"selectedMode");x(this,"mode",["line","angle"]);x(this,"cicleAttr",{fill:{color:"#0457c9"},stroke:{color:"#fff",width:2},radius:7});x(this,"onlyOnce",!1);x(this,"onMeasure",e=>{if(e.button!=0)return;const i=this.drawBoard;if(e.mouse!=null)if(this.isDrawingLine){if(!e.intersectPoint||e.intersectPoint==this.intersecPoints[0])return;this.setClickPoint(e.mouse.clone()),this.isDrawingLine=!1,this.drawingPoint.dispose(),this.intersecPoints.push(e.intersectPoint);const r=this.createItem(this.intersecPoints[0],this.intersecPoints[1]);this.onlyOnce&&(this.onDrawFinish.dispatch(r),this.endDraw())}else{if(!e.intersectPoint)return;this.intersecPoints=[e.intersectPoint],this.drawingPoint=new Zo(e.mouse,this.cicleAttr,e.intersectPoint,this.viewport,i.svg),i.svg.add(this.drawingPoint.svgElement),this.setClickPoint(e.mouse.clone()),this.isDrawingLine=!0}});x(this,"update",()=>{var e,i;(e=this.drawingPoint)==null||e.update(),(i=this.drawingLine)==null||i.update()});this.viewport=i,this.drawBoard.onClick.add(r=>{this.items.forEach(a=>a.active=!1)})}startDraw(){super.startDraw(),this.viewport.modelClickedEvent.add(this.onMeasure),this.viewport.changedEvent.add(this.update),this.viewport.changeEndEvent.add(this.update)}endDraw(){var e,i;super.endDraw(),this.onDrawFinish.removeAll(),this.viewport.modelClickedEvent.remove(this.onMeasure),this.viewport.changedEvent.remove(this.update),this.viewport.changeEndEvent.remove(this.update),this.isDrawingLine=!1,(e=this.drawingLine)==null||e.dispose(),(i=this.drawingPoint)==null||i.dispose(),this.intersecPoints=[],this.clickScreenPoint=[]}stopDraw(){var e,i;(e=this.drawingLine)==null||e.dispose(),(i=this.drawingPoint)==null||i.dispose(),this.intersecPoints=[],this.clickScreenPoint=[],this.isDrawingLine=!1}setClickPoint(e){this.clickScreenPoint.length!=2&&this.clickScreenPoint.push(e)}createItem(e,i){const r=new yP(e,i,this.drawBoard.svg,this.drawBoard.wrapper,this.viewport,this);return this.addItem(r),r}}const CP={radius:5,stroke:{width:2,color:"#fff"},fill:{color:"#0457c9"}};class yf extends Zo{constructor(e,i,r,a,f,o){super(e,CP,r,a,f);x(this,"lineA");x(this,"lineB");x(this,"screenPoint");x(this,"destPoint");x(this,"svg");x(this,"content");x(this,"cameraDistance");x(this,"drawingDiv");x(this,"dy");x(this,"dx");x(this,"rectDiv");x(this,"contentRect");x(this,"textArea");x(this,"contentDiv");x(this,"doneBtn");x(this,"deleteBtn");x(this,"cameraPosVec",new H);x(this,"onItemDelete",new Ot);x(this,"onClick",new Ot);x(this,"sortableDom");x(this,"_autoPosition",!0);this.drawingDiv=o,this.svg=f,this.screenPoint=e,this.destPoint=i,this.dy=i.y-e.y,this.dx=i.x-e.x,this.addLineA(),this.addLineB(),this.addText(),this.svg.add(this.svgElement),this.update(),this.sortableDom=[this.rectDiv]}calCameraDistance(){return this.viewport.camera.getWorldPosition(this.cameraPosVec),this.refPoint.distanceTo(this.cameraPosVec)}get refPoint(){return this.refPoints[0]}addLineA(){const e=this.screenPoint,i=this.destPoint,r={color:"blue",width:2};this.lineA=new An({x1:e.x,y1:e.y,x2:i.x,y2:i.y}).stroke(r),this.svg.add(this.lineA)}addLineB(){const e=this.dx,i=this.destPoint.x,r=this.destPoint.y;let a;const f={color:"blue",width:2};e>0?a=i+10:a=i-10,this.lineB=new An({x1:i,y1:r,x2:a,y2:r}).stroke(f),this.svg.add(this.lineB)}addText(){const e=this,i=document.createElement("textarea");i.placeholder="",i.style.outline="none",i.style.border="none",i.rows=1,i.style.minWidth="140px",i.style.width="140px",i.addEventListener("input",o=>{this.content=i.value});const r=document.createElement("div");r.className="label-content-wrapper",r.addEventListener("pointerdown",o=>o.stopPropagation()),r.addEventListener("touchstart",o=>o.stopPropagation()),r.addEventListener("click",o=>o.stopPropagation()),r.addEventListener("mouseenter",o=>{i.style.display!="none"&&(this.doneBtn.style.display="block"),this.deleteBtn.style.display="block",e.update()}),r.addEventListener("mouseleave",()=>{i.style.display=="none"&&(this.doneBtn.style.display="none",this.deleteBtn.style.display="none",e.update())});const a=cc(r,"div","label-content-wrapper-main",""),f=document.createElement("div");f.className="label-text-div",f.addEventListener("pointerup",o=>{o.stopPropagation(),this.onClick.dispatch(this)}),a.appendChild(f),a.appendChild(i),this.contentRect=r,this.contentRect.addEventListener("animationend",o=>this.contentRect.style.removeProperty("animation")),this.deleteBtn=this.createBtn("./static/savedview/delete.svg"),this.doneBtn=this.createBtn("./static/common/done.svg"),this.doneBtn.style.backgroundColor="green",r.appendChild(this.doneBtn),r.appendChild(this.deleteBtn),this.doneBtn.addEventListener("pointerdown",o=>{o.stopPropagation(),this.content?this.showDiv():this.zoomOut()}),this.deleteBtn.addEventListener("pointerdown",o=>{o.stopPropagation(),this.dispose(),this.onItemDelete.dispatch(this)}),i.addEventListener("focusout",o=>{this.content?this.showDiv():this.zoomOut()}),this.rectDiv=r,this.textArea=i,this.contentDiv=f,this.drawingDiv.appendChild(r),this.showArea(),i.focus()}zoomOut(){this.contentRect.style.animation="zoom-in-zoom-out 0.3s ease",this.textArea.focus()}showArea(){const e=this.textArea;e.style.display="block",e.focus(),this.contentDiv.style.display="none",this.doneBtn.style.display="block",this.deleteBtn.style.display="block",this.update()}showDiv(){const e=this.textArea;this.contentDiv.innerText=e.value,this.content=e.value,e.style.display="none",this.contentDiv.style.display="block",this.deleteBtn.style.display="none",this.doneBtn.style.display="none",this.update()}createBtn(e){const i=document.createElement("div");return i.classList.add("label2d-btn"),i.classList.add("label2d-del-btn"),cc(i,"img","","").setAttribute("src",e),i}setContent(e){this.textArea.value=e,this.textArea.style.display="none",this.contentDiv.innerText=e,this.content=e}get autoPosition(){return this._autoPosition}set autoPosition(e){this._autoPosition=e,this.update()}update(){if(super.update(),this.viewport.isPointVisible(this.refPoint))this.rectDiv.hidden=!1,this.svgElement.show(),this.lineA.show(),this.lineB.show();else{this.svgElement.hide(),this.rectDiv.hidden=!0,this.lineA.hide(),this.lineB.hide();return}const i=this.svgElement.cx(),r=this.svgElement.cy();let a,f;if(this.autoPosition){let s=this.viewport.screenWidth,l=this.viewport.screenHeight;i>.5*s?this.dx=30:this.dx=-30,r>.5*l?this.dy=50:this.dy=-50}a=i+this.dx,f=r+this.dy,this.lineA.attr({x1:i,y1:r,x2:a,y2:f});let o;this.dx>0?(o=a+20,this.contentRect.style.flexDirection="row"):(o=a-20,this.contentRect.style.flexDirection="row-reverse"),this.lineB.attr({x1:a,y1:f,x2:o,y2:f}),this.rectDiv.style.top=f-10+"px",this.dx>0?this.rectDiv.style.left=o+"px":this.rectDiv.style.left=o-this.contentRect.offsetWidth+"px"}toJson(){return{refPoint:this.refPoints[0],content:this.content,dx:this.dx,dy:this.dy}}dispose(){super.dispose(),this.lineA.remove(),this.lineB.remove(),this.contentRect.innerHTML="",this.contentRect.remove()}}class bP extends yf{constructor(t,e,i,r,a,f,o){const s=new xt;a.toScreenVector(i,s);const l=new xt(s.x+e,s.y+t);super(s,l,i,a,f,o),this.setContent(r)}}class BP extends kd{constructor(e,i){super(e);x(this,"viewport");x(this,"isDrawing",!1);x(this,"drawingLine");x(this,"drawingPoint");x(this,"clickPoint",[]);x(this,"oriPoint",new is);x(this,"items",[]);x(this,"lastItem",null);x(this,"onDrawFinish",new Ot);x(this,"cicleAttr",{fill:{color:"#0457c9"},stroke:{color:"#fff",width:2},radius:7});x(this,"update",()=>{var e,i;(e=this.drawingPoint)==null||e.update(),(i=this.drawingLine)==null||i.update()});x(this,"onlyOnce",!1);x(this,"autoPosition",!0);x(this,"onViewClick",e=>{if(e.button!=0||e.mouse==null||this.items.some(r=>!r.content))return;const i=this.drawBoard;if(this.isDrawing){this.setClickPoint(e.mouse.clone()),this.drawingLine.dispose(),this.drawingPoint.dispose();const r=new yf(this.clickPoint[0],this.clickPoint[1],this.oriPoint,this.viewport,i.svg,i.div);r.onClick.add(()=>{this.lastItem?this.lastItem.content?(r.showArea(),this.lastItem=r):this.lastItem.zoomOut():(r.showArea(),this.lastItem=r)}),r.autoPosition=this.autoPosition,r.onItemDelete.add(this.removeItem),this.addItem(r),this.lastItem=r,this.isDrawing=!1,this.onlyOnce&&this.onDrawFinish.dispatch(r)}else{if(this.lastItem&&!this.lastItem.content){this.lastItem.zoomOut();return}if(this.clickPoint=[],!e.intersectPoint)return;if(this.oriPoint=e.intersectPoint,this.drawingLine=new dP(e.mouse.clone(),{width:4,color:"#0457c9"},e.intersectPoint,this.viewport,i.svg),this.drawingPoint=new Zo(e.mouse,this.cicleAttr,e.intersectPoint,this.viewport,i.svg),i.svg.add(this.drawingLine.svgElement),i.svg.add(this.drawingPoint.svgElement),this.setClickPoint(e.mouse.clone()),this.isDrawing=!0,this.autoPosition){let r=this.clickPoint[0].clone();r.x-=30,r.y-=60,this.setClickPoint(r),this.drawingLine.dispose(),this.drawingPoint.dispose();const a=new yf(this.clickPoint[0],this.clickPoint[1],this.oriPoint,this.viewport,i.svg,i.div);a.autoPosition=this.autoPosition,a.onItemDelete.add(this.removeItem),this.lastItem=a,a.onClick.add(()=>{this.lastItem?this.lastItem.content?(a.showArea(),this.lastItem=a):this.lastItem.zoomOut():(a.showArea(),this.lastItem=a)}),this.addItem(a),this.isDrawing=!1,this.onlyOnce&&this.onDrawFinish.dispatch(a);return}}});x(this,"removeItem",e=>{e==this.lastItem&&(this.lastItem=null),super.removeItem(e)});this.viewport=i,this.drawBoard.onClick.add(r=>{this.lastItem&&(this.lastItem.content?(this.lastItem.showDiv(),this.lastItem=null):this.lastItem.zoomOut())})}startDraw(){super.startDraw(),this.viewport.modelClickedEvent.add(this.onViewClick),this.viewport.changedEvent.add(this.update),this.viewport.changeEndEvent.add(this.update)}endDraw(){super.endDraw(),this.viewport.modelClickedEvent.remove(this.onViewClick),this.viewport.changedEvent.remove(this.update),this.viewport.changeEndEvent.remove(this.update),this.drawingLine&&this.drawingLine.dispose(),this.drawingPoint&&this.drawingPoint.dispose(),this.isDrawing=!1,this.clickPoint=[]}setClickPoint(e){this.clickPoint.length!=2&&this.clickPoint.push(e)}clear(){this.lastItem=null,super.clear()}deleteEmptyItem(){this.items.filter(i=>!i.content).forEach(i=>this.removeItem(i))}}class Sn{constructor(t){x(this,"dom");x(this,"owner");x(this,"_oldDisplay");x(this,"pointerDown",!1);x(this,"pointerDownTime",0);this.dom=document.createElement(t),this.dom.__tinyUI=this}add(t){this.dom.appendChild(t.dom),t.owner=this}remove(t){this.dom.removeChild(t.dom)}removeFromParent(){let t=this.dom.parentElement;t&&t.removeChild(this.dom)}addClass(t){this.dom.classList.add(t)}set class(t){this.dom.className=t}removeClass(t){this.dom.classList.remove(t)}get text(){return this.dom.innerText}set text(t){this.dom.innerText=t}hide(){this.dom.style.display!="none"&&(this._oldDisplay=this.dom.style.display,this.dom.style.display="none")}show(){this._oldDisplay&&this._oldDisplay!="none"?this.style.display=this._oldDisplay:this.style.display="block"}get visible(){return this.style.visibility=="visible"}set visible(t){this.style.visibility=t?"visible":"collapse"}set src(t){this.dom.src=t}get src(){return this.dom.src}get classList(){return this.dom.classList}get style(){return this.dom.style}get pointerEventEnabled(){return this.style.pointerEvents!="none"}set pointerEventEnabled(t){t?this.style.pointerEvents="unset":this.style.pointerEvents="none"}get id(){return this.dom.id}set id(t){this.dom.id=t}absFillParent(){this.style.position="absolute",this.style.inset="0"}fill(){this.style.width="100%",this.style.height="100%"}unfill(){this.style.height=this.dom.offsetHeight+"px",this.style.width=this.dom.offsetWidth+"px"}configForDrag(t,e){function i(c,{x:h,y:p}){const m=document.elementsFromPoint(h,p);for(let d=0;d<m.length;d++)if(m[d]==c)return!0;return!1}let r=c=>{c.preventDefault(),this.pointerDown=!0;let h=c.pointerId;setTimeout(()=>{this.pointerDown&&A(c,h),this.pointerDown=!1},50)},a=c=>{this.pointerDown=!1},f=this.dom,o=null;f.addEventListener("pointerdown",r),f.addEventListener("pointerup",a),f.addEventListener("pointercancel",a);let s=null,l=c=>{c.preventDefault(),o==null||o.releasePointerCapture(c.pointerId),e.removeEventListener("pointerup",l),e.removeEventListener("pointermove",u),e.removeEventListener("pointercancel",l),e.removeChild(o),o=null,s&&s.drop(c);for(let h of t)h.dragLeave(c)},u=c=>{if(c.preventDefault(),c.stopPropagation(),!!o){o.style.left=c.x-10+"px",o.style.top=c.y-10+"px";for(let h of t)if(i(h.dom,c)){s&&(s==null||s.dragLeave(c)),s=h,s.dragEnter(c);break}}},A=(c,h)=>{console.log("pid",h),c.preventDefault(),c.stopPropagation(),o=document.createElement("div"),e.appendChild(o),o.style.width="50px",o.style.height="50px",o.style.backgroundColor="tomato",o.draggable=!1,o.style.position="absolute",o.style.opacity=.7,o.style.zIndex="9999",o.style.transform="translateX(-50%) scale(1)",o.style.left="-1000px",o.setPointerCapture(h),e.style.touchAction="none",e.addEventListener("pointermove",u),e.addEventListener("pointerup",l),e.addEventListener("pointercancel",l),this.dragStart(c)}}dragStart(t){}dragEnter(t){}dragOver(t){}dragLeave(t){this.classList.remove("tv-drop-area")}drop(t){}}x(Sn,"dragItem",null);class SP extends Sn{constructor(){super("i")}}class Me extends Sn{constructor(){super("div")}}class mn extends Sn{constructor(){super("div"),this.style.position="absolute"}}class EP extends Sn{constructor(t){super("div"),this.dom.style.border="none",t&&this.dom.addEventListener("click",()=>{t(this)})}}class MP extends Sn{constructor(t){super("img"),this.dom.src=t}}class TP extends Sn{constructor(e,i){super("button");x(this,"img");this.dom.style.border="none",this.img=new MP(i),this.add(this.img),this.dom.addEventListener("click",r=>{r.stopPropagation(),e==null||e(this)}),this.addClass("uibtn")}set text(e){this.img.dom.alt=e}}class pl extends Sn{constructor(){super("span")}}class FP extends Me{constructor(){super();x(this,"buttons",[]);x(this,"_buttonStatusCache",new Map);this.dom.className="tv-main-toolbar",this.dom.addEventListener("pointerdown",e=>{e.stopPropagation()}),this.style.display="block"}add(e){e instanceof ue&&this.buttons.push(e),super.add(e)}addSeparator(){var e=new lr;this.add(e)}getButtonByKey(e){return this.buttons.find(r=>r.key==e)}disableButton(e){e&&this._buttonStatusCache.set(e,e.enabled),e.enabled=!1}cancelDisableButton(e){if(e){let i=this._buttonStatusCache.get(e);i!=null&&(e.enabled=i)}}}class ge{constructor(){x(this,"icon");x(this,"title");x(this,"key");x(this,"enabled",!0);x(this,"active",!1);x(this,"onclick");x(this,"oninit");x(this,"viewer");x(this,"visible",!0);x(this,"showText",!1);x(this,"showIcon",!0);x(this,"bs_icon")}}class lr extends Me{constructor(){super(),this.dom.className="tv-toolbar-sep",this.style.float="left"}}class ue extends EP{constructor(e){var i;super();x(this,"img");x(this,"key");x(this,"icon");x(this,"title");x(this,"viewer");x(this,"_onbtnclick",e=>{var i;(i=this.onclick)==null||i.call(this,this,e)});x(this,"onclick");x(this,"_enabled");x(this,"_oldActive");x(this,"_active");if(this.viewer=e.viewer,this.title=e.title,this.icon=e.icon,this.key=e.key,this.dom.setAttribute("title",this.title),e.showText&&(this.dom.innerText=this.title),e.showIcon){if(this.icon){let r=document.createElement("img");r.src=this.icon,this.dom.appendChild(r),this.img=r,this.img.setAttribute("alt",this.title),this.img.className="tv-toolbar-btn-icon"}else if(e.bs_icon){let r=document.createElement("i");this.dom.appendChild(r),this.img=r,this.img.classList.add("bi"),this.img.classList.add(e.bs_icon)}}this.dom.className="tv-toolbar-btn",this.enabled=e.enabled,this.active=e.active,this.visible=e.visible,(i=e.oninit)==null||i.call(e,this),this.onclick=e.onclick,this.style.float="left"}get enabled(){return this._enabled}set enabled(e){e!=this._enabled&&(e?(this._oldActive!=null&&(this.active=this._oldActive),this.dom.addEventListener("click",this._onbtnclick),this.dom.classList.remove("tv-toolbar-btn-disable")):(this._oldActive=this.active,this.active=!1,this.dom.removeEventListener("click",this._onbtnclick),this.dom.classList.add("tv-toolbar-btn-disable")),this._enabled=e)}get active(){return this._active}set active(e){e!=this._active&&(e?this.dom.classList.add("tv-toolbar-btn-active"):this.dom.classList.remove("tv-toolbar-btn-active"),this._active=e)}get visible(){return this.dom.style.display=="flex"}set visible(e){e?this.dom.style.display="flex":this.dom.style.display="none"}}class zc{constructor(){x(this,"icon");x(this,"title");x(this,"key");x(this,"enabled",!0);x(this,"active",!1);x(this,"mode");x(this,"viewer")}}class Gc extends ue{constructor(t){let e=new ge;e.icon=t.icon,e.title=t.title,e.key=t.key,e.enabled=t.enabled,e.active=t.active,e.viewer=t.viewer,e.onclick=(i,r)=>{i.viewer.mode==t.mode?i.viewer.mode=null:i.viewer.mode=t.mode},e.oninit=i=>{i.viewer.modeChangeEvent.add(r=>{i.active=r==t.mode})},super(e)}}class UP extends Me{constructor(){super();x(this,"btns",[]);this.dom.className="sub-toolbar",this.dom.setAttribute("data-html2canvas-ignore","true"),this.dom.addEventListener("pointerdown",e=>{e.stopPropagation()}),this.dom.addEventListener("touchstart",e=>{e.stopPropagation()}),this.dom.addEventListener("touchend",e=>{e.stopPropagation()}),this.dom.addEventListener("dblclick",e=>{e.stopPropagation()}),this.dom.addEventListener("click",e=>{e.stopPropagation()})}add(e){super.add(e),this.btns.push(e)}addSeparator(){var e=new lr;this.add(e)}show(){this.dom.style.display="flex"}hide(){this.dom.style.display="none"}}const g_="/assets/trash-51f8a5d8.svg",LP="/assets/exit-2-67f94d3d.svg",IP="/assets/pen-5aea5a2e.svg",DP="/assets/rect-9fde4454.svg",PP="/assets/arrow-117b24ef.svg",OP="/assets/ellipse-2f22771d.svg",QP="/assets/text-4637b57b.svg",RP="/assets/edit-2-2b32910b.svg",HP="/assets/width-f68f52da.svg",kP="/assets/color-23e3341c.svg";class NP extends p_{constructor(e,i){super(e);x(this,"viewport");x(this,"drawBoard");x(this,"colorOptions",[]);x(this,"widthOptions",[]);x(this,"colorOptionDiv");x(this,"widthOptionDiv");x(this,"color","red");x(this,"_edit",!0);x(this,"onColorChanged",new Ot);x(this,"onDrawtypeChanged",new Ot);x(this,"onDrawCancel",new Ot);x(this,"changeType",e=>{e?(this.drawBoard.fabric.drawTypeChange(e),this.onDrawtypeChanged.dispatch(e)):(this.drawBoard.freeSelect(),this.onDrawtypeChanged.dispatch(""))});this.drawBoard=e,this.viewport=i,this.initToolbar(),this.edit=!0}startDraw(){super.startDraw(),this.viewport.enabled=!1,this.drawMenu.show(),this.drawBoard.show(),this.edit=!0}endDraw(){var e;super.endDraw(),this.viewport.enabled=!0,this.edit=!1,this.drawBoard.hide(),this.colorOptionDiv.style.display="none",this.widthOptionDiv.style.display="none",this.changeType(""),(e=this.drawMenu)==null||e.hide()}toObject(){return this.drawBoard.fabric.canvas.toObject()}fromObject(e){this.drawBoard.fromObject(e)}set edit(e){e?(this.drawMenu.btns.forEach(i=>{i.key!="edit"?i.show():i.hide()}),this.drawBoard.fabric.enableControl()):(this.drawMenu.btns.forEach(i=>{i.key!="edit"&&i.key!="cancel"?i.hide():i.show()}),this.changeType(""),this.drawBoard.fabric.disableControl()),this._edit=e}get edit(){return this._edit}initToolbar(){const e=this,i=this.drawBoard;this.drawMenu=new UP,this.drawMenu.add(s("pen",IP)),this.drawMenu.add(s("rectangle",DP)),this.drawMenu.add(s("ellipse",OP)),this.drawMenu.add(s("arrow",PP)),this.drawMenu.add(s("text",QP)),this.drawMenu.add(this.createColorOption()),this.drawMenu.add(this.createLineWidthOption()),this.drawMenu.add(this.createEditBtn());let r=new ge;r.title="delete",r.key="delete",r.icon=g_,r.onclick=()=>{this.drawBoard.fabric.deleteObj()};let a=new ue(r);this.drawMenu.add(a);let f=new ge;f.title="cancel",f.key="cancel",f.icon=LP,f.onclick=()=>{this.edit=!1,this.onDrawCancel.dispatch()};let o=new ue(f);this.drawMenu.add(o),this.viewport.container.appendChild(this.drawMenu.dom),this.onColorChanged.dispatch("tomato"),this.drawBoard.container.addEventListener("click",()=>{this.colorOptionDiv.style.display="none",this.widthOptionDiv.style.display="none"});function s(l,u){let A=new ge;return A.title=l,A.key=l,A.icon=u,A.onclick=()=>{e.colorOptionDiv.style.display="none",e.widthOptionDiv.style.display="none",i.drawType==A.key?e.changeType(""):e.changeType(A.key)},A.oninit=h=>{h.active=i.drawType==A.key,e.onDrawtypeChanged.add(p=>{h.active=p==A.key})},new ue(A)}}createLineWidthOption(){const e=this,i=l(4),r=l(3),a=l(2);a.click();const f=zr("div","linewidth_div","");f.appendChild(i),f.appendChild(r),f.appendChild(a),f.style.display="none",this.widthOptionDiv=f;let o=new ge;o.title="width",o.key="width",o.icon=HP,o.onclick=()=>{e.toggoleOption(f)};let s=new ue(o);return s.dom.appendChild(f),e.onColorChanged.add(u=>{s.img.style.filter=`drop-shadow(100px 0 0 ${u})`}),s;function l(u){const A=zr("div","drawboard_option","");A.style.padding="0 2px";const c=zr("div","","");return c.style.background=e.color,c.style.height=`${u}px`,c.style.width="100%",A.appendChild(c),A.addEventListener("click",h=>{h.stopPropagation(),e.widthOptions.forEach(p=>p.classList.remove("option_select")),e.drawBoard.fabric.drawWidth=u,e.drawBoard.fabric.canvas.freeDrawingBrush.width=u,A.classList.add("option_select")}),e.onColorChanged.add(h=>{c.style.background=h}),e.widthOptions.push(A),A}}createColorOption(){const e=this,i=h("red"),r=h("lawngreen"),a=h("yellow"),f=h("blue"),o=h("tomato"),s=h("magenta"),l=h("black"),u=zr("div","linewidth_div","");u.appendChild(i),u.appendChild(r),u.appendChild(f),u.appendChild(o),u.appendChild(s),u.appendChild(l),u.appendChild(a),u.style.display="none",this.colorOptionDiv=u;let A=new ge;A.title="color",A.key="color",A.icon=kP,A.onclick=()=>{e.toggoleOption(u)};let c=new ue(A);return c.dom.appendChild(u),o.click(),e.onColorChanged.add(p=>{c.img.style.filter=`drop-shadow(100px 0 0 ${p})`}),c;function h(p){const m=zr("div","drawboard_option",""),d=zr("div","circle_option","");return d.style.background=p,m.appendChild(d),m.addEventListener("click",g=>{g.stopPropagation(),e.colorOptions.forEach(v=>v.classList.remove("option_select")),e.drawBoard.fabric.drawColor=p,e.drawBoard.fabric.canvas.freeDrawingBrush.color=p,m.classList.add("option_select"),e.onColorChanged.dispatch(p)}),e.colorOptions.push(m),m}}createEditBtn(){let e=new ge;return e.title="edit",e.key="edit",e.icon=RP,e.onclick=()=>{console.log(this.edit),this.edit=!this.edit},new ue(e)}toggoleOption(e){e.style.display=="none"?e.style.display="flex":e.style.display="none"}clear(){this.drawBoard.clear()}}function VP(n){if(n.__esModule)return n;var t=n.default;if(typeof t=="function"){var e=function i(){if(this instanceof i){var r=[null];r.push.apply(r,arguments);var a=Function.bind.apply(t,r);return new a}return t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(n).forEach(function(i){var r=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(e,i,r.get?r:{enumerable:!0,get:function(){return n[i]}})}),e}var sr={};const zP={},GP=Object.freeze(Object.defineProperty({__proto__:null,default:zP},Symbol.toStringTag,{value:"Module"})),du=VP(GP);(function(n){/*! Fabric.js Copyright 2008-2015, Printio (Juriy Zaytsev, Maxim Chernyak) */var t=t||{version:"5.3.0"};if(n.fabric=t,typeof document<"u"&&typeof window<"u")document instanceof(typeof HTMLDocument<"u"?HTMLDocument:Document)?t.document=document:t.document=document.implementation.createHTMLDocument(""),t.window=window;else{var e=du,i=new e.JSDOM(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;t.document=i.document,t.jsdomImplForWrapper=du.implForWrapper,t.nodeCanvas=du.Canvas,t.window=i,DOMParser=t.window.DOMParser}t.isTouchSupported="ontouchstart"in t.window||"ontouchstart"in t.document||t.window&&t.window.navigator&&t.window.navigator.maxTouchPoints>0,t.isLikelyNode=typeof Buffer<"u"&&typeof window>"u",t.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"],t.DPI=96,t.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)",t.commaWsp="(?:\\s+,?\\s*|,\\s*)",t.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/ig,t.reNonWord=/[ \n\.,;!\?\-]/,t.fontPaths={},t.iMatrix=[1,0,0,1,0,0],t.svgNS="http://www.w3.org/2000/svg",t.perfLimitSizeTotal=2097152,t.maxCacheSideLimit=4096,t.minCacheSideLimit=256,t.charWidthsCache={},t.textureSize=2048,t.disableStyleCopyPaste=!1,t.enableGLFiltering=!0,t.devicePixelRatio=t.window.devicePixelRatio||t.window.webkitDevicePixelRatio||t.window.mozDevicePixelRatio||1,t.browserShadowBlurConstant=1,t.arcToSegmentsCache={},t.boundsOfCurveCache={},t.cachesBoundsOfCurve=!0,t.forceGLPutImageData=!1,t.initFilterBackend=function(){if(t.enableGLFiltering&&t.isWebglSupported&&t.isWebglSupported(t.textureSize))return console.log("max texture size: "+t.maxTextureSize),new t.WebglFilterBackend({tileSize:t.textureSize});if(t.Canvas2dFilterBackend)return new t.Canvas2dFilterBackend},typeof document<"u"&&typeof window<"u"&&(window.fabric=t),function(){function o(h,p){if(this.__eventListeners[h]){var m=this.__eventListeners[h];p?m[m.indexOf(p)]=!1:t.util.array.fill(m,!1)}}function s(h,p){if(this.__eventListeners||(this.__eventListeners={}),arguments.length===1)for(var m in h)this.on(m,h[m]);else this.__eventListeners[h]||(this.__eventListeners[h]=[]),this.__eventListeners[h].push(p);return this}function l(h,p){var m=function(){p.apply(this,arguments),this.off(h,m)}.bind(this);this.on(h,m)}function u(h,p){if(arguments.length===1)for(var m in h)l.call(this,m,h[m]);else l.call(this,h,p);return this}function A(h,p){if(!this.__eventListeners)return this;if(arguments.length===0)for(h in this.__eventListeners)o.call(this,h);else if(arguments.length===1&&typeof arguments[0]=="object")for(var m in h)o.call(this,m,h[m]);else o.call(this,h,p);return this}function c(h,p){if(!this.__eventListeners)return this;var m=this.__eventListeners[h];if(!m)return this;for(var d=0,g=m.length;d<g;d++)m[d]&&m[d].call(this,p||{});return this.__eventListeners[h]=m.filter(function(v){return v!==!1}),this}t.Observable={fire:c,on:s,once:u,off:A}}(),t.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var o=0,s=arguments.length;o<s;o++)this._onObjectAdded(arguments[o]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(o,s,l){var u=this._objects;return l?u[s]=o:u.splice(s,0,o),this._onObjectAdded&&this._onObjectAdded(o),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var o=this._objects,s,l=!1,u=0,A=arguments.length;u<A;u++)s=o.indexOf(arguments[u]),s!==-1&&(l=!0,o.splice(s,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[u]));return this.renderOnAddRemove&&l&&this.requestRenderAll(),this},forEachObject:function(o,s){for(var l=this.getObjects(),u=0,A=l.length;u<A;u++)o.call(s,l[u],u,l);return this},getObjects:function(o){return typeof o>"u"?this._objects.concat():this._objects.filter(function(s){return s.type===o})},item:function(o){return this._objects[o]},isEmpty:function(){return this._objects.length===0},size:function(){return this._objects.length},contains:function(o,s){return this._objects.indexOf(o)>-1?!0:s?this._objects.some(function(l){return typeof l.contains=="function"&&l.contains(o,!0)}):!1},complexity:function(){return this._objects.reduce(function(o,s){return o+=s.complexity?s.complexity():0,o},0)}},t.CommonMethods={_setOptions:function(o){for(var s in o)this.set(s,o[s])},_initGradient:function(o,s){o&&o.colorStops&&!(o instanceof t.Gradient)&&this.set(s,new t.Gradient(o))},_initPattern:function(o,s,l){o&&o.source&&!(o instanceof t.Pattern)?this.set(s,new t.Pattern(o,l)):l&&l()},_setObject:function(o){for(var s in o)this._set(s,o[s])},set:function(o,s){return typeof o=="object"?this._setObject(o):this._set(o,s),this},_set:function(o,s){this[o]=s},toggle:function(o){var s=this.get(o);return typeof s=="boolean"&&this.set(o,!s),this},get:function(o){return this[o]}},function(o){var s=Math.sqrt,l=Math.atan2,u=Math.pow,A=Math.PI/180,c=Math.PI/2;t.util={cos:function(h){if(h===0)return 1;h<0&&(h=-h);var p=h/c;switch(p){case 1:case 3:return 0;case 2:return-1}return Math.cos(h)},sin:function(h){if(h===0)return 0;var p=h/c,m=1;switch(h<0&&(m=-1),p){case 1:return m;case 2:return 0;case 3:return-m}return Math.sin(h)},removeFromArray:function(h,p){var m=h.indexOf(p);return m!==-1&&h.splice(m,1),h},getRandomInt:function(h,p){return Math.floor(Math.random()*(p-h+1))+h},degreesToRadians:function(h){return h*A},radiansToDegrees:function(h){return h/A},rotatePoint:function(h,p,m){var d=new t.Point(h.x-p.x,h.y-p.y),g=t.util.rotateVector(d,m);return new t.Point(g.x,g.y).addEquals(p)},rotateVector:function(h,p){var m=t.util.sin(p),d=t.util.cos(p),g=h.x*d-h.y*m,v=h.x*m+h.y*d;return{x:g,y:v}},createVector:function(h,p){return new t.Point(p.x-h.x,p.y-h.y)},calcAngleBetweenVectors:function(h,p){return Math.acos((h.x*p.x+h.y*p.y)/(Math.hypot(h.x,h.y)*Math.hypot(p.x,p.y)))},getHatVector:function(h){return new t.Point(h.x,h.y).multiply(1/Math.hypot(h.x,h.y))},getBisector:function(h,p,m){var d=t.util.createVector(h,p),g=t.util.createVector(h,m),v=t.util.calcAngleBetweenVectors(d,g),w=t.util.calcAngleBetweenVectors(t.util.rotateVector(d,v),g),_=v*(w===0?1:-1)/2;return{vector:t.util.getHatVector(t.util.rotateVector(d,_)),angle:v}},projectStrokeOnPoints:function(h,p,m){var d=[],g=p.strokeWidth/2,v=p.strokeUniform?new t.Point(1/p.scaleX,1/p.scaleY):new t.Point(1,1),w=function(_){var y=g/Math.hypot(_.x,_.y);return new t.Point(_.x*y*v.x,_.y*y*v.y)};return h.length<=1||h.forEach(function(_,y){var C=new t.Point(_.x,_.y),b,S;y===0?(S=h[y+1],b=m?w(t.util.createVector(S,C)).addEquals(C):h[h.length-1]):y===h.length-1?(b=h[y-1],S=m?w(t.util.createVector(b,C)).addEquals(C):h[0]):(b=h[y-1],S=h[y+1]);var B=t.util.getBisector(C,b,S),M=B.vector,z=B.angle,G,P;if(p.strokeLineJoin==="miter"&&(G=-g/Math.sin(z/2),P=new t.Point(M.x*G*v.x,M.y*G*v.y),Math.hypot(P.x,P.y)/g<=p.strokeMiterLimit)){d.push(C.add(P)),d.push(C.subtract(P));return}G=-g*Math.SQRT2,P=new t.Point(M.x*G*v.x,M.y*G*v.y),d.push(C.add(P)),d.push(C.subtract(P))}),d},transformPoint:function(h,p,m){return m?new t.Point(p[0]*h.x+p[2]*h.y,p[1]*h.x+p[3]*h.y):new t.Point(p[0]*h.x+p[2]*h.y+p[4],p[1]*h.x+p[3]*h.y+p[5])},makeBoundingBoxFromPoints:function(h,p){if(p)for(var m=0;m<h.length;m++)h[m]=t.util.transformPoint(h[m],p);var d=[h[0].x,h[1].x,h[2].x,h[3].x],g=t.util.array.min(d),v=t.util.array.max(d),w=v-g,_=[h[0].y,h[1].y,h[2].y,h[3].y],y=t.util.array.min(_),C=t.util.array.max(_),b=C-y;return{left:g,top:y,width:w,height:b}},invertTransform:function(h){var p=1/(h[0]*h[3]-h[1]*h[2]),m=[p*h[3],-p*h[1],-p*h[2],p*h[0]],d=t.util.transformPoint({x:h[4],y:h[5]},m,!0);return m[4]=-d.x,m[5]=-d.y,m},toFixed:function(h,p){return parseFloat(Number(h).toFixed(p))},parseUnit:function(h,p){var m=/\D{0,2}$/.exec(h),d=parseFloat(h);switch(p||(p=t.Text.DEFAULT_SVG_FONT_SIZE),m[0]){case"mm":return d*t.DPI/25.4;case"cm":return d*t.DPI/2.54;case"in":return d*t.DPI;case"pt":return d*t.DPI/72;case"pc":return d*t.DPI/72*12;case"em":return d*p;default:return d}},falseFunction:function(){return!1},getKlass:function(h,p){return h=t.util.string.camelize(h.charAt(0).toUpperCase()+h.slice(1)),t.util.resolveNamespace(p)[h]},getSvgAttributes:function(h){var p=["instantiated_by_use","style","id","class"];switch(h){case"linearGradient":p=p.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":p=p.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":p=p.concat(["offset","stop-color","stop-opacity"]);break}return p},resolveNamespace:function(h){if(!h)return t;var p=h.split("."),m=p.length,d,g=o||t.window;for(d=0;d<m;++d)g=g[p[d]];return g},loadImage:function(h,p,m,d){if(!h){p&&p.call(m,h);return}var g=t.util.createImage(),v=function(){p&&p.call(m,g,!1),g=g.onload=g.onerror=null};g.onload=v,g.onerror=function(){t.log("Error loading "+g.src),p&&p.call(m,null,!0),g=g.onload=g.onerror=null},h.indexOf("data")!==0&&d!==void 0&&d!==null&&(g.crossOrigin=d),h.substring(0,14)==="data:image/svg"&&(g.onload=null,t.util.loadImageInDom(g,v)),g.src=h},loadImageInDom:function(h,p){var m=t.document.createElement("div");m.style.width=m.style.height="1px",m.style.left=m.style.top="-100%",m.style.position="absolute",m.appendChild(h),t.document.querySelector("body").appendChild(m),h.onload=function(){p(),m.parentNode.removeChild(m),m=null}},enlivenObjects:function(h,p,m,d){h=h||[];var g=[],v=0,w=h.length;function _(){++v===w&&p&&p(g.filter(function(y){return y}))}if(!w){p&&p(g);return}h.forEach(function(y,C){if(!y||!y.type){_();return}var b=t.util.getKlass(y.type,m);b.fromObject(y,function(S,B){B||(g[C]=S),d&&d(y,S,B),_()})})},enlivenObjectEnlivables:function(h,p,m){var d=t.Object.ENLIVEN_PROPS.filter(function(g){return!!h[g]});t.util.enlivenObjects(d.map(function(g){return h[g]}),function(g){var v={};d.forEach(function(w,_){v[w]=g[_],p&&(p[w]=g[_])}),m&&m(v)})},enlivenPatterns:function(h,p){h=h||[];function m(){++g===v&&p&&p(d)}var d=[],g=0,v=h.length;if(!v){p&&p(d);return}h.forEach(function(w,_){w&&w.source?new t.Pattern(w,function(y){d[_]=y,m()}):(d[_]=w,m())})},groupSVGElements:function(h,p,m){var d;return h&&h.length===1?(typeof m<"u"&&(h[0].sourcePath=m),h[0]):(p&&(p.width&&p.height?p.centerPoint={x:p.width/2,y:p.height/2}:(delete p.width,delete p.height)),d=new t.Group(h,p),typeof m<"u"&&(d.sourcePath=m),d)},populateWithProperties:function(h,p,m){if(m&&Array.isArray(m))for(var d=0,g=m.length;d<g;d++)m[d]in h&&(p[m[d]]=h[m[d]])},createCanvasElement:function(){return t.document.createElement("canvas")},copyCanvasElement:function(h){var p=t.util.createCanvasElement();return p.width=h.width,p.height=h.height,p.getContext("2d").drawImage(h,0,0),p},toDataURL:function(h,p,m){return h.toDataURL("image/"+p,m)},createImage:function(){return t.document.createElement("img")},multiplyTransformMatrices:function(h,p,m){return[h[0]*p[0]+h[2]*p[1],h[1]*p[0]+h[3]*p[1],h[0]*p[2]+h[2]*p[3],h[1]*p[2]+h[3]*p[3],m?0:h[0]*p[4]+h[2]*p[5]+h[4],m?0:h[1]*p[4]+h[3]*p[5]+h[5]]},qrDecompose:function(h){var p=l(h[1],h[0]),m=u(h[0],2)+u(h[1],2),d=s(m),g=(h[0]*h[3]-h[2]*h[1])/d,v=l(h[0]*h[2]+h[1]*h[3],m);return{angle:p/A,scaleX:d,scaleY:g,skewX:v/A,skewY:0,translateX:h[4],translateY:h[5]}},calcRotateMatrix:function(h){if(!h.angle)return t.iMatrix.concat();var p=t.util.degreesToRadians(h.angle),m=t.util.cos(p),d=t.util.sin(p);return[m,d,-d,m,0,0]},calcDimensionsMatrix:function(h){var p=typeof h.scaleX>"u"?1:h.scaleX,m=typeof h.scaleY>"u"?1:h.scaleY,d=[h.flipX?-p:p,0,0,h.flipY?-m:m,0,0],g=t.util.multiplyTransformMatrices,v=t.util.degreesToRadians;return h.skewX&&(d=g(d,[1,0,Math.tan(v(h.skewX)),1],!0)),h.skewY&&(d=g(d,[1,Math.tan(v(h.skewY)),0,1],!0)),d},composeMatrix:function(h){var p=[1,0,0,1,h.translateX||0,h.translateY||0],m=t.util.multiplyTransformMatrices;return h.angle&&(p=m(p,t.util.calcRotateMatrix(h))),(h.scaleX!==1||h.scaleY!==1||h.skewX||h.skewY||h.flipX||h.flipY)&&(p=m(p,t.util.calcDimensionsMatrix(h))),p},resetObjectTransform:function(h){h.scaleX=1,h.scaleY=1,h.skewX=0,h.skewY=0,h.flipX=!1,h.flipY=!1,h.rotate(0)},saveObjectTransform:function(h){return{scaleX:h.scaleX,scaleY:h.scaleY,skewX:h.skewX,skewY:h.skewY,angle:h.angle,left:h.left,flipX:h.flipX,flipY:h.flipY,top:h.top}},isTransparent:function(h,p,m,d){d>0&&(p>d?p-=d:p=0,m>d?m-=d:m=0);var g=!0,v,w,_=h.getImageData(p,m,d*2||1,d*2||1),y=_.data.length;for(v=3;v<y&&(w=_.data[v],g=w<=0,g!==!1);v+=4);return _=null,g},parsePreserveAspectRatioAttribute:function(h){var p="meet",m="Mid",d="Mid",g=h.split(" "),v;return g&&g.length&&(p=g.pop(),p!=="meet"&&p!=="slice"?(v=p,p="meet"):g.length&&(v=g.pop())),m=v!=="none"?v.slice(1,4):"none",d=v!=="none"?v.slice(5,8):"none",{meetOrSlice:p,alignX:m,alignY:d}},clearFabricFontCache:function(h){h=(h||"").toLowerCase(),h?t.charWidthsCache[h]&&delete t.charWidthsCache[h]:t.charWidthsCache={}},limitDimsByArea:function(h,p){var m=Math.sqrt(p*h),d=Math.floor(p/m);return{x:Math.floor(m),y:d}},capValue:function(h,p,m){return Math.max(h,Math.min(p,m))},findScaleToFit:function(h,p){return Math.min(p.width/h.width,p.height/h.height)},findScaleToCover:function(h,p){return Math.max(p.width/h.width,p.height/h.height)},matrixToSVG:function(h){return"matrix("+h.map(function(p){return t.util.toFixed(p,t.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"},removeTransformFromObject:function(h,p){var m=t.util.invertTransform(p),d=t.util.multiplyTransformMatrices(m,h.calcOwnMatrix());t.util.applyTransformToObject(h,d)},addTransformToObject:function(h,p){t.util.applyTransformToObject(h,t.util.multiplyTransformMatrices(p,h.calcOwnMatrix()))},applyTransformToObject:function(h,p){var m=t.util.qrDecompose(p),d=new t.Point(m.translateX,m.translateY);h.flipX=!1,h.flipY=!1,h.set("scaleX",m.scaleX),h.set("scaleY",m.scaleY),h.skewX=m.skewX,h.skewY=m.skewY,h.angle=m.angle,h.setPositionByOrigin(d,"center","center")},sizeAfterTransform:function(h,p,m){var d=h/2,g=p/2,v=[{x:-d,y:-g},{x:d,y:-g},{x:-d,y:g},{x:d,y:g}],w=t.util.calcDimensionsMatrix(m),_=t.util.makeBoundingBoxFromPoints(v,w);return{x:_.width,y:_.height}},mergeClipPaths:function(h,p){var m=h,d=p;m.inverted&&!d.inverted&&(m=p,d=h),t.util.applyTransformToObject(d,t.util.multiplyTransformMatrices(t.util.invertTransform(m.calcTransformMatrix()),d.calcTransformMatrix()));var g=m.inverted&&d.inverted;return g&&(m.inverted=d.inverted=!1),new t.Group([m],{clipPath:d,inverted:g})},hasStyleChanged:function(h,p,m){return m=m||!1,h.fill!==p.fill||h.stroke!==p.stroke||h.strokeWidth!==p.strokeWidth||h.fontSize!==p.fontSize||h.fontFamily!==p.fontFamily||h.fontWeight!==p.fontWeight||h.fontStyle!==p.fontStyle||h.textBackgroundColor!==p.textBackgroundColor||h.deltaY!==p.deltaY||m&&(h.overline!==p.overline||h.underline!==p.underline||h.linethrough!==p.linethrough)},stylesToArray:function(m,p){for(var m=t.util.object.clone(m,!0),d=p.split(`
`),g=-1,v={},w=[],_=0;_<d.length;_++){if(!m[_]){g+=d[_].length;continue}for(var y=0;y<d[_].length;y++){g++;var C=m[_][y];if(C&&Object.keys(C).length>0){var b=t.util.hasStyleChanged(v,C,!0);b?w.push({start:g,end:g+1,style:C}):w[w.length-1].end++}v=C||{}}}return w},stylesFromArray:function(h,p){if(!Array.isArray(h))return h;for(var m=p.split(`
`),d=-1,g=0,v={},w=0;w<m.length;w++)for(var _=0;_<m[w].length;_++)d++,h[g]&&h[g].start<=d&&d<h[g].end&&(v[w]=v[w]||{},v[w][_]=Object.assign({},h[g].style),d===h[g].end-1&&g++);return v}}}(n),function(){var o=Array.prototype.join,s={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},l={m:"l",M:"L"};function u(E,I,Q,D,k,U,T,V,O,et,q){var J=t.util.cos(E),st=t.util.sin(E),gt=t.util.cos(I),Y=t.util.sin(I),X=Q*k*gt-D*U*Y+T,ot=D*k*gt+Q*U*Y+V,At=et+O*(-Q*k*st-D*U*J),rt=q+O*(-D*k*st+Q*U*J),lt=X+O*(Q*k*Y+D*U*gt),mt=ot+O*(D*k*Y-Q*U*gt);return["C",At,rt,lt,mt,X,ot]}function A(E,I,Q,D,k,U,T){var V=Math.PI,O=T*V/180,et=t.util.sin(O),q=t.util.cos(O),J=0,st=0;Q=Math.abs(Q),D=Math.abs(D);var gt=-q*E*.5-et*I*.5,Y=-q*I*.5+et*E*.5,X=Q*Q,ot=D*D,At=Y*Y,rt=gt*gt,lt=X*ot-X*At-ot*rt,mt=0;if(lt<0){var St=Math.sqrt(1-lt/(X*ot));Q*=St,D*=St}else mt=(k===U?-1:1)*Math.sqrt(lt/(X*At+ot*rt));var bt=mt*Q*Y/D,F=-mt*D*gt/Q,L=q*bt-et*F+E*.5,it=et*bt+q*F+I*.5,ct=c(1,0,(gt-bt)/Q,(Y-F)/D),dt=c((gt-bt)/Q,(Y-F)/D,(-gt-bt)/Q,(-Y-F)/D);U===0&&dt>0?dt-=2*V:U===1&&dt<0&&(dt+=2*V);for(var vt=Math.ceil(Math.abs(dt/V*2)),Ut=[],Ct=dt/vt,ht=8/3*Math.sin(Ct/4)*Math.sin(Ct/4)/Math.sin(Ct/2),It=ct+Ct,Lt=0;Lt<vt;Lt++)Ut[Lt]=u(ct,It,q,et,Q,D,L,it,ht,J,st),J=Ut[Lt][5],st=Ut[Lt][6],ct=It,It+=Ct;return Ut}function c(E,I,Q,D){var k=Math.atan2(I,E),U=Math.atan2(D,Q);return U>=k?U-k:2*Math.PI-(k-U)}function h(E,I,Q,D,k,U,T,V){var O;if(t.cachesBoundsOfCurve&&(O=o.call(arguments),t.boundsOfCurveCache[O]))return t.boundsOfCurveCache[O];var et=Math.sqrt,q=Math.min,J=Math.max,st=Math.abs,gt=[],Y=[[],[]],X,ot,At,rt,lt,mt,St,bt;ot=6*E-12*Q+6*k,X=-3*E+9*Q-9*k+3*T,At=3*Q-3*E;for(var F=0;F<2;++F){if(F>0&&(ot=6*I-12*D+6*U,X=-3*I+9*D-9*U+3*V,At=3*D-3*I),st(X)<1e-12){if(st(ot)<1e-12)continue;rt=-At/ot,0<rt&&rt<1&&gt.push(rt);continue}St=ot*ot-4*At*X,!(St<0)&&(bt=et(St),lt=(-ot+bt)/(2*X),0<lt&&lt<1&&gt.push(lt),mt=(-ot-bt)/(2*X),0<mt&&mt<1&&gt.push(mt))}for(var L,it,ct=gt.length,dt=ct,vt;ct--;)rt=gt[ct],vt=1-rt,L=vt*vt*vt*E+3*vt*vt*rt*Q+3*vt*rt*rt*k+rt*rt*rt*T,Y[0][ct]=L,it=vt*vt*vt*I+3*vt*vt*rt*D+3*vt*rt*rt*U+rt*rt*rt*V,Y[1][ct]=it;Y[0][dt]=E,Y[1][dt]=I,Y[0][dt+1]=T,Y[1][dt+1]=V;var Ut=[{x:q.apply(null,Y[0]),y:q.apply(null,Y[1])},{x:J.apply(null,Y[0]),y:J.apply(null,Y[1])}];return t.cachesBoundsOfCurve&&(t.boundsOfCurveCache[O]=Ut),Ut}function p(E,I,Q){for(var D=Q[1],k=Q[2],U=Q[3],T=Q[4],V=Q[5],O=Q[6],et=Q[7],q=A(O-E,et-I,D,k,T,V,U),J=0,st=q.length;J<st;J++)q[J][1]+=E,q[J][2]+=I,q[J][3]+=E,q[J][4]+=I,q[J][5]+=E,q[J][6]+=I;return q}function m(E){var I=0,Q=0,D=E.length,k=0,U=0,T,V,O,et=[],q,J,st;for(V=0;V<D;++V){switch(O=!1,T=E[V].slice(0),T[0]){case"l":T[0]="L",T[1]+=I,T[2]+=Q;case"L":I=T[1],Q=T[2];break;case"h":T[1]+=I;case"H":T[0]="L",T[2]=Q,I=T[1];break;case"v":T[1]+=Q;case"V":T[0]="L",Q=T[1],T[1]=I,T[2]=Q;break;case"m":T[0]="M",T[1]+=I,T[2]+=Q;case"M":I=T[1],Q=T[2],k=T[1],U=T[2];break;case"c":T[0]="C",T[1]+=I,T[2]+=Q,T[3]+=I,T[4]+=Q,T[5]+=I,T[6]+=Q;case"C":J=T[3],st=T[4],I=T[5],Q=T[6];break;case"s":T[0]="S",T[1]+=I,T[2]+=Q,T[3]+=I,T[4]+=Q;case"S":q==="C"?(J=2*I-J,st=2*Q-st):(J=I,st=Q),I=T[3],Q=T[4],T[0]="C",T[5]=T[3],T[6]=T[4],T[3]=T[1],T[4]=T[2],T[1]=J,T[2]=st,J=T[3],st=T[4];break;case"q":T[0]="Q",T[1]+=I,T[2]+=Q,T[3]+=I,T[4]+=Q;case"Q":J=T[1],st=T[2],I=T[3],Q=T[4];break;case"t":T[0]="T",T[1]+=I,T[2]+=Q;case"T":q==="Q"?(J=2*I-J,st=2*Q-st):(J=I,st=Q),T[0]="Q",I=T[1],Q=T[2],T[1]=J,T[2]=st,T[3]=I,T[4]=Q;break;case"a":T[0]="A",T[6]+=I,T[7]+=Q;case"A":O=!0,et=et.concat(p(I,Q,T)),I=T[6],Q=T[7];break;case"z":case"Z":I=k,Q=U;break}O||et.push(T),q=T[0]}return et}function d(E,I,Q,D){return Math.sqrt((Q-E)*(Q-E)+(D-I)*(D-I))}function g(E){return E*E*E}function v(E){return 3*E*E*(1-E)}function w(E){return 3*E*(1-E)*(1-E)}function _(E){return(1-E)*(1-E)*(1-E)}function y(E,I,Q,D,k,U,T,V){return function(O){var et=g(O),q=v(O),J=w(O),st=_(O);return{x:T*et+k*q+Q*J+E*st,y:V*et+U*q+D*J+I*st}}}function C(E,I,Q,D,k,U,T,V){return function(O){var et=1-O,q=3*et*et*(Q-E)+6*et*O*(k-Q)+3*O*O*(T-k),J=3*et*et*(D-I)+6*et*O*(U-D)+3*O*O*(V-U);return Math.atan2(J,q)}}function b(E){return E*E}function S(E){return 2*E*(1-E)}function B(E){return(1-E)*(1-E)}function M(E,I,Q,D,k,U){return function(T){var V=b(T),O=S(T),et=B(T);return{x:k*V+Q*O+E*et,y:U*V+D*O+I*et}}}function z(E,I,Q,D,k,U){return function(T){var V=1-T,O=2*V*(Q-E)+2*T*(k-Q),et=2*V*(D-I)+2*T*(U-D);return Math.atan2(et,O)}}function G(E,I,Q){var D={x:I,y:Q},k,U=0,T;for(T=1;T<=100;T+=1)k=E(T/100),U+=d(D.x,D.y,k.x,k.y),D=k;return U}function P(E,I){for(var Q=0,D=0,k=E.iterator,U={x:E.x,y:E.y},T,V,O=.01,et=E.angleFinder,q;D<I&&O>1e-4;)T=k(Q),q=Q,V=d(U.x,U.y,T.x,T.y),V+D>I?(Q-=O,O/=2):(U=T,Q+=O,D+=V);return T.angle=et(q),T}function R(E){for(var I=0,Q=E.length,D,k=0,U=0,T=0,V=0,O=[],et,q,J,st=0;st<Q;st++){switch(D=E[st],q={x:k,y:U,command:D[0]},D[0]){case"M":q.length=0,T=k=D[1],V=U=D[2];break;case"L":q.length=d(k,U,D[1],D[2]),k=D[1],U=D[2];break;case"C":et=y(k,U,D[1],D[2],D[3],D[4],D[5],D[6]),J=C(k,U,D[1],D[2],D[3],D[4],D[5],D[6]),q.iterator=et,q.angleFinder=J,q.length=G(et,k,U),k=D[5],U=D[6];break;case"Q":et=M(k,U,D[1],D[2],D[3],D[4]),J=z(k,U,D[1],D[2],D[3],D[4]),q.iterator=et,q.angleFinder=J,q.length=G(et,k,U),k=D[3],U=D[4];break;case"Z":case"z":q.destX=T,q.destY=V,q.length=d(k,U,T,V),k=T,U=V;break}I+=q.length,O.push(q)}return O.push({length:I,x:k,y:U}),O}function W(E,I,Q){Q||(Q=R(E));for(var D=0;I-Q[D].length>0&&D<Q.length-2;)I-=Q[D].length,D++;var k=Q[D],U=I/k.length,T=k.command,V=E[D],O;switch(T){case"M":return{x:k.x,y:k.y,angle:0};case"Z":case"z":return O=new t.Point(k.x,k.y).lerp(new t.Point(k.destX,k.destY),U),O.angle=Math.atan2(k.destY-k.y,k.destX-k.x),O;case"L":return O=new t.Point(k.x,k.y).lerp(new t.Point(V[1],V[2]),U),O.angle=Math.atan2(V[2]-k.y,V[1]-k.x),O;case"C":return P(k,I);case"Q":return P(k,I)}}function K(E){var I=[],Q=[],D,k,U=t.rePathCommand,T="[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?\\s*",V="("+T+")"+t.commaWsp,O="([01])"+t.commaWsp+"?",et=V+"?"+V+"?"+V+O+O+V+"?("+T+")",q=new RegExp(et,"g"),J,st,gt;if(!E||!E.match)return I;gt=E.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);for(var Y=0,X,ot=gt.length;Y<ot;Y++){D=gt[Y],st=D.slice(1).trim(),Q.length=0;var At=D.charAt(0);if(X=[At],At.toLowerCase()==="a")for(var rt;rt=q.exec(st);)for(var lt=1;lt<rt.length;lt++)Q.push(rt[lt]);else for(;J=U.exec(st);)Q.push(J[0]);for(var lt=0,mt=Q.length;lt<mt;lt++)k=parseFloat(Q[lt]),isNaN(k)||X.push(k);var St=s[At.toLowerCase()],bt=l[At]||At;if(X.length-1>St)for(var F=1,L=X.length;F<L;F+=St)I.push([At].concat(X.slice(F,F+St))),At=bt;else I.push(X)}return I}function tt(E,I){var Q=[],D,k=new t.Point(E[0].x,E[0].y),U=new t.Point(E[1].x,E[1].y),T=E.length,V=1,O=0,et=T>2;for(I=I||0,et&&(V=E[2].x<U.x?-1:E[2].x===U.x?0:1,O=E[2].y<U.y?-1:E[2].y===U.y?0:1),Q.push(["M",k.x-V*I,k.y-O*I]),D=1;D<T;D++){if(!k.eq(U)){var q=k.midPointFrom(U);Q.push(["Q",k.x,k.y,q.x,q.y])}k=E[D],D+1<E.length&&(U=E[D+1])}return et&&(V=k.x>E[D-2].x?1:k.x===E[D-2].x?0:-1,O=k.y>E[D-2].y?1:k.y===E[D-2].y?0:-1),Q.push(["L",k.x+V*I,k.y+O*I]),Q}function j(E,I,Q){return Q&&(I=t.util.multiplyTransformMatrices(I,[1,0,0,1,-Q.x,-Q.y])),E.map(function(D){for(var k=D.slice(0),U={},T=1;T<D.length-1;T+=2)U.x=D[T],U.y=D[T+1],U=t.util.transformPoint(U,I),k[T]=U.x,k[T+1]=U.y;return k})}t.util.joinPath=function(E){return E.map(function(I){return I.join(" ")}).join(" ")},t.util.parsePath=K,t.util.makePathSimpler=m,t.util.getSmoothPathFromPoints=tt,t.util.getPathSegmentsInfo=R,t.util.getBoundsOfCurve=h,t.util.getPointOnPath=W,t.util.transformPath=j}(),function(){var o=Array.prototype.slice;function s(h,p){for(var m=o.call(arguments,2),d=[],g=0,v=h.length;g<v;g++)d[g]=m.length?h[g][p].apply(h[g],m):h[g][p].call(h[g]);return d}function l(h,p){return c(h,p,function(m,d){return m>=d})}function u(h,p){return c(h,p,function(m,d){return m<d})}function A(h,p){for(var m=h.length;m--;)h[m]=p;return h}function c(h,p,m){if(!(!h||h.length===0)){var d=h.length-1,g=p?h[d][p]:h[d];if(p)for(;d--;)m(h[d][p],g)&&(g=h[d][p]);else for(;d--;)m(h[d],g)&&(g=h[d]);return g}}t.util.array={fill:A,invoke:s,min:u,max:l}}(),function(){function o(l,u,A){if(A)if(!t.isLikelyNode&&u instanceof Element)l=u;else if(u instanceof Array){l=[];for(var c=0,h=u.length;c<h;c++)l[c]=o({},u[c],A)}else if(u&&typeof u=="object")for(var p in u)p==="canvas"||p==="group"?l[p]=null:u.hasOwnProperty(p)&&(l[p]=o({},u[p],A));else l=u;else for(var p in u)l[p]=u[p];return l}function s(l,u){return o({},l,u)}t.util.object={extend:o,clone:s},t.util.object.extend(t.util,t.Observable)}(),function(){function o(c){return c.replace(/-+(.)?/g,function(h,p){return p?p.toUpperCase():""})}function s(c,h){return c.charAt(0).toUpperCase()+(h?c.slice(1):c.slice(1).toLowerCase())}function l(c){return c.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function u(c){var h=0,p,m=[];for(h=0,p;h<c.length;h++)(p=A(c,h))!==!1&&m.push(p);return m}function A(c,h){var p=c.charCodeAt(h);if(isNaN(p))return"";if(p<55296||p>57343)return c.charAt(h);if(55296<=p&&p<=56319){if(c.length<=h+1)throw"High surrogate without following low surrogate";var m=c.charCodeAt(h+1);if(56320>m||m>57343)throw"High surrogate without following low surrogate";return c.charAt(h)+c.charAt(h+1)}if(h===0)throw"Low surrogate without preceding high surrogate";var d=c.charCodeAt(h-1);if(55296>d||d>56319)throw"Low surrogate without preceding high surrogate";return!1}t.util.string={camelize:o,capitalize:s,escapeXml:l,graphemeSplit:u}}(),function(){var o=Array.prototype.slice,s=function(){},l=function(){for(var p in{toString:1})if(p==="toString")return!1;return!0}(),u=function(p,m,d){for(var g in m)g in p.prototype&&typeof p.prototype[g]=="function"&&(m[g]+"").indexOf("callSuper")>-1?p.prototype[g]=function(v){return function(){var w=this.constructor.superclass;this.constructor.superclass=d;var _=m[v].apply(this,arguments);if(this.constructor.superclass=w,v!=="initialize")return _}}(g):p.prototype[g]=m[g],l&&(m.toString!==Object.prototype.toString&&(p.prototype.toString=m.toString),m.valueOf!==Object.prototype.valueOf&&(p.prototype.valueOf=m.valueOf))};function A(){}function c(p){for(var m=null,d=this;d.constructor.superclass;){var g=d.constructor.superclass.prototype[p];if(d[p]!==g){m=g;break}d=d.constructor.superclass.prototype}return m?arguments.length>1?m.apply(this,o.call(arguments,1)):m.call(this):console.log("tried to callSuper "+p+", method not found in prototype chain",this)}function h(){var p=null,m=o.call(arguments,0);typeof m[0]=="function"&&(p=m.shift());function d(){this.initialize.apply(this,arguments)}d.superclass=p,d.subclasses=[],p&&(A.prototype=p.prototype,d.prototype=new A,p.subclasses.push(d));for(var g=0,v=m.length;g<v;g++)u(d,m[g],p);return d.prototype.initialize||(d.prototype.initialize=s),d.prototype.constructor=d,d.prototype.callSuper=c,d}t.util.createClass=h}(),function(){var o=!!t.document.createElement("div").attachEvent,s=["touchstart","touchmove","touchend"];t.util.addListener=function(u,A,c,h){u&&u.addEventListener(A,c,o?!1:h)},t.util.removeListener=function(u,A,c,h){u&&u.removeEventListener(A,c,o?!1:h)};function l(u){var A=u.changedTouches;return A&&A[0]?A[0]:u}t.util.getPointer=function(u){var A=u.target,c=t.util.getScrollLeftTop(A),h=l(u);return{x:h.clientX+c.left,y:h.clientY+c.top}},t.util.isTouchEvent=function(u){return s.indexOf(u.type)>-1||u.pointerType==="touch"}}(),function(){function o(h,p){var m=h.style;if(!m)return h;if(typeof p=="string")return h.style.cssText+=";"+p,p.indexOf("opacity")>-1?c(h,p.match(/opacity:\s*(\d?\.?\d*)/)[1]):h;for(var d in p)if(d==="opacity")c(h,p[d]);else{var g=d==="float"||d==="cssFloat"?typeof m.styleFloat>"u"?"cssFloat":"styleFloat":d;m.setProperty(g,p[d])}return h}var s=t.document.createElement("div"),l=typeof s.style.opacity=="string",u=typeof s.style.filter=="string",A=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,c=function(h){return h};l?c=function(h,p){return h.style.opacity=p,h}:u&&(c=function(h,p){var m=h.style;return h.currentStyle&&!h.currentStyle.hasLayout&&(m.zoom=1),A.test(m.filter)?(p=p>=.9999?"":"alpha(opacity="+p*100+")",m.filter=m.filter.replace(A,p)):m.filter+=" alpha(opacity="+p*100+")",h}),t.util.setStyle=o}(),function(){var o=Array.prototype.slice;function s(_){return typeof _=="string"?t.document.getElementById(_):_}var l,u=function(_){return o.call(_,0)};try{l=u(t.document.childNodes)instanceof Array}catch{}l||(u=function(_){for(var y=new Array(_.length),C=_.length;C--;)y[C]=_[C];return y});function A(_,y){var C=t.document.createElement(_);for(var b in y)b==="class"?C.className=y[b]:b==="for"?C.htmlFor=y[b]:C.setAttribute(b,y[b]);return C}function c(_,y){_&&(" "+_.className+" ").indexOf(" "+y+" ")===-1&&(_.className+=(_.className?" ":"")+y)}function h(_,y,C){return typeof y=="string"&&(y=A(y,C)),_.parentNode&&_.parentNode.replaceChild(y,_),y.appendChild(_),y}function p(_){for(var y=0,C=0,b=t.document.documentElement,S=t.document.body||{scrollLeft:0,scrollTop:0};_&&(_.parentNode||_.host)&&(_=_.parentNode||_.host,_===t.document?(y=S.scrollLeft||b.scrollLeft||0,C=S.scrollTop||b.scrollTop||0):(y+=_.scrollLeft||0,C+=_.scrollTop||0),!(_.nodeType===1&&_.style.position==="fixed")););return{left:y,top:C}}function m(_){var y,C=_&&_.ownerDocument,b={left:0,top:0},S={left:0,top:0},B,M={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!C)return S;for(var z in M)S[M[z]]+=parseInt(d(_,z),10)||0;return y=C.documentElement,typeof _.getBoundingClientRect<"u"&&(b=_.getBoundingClientRect()),B=p(_),{left:b.left+B.left-(y.clientLeft||0)+S.left,top:b.top+B.top-(y.clientTop||0)+S.top}}var d;t.document.defaultView&&t.document.defaultView.getComputedStyle?d=function(_,y){var C=t.document.defaultView.getComputedStyle(_,null);return C?C[y]:void 0}:d=function(_,y){var C=_.style[y];return!C&&_.currentStyle&&(C=_.currentStyle[y]),C},function(){var _=t.document.documentElement.style,y="userSelect"in _?"userSelect":"MozUserSelect"in _?"MozUserSelect":"WebkitUserSelect"in _?"WebkitUserSelect":"KhtmlUserSelect"in _?"KhtmlUserSelect":"";function C(S){return typeof S.onselectstart<"u"&&(S.onselectstart=t.util.falseFunction),y?S.style[y]="none":typeof S.unselectable=="string"&&(S.unselectable="on"),S}function b(S){return typeof S.onselectstart<"u"&&(S.onselectstart=null),y?S.style[y]="":typeof S.unselectable=="string"&&(S.unselectable=""),S}t.util.makeElementUnselectable=C,t.util.makeElementSelectable=b}();function g(_){var y=t.jsdomImplForWrapper(_);return y._canvas||y._image}function v(_){if(t.isLikelyNode){var y=t.jsdomImplForWrapper(_);y&&(y._image=null,y._canvas=null,y._currentSrc=null,y._attributes=null,y._classList=null)}}function w(_,y){_.imageSmoothingEnabled=_.imageSmoothingEnabled||_.webkitImageSmoothingEnabled||_.mozImageSmoothingEnabled||_.msImageSmoothingEnabled||_.oImageSmoothingEnabled,_.imageSmoothingEnabled=y}t.util.setImageSmoothing=w,t.util.getById=s,t.util.toArray=u,t.util.addClass=c,t.util.makeElement=A,t.util.wrapElement=h,t.util.getScrollLeftTop=p,t.util.getElementOffset=m,t.util.getNodeCanvas=g,t.util.cleanUpJsdomNode=v}(),function(){function o(u,A){return u+(/\?/.test(u)?"&":"?")+A}function s(){}function l(u,A){A||(A={});var c=A.method?A.method.toUpperCase():"GET",h=A.onComplete||function(){},p=new t.window.XMLHttpRequest,m=A.body||A.parameters;return p.onreadystatechange=function(){p.readyState===4&&(h(p),p.onreadystatechange=s)},c==="GET"&&(m=null,typeof A.parameters=="string"&&(u=o(u,A.parameters))),p.open(c,u,!0),(c==="POST"||c==="PUT")&&p.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),p.send(m),p}t.util.request=l}(),t.log=console.log,t.warn=console.warn,function(){var o=t.util.object.extend,s=t.util.object.clone,l=[];t.util.object.extend(l,{cancelAll:function(){var g=this.splice(0);return g.forEach(function(v){v.cancel()}),g},cancelByCanvas:function(g){if(!g)return[];var v=this.filter(function(w){return typeof w.target=="object"&&w.target.canvas===g});return v.forEach(function(w){w.cancel()}),v},cancelByTarget:function(g){var v=this.findAnimationsByTarget(g);return v.forEach(function(w){w.cancel()}),v},findAnimationIndex:function(g){return this.indexOf(this.findAnimation(g))},findAnimation:function(g){return this.find(function(v){return v.cancel===g})},findAnimationsByTarget:function(g){return g?this.filter(function(v){return v.target===g}):[]}});function u(){return!1}function A(g,v,w,_){return-w*Math.cos(g/_*(Math.PI/2))+w+v}function c(g){g||(g={});var v=!1,w,_=function(){var y=t.runningAnimations.indexOf(w);return y>-1&&t.runningAnimations.splice(y,1)[0]};return w=o(s(g),{cancel:function(){return v=!0,_()},currentValue:"startValue"in g?g.startValue:0,completionRate:0,durationRate:0}),t.runningAnimations.push(w),m(function(y){var C=y||+new Date,b=g.duration||500,S=C+b,B,M=g.onChange||u,z=g.abort||u,G=g.onComplete||u,P=g.easing||A,R="startValue"in g?g.startValue.length>0:!1,W="startValue"in g?g.startValue:0,K="endValue"in g?g.endValue:100,tt=g.byValue||(R?W.map(function(j,E){return K[E]-W[E]}):K-W);g.onStart&&g.onStart(),function j(E){B=E||+new Date;var I=B>S?b:B-C,Q=I/b,D=R?W.map(function(U,T){return P(I,W[T],tt[T],b)}):P(I,W,tt,b),k=Math.abs(R?(D[0]-W[0])/tt[0]:(D-W)/tt);if(w.currentValue=R?D.slice():D,w.completionRate=k,w.durationRate=Q,!v){if(z(D,k,Q)){_();return}if(B>S){w.currentValue=R?K.slice():K,w.completionRate=1,w.durationRate=1,M(R?K.slice():K,1,1),G(K,1,1),_();return}else M(D,k,Q),m(j)}}(C)}),w.cancel}var h=t.window.requestAnimationFrame||t.window.webkitRequestAnimationFrame||t.window.mozRequestAnimationFrame||t.window.oRequestAnimationFrame||t.window.msRequestAnimationFrame||function(g){return t.window.setTimeout(g,1e3/60)},p=t.window.cancelAnimationFrame||t.window.clearTimeout;function m(){return h.apply(t.window,arguments)}function d(){return p.apply(t.window,arguments)}t.util.animate=c,t.util.requestAnimFrame=m,t.util.cancelAnimFrame=d,t.runningAnimations=l}(),function(){function o(l,u,A){var c="rgba("+parseInt(l[0]+A*(u[0]-l[0]),10)+","+parseInt(l[1]+A*(u[1]-l[1]),10)+","+parseInt(l[2]+A*(u[2]-l[2]),10);return c+=","+(l&&u?parseFloat(l[3]+A*(u[3]-l[3])):1),c+=")",c}function s(l,u,A,c){var h=new t.Color(l).getSource(),p=new t.Color(u).getSource(),m=c.onComplete,d=c.onChange;return c=c||{},t.util.animate(t.util.object.extend(c,{duration:A||500,startValue:h,endValue:p,byValue:p,easing:function(g,v,w,_){var y=c.colorEasing?c.colorEasing(g,_):1-Math.cos(g/_*(Math.PI/2));return o(v,w,y)},onComplete:function(g,v,w){if(m)return m(o(p,p,0),v,w)},onChange:function(g,v,w){if(d){if(Array.isArray(g))return d(o(g,g,0),v,w);d(g,v,w)}}}))}t.util.animateColor=s}(),function(){function o(E,I,Q,D){return E<Math.abs(I)?(E=I,D=Q/4):I===0&&E===0?D=Q/(2*Math.PI)*Math.asin(1):D=Q/(2*Math.PI)*Math.asin(I/E),{a:E,c:I,p:Q,s:D}}function s(E,I,Q){return E.a*Math.pow(2,10*(I-=1))*Math.sin((I*Q-E.s)*(2*Math.PI)/E.p)}function l(E,I,Q,D){return Q*((E=E/D-1)*E*E+1)+I}function u(E,I,Q,D){return E/=D/2,E<1?Q/2*E*E*E+I:Q/2*((E-=2)*E*E+2)+I}function A(E,I,Q,D){return Q*(E/=D)*E*E*E+I}function c(E,I,Q,D){return-Q*((E=E/D-1)*E*E*E-1)+I}function h(E,I,Q,D){return E/=D/2,E<1?Q/2*E*E*E*E+I:-Q/2*((E-=2)*E*E*E-2)+I}function p(E,I,Q,D){return Q*(E/=D)*E*E*E*E+I}function m(E,I,Q,D){return Q*((E=E/D-1)*E*E*E*E+1)+I}function d(E,I,Q,D){return E/=D/2,E<1?Q/2*E*E*E*E*E+I:Q/2*((E-=2)*E*E*E*E+2)+I}function g(E,I,Q,D){return-Q*Math.cos(E/D*(Math.PI/2))+Q+I}function v(E,I,Q,D){return Q*Math.sin(E/D*(Math.PI/2))+I}function w(E,I,Q,D){return-Q/2*(Math.cos(Math.PI*E/D)-1)+I}function _(E,I,Q,D){return E===0?I:Q*Math.pow(2,10*(E/D-1))+I}function y(E,I,Q,D){return E===D?I+Q:Q*(-Math.pow(2,-10*E/D)+1)+I}function C(E,I,Q,D){return E===0?I:E===D?I+Q:(E/=D/2,E<1?Q/2*Math.pow(2,10*(E-1))+I:Q/2*(-Math.pow(2,-10*--E)+2)+I)}function b(E,I,Q,D){return-Q*(Math.sqrt(1-(E/=D)*E)-1)+I}function S(E,I,Q,D){return Q*Math.sqrt(1-(E=E/D-1)*E)+I}function B(E,I,Q,D){return E/=D/2,E<1?-Q/2*(Math.sqrt(1-E*E)-1)+I:Q/2*(Math.sqrt(1-(E-=2)*E)+1)+I}function M(E,I,Q,D){var k=1.70158,U=0,T=Q;if(E===0)return I;if(E/=D,E===1)return I+Q;U||(U=D*.3);var V=o(T,Q,U,k);return-s(V,E,D)+I}function z(E,I,Q,D){var k=1.70158,U=0,T=Q;if(E===0)return I;if(E/=D,E===1)return I+Q;U||(U=D*.3);var V=o(T,Q,U,k);return V.a*Math.pow(2,-10*E)*Math.sin((E*D-V.s)*(2*Math.PI)/V.p)+V.c+I}function G(E,I,Q,D){var k=1.70158,U=0,T=Q;if(E===0)return I;if(E/=D/2,E===2)return I+Q;U||(U=D*(.3*1.5));var V=o(T,Q,U,k);return E<1?-.5*s(V,E,D)+I:V.a*Math.pow(2,-10*(E-=1))*Math.sin((E*D-V.s)*(2*Math.PI)/V.p)*.5+V.c+I}function P(E,I,Q,D,k){return k===void 0&&(k=1.70158),Q*(E/=D)*E*((k+1)*E-k)+I}function R(E,I,Q,D,k){return k===void 0&&(k=1.70158),Q*((E=E/D-1)*E*((k+1)*E+k)+1)+I}function W(E,I,Q,D,k){return k===void 0&&(k=1.70158),E/=D/2,E<1?Q/2*(E*E*(((k*=1.525)+1)*E-k))+I:Q/2*((E-=2)*E*(((k*=1.525)+1)*E+k)+2)+I}function K(E,I,Q,D){return Q-tt(D-E,0,Q,D)+I}function tt(E,I,Q,D){return(E/=D)<1/2.75?Q*(7.5625*E*E)+I:E<2/2.75?Q*(7.5625*(E-=1.5/2.75)*E+.75)+I:E<2.5/2.75?Q*(7.5625*(E-=2.25/2.75)*E+.9375)+I:Q*(7.5625*(E-=2.625/2.75)*E+.984375)+I}function j(E,I,Q,D){return E<D/2?K(E*2,0,Q,D)*.5+I:tt(E*2-D,0,Q,D)*.5+Q*.5+I}t.util.ease={easeInQuad:function(E,I,Q,D){return Q*(E/=D)*E+I},easeOutQuad:function(E,I,Q,D){return-Q*(E/=D)*(E-2)+I},easeInOutQuad:function(E,I,Q,D){return E/=D/2,E<1?Q/2*E*E+I:-Q/2*(--E*(E-2)-1)+I},easeInCubic:function(E,I,Q,D){return Q*(E/=D)*E*E+I},easeOutCubic:l,easeInOutCubic:u,easeInQuart:A,easeOutQuart:c,easeInOutQuart:h,easeInQuint:p,easeOutQuint:m,easeInOutQuint:d,easeInSine:g,easeOutSine:v,easeInOutSine:w,easeInExpo:_,easeOutExpo:y,easeInOutExpo:C,easeInCirc:b,easeOutCirc:S,easeInOutCirc:B,easeInElastic:M,easeOutElastic:z,easeInOutElastic:G,easeInBack:P,easeOutBack:R,easeInOutBack:W,easeInBounce:K,easeOutBounce:tt,easeInOutBounce:j}}(),function(o){var s=o.fabric||(o.fabric={}),l=s.util.object.extend,u=s.util.object.clone,A=s.util.toFixed,c=s.util.parseUnit,h=s.util.multiplyTransformMatrices,p=["path","circle","polygon","polyline","ellipse","rect","line","image","text"],m=["symbol","image","marker","pattern","view","svg"],d=["pattern","defs","symbol","metadata","clipPath","mask","desc"],g=["symbol","g","a","svg","clipPath","defs"],v={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},w={stroke:"strokeOpacity",fill:"fillOpacity"},_="font-size",y="clip-path";s.svgValidTagNamesRegEx=S(p),s.svgViewBoxElementsRegEx=S(m),s.svgInvalidAncestorsRegEx=S(d),s.svgValidParentsRegEx=S(g),s.cssRules={},s.gradientDefs={},s.clipPaths={};function C(U){return U in v?v[U]:U}function b(U,T,V,O){var et=Array.isArray(T),q;if((U==="fill"||U==="stroke")&&T==="none")T="";else{if(U==="strokeUniform")return T==="non-scaling-stroke";if(U==="strokeDashArray")T==="none"?T=null:T=T.replace(/,/g," ").split(/\s+/).map(parseFloat);else if(U==="transformMatrix")V&&V.transformMatrix?T=h(V.transformMatrix,s.parseTransformAttribute(T)):T=s.parseTransformAttribute(T);else if(U==="visible")T=T!=="none"&&T!=="hidden",V&&V.visible===!1&&(T=!1);else if(U==="opacity")T=parseFloat(T),V&&typeof V.opacity<"u"&&(T*=V.opacity);else if(U==="textAnchor")T=T==="start"?"left":T==="end"?"right":"center";else if(U==="charSpacing")q=c(T,O)/O*1e3;else if(U==="paintFirst"){var J=T.indexOf("fill"),st=T.indexOf("stroke"),T="fill";(J>-1&&st>-1&&st<J||J===-1&&st>-1)&&(T="stroke")}else{if(U==="href"||U==="xlink:href"||U==="font")return T;if(U==="imageSmoothing")return T==="optimizeQuality";q=et?T.map(c):c(T,O)}}return!et&&isNaN(q)?T:q}function S(U){return new RegExp("^("+U.join("|")+")\\b","i")}function B(U){for(var T in w)if(!(typeof U[w[T]]>"u"||U[T]==="")){if(typeof U[T]>"u"){if(!s.Object.prototype[T])continue;U[T]=s.Object.prototype[T]}if(U[T].indexOf("url(")!==0){var V=new s.Color(U[T]);U[T]=V.setAlpha(A(V.getAlpha()*U[w[T]],2)).toRgba()}}return U}function M(U,T){var V,O=[],et,q,J;for(q=0,J=T.length;q<J;q++)V=T[q],et=U.getElementsByTagName(V),O=O.concat(Array.prototype.slice.call(et));return O}s.parseTransformAttribute=function(){function U(F,L){var it=s.util.cos(L[0]),ct=s.util.sin(L[0]),dt=0,vt=0;L.length===3&&(dt=L[1],vt=L[2]),F[0]=it,F[1]=ct,F[2]=-ct,F[3]=it,F[4]=dt-(it*dt-ct*vt),F[5]=vt-(ct*dt+it*vt)}function T(F,L){var it=L[0],ct=L.length===2?L[1]:L[0];F[0]=it,F[3]=ct}function V(F,L,it){F[it]=Math.tan(s.util.degreesToRadians(L[0]))}function O(F,L){F[4]=L[0],L.length===2&&(F[5]=L[1])}var et=s.iMatrix,q=s.reNum,J=s.commaWsp,st="(?:(skewX)\\s*\\(\\s*("+q+")\\s*\\))",gt="(?:(skewY)\\s*\\(\\s*("+q+")\\s*\\))",Y="(?:(rotate)\\s*\\(\\s*("+q+")(?:"+J+"("+q+")"+J+"("+q+"))?\\s*\\))",X="(?:(scale)\\s*\\(\\s*("+q+")(?:"+J+"("+q+"))?\\s*\\))",ot="(?:(translate)\\s*\\(\\s*("+q+")(?:"+J+"("+q+"))?\\s*\\))",At="(?:(matrix)\\s*\\(\\s*("+q+")"+J+"("+q+")"+J+"("+q+")"+J+"("+q+")"+J+"("+q+")"+J+"("+q+")\\s*\\))",rt="(?:"+At+"|"+ot+"|"+X+"|"+Y+"|"+st+"|"+gt+")",lt="(?:"+rt+"(?:"+J+"*"+rt+")*)",mt="^\\s*(?:"+lt+"?)\\s*$",St=new RegExp(mt),bt=new RegExp(rt,"g");return function(F){var L=et.concat(),it=[];if(!F||F&&!St.test(F))return L;F.replace(bt,function(dt){var vt=new RegExp(rt).exec(dt).filter(function(ht){return!!ht}),Ut=vt[1],Ct=vt.slice(2).map(parseFloat);switch(Ut){case"translate":O(L,Ct);break;case"rotate":Ct[0]=s.util.degreesToRadians(Ct[0]),U(L,Ct);break;case"scale":T(L,Ct);break;case"skewX":V(L,Ct,2);break;case"skewY":V(L,Ct,1);break;case"matrix":L=Ct;break}it.push(L.concat()),L=et.concat()});for(var ct=it[0];it.length>1;)it.shift(),ct=s.util.multiplyTransformMatrices(ct,it[0]);return ct}}();function z(U,T){var V,O;U.replace(/;\s*$/,"").split(";").forEach(function(et){var q=et.split(":");V=q[0].trim().toLowerCase(),O=q[1].trim(),T[V]=O})}function G(U,T){var V,O;for(var et in U)typeof U[et]>"u"||(V=et.toLowerCase(),O=U[et],T[V]=O)}function P(U,T){var V={};for(var O in s.cssRules[T])if(R(U,O.split(" ")))for(var et in s.cssRules[T][O])V[et]=s.cssRules[T][O][et];return V}function R(U,T){var V,O=!0;return V=K(U,T.pop()),V&&T.length&&(O=W(U,T)),V&&O&&T.length===0}function W(U,T){for(var V,O=!0;U.parentNode&&U.parentNode.nodeType===1&&T.length;)O&&(V=T.pop()),U=U.parentNode,O=K(U,V);return T.length===0}function K(U,T){var V=U.nodeName,O=U.getAttribute("class"),et=U.getAttribute("id"),q,J;if(q=new RegExp("^"+V,"i"),T=T.replace(q,""),et&&T.length&&(q=new RegExp("#"+et+"(?![a-zA-Z\\-]+)","i"),T=T.replace(q,"")),O&&T.length)for(O=O.split(" "),J=O.length;J--;)q=new RegExp("\\."+O[J]+"(?![a-zA-Z\\-]+)","i"),T=T.replace(q,"");return T.length===0}function tt(U,T){var V;if(U.getElementById&&(V=U.getElementById(T)),V)return V;var O,et,q,J=U.getElementsByTagName("*");for(et=0,q=J.length;et<q;et++)if(O=J[et],T===O.getAttribute("id"))return O}function j(U){for(var T=M(U,["use","svg:use"]),V=0;T.length&&V<T.length;){var O=T[V],et=O.getAttribute("xlink:href")||O.getAttribute("href");if(et===null)return;var q=et.slice(1),J=O.getAttribute("x")||0,st=O.getAttribute("y")||0,gt=tt(U,q).cloneNode(!0),Y=(gt.getAttribute("transform")||"")+" translate("+J+", "+st+")",X,ot=T.length,At,rt,lt,mt,St=s.svgNS;if(I(gt),/^svg$/i.test(gt.nodeName)){var bt=gt.ownerDocument.createElementNS(St,"g");for(rt=0,lt=gt.attributes,mt=lt.length;rt<mt;rt++)At=lt.item(rt),bt.setAttributeNS(St,At.nodeName,At.nodeValue);for(;gt.firstChild;)bt.appendChild(gt.firstChild);gt=bt}for(rt=0,lt=O.attributes,mt=lt.length;rt<mt;rt++)At=lt.item(rt),!(At.nodeName==="x"||At.nodeName==="y"||At.nodeName==="xlink:href"||At.nodeName==="href")&&(At.nodeName==="transform"?Y=At.nodeValue+" "+Y:gt.setAttribute(At.nodeName,At.nodeValue));gt.setAttribute("transform",Y),gt.setAttribute("instantiated_by_use","1"),gt.removeAttribute("id"),X=O.parentNode,X.replaceChild(gt,O),T.length===ot&&V++}}var E=new RegExp("^\\s*("+s.reNum+"+)\\s*,?\\s*("+s.reNum+"+)\\s*,?\\s*("+s.reNum+"+)\\s*,?\\s*("+s.reNum+"+)\\s*$");function I(U){if(!s.svgViewBoxElementsRegEx.test(U.nodeName))return{};var T=U.getAttribute("viewBox"),V=1,O=1,et=0,q=0,J,st,gt,Y,X=U.getAttribute("width"),ot=U.getAttribute("height"),At=U.getAttribute("x")||0,rt=U.getAttribute("y")||0,lt=U.getAttribute("preserveAspectRatio")||"",mt=!T||!(T=T.match(E)),St=!X||!ot||X==="100%"||ot==="100%",bt=mt&&St,F={},L="",it=0,ct=0;if(F.width=0,F.height=0,F.toBeParsed=bt,mt&&(At||rt)&&U.parentNode&&U.parentNode.nodeName!=="#document"&&(L=" translate("+c(At)+" "+c(rt)+") ",gt=(U.getAttribute("transform")||"")+L,U.setAttribute("transform",gt),U.removeAttribute("x"),U.removeAttribute("y")),bt)return F;if(mt)return F.width=c(X),F.height=c(ot),F;if(et=-parseFloat(T[1]),q=-parseFloat(T[2]),J=parseFloat(T[3]),st=parseFloat(T[4]),F.minX=et,F.minY=q,F.viewBoxWidth=J,F.viewBoxHeight=st,St?(F.width=J,F.height=st):(F.width=c(X),F.height=c(ot),V=F.width/J,O=F.height/st),lt=s.util.parsePreserveAspectRatioAttribute(lt),lt.alignX!=="none"&&(lt.meetOrSlice==="meet"&&(O=V=V>O?O:V),lt.meetOrSlice==="slice"&&(O=V=V>O?V:O),it=F.width-J*V,ct=F.height-st*V,lt.alignX==="Mid"&&(it/=2),lt.alignY==="Mid"&&(ct/=2),lt.alignX==="Min"&&(it=0),lt.alignY==="Min"&&(ct=0)),V===1&&O===1&&et===0&&q===0&&At===0&&rt===0)return F;if((At||rt)&&U.parentNode.nodeName!=="#document"&&(L=" translate("+c(At)+" "+c(rt)+") "),gt=L+" matrix("+V+" 0 0 "+O+" "+(et*V+it)+" "+(q*O+ct)+") ",U.nodeName==="svg"){for(Y=U.ownerDocument.createElementNS(s.svgNS,"g");U.firstChild;)Y.appendChild(U.firstChild);U.appendChild(Y)}else Y=U,Y.removeAttribute("x"),Y.removeAttribute("y"),gt=Y.getAttribute("transform")+gt;return Y.setAttribute("transform",gt),F}function Q(U,T){for(;U&&(U=U.parentNode);)if(U.nodeName&&T.test(U.nodeName.replace("svg:",""))&&!U.getAttribute("instantiated_by_use"))return!0;return!1}s.parseSVGDocument=function(U,T,V,O){if(U){j(U);var et=s.Object.__uid++,q,J,st=I(U),gt=s.util.toArray(U.getElementsByTagName("*"));if(st.crossOrigin=O&&O.crossOrigin,st.svgUid=et,gt.length===0&&s.isLikelyNode){gt=U.selectNodes('//*[name(.)!="svg"]');var Y=[];for(q=0,J=gt.length;q<J;q++)Y[q]=gt[q];gt=Y}var X=gt.filter(function(At){return I(At),s.svgValidTagNamesRegEx.test(At.nodeName.replace("svg:",""))&&!Q(At,s.svgInvalidAncestorsRegEx)});if(!X||X&&!X.length){T&&T([],{});return}var ot={};gt.filter(function(At){return At.nodeName.replace("svg:","")==="clipPath"}).forEach(function(At){var rt=At.getAttribute("id");ot[rt]=s.util.toArray(At.getElementsByTagName("*")).filter(function(lt){return s.svgValidTagNamesRegEx.test(lt.nodeName.replace("svg:",""))})}),s.gradientDefs[et]=s.getGradientDefs(U),s.cssRules[et]=s.getCSSRules(U),s.clipPaths[et]=ot,s.parseElements(X,function(At,rt){T&&(T(At,st,rt,gt),delete s.gradientDefs[et],delete s.cssRules[et],delete s.clipPaths[et])},u(st),V,O)}};function D(U,T){var V=["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"],O="xlink:href",et=T.getAttribute(O).slice(1),q=tt(U,et);if(q&&q.getAttribute(O)&&D(U,q),V.forEach(function(st){q&&!T.hasAttribute(st)&&q.hasAttribute(st)&&T.setAttribute(st,q.getAttribute(st))}),!T.children.length)for(var J=q.cloneNode(!0);J.firstChild;)T.appendChild(J.firstChild);T.removeAttribute(O)}var k=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+s.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+s.reNum+"))?\\s+(.*)");l(s,{parseFontDeclaration:function(U,T){var V=U.match(k);if(V){var O=V[1],et=V[3],q=V[4],J=V[5],st=V[6];O&&(T.fontStyle=O),et&&(T.fontWeight=isNaN(parseFloat(et))?et:parseFloat(et)),q&&(T.fontSize=c(q)),st&&(T.fontFamily=st),J&&(T.lineHeight=J==="normal"?1:J)}},getGradientDefs:function(U){var T=["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"],V=M(U,T),O,et=0,q={};for(et=V.length;et--;)O=V[et],O.getAttribute("xlink:href")&&D(U,O),q[O.getAttribute("id")]=O;return q},parseAttributes:function(U,T,V){if(U){var O,et={},q,J;typeof V>"u"&&(V=U.getAttribute("svgUid")),U.parentNode&&s.svgValidParentsRegEx.test(U.parentNode.nodeName)&&(et=s.parseAttributes(U.parentNode,T,V));var st=T.reduce(function(lt,mt){return O=U.getAttribute(mt),O&&(lt[mt]=O),lt},{}),gt=l(P(U,V),s.parseStyleAttribute(U));st=l(st,gt),gt[y]&&U.setAttribute(y,gt[y]),q=J=et.fontSize||s.Text.DEFAULT_SVG_FONT_SIZE,st[_]&&(st[_]=q=c(st[_],J));var Y,X,ot={};for(var At in st)Y=C(At),X=b(Y,st[At],et,q),ot[Y]=X;ot&&ot.font&&s.parseFontDeclaration(ot.font,ot);var rt=l(et,ot);return s.svgValidParentsRegEx.test(U.nodeName)?rt:B(rt)}},parseElements:function(U,T,V,O,et){new s.ElementsParser(U,T,V,O,et).parse()},parseStyleAttribute:function(U){var T={},V=U.getAttribute("style");return V&&(typeof V=="string"?z(V,T):G(V,T)),T},parsePointsAttribute:function(U){if(!U)return null;U=U.replace(/,/g," ").trim(),U=U.split(/\s+/);var T=[],V,O;for(V=0,O=U.length;V<O;V+=2)T.push({x:parseFloat(U[V]),y:parseFloat(U[V+1])});return T},getCSSRules:function(U){var T=U.getElementsByTagName("style"),V,O,et={},q;for(V=0,O=T.length;V<O;V++){var J=T[V].textContent;J=J.replace(/\/\*[\s\S]*?\*\//g,""),J.trim()!==""&&(q=J.split("}"),q=q.filter(function(st){return st.trim()}),q.forEach(function(st){var gt=st.split("{"),Y={},X=gt[1].trim(),ot=X.split(";").filter(function(mt){return mt.trim()});for(V=0,O=ot.length;V<O;V++){var At=ot[V].split(":"),rt=At[0].trim(),lt=At[1].trim();Y[rt]=lt}st=gt[0].trim(),st.split(",").forEach(function(mt){mt=mt.replace(/^svg/i,"").trim(),mt!==""&&(et[mt]?s.util.object.extend(et[mt],Y):et[mt]=s.util.object.clone(Y))})}))}return et},loadSVGFromURL:function(U,T,V,O){U=U.replace(/^\n\s*/,"").trim(),new s.util.request(U,{method:"get",onComplete:et});function et(q){var J=q.responseXML;if(!J||!J.documentElement)return T&&T(null),!1;s.parseSVGDocument(J.documentElement,function(st,gt,Y,X){T&&T(st,gt,Y,X)},V,O)}},loadSVGFromString:function(U,T,V,O){var et=new s.window.DOMParser,q=et.parseFromString(U.trim(),"text/xml");s.parseSVGDocument(q.documentElement,function(J,st,gt,Y){T(J,st,gt,Y)},V,O)}})}(n),t.ElementsParser=function(o,s,l,u,A,c){this.elements=o,this.callback=s,this.options=l,this.reviver=u,this.svgUid=l&&l.svgUid||0,this.parsingOptions=A,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=c},function(o){o.parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},o.createObjects=function(){var s=this;this.elements.forEach(function(l,u){l.setAttribute("svgUid",s.svgUid),s.createObject(l,u)})},o.findTag=function(s){return t[t.util.string.capitalize(s.tagName.replace("svg:",""))]},o.createObject=function(s,l){var u=this.findTag(s);if(u&&u.fromElement)try{u.fromElement(s,this.createCallback(l,s),this.options)}catch(A){t.log(A)}else this.checkIfDone()},o.createCallback=function(s,l){var u=this;return function(A){var c;u.resolveGradient(A,l,"fill"),u.resolveGradient(A,l,"stroke"),A instanceof t.Image&&A._originalElement&&(c=A.parsePreserveAspectRatioAttribute(l)),A._removeTransformMatrix(c),u.resolveClipPath(A,l),u.reviver&&u.reviver(l,A),u.instances[s]=A,u.checkIfDone()}},o.extractPropertyDefinition=function(s,l,u){var A=s[l],c=this.regexUrl;if(c.test(A)){c.lastIndex=0;var h=c.exec(A)[1];return c.lastIndex=0,t[u][this.svgUid][h]}},o.resolveGradient=function(s,l,u){var A=this.extractPropertyDefinition(s,u,"gradientDefs");if(A){var c=l.getAttribute(u+"-opacity"),h=t.Gradient.fromElement(A,s,c,this.options);s.set(u,h)}},o.createClipPathCallback=function(s,l){return function(u){u._removeTransformMatrix(),u.fillRule=u.clipRule,l.push(u)}},o.resolveClipPath=function(s,l){var u=this.extractPropertyDefinition(s,"clipPath","clipPaths"),A,c,h,p,m,d;if(u){p=[],h=t.util.invertTransform(s.calcTransformMatrix());for(var g=u[0].parentNode,v=l;v.parentNode&&v.getAttribute("clip-path")!==s.clipPath;)v=v.parentNode;v.parentNode.appendChild(g);for(var w=0;w<u.length;w++)A=u[w],c=this.findTag(A),c.fromElement(A,this.createClipPathCallback(s,p),this.options);p.length===1?u=p[0]:u=new t.Group(p),m=t.util.multiplyTransformMatrices(h,u.calcTransformMatrix()),u.clipPath&&this.resolveClipPath(u,v);var d=t.util.qrDecompose(m);u.flipX=!1,u.flipY=!1,u.set("scaleX",d.scaleX),u.set("scaleY",d.scaleY),u.angle=d.angle,u.skewX=d.skewX,u.skewY=0,u.setPositionByOrigin({x:d.translateX,y:d.translateY},"center","center"),s.clipPath=u}else delete s.clipPath},o.checkIfDone=function(){--this.numElements===0&&(this.instances=this.instances.filter(function(s){return s!=null}),this.callback(this.instances,this.elements))}}(t.ElementsParser.prototype),function(o){var s=o.fabric||(o.fabric={});if(s.Point){s.warn("fabric.Point is already defined");return}s.Point=l;function l(u,A){this.x=u,this.y=A}l.prototype={type:"point",constructor:l,add:function(u){return new l(this.x+u.x,this.y+u.y)},addEquals:function(u){return this.x+=u.x,this.y+=u.y,this},scalarAdd:function(u){return new l(this.x+u,this.y+u)},scalarAddEquals:function(u){return this.x+=u,this.y+=u,this},subtract:function(u){return new l(this.x-u.x,this.y-u.y)},subtractEquals:function(u){return this.x-=u.x,this.y-=u.y,this},scalarSubtract:function(u){return new l(this.x-u,this.y-u)},scalarSubtractEquals:function(u){return this.x-=u,this.y-=u,this},multiply:function(u){return new l(this.x*u,this.y*u)},multiplyEquals:function(u){return this.x*=u,this.y*=u,this},divide:function(u){return new l(this.x/u,this.y/u)},divideEquals:function(u){return this.x/=u,this.y/=u,this},eq:function(u){return this.x===u.x&&this.y===u.y},lt:function(u){return this.x<u.x&&this.y<u.y},lte:function(u){return this.x<=u.x&&this.y<=u.y},gt:function(u){return this.x>u.x&&this.y>u.y},gte:function(u){return this.x>=u.x&&this.y>=u.y},lerp:function(u,A){return typeof A>"u"&&(A=.5),A=Math.max(Math.min(1,A),0),new l(this.x+(u.x-this.x)*A,this.y+(u.y-this.y)*A)},distanceFrom:function(u){var A=this.x-u.x,c=this.y-u.y;return Math.sqrt(A*A+c*c)},midPointFrom:function(u){return this.lerp(u)},min:function(u){return new l(Math.min(this.x,u.x),Math.min(this.y,u.y))},max:function(u){return new l(Math.max(this.x,u.x),Math.max(this.y,u.y))},toString:function(){return this.x+","+this.y},setXY:function(u,A){return this.x=u,this.y=A,this},setX:function(u){return this.x=u,this},setY:function(u){return this.y=u,this},setFromPoint:function(u){return this.x=u.x,this.y=u.y,this},swap:function(u){var A=this.x,c=this.y;this.x=u.x,this.y=u.y,u.x=A,u.y=c},clone:function(){return new l(this.x,this.y)}}}(n),function(o){var s=o.fabric||(o.fabric={});if(s.Intersection){s.warn("fabric.Intersection is already defined");return}function l(u){this.status=u,this.points=[]}s.Intersection=l,s.Intersection.prototype={constructor:l,appendPoint:function(u){return this.points.push(u),this},appendPoints:function(u){return this.points=this.points.concat(u),this}},s.Intersection.intersectLineLine=function(u,A,c,h){var p,m=(h.x-c.x)*(u.y-c.y)-(h.y-c.y)*(u.x-c.x),d=(A.x-u.x)*(u.y-c.y)-(A.y-u.y)*(u.x-c.x),g=(h.y-c.y)*(A.x-u.x)-(h.x-c.x)*(A.y-u.y);if(g!==0){var v=m/g,w=d/g;0<=v&&v<=1&&0<=w&&w<=1?(p=new l("Intersection"),p.appendPoint(new s.Point(u.x+v*(A.x-u.x),u.y+v*(A.y-u.y)))):p=new l}else m===0||d===0?p=new l("Coincident"):p=new l("Parallel");return p},s.Intersection.intersectLinePolygon=function(u,A,c){var h=new l,p=c.length,m,d,g,v;for(v=0;v<p;v++)m=c[v],d=c[(v+1)%p],g=l.intersectLineLine(u,A,m,d),h.appendPoints(g.points);return h.points.length>0&&(h.status="Intersection"),h},s.Intersection.intersectPolygonPolygon=function(u,A){var c=new l,h=u.length,p;for(p=0;p<h;p++){var m=u[p],d=u[(p+1)%h],g=l.intersectLinePolygon(m,d,A);c.appendPoints(g.points)}return c.points.length>0&&(c.status="Intersection"),c},s.Intersection.intersectPolygonRectangle=function(u,A,c){var h=A.min(c),p=A.max(c),m=new s.Point(p.x,h.y),d=new s.Point(h.x,p.y),g=l.intersectLinePolygon(h,m,u),v=l.intersectLinePolygon(m,p,u),w=l.intersectLinePolygon(p,d,u),_=l.intersectLinePolygon(d,h,u),y=new l;return y.appendPoints(g.points),y.appendPoints(v.points),y.appendPoints(w.points),y.appendPoints(_.points),y.points.length>0&&(y.status="Intersection"),y}}(n),function(o){var s=o.fabric||(o.fabric={});if(s.Color){s.warn("fabric.Color is already defined.");return}function l(A){A?this._tryParsingColor(A):this.setSource([0,0,0,1])}s.Color=l,s.Color.prototype={_tryParsingColor:function(A){var c;A in l.colorNameMap&&(A=l.colorNameMap[A]),A==="transparent"&&(c=[255,255,255,0]),c||(c=l.sourceFromHex(A)),c||(c=l.sourceFromRgb(A)),c||(c=l.sourceFromHsl(A)),c||(c=[0,0,0,1]),c&&this.setSource(c)},_rgbToHsl:function(A,c,h){A/=255,c/=255,h/=255;var p,m,d,g=s.util.array.max([A,c,h]),v=s.util.array.min([A,c,h]);if(d=(g+v)/2,g===v)p=m=0;else{var w=g-v;switch(m=d>.5?w/(2-g-v):w/(g+v),g){case A:p=(c-h)/w+(c<h?6:0);break;case c:p=(h-A)/w+2;break;case h:p=(A-c)/w+4;break}p/=6}return[Math.round(p*360),Math.round(m*100),Math.round(d*100)]},getSource:function(){return this._source},setSource:function(A){this._source=A},toRgb:function(){var A=this.getSource();return"rgb("+A[0]+","+A[1]+","+A[2]+")"},toRgba:function(){var A=this.getSource();return"rgba("+A[0]+","+A[1]+","+A[2]+","+A[3]+")"},toHsl:function(){var A=this.getSource(),c=this._rgbToHsl(A[0],A[1],A[2]);return"hsl("+c[0]+","+c[1]+"%,"+c[2]+"%)"},toHsla:function(){var A=this.getSource(),c=this._rgbToHsl(A[0],A[1],A[2]);return"hsla("+c[0]+","+c[1]+"%,"+c[2]+"%,"+A[3]+")"},toHex:function(){var A=this.getSource(),c,h,p;return c=A[0].toString(16),c=c.length===1?"0"+c:c,h=A[1].toString(16),h=h.length===1?"0"+h:h,p=A[2].toString(16),p=p.length===1?"0"+p:p,c.toUpperCase()+h.toUpperCase()+p.toUpperCase()},toHexa:function(){var A=this.getSource(),c;return c=Math.round(A[3]*255),c=c.toString(16),c=c.length===1?"0"+c:c,this.toHex()+c.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(A){var c=this.getSource();return c[3]=A,this.setSource(c),this},toGrayscale:function(){var A=this.getSource(),c=parseInt((A[0]*.3+A[1]*.59+A[2]*.11).toFixed(0),10),h=A[3];return this.setSource([c,c,c,h]),this},toBlackWhite:function(A){var c=this.getSource(),h=(c[0]*.3+c[1]*.59+c[2]*.11).toFixed(0),p=c[3];return A=A||127,h=Number(h)<Number(A)?0:255,this.setSource([h,h,h,p]),this},overlayWith:function(A){A instanceof l||(A=new l(A));var c=[],h=this.getAlpha(),p=.5,m=this.getSource(),d=A.getSource(),g;for(g=0;g<3;g++)c.push(Math.round(m[g]*(1-p)+d[g]*p));return c[3]=h,this.setSource(c),this}},s.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,s.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,s.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,s.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"};function u(A,c,h){return h<0&&(h+=1),h>1&&(h-=1),h<1/6?A+(c-A)*6*h:h<1/2?c:h<2/3?A+(c-A)*(2/3-h)*6:A}s.Color.fromRgb=function(A){return l.fromSource(l.sourceFromRgb(A))},s.Color.sourceFromRgb=function(A){var c=A.match(l.reRGBa);if(c){var h=parseInt(c[1],10)/(/%$/.test(c[1])?100:1)*(/%$/.test(c[1])?255:1),p=parseInt(c[2],10)/(/%$/.test(c[2])?100:1)*(/%$/.test(c[2])?255:1),m=parseInt(c[3],10)/(/%$/.test(c[3])?100:1)*(/%$/.test(c[3])?255:1);return[parseInt(h,10),parseInt(p,10),parseInt(m,10),c[4]?parseFloat(c[4]):1]}},s.Color.fromRgba=l.fromRgb,s.Color.fromHsl=function(A){return l.fromSource(l.sourceFromHsl(A))},s.Color.sourceFromHsl=function(A){var c=A.match(l.reHSLa);if(c){var h=(parseFloat(c[1])%360+360)%360/360,p=parseFloat(c[2])/(/%$/.test(c[2])?100:1),m=parseFloat(c[3])/(/%$/.test(c[3])?100:1),d,g,v;if(p===0)d=g=v=m;else{var w=m<=.5?m*(p+1):m+p-m*p,_=m*2-w;d=u(_,w,h+1/3),g=u(_,w,h),v=u(_,w,h-1/3)}return[Math.round(d*255),Math.round(g*255),Math.round(v*255),c[4]?parseFloat(c[4]):1]}},s.Color.fromHsla=l.fromHsl,s.Color.fromHex=function(A){return l.fromSource(l.sourceFromHex(A))},s.Color.sourceFromHex=function(A){if(A.match(l.reHex)){var c=A.slice(A.indexOf("#")+1),h=c.length===3||c.length===4,p=c.length===8||c.length===4,m=h?c.charAt(0)+c.charAt(0):c.substring(0,2),d=h?c.charAt(1)+c.charAt(1):c.substring(2,4),g=h?c.charAt(2)+c.charAt(2):c.substring(4,6),v=p?h?c.charAt(3)+c.charAt(3):c.substring(6,8):"FF";return[parseInt(m,16),parseInt(d,16),parseInt(g,16),parseFloat((parseInt(v,16)/255).toFixed(2))]}},s.Color.fromSource=function(A){var c=new l;return c.setSource(A),c}}(n),function(o){var s=o.fabric||(o.fabric={}),l=["e","se","s","sw","w","nw","n","ne","e"],u=["ns","nesw","ew","nwse"],A={},c="left",h="top",p="right",m="bottom",d="center",g={top:m,bottom:h,left:p,right:c,center:d},v=s.util.radiansToDegrees,w=Math.sign||function(Y){return(Y>0)-(Y<0)||+Y};function _(Y,X){var ot=Y.angle+v(Math.atan2(X.y,X.x))+360;return Math.round(ot%360/45)}function y(Y,X){var ot=X.transform.target,At=ot.canvas,rt=s.util.object.clone(X);rt.target=ot,At&&At.fire("object:"+Y,rt),ot.fire(Y,X)}function C(Y,X){var ot=X.canvas,At=ot.uniScaleKey,rt=Y[At];return ot.uniformScaling&&!rt||!ot.uniformScaling&&rt}function b(Y){return Y.originX===d&&Y.originY===d}function S(Y,X,ot){var At=Y.lockScalingX,rt=Y.lockScalingY;return!!(At&&rt||!X&&(At||rt)&&ot||At&&X==="x"||rt&&X==="y")}function B(Y,X,ot){var At="not-allowed",rt=C(Y,ot),lt="";if(X.x!==0&&X.y===0?lt="x":X.x===0&&X.y!==0&&(lt="y"),S(ot,lt,rt))return At;var mt=_(ot,X);return l[mt]+"-resize"}function M(Y,X,ot){var At="not-allowed";if(X.x!==0&&ot.lockSkewingY||X.y!==0&&ot.lockSkewingX)return At;var rt=_(ot,X)%4;return u[rt]+"-resize"}function z(Y,X,ot){return Y[ot.canvas.altActionKey]?A.skewCursorStyleHandler(Y,X,ot):A.scaleCursorStyleHandler(Y,X,ot)}function G(Y,X,ot){var At=Y[ot.canvas.altActionKey];if(X.x===0)return At?"skewX":"scaleY";if(X.y===0)return At?"skewY":"scaleX"}function P(Y,X,ot){return ot.lockRotation?"not-allowed":X.cursorStyle}function R(Y,X,ot,At){return{e:Y,transform:X,pointer:{x:ot,y:At}}}function W(Y){return function(X,ot,At,rt){var lt=ot.target,mt=lt.getCenterPoint(),St=lt.translateToOriginPoint(mt,ot.originX,ot.originY),bt=Y(X,ot,At,rt);return lt.setPositionByOrigin(St,ot.originX,ot.originY),bt}}function K(Y,X){return function(ot,At,rt,lt){var mt=X(ot,At,rt,lt);return mt&&y(Y,R(ot,At,rt,lt)),mt}}function tt(Y,X,ot,At,rt){var lt=Y.target,mt=lt.controls[Y.corner],St=lt.canvas.getZoom(),bt=lt.padding/St,F=lt.toLocalPoint(new s.Point(At,rt),X,ot);return F.x>=bt&&(F.x-=bt),F.x<=-bt&&(F.x+=bt),F.y>=bt&&(F.y-=bt),F.y<=bt&&(F.y+=bt),F.x-=mt.offsetX,F.y-=mt.offsetY,F}function j(Y){return Y.flipX!==Y.flipY}function E(Y,X,ot,At,rt){if(Y[X]!==0){var lt=Y._getTransformedDimensions()[At],mt=rt/lt*Y[ot];Y.set(ot,mt)}}function I(Y,X,ot,At){var rt=X.target,lt=rt._getTransformedDimensions(0,rt.skewY),mt=tt(X,X.originX,X.originY,ot,At),St=Math.abs(mt.x*2)-lt.x,bt=rt.skewX,F;St<2?F=0:(F=v(Math.atan2(St/rt.scaleX,lt.y/rt.scaleY)),X.originX===c&&X.originY===m&&(F=-F),X.originX===p&&X.originY===h&&(F=-F),j(rt)&&(F=-F));var L=bt!==F;if(L){var it=rt._getTransformedDimensions().y;rt.set("skewX",F),E(rt,"skewY","scaleY","y",it)}return L}function Q(Y,X,ot,At){var rt=X.target,lt=rt._getTransformedDimensions(rt.skewX,0),mt=tt(X,X.originX,X.originY,ot,At),St=Math.abs(mt.y*2)-lt.y,bt=rt.skewY,F;St<2?F=0:(F=v(Math.atan2(St/rt.scaleY,lt.x/rt.scaleX)),X.originX===c&&X.originY===m&&(F=-F),X.originX===p&&X.originY===h&&(F=-F),j(rt)&&(F=-F));var L=bt!==F;if(L){var it=rt._getTransformedDimensions().x;rt.set("skewY",F),E(rt,"skewX","scaleX","x",it)}return L}function D(Y,X,ot,At){var rt=X.target,lt=rt.skewX,mt,St=X.originY;if(rt.lockSkewingX)return!1;if(lt===0){var bt=tt(X,d,d,ot,At);bt.x>0?mt=c:mt=p}else lt>0&&(mt=St===h?c:p),lt<0&&(mt=St===h?p:c),j(rt)&&(mt=mt===c?p:c);X.originX=mt;var F=K("skewing",W(I));return F(Y,X,ot,At)}function k(Y,X,ot,At){var rt=X.target,lt=rt.skewY,mt,St=X.originX;if(rt.lockSkewingY)return!1;if(lt===0){var bt=tt(X,d,d,ot,At);bt.y>0?mt=h:mt=m}else lt>0&&(mt=St===c?h:m),lt<0&&(mt=St===c?m:h),j(rt)&&(mt=mt===h?m:h);X.originY=mt;var F=K("skewing",W(Q));return F(Y,X,ot,At)}function U(Y,X,ot,At){var rt=X,lt=rt.target,mt=lt.translateToOriginPoint(lt.getCenterPoint(),rt.originX,rt.originY);if(lt.lockRotation)return!1;var St=Math.atan2(rt.ey-mt.y,rt.ex-mt.x),bt=Math.atan2(At-mt.y,ot-mt.x),F=v(bt-St+rt.theta),L=!0;if(lt.snapAngle>0){var it=lt.snapAngle,ct=lt.snapThreshold||it,dt=Math.ceil(F/it)*it,vt=Math.floor(F/it)*it;Math.abs(F-vt)<ct?F=vt:Math.abs(F-dt)<ct&&(F=dt)}return F<0&&(F=360+F),F%=360,L=lt.angle!==F,lt.angle=F,L}function T(Y,X,ot,At,rt){rt=rt||{};var lt=X.target,mt=lt.lockScalingX,St=lt.lockScalingY,bt=rt.by,F,L,it,ct,dt=C(Y,lt),vt=S(lt,bt,dt),Ut,Ct,ht=X.gestureScale;if(vt)return!1;if(ht)L=X.scaleX*ht,it=X.scaleY*ht;else{if(F=tt(X,X.originX,X.originY,ot,At),Ut=bt!=="y"?w(F.x):1,Ct=bt!=="x"?w(F.y):1,X.signX||(X.signX=Ut),X.signY||(X.signY=Ct),lt.lockScalingFlip&&(X.signX!==Ut||X.signY!==Ct))return!1;if(ct=lt._getTransformedDimensions(),dt&&!bt){var It=Math.abs(F.x)+Math.abs(F.y),Lt=X.original,Nt=Math.abs(ct.x*Lt.scaleX/lt.scaleX)+Math.abs(ct.y*Lt.scaleY/lt.scaleY),Ft=It/Nt;L=Lt.scaleX*Ft,it=Lt.scaleY*Ft}else L=Math.abs(F.x*lt.scaleX/ct.x),it=Math.abs(F.y*lt.scaleY/ct.y);b(X)&&(L*=2,it*=2),X.signX!==Ut&&bt!=="y"&&(X.originX=g[X.originX],L*=-1,X.signX=Ut),X.signY!==Ct&&bt!=="x"&&(X.originY=g[X.originY],it*=-1,X.signY=Ct)}var Dt=lt.scaleX,Jt=lt.scaleY;return bt?(bt==="x"&&lt.set("scaleX",L),bt==="y"&&lt.set("scaleY",it)):(!mt&&lt.set("scaleX",L),!St&&lt.set("scaleY",it)),Dt!==lt.scaleX||Jt!==lt.scaleY}function V(Y,X,ot,At){return T(Y,X,ot,At)}function O(Y,X,ot,At){return T(Y,X,ot,At,{by:"x"})}function et(Y,X,ot,At){return T(Y,X,ot,At,{by:"y"})}function q(Y,X,ot,At){return Y[X.target.canvas.altActionKey]?A.skewHandlerX(Y,X,ot,At):A.scalingY(Y,X,ot,At)}function J(Y,X,ot,At){return Y[X.target.canvas.altActionKey]?A.skewHandlerY(Y,X,ot,At):A.scalingX(Y,X,ot,At)}function st(Y,X,ot,At){var rt=X.target,lt=tt(X,X.originX,X.originY,ot,At),mt=rt.strokeWidth/(rt.strokeUniform?rt.scaleX:1),St=b(X)?2:1,bt=rt.width,F=Math.abs(lt.x*St/rt.scaleX)-mt;return rt.set("width",Math.max(F,0)),bt!==F}function gt(Y,X,ot,At){var rt=X.target,lt=ot-X.offsetX,mt=At-X.offsetY,St=!rt.get("lockMovementX")&&rt.left!==lt,bt=!rt.get("lockMovementY")&&rt.top!==mt;return St&&rt.set("left",lt),bt&&rt.set("top",mt),(St||bt)&&y("moving",R(Y,X,ot,At)),St||bt}A.scaleCursorStyleHandler=B,A.skewCursorStyleHandler=M,A.scaleSkewCursorStyleHandler=z,A.rotationWithSnapping=K("rotating",W(U)),A.scalingEqually=K("scaling",W(V)),A.scalingX=K("scaling",W(O)),A.scalingY=K("scaling",W(et)),A.scalingYOrSkewingX=q,A.scalingXOrSkewingY=J,A.changeWidth=K("resizing",W(st)),A.skewHandlerX=D,A.skewHandlerY=k,A.dragHandler=gt,A.scaleOrSkewActionName=G,A.rotationStyleHandler=P,A.fireEvent=y,A.wrapWithFixedAnchor=W,A.wrapWithFireEvent=K,A.getLocalPoint=tt,s.controlsUtils=A}(n),function(o){var s=o.fabric||(o.fabric={}),l=s.util.degreesToRadians,u=s.controlsUtils;function A(h,p,m,d,g){d=d||{};var v=this.sizeX||d.cornerSize||g.cornerSize,w=this.sizeY||d.cornerSize||g.cornerSize,_=typeof d.transparentCorners<"u"?d.transparentCorners:g.transparentCorners,y=_?"stroke":"fill",C=!_&&(d.cornerStrokeColor||g.cornerStrokeColor),b=p,S=m,B;h.save(),h.fillStyle=d.cornerColor||g.cornerColor,h.strokeStyle=d.cornerStrokeColor||g.cornerStrokeColor,v>w?(B=v,h.scale(1,w/v),S=m*v/w):w>v?(B=w,h.scale(v/w,1),b=p*w/v):B=v,h.lineWidth=1,h.beginPath(),h.arc(b,S,B/2,0,2*Math.PI,!1),h[y](),C&&h.stroke(),h.restore()}function c(h,p,m,d,g){d=d||{};var v=this.sizeX||d.cornerSize||g.cornerSize,w=this.sizeY||d.cornerSize||g.cornerSize,_=typeof d.transparentCorners<"u"?d.transparentCorners:g.transparentCorners,y=_?"stroke":"fill",C=!_&&(d.cornerStrokeColor||g.cornerStrokeColor),b=v/2,S=w/2;h.save(),h.fillStyle=d.cornerColor||g.cornerColor,h.strokeStyle=d.cornerStrokeColor||g.cornerStrokeColor,h.lineWidth=1,h.translate(p,m),h.rotate(l(g.angle)),h[y+"Rect"](-b,-S,v,w),C&&h.strokeRect(-b,-S,v,w),h.restore()}u.renderCircleControl=A,u.renderSquareControl=c}(n),function(o){var s=o.fabric||(o.fabric={});function l(u){for(var A in u)this[A]=u[A]}s.Control=l,s.Control.prototype={visible:!0,actionName:"scale",angle:0,x:0,y:0,offsetX:0,offsetY:0,sizeX:null,sizeY:null,touchSizeX:null,touchSizeY:null,cursorStyle:"crosshair",withConnection:!1,actionHandler:function(){},mouseDownHandler:function(){},mouseUpHandler:function(){},getActionHandler:function(){return this.actionHandler},getMouseDownHandler:function(){return this.mouseDownHandler},getMouseUpHandler:function(){return this.mouseUpHandler},cursorStyleHandler:function(u,A){return A.cursorStyle},getActionName:function(u,A){return A.actionName},getVisibility:function(u,A){var c=u._controlsVisibility;return c&&typeof c[A]<"u"?c[A]:this.visible},setVisibility:function(u){this.visible=u},positionHandler:function(u,A){var c=s.util.transformPoint({x:this.x*u.x+this.offsetX,y:this.y*u.y+this.offsetY},A);return c},calcCornerCoords:function(u,A,c,h,p){var m,d,g,v,w=p?this.touchSizeX:this.sizeX,_=p?this.touchSizeY:this.sizeY;if(w&&_&&w!==_){var y=Math.atan2(_,w),C=Math.sqrt(w*w+_*_)/2,b=y-s.util.degreesToRadians(u),S=Math.PI/2-y-s.util.degreesToRadians(u);m=C*s.util.cos(b),d=C*s.util.sin(b),g=C*s.util.cos(S),v=C*s.util.sin(S)}else{var B=w&&_?w:A;C=B*.7071067812;var b=s.util.degreesToRadians(45-u);m=g=C*s.util.cos(b),d=v=C*s.util.sin(b)}return{tl:{x:c-v,y:h-g},tr:{x:c+m,y:h-d},bl:{x:c-m,y:h+d},br:{x:c+v,y:h+g}}},render:function(u,A,c,h,p){switch(h=h||{},h.cornerStyle||p.cornerStyle){case"circle":s.controlsUtils.renderCircleControl.call(this,u,A,c,h,p);break;default:s.controlsUtils.renderSquareControl.call(this,u,A,c,h,p)}}}}(n),function(){function o(c,h){var p=c.getAttribute("style"),m=c.getAttribute("offset")||0,d,g,v,w;if(m=parseFloat(m)/(/%$/.test(m)?100:1),m=m<0?0:m>1?1:m,p){var _=p.split(/\s*;\s*/);for(_[_.length-1]===""&&_.pop(),w=_.length;w--;){var y=_[w].split(/\s*:\s*/),C=y[0].trim(),b=y[1].trim();C==="stop-color"?d=b:C==="stop-opacity"&&(v=b)}}return d||(d=c.getAttribute("stop-color")||"rgb(0,0,0)"),v||(v=c.getAttribute("stop-opacity")),d=new t.Color(d),g=d.getAlpha(),v=isNaN(parseFloat(v))?1:parseFloat(v),v*=g*h,{offset:m,color:d.toRgb(),opacity:v}}function s(c){return{x1:c.getAttribute("x1")||0,y1:c.getAttribute("y1")||0,x2:c.getAttribute("x2")||"100%",y2:c.getAttribute("y2")||0}}function l(c){return{x1:c.getAttribute("fx")||c.getAttribute("cx")||"50%",y1:c.getAttribute("fy")||c.getAttribute("cy")||"50%",r1:0,x2:c.getAttribute("cx")||"50%",y2:c.getAttribute("cy")||"50%",r2:c.getAttribute("r")||"50%"}}var u=t.util.object.clone;t.Gradient=t.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(c){c||(c={}),c.coords||(c.coords={});var h,p=this;Object.keys(c).forEach(function(m){p[m]=c[m]}),this.id?this.id+="_"+t.Object.__uid++:this.id=t.Object.__uid++,h={x1:c.coords.x1||0,y1:c.coords.y1||0,x2:c.coords.x2||0,y2:c.coords.y2||0},this.type==="radial"&&(h.r1=c.coords.r1||0,h.r2=c.coords.r2||0),this.coords=h,this.colorStops=c.colorStops.slice()},addColorStop:function(c){for(var h in c){var p=new t.Color(c[h]);this.colorStops.push({offset:parseFloat(h),color:p.toRgb(),opacity:p.getAlpha()})}return this},toObject:function(c){var h={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return t.util.populateWithProperties(this,h,c),h},toSVG:function(c,g){var p=u(this.coords,!0),m,d,g=g||{},v,w,_=u(this.colorStops,!0),y=p.r1>p.r2,C=this.gradientTransform?this.gradientTransform.concat():t.iMatrix.concat(),b=-this.offsetX,S=-this.offsetY,B=!!g.additionalTransform,M=this.gradientUnits==="pixels"?"userSpaceOnUse":"objectBoundingBox";if(_.sort(function(W,K){return W.offset-K.offset}),M==="objectBoundingBox"?(b/=c.width,S/=c.height):(b+=c.width/2,S+=c.height/2),c.type==="path"&&this.gradientUnits!=="percentage"&&(b-=c.pathOffset.x,S-=c.pathOffset.y),C[4]-=b,C[5]-=S,w='id="SVGID_'+this.id+'" gradientUnits="'+M+'"',w+=' gradientTransform="'+(B?g.additionalTransform+" ":"")+t.util.matrixToSVG(C)+'" ',this.type==="linear"?v=["<linearGradient ",w,' x1="',p.x1,'" y1="',p.y1,'" x2="',p.x2,'" y2="',p.y2,`">
`]:this.type==="radial"&&(v=["<radialGradient ",w,' cx="',y?p.x1:p.x2,'" cy="',y?p.y1:p.y2,'" r="',y?p.r1:p.r2,'" fx="',y?p.x2:p.x1,'" fy="',y?p.y2:p.y1,`">
`]),this.type==="radial"){if(y)for(_=_.concat(),_.reverse(),m=0,d=_.length;m<d;m++)_[m].offset=1-_[m].offset;var z=Math.min(p.r1,p.r2);if(z>0){var G=Math.max(p.r1,p.r2),P=z/G;for(m=0,d=_.length;m<d;m++)_[m].offset+=P*(1-_[m].offset)}}for(m=0,d=_.length;m<d;m++){var R=_[m];v.push("<stop ",'offset="',R.offset*100+"%",'" style="stop-color:',R.color,typeof R.opacity<"u"?";stop-opacity: "+R.opacity:";",`"/>
`)}return v.push(this.type==="linear"?`</linearGradient>
`:`</radialGradient>
`),v.join("")},toLive:function(c){var h,p=t.util.object.clone(this.coords),m,d;if(this.type){for(this.type==="linear"?h=c.createLinearGradient(p.x1,p.y1,p.x2,p.y2):this.type==="radial"&&(h=c.createRadialGradient(p.x1,p.y1,p.r1,p.x2,p.y2,p.r2)),m=0,d=this.colorStops.length;m<d;m++){var g=this.colorStops[m].color,v=this.colorStops[m].opacity,w=this.colorStops[m].offset;typeof v<"u"&&(g=new t.Color(g).setAlpha(v).toRgba()),h.addColorStop(w,g)}return h}}}),t.util.object.extend(t.Gradient,{fromElement:function(c,h,p,m){var d=parseFloat(p)/(/%$/.test(p)?100:1);d=d<0?0:d>1?1:d,isNaN(d)&&(d=1);var g=c.getElementsByTagName("stop"),v,w=c.getAttribute("gradientUnits")==="userSpaceOnUse"?"pixels":"percentage",_=c.getAttribute("gradientTransform")||"",y=[],C,b,S=0,B=0,M;for(c.nodeName==="linearGradient"||c.nodeName==="LINEARGRADIENT"?(v="linear",C=s(c)):(v="radial",C=l(c)),b=g.length;b--;)y.push(o(g[b],d));M=t.parseTransformAttribute(_),A(h,C,m,w),w==="pixels"&&(S=-h.left,B=-h.top);var z=new t.Gradient({id:c.getAttribute("id"),type:v,coords:C,colorStops:y,gradientUnits:w,gradientTransform:M,offsetX:S,offsetY:B});return z}});function A(c,h,p,m){var d,g;Object.keys(h).forEach(function(v){d=h[v],d==="Infinity"?g=1:d==="-Infinity"?g=0:(g=parseFloat(h[v],10),typeof d=="string"&&/^(\d+\.\d+)%|(\d+)%$/.test(d)&&(g*=.01,m==="pixels"&&((v==="x1"||v==="x2"||v==="r2")&&(g*=p.viewBoxWidth||p.width),(v==="y1"||v==="y2")&&(g*=p.viewBoxHeight||p.height)))),h[v]=g})}}(),function(){var o=t.util.toFixed;t.Pattern=t.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(s,l){if(s||(s={}),this.id=t.Object.__uid++,this.setOptions(s),!s.source||s.source&&typeof s.source!="string"){l&&l(this);return}else{var u=this;this.source=t.util.createImage(),t.util.loadImage(s.source,function(A,c){u.source=A,l&&l(u,c)},null,this.crossOrigin)}},toObject:function(s){var l=t.Object.NUM_FRACTION_DIGITS,u,A;return typeof this.source.src=="string"?u=this.source.src:typeof this.source=="object"&&this.source.toDataURL&&(u=this.source.toDataURL()),A={type:"pattern",source:u,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:o(this.offsetX,l),offsetY:o(this.offsetY,l),patternTransform:this.patternTransform?this.patternTransform.concat():null},t.util.populateWithProperties(this,A,s),A},toSVG:function(s){var l=typeof this.source=="function"?this.source():this.source,u=l.width/s.width,A=l.height/s.height,c=this.offsetX/s.width,h=this.offsetY/s.height,p="";return(this.repeat==="repeat-x"||this.repeat==="no-repeat")&&(A=1,h&&(A+=Math.abs(h))),(this.repeat==="repeat-y"||this.repeat==="no-repeat")&&(u=1,c&&(u+=Math.abs(c))),l.src?p=l.src:l.toDataURL&&(p=l.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+c+'" y="'+h+'" width="'+u+'" height="'+A+`">
<image x="0" y="0" width="`+l.width+'" height="'+l.height+'" xlink:href="'+p+`"></image>
</pattern>
`},setOptions:function(s){for(var l in s)this[l]=s[l]},toLive:function(s){var l=this.source;return!l||typeof l.src<"u"&&(!l.complete||l.naturalWidth===0||l.naturalHeight===0)?"":s.createPattern(l,this.repeat)}})}(),function(o){var s=o.fabric||(o.fabric={}),l=s.util.toFixed;if(s.Shadow){s.warn("fabric.Shadow is already defined.");return}s.Shadow=s.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(u){typeof u=="string"&&(u=this._parseShadow(u));for(var A in u)this[A]=u[A];this.id=s.Object.__uid++},_parseShadow:function(u){var A=u.trim(),c=s.Shadow.reOffsetsAndBlur.exec(A)||[],h=A.replace(s.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)";return{color:h.trim(),offsetX:parseFloat(c[1],10)||0,offsetY:parseFloat(c[2],10)||0,blur:parseFloat(c[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(u){var A=40,c=40,h=s.Object.NUM_FRACTION_DIGITS,p=s.util.rotateVector({x:this.offsetX,y:this.offsetY},s.util.degreesToRadians(-u.angle)),m=20,d=new s.Color(this.color);return u.width&&u.height&&(A=l((Math.abs(p.x)+this.blur)/u.width,h)*100+m,c=l((Math.abs(p.y)+this.blur)/u.height,h)*100+m),u.flipX&&(p.x*=-1),u.flipY&&(p.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+c+'%" height="'+(100+2*c)+'%" x="-'+A+'%" width="'+(100+2*A)+`%" >
	<feGaussianBlur in="SourceAlpha" stdDeviation="`+l(this.blur?this.blur/2:0,h)+`"></feGaussianBlur>
	<feOffset dx="`+l(p.x,h)+'" dy="'+l(p.y,h)+`" result="oBlur" ></feOffset>
	<feFlood flood-color="`+d.toRgb()+'" flood-opacity="'+d.getAlpha()+`"/>
	<feComposite in2="oBlur" operator="in" />
	<feMerge>
		<feMergeNode></feMergeNode>
		<feMergeNode in="SourceGraphic"></feMergeNode>
	</feMerge>
</filter>
`},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var u={},A=s.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach(function(c){this[c]!==A[c]&&(u[c]=this[c])},this),u}}),s.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(\d+(?:\.\d*)?(?:px)?)?(?:\s?|$)(?:$|\s)/}(n),function(){if(t.StaticCanvas){t.warn("fabric.StaticCanvas is already defined.");return}var o=t.util.object.extend,s=t.util.getElementOffset,l=t.util.removeFromArray,u=t.util.toFixed,A=t.util.transformPoint,c=t.util.invertTransform,h=t.util.getNodeCanvas,p=t.util.createCanvasElement,m=new Error("Could not initialize `canvas` element");t.StaticCanvas=t.util.createClass(t.CommonMethods,{initialize:function(d,g){g||(g={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(d,g)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:t.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(d,g){var v=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(d),this._initOptions(g),this.interactive||this._initRetinaScaling(),g.overlayImage&&this.setOverlayImage(g.overlayImage,v),g.backgroundImage&&this.setBackgroundImage(g.backgroundImage,v),g.backgroundColor&&this.setBackgroundColor(g.backgroundColor,v),g.overlayColor&&this.setOverlayColor(g.overlayColor,v),this.calcOffset()},_isRetinaScaling:function(){return t.devicePixelRatio>1&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?Math.max(1,t.devicePixelRatio):1},_initRetinaScaling:function(){if(this._isRetinaScaling()){var d=t.devicePixelRatio;this.__initRetinaScaling(d,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(d,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(d,g,v){g.setAttribute("width",this.width*d),g.setAttribute("height",this.height*d),v.scale(d,d)},calcOffset:function(){return this._offset=s(this.lowerCanvasEl),this},setOverlayImage:function(d,g,v){return this.__setBgOverlayImage("overlayImage",d,g,v)},setBackgroundImage:function(d,g,v){return this.__setBgOverlayImage("backgroundImage",d,g,v)},setOverlayColor:function(d,g){return this.__setBgOverlayColor("overlayColor",d,g)},setBackgroundColor:function(d,g){return this.__setBgOverlayColor("backgroundColor",d,g)},__setBgOverlayImage:function(d,g,v,w){return typeof g=="string"?t.util.loadImage(g,function(_,y){if(_){var C=new t.Image(_,w);this[d]=C,C.canvas=this}v&&v(_,y)},this,w&&w.crossOrigin):(w&&g.setOptions(w),this[d]=g,g&&(g.canvas=this),v&&v(g,!1)),this},__setBgOverlayColor:function(d,g,v){return this[d]=g,this._initGradient(g,d),this._initPattern(g,d,v),this},_createCanvasElement:function(){var d=p();if(!d||(d.style||(d.style={}),typeof d.getContext>"u"))throw m;return d},_initOptions:function(d){var g=this.lowerCanvasEl;this._setOptions(d),this.width=this.width||parseInt(g.width,10)||0,this.height=this.height||parseInt(g.height,10)||0,this.lowerCanvasEl.style&&(g.width=this.width,g.height=this.height,g.style.width=this.width+"px",g.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(d){d&&d.getContext?this.lowerCanvasEl=d:this.lowerCanvasEl=t.util.getById(d)||this._createCanvasElement(),t.util.addClass(this.lowerCanvasEl,"lower-canvas"),this._originalCanvasStyle=this.lowerCanvasEl.style,this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(d,g){return this.setDimensions({width:d},g)},setHeight:function(d,g){return this.setDimensions({height:d},g)},setDimensions:function(d,g){var v;g=g||{};for(var w in d)v=d[w],g.cssOnly||(this._setBackstoreDimension(w,d[w]),v+="px",this.hasLostContext=!0),g.backstoreOnly||this._setCssDimension(w,v);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop),this._initRetinaScaling(),this.calcOffset(),g.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(d,g){return this.lowerCanvasEl[d]=g,this.upperCanvasEl&&(this.upperCanvasEl[d]=g),this.cacheCanvasEl&&(this.cacheCanvasEl[d]=g),this[d]=g,this},_setCssDimension:function(d,g){return this.lowerCanvasEl.style[d]=g,this.upperCanvasEl&&(this.upperCanvasEl.style[d]=g),this.wrapperEl&&(this.wrapperEl.style[d]=g),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(d){var g=this._activeObject,v=this.backgroundImage,w=this.overlayImage,_,y,C;for(this.viewportTransform=d,y=0,C=this._objects.length;y<C;y++)_=this._objects[y],_.group||_.setCoords(!0);return g&&g.setCoords(),v&&v.setCoords(!0),w&&w.setCoords(!0),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(d,g){var v=d,w=this.viewportTransform.slice(0);d=A(d,c(this.viewportTransform)),w[0]=g,w[3]=g;var _=A(d,w);return w[4]+=v.x-_.x,w[5]+=v.y-_.y,this.setViewportTransform(w)},setZoom:function(d){return this.zoomToPoint(new t.Point(0,0),d),this},absolutePan:function(d){var g=this.viewportTransform.slice(0);return g[4]=-d.x,g[5]=-d.y,this.setViewportTransform(g)},relativePan:function(d){return this.absolutePan(new t.Point(-d.x-this.viewportTransform[4],-d.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(d){this.stateful&&d.setupState(),d._set("canvas",this),d.setCoords(),this.fire("object:added",{target:d}),d.fire("added")},_onObjectRemoved:function(d){this.fire("object:removed",{target:d}),d.fire("removed"),delete d.canvas},clearContext:function(d){return d.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this.remove.apply(this,this.getObjects()),this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){var d=this.contextContainer;return this.renderCanvas(d,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=t.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var d={},g=this.width,v=this.height,w=c(this.viewportTransform);return d.tl=A({x:0,y:0},w),d.br=A({x:g,y:v},w),d.tr=new t.Point(d.br.x,d.tl.y),d.bl=new t.Point(d.tl.x,d.br.y),this.vptCoords=d,d},cancelRequestedRender:function(){this.isRendering&&(t.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(d,g){var v=this.viewportTransform,w=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(d),t.util.setImageSmoothing(d,this.imageSmoothingEnabled),this.fire("before:render",{ctx:d}),this._renderBackground(d),d.save(),d.transform(v[0],v[1],v[2],v[3],v[4],v[5]),this._renderObjects(d,g),d.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(d),w&&(w.canvas=this,w.shouldCache(),w._transformDone=!0,w.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(d)),this._renderOverlay(d),this.controlsAboveOverlay&&this.interactive&&this.drawControls(d),this.fire("after:render",{ctx:d})},drawClipPathOnCanvas:function(d){var g=this.viewportTransform,v=this.clipPath;d.save(),d.transform(g[0],g[1],g[2],g[3],g[4],g[5]),d.globalCompositeOperation="destination-in",v.transform(d),d.scale(1/v.zoomX,1/v.zoomY),d.drawImage(v._cacheCanvas,-v.cacheTranslationX,-v.cacheTranslationY),d.restore()},_renderObjects:function(d,g){var v,w;for(v=0,w=g.length;v<w;++v)g[v]&&g[v].render(d)},_renderBackgroundOrOverlay:function(d,g){var v=this[g+"Color"],w=this[g+"Image"],_=this.viewportTransform,y=this[g+"Vpt"];if(!(!v&&!w)){if(v){d.save(),d.beginPath(),d.moveTo(0,0),d.lineTo(this.width,0),d.lineTo(this.width,this.height),d.lineTo(0,this.height),d.closePath(),d.fillStyle=v.toLive?v.toLive(d,this):v,y&&d.transform(_[0],_[1],_[2],_[3],_[4],_[5]),d.transform(1,0,0,1,v.offsetX||0,v.offsetY||0);var C=v.gradientTransform||v.patternTransform;C&&d.transform(C[0],C[1],C[2],C[3],C[4],C[5]),d.fill(),d.restore()}w&&(d.save(),y&&d.transform(_[0],_[1],_[2],_[3],_[4],_[5]),w.render(d),d.restore())}},_renderBackground:function(d){this._renderBackgroundOrOverlay(d,"background")},_renderOverlay:function(d){this._renderBackgroundOrOverlay(d,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},getCenterPoint:function(){return new t.Point(this.width/2,this.height/2)},centerObjectH:function(d){return this._centerObject(d,new t.Point(this.getCenterPoint().x,d.getCenterPoint().y))},centerObjectV:function(d){return this._centerObject(d,new t.Point(d.getCenterPoint().x,this.getCenterPoint().y))},centerObject:function(d){var g=this.getCenterPoint();return this._centerObject(d,g)},viewportCenterObject:function(d){var g=this.getVpCenter();return this._centerObject(d,g)},viewportCenterObjectH:function(d){var g=this.getVpCenter();return this._centerObject(d,new t.Point(g.x,d.getCenterPoint().y)),this},viewportCenterObjectV:function(d){var g=this.getVpCenter();return this._centerObject(d,new t.Point(d.getCenterPoint().x,g.y))},getVpCenter:function(){var d=this.getCenterPoint(),g=c(this.viewportTransform);return A(d,g)},_centerObject:function(d,g){return d.setPositionByOrigin(g,"center","center"),d.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(d){return this.toDatalessObject(d)},toObject:function(d){return this._toObjectMethod("toObject",d)},toDatalessObject:function(d){return this._toObjectMethod("toDatalessObject",d)},_toObjectMethod:function(d,g){var v=this.clipPath,w={version:t.version,objects:this._toObjects(d,g)};return v&&!v.excludeFromExport&&(w.clipPath=this._toObject(this.clipPath,d,g)),o(w,this.__serializeBgOverlay(d,g)),t.util.populateWithProperties(this,w,g),w},_toObjects:function(d,g){return this._objects.filter(function(v){return!v.excludeFromExport}).map(function(v){return this._toObject(v,d,g)},this)},_toObject:function(d,g,v){var w;this.includeDefaultValues||(w=d.includeDefaultValues,d.includeDefaultValues=!1);var _=d[g](v);return this.includeDefaultValues||(d.includeDefaultValues=w),_},__serializeBgOverlay:function(d,g){var v={},w=this.backgroundImage,_=this.overlayImage,y=this.backgroundColor,C=this.overlayColor;return y&&y.toObject?y.excludeFromExport||(v.background=y.toObject(g)):y&&(v.background=y),C&&C.toObject?C.excludeFromExport||(v.overlay=C.toObject(g)):C&&(v.overlay=C),w&&!w.excludeFromExport&&(v.backgroundImage=this._toObject(w,d,g)),_&&!_.excludeFromExport&&(v.overlayImage=this._toObject(_,d,g)),v},svgViewportTransformation:!0,toSVG:function(d,g){d||(d={}),d.reviver=g;var v=[];return this._setSVGPreamble(v,d),this._setSVGHeader(v,d),this.clipPath&&v.push('<g clip-path="url(#'+this.clipPath.clipPathId+`)" >
`),this._setSVGBgOverlayColor(v,"background"),this._setSVGBgOverlayImage(v,"backgroundImage",g),this._setSVGObjects(v,g),this.clipPath&&v.push(`</g>
`),this._setSVGBgOverlayColor(v,"overlay"),this._setSVGBgOverlayImage(v,"overlayImage",g),v.push("</svg>"),v.join("")},_setSVGPreamble:function(d,g){g.suppressPreamble||d.push('<?xml version="1.0" encoding="',g.encoding||"UTF-8",`" standalone="no" ?>
`,'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',`"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
`)},_setSVGHeader:function(d,g){var v=g.width||this.width,w=g.height||this.height,_,y='viewBox="0 0 '+this.width+" "+this.height+'" ',C=t.Object.NUM_FRACTION_DIGITS;g.viewBox?y='viewBox="'+g.viewBox.x+" "+g.viewBox.y+" "+g.viewBox.width+" "+g.viewBox.height+'" ':this.svgViewportTransformation&&(_=this.viewportTransform,y='viewBox="'+u(-_[4]/_[0],C)+" "+u(-_[5]/_[3],C)+" "+u(this.width/_[0],C)+" "+u(this.height/_[3],C)+'" '),d.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',v,'" ','height="',w,'" ',y,`xml:space="preserve">
`,"<desc>Created with Fabric.js ",t.version,`</desc>
`,`<defs>
`,this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(g),`</defs>
`)},createSVGClipPathMarkup:function(d){var g=this.clipPath;return g?(g.clipPathId="CLIPPATH_"+t.Object.__uid++,'<clipPath id="'+g.clipPathId+`" >
`+this.clipPath.toClipPathSVG(d.reviver)+`</clipPath>
`):""},createSVGRefElementsMarkup:function(){var d=this,g=["background","overlay"].map(function(v){var w=d[v+"Color"];if(w&&w.toLive){var _=d[v+"Vpt"],y=d.viewportTransform,C={width:d.width/(_?y[0]:1),height:d.height/(_?y[3]:1)};return w.toSVG(C,{additionalTransform:_?t.util.matrixToSVG(y):""})}});return g.join("")},createSVGFontFacesMarkup:function(){var d="",g={},v,w,_,y,C,b,S,B,M,z=t.fontPaths,G=[];for(this._objects.forEach(function R(W){G.push(W),W._objects&&W._objects.forEach(R)}),B=0,M=G.length;B<M;B++)if(v=G[B],w=v.fontFamily,!(v.type.indexOf("text")===-1||g[w]||!z[w])&&(g[w]=!0,!!v.styles)){_=v.styles;for(C in _){y=_[C];for(S in y)b=y[S],w=b.fontFamily,!g[w]&&z[w]&&(g[w]=!0)}}for(var P in g)d+=[`		@font-face {
`,"			font-family: '",P,`';
`,"			src: url('",z[P],`');
`,`		}
`].join("");return d&&(d=['	<style type="text/css">',`<![CDATA[
`,d,"]]>",`</style>
`].join("")),d},_setSVGObjects:function(d,g){var v,w,_,y=this._objects;for(w=0,_=y.length;w<_;w++)v=y[w],!v.excludeFromExport&&this._setSVGObject(d,v,g)},_setSVGObject:function(d,g,v){d.push(g.toSVG(v))},_setSVGBgOverlayImage:function(d,g,v){this[g]&&!this[g].excludeFromExport&&this[g].toSVG&&d.push(this[g].toSVG(v))},_setSVGBgOverlayColor:function(d,g){var v=this[g+"Color"],w=this.viewportTransform,_=this.width,y=this.height;if(v)if(v.toLive){var C=v.repeat,b=t.util.invertTransform(w),S=this[g+"Vpt"],B=S?t.util.matrixToSVG(b):"";d.push('<rect transform="'+B+" translate(",_/2,",",y/2,')"',' x="',v.offsetX-_/2,'" y="',v.offsetY-y/2,'" ','width="',C==="repeat-y"||C==="no-repeat"?v.source.width:_,'" height="',C==="repeat-x"||C==="no-repeat"?v.source.height:y,'" fill="url(#SVGID_'+v.id+')"',`></rect>
`)}else d.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',v,'"',`></rect>
`)},sendToBack:function(d){if(!d)return this;var g=this._activeObject,v,w,_;if(d===g&&d.type==="activeSelection")for(_=g._objects,v=_.length;v--;)w=_[v],l(this._objects,w),this._objects.unshift(w);else l(this._objects,d),this._objects.unshift(d);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(d){if(!d)return this;var g=this._activeObject,v,w,_;if(d===g&&d.type==="activeSelection")for(_=g._objects,v=0;v<_.length;v++)w=_[v],l(this._objects,w),this._objects.push(w);else l(this._objects,d),this._objects.push(d);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(d,g){if(!d)return this;var v=this._activeObject,w,_,y,C,b,S=0;if(d===v&&d.type==="activeSelection")for(b=v._objects,w=0;w<b.length;w++)_=b[w],y=this._objects.indexOf(_),y>0+S&&(C=y-1,l(this._objects,_),this._objects.splice(C,0,_)),S++;else y=this._objects.indexOf(d),y!==0&&(C=this._findNewLowerIndex(d,y,g),l(this._objects,d),this._objects.splice(C,0,d));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(d,g,v){var w,_;if(v)for(w=g,_=g-1;_>=0;--_){var y=d.intersectsWithObject(this._objects[_])||d.isContainedWithinObject(this._objects[_])||this._objects[_].isContainedWithinObject(d);if(y){w=_;break}}else w=g-1;return w},bringForward:function(d,g){if(!d)return this;var v=this._activeObject,w,_,y,C,b,S=0;if(d===v&&d.type==="activeSelection")for(b=v._objects,w=b.length;w--;)_=b[w],y=this._objects.indexOf(_),y<this._objects.length-1-S&&(C=y+1,l(this._objects,_),this._objects.splice(C,0,_)),S++;else y=this._objects.indexOf(d),y!==this._objects.length-1&&(C=this._findNewUpperIndex(d,y,g),l(this._objects,d),this._objects.splice(C,0,d));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(d,g,v){var w,_,y;if(v)for(w=g,_=g+1,y=this._objects.length;_<y;++_){var C=d.intersectsWithObject(this._objects[_])||d.isContainedWithinObject(this._objects[_])||this._objects[_].isContainedWithinObject(d);if(C){w=_;break}}else w=g+1;return w},moveTo:function(d,g){return l(this._objects,d),this._objects.splice(g,0,d),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(t.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(d){d.dispose&&d.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),t.util.setStyle(this.lowerCanvasEl,this._originalCanvasStyle),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),t.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),o(t.StaticCanvas.prototype,t.Observable),o(t.StaticCanvas.prototype,t.Collection),o(t.StaticCanvas.prototype,t.DataURLExporter),o(t.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(d){var g=p();if(!g||!g.getContext)return null;var v=g.getContext("2d");if(!v)return null;switch(d){case"setLineDash":return typeof v.setLineDash<"u";default:return null}}}),t.StaticCanvas.prototype.toJSON=t.StaticCanvas.prototype.toObject,t.isLikelyNode&&(t.StaticCanvas.prototype.createPNGStream=function(){var d=h(this.lowerCanvasEl);return d&&d.createPNGStream()},t.StaticCanvas.prototype.createJPEGStream=function(d){var g=h(this.lowerCanvasEl);return g&&g.createJPEGStream(d)})}(),t.BaseBrush=t.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,limitedToCanvasSize:!1,_setBrushStyles:function(o){o.strokeStyle=this.color,o.lineWidth=this.width,o.lineCap=this.strokeLineCap,o.miterLimit=this.strokeMiterLimit,o.lineJoin=this.strokeLineJoin,o.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(o){var s=this.canvas.viewportTransform;o.save(),o.transform(s[0],s[1],s[2],s[3],s[4],s[5])},_setShadow:function(){if(this.shadow){var o=this.canvas,s=this.shadow,l=o.contextTop,u=o.getZoom();o&&o._isRetinaScaling()&&(u*=t.devicePixelRatio),l.shadowColor=s.color,l.shadowBlur=s.blur*u,l.shadowOffsetX=s.offsetX*u,l.shadowOffsetY=s.offsetY*u}},needsFullRender:function(){var o=new t.Color(this.color);return o.getAlpha()<1||!!this.shadow},_resetShadow:function(){var o=this.canvas.contextTop;o.shadowColor="",o.shadowBlur=o.shadowOffsetX=o.shadowOffsetY=0},_isOutSideCanvas:function(o){return o.x<0||o.x>this.canvas.getWidth()||o.y<0||o.y>this.canvas.getHeight()}}),function(){t.PencilBrush=t.util.createClass(t.BaseBrush,{decimate:.4,drawStraightLine:!1,straightLineKey:"shiftKey",initialize:function(o){this.canvas=o,this._points=[]},needsFullRender:function(){return this.callSuper("needsFullRender")||this._hasStraightLine},_drawSegment:function(o,s,l){var u=s.midPointFrom(l);return o.quadraticCurveTo(s.x,s.y,u.x,u.y),u},onMouseDown:function(o,s){this.canvas._isMainEvent(s.e)&&(this.drawStraightLine=s.e[this.straightLineKey],this._prepareForDrawing(o),this._captureDrawingPath(o),this._render())},onMouseMove:function(o,s){if(this.canvas._isMainEvent(s.e)&&(this.drawStraightLine=s.e[this.straightLineKey],!(this.limitedToCanvasSize===!0&&this._isOutSideCanvas(o))&&this._captureDrawingPath(o)&&this._points.length>1))if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var l=this._points,u=l.length,A=this.canvas.contextTop;this._saveAndTransform(A),this.oldEnd&&(A.beginPath(),A.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(A,l[u-2],l[u-1],!0),A.stroke(),A.restore()}},onMouseUp:function(o){return this.canvas._isMainEvent(o.e)?(this.drawStraightLine=!1,this.oldEnd=void 0,this._finalizeAndAddPath(),!1):!0},_prepareForDrawing:function(o){var s=new t.Point(o.x,o.y);this._reset(),this._addPoint(s),this.canvas.contextTop.moveTo(s.x,s.y)},_addPoint:function(o){return this._points.length>1&&o.eq(this._points[this._points.length-1])?!1:(this.drawStraightLine&&this._points.length>1&&(this._hasStraightLine=!0,this._points.pop()),this._points.push(o),!0)},_reset:function(){this._points=[],this._setBrushStyles(this.canvas.contextTop),this._setShadow(),this._hasStraightLine=!1},_captureDrawingPath:function(o){var s=new t.Point(o.x,o.y);return this._addPoint(s)},_render:function(o){var s,l,u=this._points[0],A=this._points[1];if(o=o||this.canvas.contextTop,this._saveAndTransform(o),o.beginPath(),this._points.length===2&&u.x===A.x&&u.y===A.y){var c=this.width/1e3;u=new t.Point(u.x,u.y),A=new t.Point(A.x,A.y),u.x-=c,A.x+=c}for(o.moveTo(u.x,u.y),s=1,l=this._points.length;s<l;s++)this._drawSegment(o,u,A),u=this._points[s],A=this._points[s+1];o.lineTo(u.x,u.y),o.stroke(),o.restore()},convertPointsToSVGPath:function(o){var s=this.width/1e3;return t.util.getSmoothPathFromPoints(o,s)},_isEmptySVGPath:function(o){var s=t.util.joinPath(o);return s==="M 0 0 Q 0 0 0 0 L 0 0"},createPath:function(o){var s=new t.Path(o,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,s.shadow=new t.Shadow(this.shadow)),s},decimatePoints:function(o,s){if(o.length<=2)return o;var l=this.canvas.getZoom(),u=Math.pow(s/l,2),A,c=o.length-1,h=o[0],p=[h],m;for(A=1;A<c-1;A++)m=Math.pow(h.x-o[A].x,2)+Math.pow(h.y-o[A].y,2),m>=u&&(h=o[A],p.push(h));return p.push(o[c]),p},_finalizeAndAddPath:function(){var o=this.canvas.contextTop;o.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var s=this.convertPointsToSVGPath(this._points);if(this._isEmptySVGPath(s)){this.canvas.requestRenderAll();return}var l=this.createPath(s);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:l}),this.canvas.add(l),this.canvas.requestRenderAll(),l.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:l})}})}(),t.CircleBrush=t.util.createClass(t.BaseBrush,{width:10,initialize:function(o){this.canvas=o,this.points=[]},drawDot:function(o){var s=this.addPoint(o),l=this.canvas.contextTop;this._saveAndTransform(l),this.dot(l,s),l.restore()},dot:function(o,s){o.fillStyle=s.fill,o.beginPath(),o.arc(s.x,s.y,s.radius,0,Math.PI*2,!1),o.closePath(),o.fill()},onMouseDown:function(o){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(o)},_render:function(){var o=this.canvas.contextTop,s,l,u=this.points;for(this._saveAndTransform(o),s=0,l=u.length;s<l;s++)this.dot(o,u[s]);o.restore()},onMouseMove:function(o){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(o)||(this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(o),this._render()):this.drawDot(o))},onMouseUp:function(){var o=this.canvas.renderOnAddRemove,s,l;this.canvas.renderOnAddRemove=!1;var u=[];for(s=0,l=this.points.length;s<l;s++){var A=this.points[s],c=new t.Circle({radius:A.radius,left:A.x,top:A.y,originX:"center",originY:"center",fill:A.fill});this.shadow&&(c.shadow=new t.Shadow(this.shadow)),u.push(c)}var h=new t.Group(u);h.canvas=this.canvas,this.canvas.fire("before:path:created",{path:h}),this.canvas.add(h),this.canvas.fire("path:created",{path:h}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=o,this.canvas.requestRenderAll()},addPoint:function(o){var s=new t.Point(o.x,o.y),l=t.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,u=new t.Color(this.color).setAlpha(t.util.getRandomInt(0,100)/100).toRgba();return s.radius=l,s.fill=u,this.points.push(s),s}}),t.SprayBrush=t.util.createClass(t.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(o){this.canvas=o,this.sprayChunks=[]},onMouseDown:function(o){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(o),this.render(this.sprayChunkPoints)},onMouseMove:function(o){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(o)||(this.addSprayChunk(o),this.render(this.sprayChunkPoints))},onMouseUp:function(){var o=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var s=[],l=0,u=this.sprayChunks.length;l<u;l++)for(var A=this.sprayChunks[l],c=0,h=A.length;c<h;c++){var p=new t.Rect({width:A[c].width,height:A[c].width,left:A[c].x+1,top:A[c].y+1,originX:"center",originY:"center",fill:this.color});s.push(p)}this.optimizeOverlapping&&(s=this._getOptimizedRects(s));var m=new t.Group(s);this.shadow&&m.set("shadow",new t.Shadow(this.shadow)),this.canvas.fire("before:path:created",{path:m}),this.canvas.add(m),this.canvas.fire("path:created",{path:m}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=o,this.canvas.requestRenderAll()},_getOptimizedRects:function(o){var s={},l,u,A;for(u=0,A=o.length;u<A;u++)l=o[u].left+""+o[u].top,s[l]||(s[l]=o[u]);var c=[];for(l in s)c.push(s[l]);return c},render:function(o){var s=this.canvas.contextTop,l,u;for(s.fillStyle=this.color,this._saveAndTransform(s),l=0,u=o.length;l<u;l++){var A=o[l];typeof A.opacity<"u"&&(s.globalAlpha=A.opacity),s.fillRect(A.x,A.y,A.width,A.width)}s.restore()},_render:function(){var o=this.canvas.contextTop,s,l;for(o.fillStyle=this.color,this._saveAndTransform(o),s=0,l=this.sprayChunks.length;s<l;s++)this.render(this.sprayChunks[s]);o.restore()},addSprayChunk:function(o){this.sprayChunkPoints=[];var s,l,u,A=this.width/2,c;for(c=0;c<this.density;c++){s=t.util.getRandomInt(o.x-A,o.x+A),l=t.util.getRandomInt(o.y-A,o.y+A),this.dotWidthVariance?u=t.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):u=this.dotWidth;var h=new t.Point(s,l);h.width=u,this.randomOpacity&&(h.opacity=t.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(h)}this.sprayChunks.push(this.sprayChunkPoints)}}),t.PatternBrush=t.util.createClass(t.PencilBrush,{getPatternSrc:function(){var o=20,s=5,l=t.util.createCanvasElement(),u=l.getContext("2d");return l.width=l.height=o+s,u.fillStyle=this.color,u.beginPath(),u.arc(o/2,o/2,o/2,0,Math.PI*2,!1),u.closePath(),u.fill(),l},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(o){return o.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(o){this.callSuper("_setBrushStyles",o),o.strokeStyle=this.getPattern(o)},createPath:function(o){var s=this.callSuper("createPath",o),l=s._getLeftTopCoords().scalarAdd(s.strokeWidth/2);return s.stroke=new t.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-l.x,offsetY:-l.y}),s}}),function(){var o=t.util.getPointer,s=t.util.degreesToRadians,l=t.util.isTouchEvent;t.Canvas=t.util.createClass(t.StaticCanvas,{initialize:function(A,c){c||(c={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(A,c),this._initInteractive(),this._createCacheCanvas()},uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],enablePointerEvents:!1,_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=t.PencilBrush&&new t.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var A=this.getActiveObjects(),c,h,p;if(A.length>0&&!this.preserveObjectStacking){h=[],p=[];for(var m=0,d=this._objects.length;m<d;m++)c=this._objects[m],A.indexOf(c)===-1?h.push(c):p.push(c);A.length>1&&(this._activeObject._objects=p),h.push.apply(h,p)}else h=this._objects;return h},renderAll:function(){this.contextTopDirty&&!this._groupSelector&&!this.isDrawingMode&&(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1);var A=this.contextContainer;return this.renderCanvas(A,this._chooseObjectsToRender()),this},renderTopLayer:function(A){A.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(A),this.contextTopDirty=!0),A.restore()},renderTop:function(){var A=this.contextTop;return this.clearContext(A),this.renderTopLayer(A),this.fire("after:render"),this},_normalizePointer:function(A,c){var h=A.calcTransformMatrix(),p=t.util.invertTransform(h),m=this.restorePointerVpt(c);return t.util.transformPoint(m,p)},isTargetTransparent:function(A,c,h){if(A.shouldCache()&&A._cacheCanvas&&A!==this._activeObject){var p=this._normalizePointer(A,{x:c,y:h}),m=Math.max(A.cacheTranslationX+p.x*A.zoomX,0),d=Math.max(A.cacheTranslationY+p.y*A.zoomY,0),_=t.util.isTransparent(A._cacheContext,Math.round(m),Math.round(d),this.targetFindTolerance);return _}var g=this.contextCache,v=A.selectionBackgroundColor,w=this.viewportTransform;A.selectionBackgroundColor="",this.clearContext(g),g.save(),g.transform(w[0],w[1],w[2],w[3],w[4],w[5]),A.render(g),g.restore(),A.selectionBackgroundColor=v;var _=t.util.isTransparent(g,c,h,this.targetFindTolerance);return _},_isSelectionKeyPressed:function(A){var c=!1;return Array.isArray(this.selectionKey)?c=!!this.selectionKey.find(function(h){return A[h]===!0}):c=A[this.selectionKey],c},_shouldClearSelection:function(A,c){var h=this.getActiveObjects(),p=this._activeObject;return!c||c&&p&&h.length>1&&h.indexOf(c)===-1&&p!==c&&!this._isSelectionKeyPressed(A)||c&&!c.evented||c&&!c.selectable&&p&&p!==c},_shouldCenterTransform:function(A,c,h){if(A){var p;return c==="scale"||c==="scaleX"||c==="scaleY"||c==="resizing"?p=this.centeredScaling||A.centeredScaling:c==="rotate"&&(p=this.centeredRotation||A.centeredRotation),p?!h:h}},_getOriginFromCorner:function(A,c){var h={x:A.originX,y:A.originY};return c==="ml"||c==="tl"||c==="bl"?h.x="right":(c==="mr"||c==="tr"||c==="br")&&(h.x="left"),c==="tl"||c==="mt"||c==="tr"?h.y="bottom":(c==="bl"||c==="mb"||c==="br")&&(h.y="top"),h},_getActionFromCorner:function(A,c,h,p){if(!c||!A)return"drag";var m=p.controls[c];return m.getActionName(h,m,p)},_setupCurrentTransform:function(A,c,h){if(c){var p=this.getPointer(A),m=c.__corner,d=c.controls[m],g=h&&m?d.getActionHandler(A,c,d):t.controlsUtils.dragHandler,v=this._getActionFromCorner(h,m,A,c),w=this._getOriginFromCorner(c,m),_=A[this.centeredKey],y={target:c,action:v,actionHandler:g,corner:m,scaleX:c.scaleX,scaleY:c.scaleY,skewX:c.skewX,skewY:c.skewY,offsetX:p.x-c.left,offsetY:p.y-c.top,originX:w.x,originY:w.y,ex:p.x,ey:p.y,lastX:p.x,lastY:p.y,theta:s(c.angle),width:c.width*c.scaleX,shiftKey:A.shiftKey,altKey:_,original:t.util.saveObjectTransform(c)};this._shouldCenterTransform(c,v,_)&&(y.originX="center",y.originY="center"),y.original.originX=w.x,y.original.originY=w.y,this._currentTransform=y,this._beforeTransform(A)}},setCursor:function(A){this.upperCanvasEl.style.cursor=A},_drawSelection:function(A){var c=this._groupSelector,h=new t.Point(c.ex,c.ey),p=t.util.transformPoint(h,this.viewportTransform),m=new t.Point(c.ex+c.left,c.ey+c.top),d=t.util.transformPoint(m,this.viewportTransform),g=Math.min(p.x,d.x),v=Math.min(p.y,d.y),w=Math.max(p.x,d.x),_=Math.max(p.y,d.y),y=this.selectionLineWidth/2;this.selectionColor&&(A.fillStyle=this.selectionColor,A.fillRect(g,v,w-g,_-v)),!(!this.selectionLineWidth||!this.selectionBorderColor)&&(A.lineWidth=this.selectionLineWidth,A.strokeStyle=this.selectionBorderColor,g+=y,v+=y,w-=y,_-=y,t.Object.prototype._setLineDash.call(this,A,this.selectionDashArray),A.strokeRect(g,v,w-g,_-v))},findTarget:function(A,c){if(!this.skipTargetFind){var h=!0,p=this.getPointer(A,h),m=this._activeObject,d=this.getActiveObjects(),g,v,w=l(A),_=d.length>1&&!c||d.length===1;if(this.targets=[],_&&m._findTargetCorner(p,w)||d.length>1&&!c&&m===this._searchPossibleTargets([m],p))return m;if(d.length===1&&m===this._searchPossibleTargets([m],p))if(this.preserveObjectStacking)g=m,v=this.targets,this.targets=[];else return m;var y=this._searchPossibleTargets(this._objects,p);return A[this.altSelectionKey]&&y&&g&&y!==g&&(y=g,this.targets=v),y}},_checkTarget:function(A,c,h){if(c&&c.visible&&c.evented&&c.containsPoint(A))if((this.perPixelTargetFind||c.perPixelTargetFind)&&!c.isEditing){var p=this.isTargetTransparent(c,h.x,h.y);if(!p)return!0}else return!0},_searchPossibleTargets:function(A,c){for(var h,p=A.length,m;p--;){var d=A[p],g=d.group?this._normalizePointer(d.group,c):c;if(this._checkTarget(g,d,c)){h=A[p],h.subTargetCheck&&h instanceof t.Group&&(m=this._searchPossibleTargets(h._objects,c),m&&this.targets.push(m));break}}return h},restorePointerVpt:function(A){return t.util.transformPoint(A,t.util.invertTransform(this.viewportTransform))},getPointer:function(A,c){if(this._absolutePointer&&!c)return this._absolutePointer;if(this._pointer&&c)return this._pointer;var h=o(A),p=this.upperCanvasEl,m=p.getBoundingClientRect(),d=m.width||0,g=m.height||0,v;(!d||!g)&&("top"in m&&"bottom"in m&&(g=Math.abs(m.top-m.bottom)),"right"in m&&"left"in m&&(d=Math.abs(m.right-m.left))),this.calcOffset(),h.x=h.x-this._offset.left,h.y=h.y-this._offset.top,c||(h=this.restorePointerVpt(h));var w=this.getRetinaScaling();return w!==1&&(h.x/=w,h.y/=w),d===0||g===0?v={width:1,height:1}:v={width:p.width/d,height:p.height/g},{x:h.x*v.width,y:h.y*v.height}},_createUpperCanvas:function(){var A=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),c=this.lowerCanvasEl,h=this.upperCanvasEl;h?h.className="":(h=this._createCanvasElement(),this.upperCanvasEl=h),t.util.addClass(h,"upper-canvas "+A),this.wrapperEl.appendChild(h),this._copyCanvasStyle(c,h),this._applyCanvasStyle(h),this.contextTop=h.getContext("2d")},getTopContext:function(){return this.contextTop},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=t.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),t.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),t.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(A){var c=this.width||A.width,h=this.height||A.height;t.util.setStyle(A,{position:"absolute",width:c+"px",height:h+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),A.width=c,A.height=h,t.util.makeElementUnselectable(A)},_copyCanvasStyle:function(A,c){c.style.cssText=A.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var A=this._activeObject;return A?A.type==="activeSelection"&&A._objects?A._objects.slice(0):[A]:[]},_onObjectRemoved:function(A){A===this._activeObject&&(this.fire("before:selection:cleared",{target:A}),this._discardActiveObject(),this.fire("selection:cleared",{target:A}),A.fire("deselected")),A===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",A)},_fireSelectionEvents:function(A,c){var h=!1,p=this.getActiveObjects(),m=[],d=[];A.forEach(function(g){p.indexOf(g)===-1&&(h=!0,g.fire("deselected",{e:c,target:g}),d.push(g))}),p.forEach(function(g){A.indexOf(g)===-1&&(h=!0,g.fire("selected",{e:c,target:g}),m.push(g))}),A.length>0&&p.length>0?h&&this.fire("selection:updated",{e:c,selected:m,deselected:d}):p.length>0?this.fire("selection:created",{e:c,selected:m}):A.length>0&&this.fire("selection:cleared",{e:c,deselected:d})},setActiveObject:function(A,c){var h=this.getActiveObjects();return this._setActiveObject(A,c),this._fireSelectionEvents(h,c),this},_setActiveObject:function(A,c){return this._activeObject===A||!this._discardActiveObject(c,A)||A.onSelect({e:c})?!1:(this._activeObject=A,!0)},_discardActiveObject:function(A,c){var h=this._activeObject;if(h){if(h.onDeselect({e:A,object:c}))return!1;this._activeObject=null}return!0},discardActiveObject:function(A){var c=this.getActiveObjects(),h=this.getActiveObject();return c.length&&this.fire("before:selection:cleared",{target:h,e:A}),this._discardActiveObject(A),this._fireSelectionEvents(c,A),this},dispose:function(){var A=this.wrapperEl;return this.removeListeners(),A.removeChild(this.upperCanvasEl),A.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach(function(c){t.util.cleanUpJsdomNode(this[c]),this[c]=void 0}.bind(this)),A.parentNode&&A.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,t.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(A){var c=this._activeObject;c&&c._renderControls(A)},_toObject:function(A,c,h){var p=this._realizeGroupTransformOnObject(A),m=this.callSuper("_toObject",A,c,h);return this._unwindGroupTransformOnObject(A,p),m},_realizeGroupTransformOnObject:function(A){if(A.group&&A.group.type==="activeSelection"&&this._activeObject===A.group){var c=["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"],h={};return c.forEach(function(p){h[p]=A[p]}),t.util.addTransformToObject(A,this._activeObject.calcOwnMatrix()),h}else return null},_unwindGroupTransformOnObject:function(A,c){c&&A.set(c)},_setSVGObject:function(A,c,h){var p=this._realizeGroupTransformOnObject(c);this.callSuper("_setSVGObject",A,c,h),this._unwindGroupTransformOnObject(c,p)},setViewportTransform:function(A){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),t.StaticCanvas.prototype.setViewportTransform.call(this,A)}});for(var u in t.StaticCanvas)u!=="prototype"&&(t.Canvas[u]=t.StaticCanvas[u])}(),function(){var o=t.util.addListener,s=t.util.removeListener,l=3,u=2,A=1,c={passive:!1};function h(p,m){return p.button&&p.button===m-1}t.util.object.extend(t.Canvas.prototype,{mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(o,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(p,m){var d=this.upperCanvasEl,g=this._getEventPrefix();p(t.window,"resize",this._onResize),p(d,g+"down",this._onMouseDown),p(d,g+"move",this._onMouseMove,c),p(d,g+"out",this._onMouseOut),p(d,g+"enter",this._onMouseEnter),p(d,"wheel",this._onMouseWheel),p(d,"contextmenu",this._onContextMenu),p(d,"dblclick",this._onDoubleClick),p(d,"dragover",this._onDragOver),p(d,"dragenter",this._onDragEnter),p(d,"dragleave",this._onDragLeave),p(d,"drop",this._onDrop),this.enablePointerEvents||p(d,"touchstart",this._onTouchStart,c),typeof eventjs<"u"&&m in eventjs&&(eventjs[m](d,"gesture",this._onGesture),eventjs[m](d,"drag",this._onDrag),eventjs[m](d,"orientation",this._onOrientationChange),eventjs[m](d,"shake",this._onShake),eventjs[m](d,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(s,"remove");var p=this._getEventPrefix();s(t.document,p+"up",this._onMouseUp),s(t.document,"touchend",this._onTouchEnd,c),s(t.document,p+"move",this._onMouseMove,c),s(t.document,"touchmove",this._onMouseMove,c)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._onDrop.bind(this),this.eventsBound=!0)},_onGesture:function(p,m){this.__onTransformGesture&&this.__onTransformGesture(p,m)},_onDrag:function(p,m){this.__onDrag&&this.__onDrag(p,m)},_onMouseWheel:function(p){this.__onMouseWheel(p)},_onMouseOut:function(p){var m=this._hoveredTarget;this.fire("mouse:out",{target:m,e:p}),this._hoveredTarget=null,m&&m.fire("mouseout",{e:p});var d=this;this._hoveredTargets.forEach(function(g){d.fire("mouse:out",{target:m,e:p}),g&&m.fire("mouseout",{e:p})}),this._hoveredTargets=[]},_onMouseEnter:function(p){!this._currentTransform&&!this.findTarget(p)&&(this.fire("mouse:over",{target:null,e:p}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(p,m){this.__onOrientationChange&&this.__onOrientationChange(p,m)},_onShake:function(p,m){this.__onShake&&this.__onShake(p,m)},_onLongPress:function(p,m){this.__onLongPress&&this.__onLongPress(p,m)},_onDragOver:function(p){p.preventDefault();var m=this._simpleEventHandler("dragover",p);this._fireEnterLeaveEvents(m,p)},_onDrop:function(p){return this._simpleEventHandler("drop:before",p),this._simpleEventHandler("drop",p)},_onContextMenu:function(p){return this.stopContextMenu&&(p.stopPropagation(),p.preventDefault()),!1},_onDoubleClick:function(p){this._cacheTransformEventData(p),this._handleEvent(p,"dblclick"),this._resetTransformEventData(p)},getPointerId:function(p){var m=p.changedTouches;return m?m[0]&&m[0].identifier:this.enablePointerEvents?p.pointerId:-1},_isMainEvent:function(p){return p.isPrimary===!0?!0:p.isPrimary===!1?!1:p.type==="touchend"&&p.touches.length===0?!0:p.changedTouches?p.changedTouches[0].identifier===this.mainTouchId:!0},_onTouchStart:function(p){p.preventDefault(),this.mainTouchId===null&&(this.mainTouchId=this.getPointerId(p)),this.__onMouseDown(p),this._resetTransformEventData();var m=this.upperCanvasEl,d=this._getEventPrefix();o(t.document,"touchend",this._onTouchEnd,c),o(t.document,"touchmove",this._onMouseMove,c),s(m,d+"down",this._onMouseDown)},_onMouseDown:function(p){this.__onMouseDown(p),this._resetTransformEventData();var m=this.upperCanvasEl,d=this._getEventPrefix();s(m,d+"move",this._onMouseMove,c),o(t.document,d+"up",this._onMouseUp),o(t.document,d+"move",this._onMouseMove,c)},_onTouchEnd:function(p){if(!(p.touches.length>0)){this.__onMouseUp(p),this._resetTransformEventData(),this.mainTouchId=null;var m=this._getEventPrefix();s(t.document,"touchend",this._onTouchEnd,c),s(t.document,"touchmove",this._onMouseMove,c);var d=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(function(){o(d.upperCanvasEl,m+"down",d._onMouseDown),d._willAddMouseDown=0},400)}},_onMouseUp:function(p){this.__onMouseUp(p),this._resetTransformEventData();var m=this.upperCanvasEl,d=this._getEventPrefix();this._isMainEvent(p)&&(s(t.document,d+"up",this._onMouseUp),s(t.document,d+"move",this._onMouseMove,c),o(m,d+"move",this._onMouseMove,c))},_onMouseMove:function(p){!this.allowTouchScrolling&&p.preventDefault&&p.preventDefault(),this.__onMouseMove(p)},_onResize:function(){this.calcOffset()},_shouldRender:function(p){var m=this._activeObject;return!!m!=!!p||m&&p&&m!==p?!0:(m&&m.isEditing,!1)},__onMouseUp:function(p){var m,d=this._currentTransform,g=this._groupSelector,v=!1,w=!g||g.left===0&&g.top===0;if(this._cacheTransformEventData(p),m=this._target,this._handleEvent(p,"up:before"),h(p,l)){this.fireRightClick&&this._handleEvent(p,"up",l,w);return}if(h(p,u)){this.fireMiddleClick&&this._handleEvent(p,"up",u,w),this._resetTransformEventData();return}if(this.isDrawingMode&&this._isCurrentlyDrawing){this._onMouseUpInDrawingMode(p);return}if(this._isMainEvent(p)){if(d&&(this._finalizeCurrentTransform(p),v=d.actionPerformed),!w){var _=m===this._activeObject;this._maybeGroupObjects(p),v||(v=this._shouldRender(m)||!_&&m===this._activeObject)}var y,C;if(m){if(y=m._findTargetCorner(this.getPointer(p,!0),t.util.isTouchEvent(p)),m.selectable&&m!==this._activeObject&&m.activeOn==="up")this.setActiveObject(m,p),v=!0;else{var b=m.controls[y],S=b&&b.getMouseUpHandler(p,m,b);S&&(C=this.getPointer(p),S(p,d,C.x,C.y))}m.isMoving=!1}if(d&&(d.target!==m||d.corner!==y)){var B=d.target&&d.target.controls[d.corner],M=B&&B.getMouseUpHandler(p,m,b);C=C||this.getPointer(p),M&&M(p,d,C.x,C.y)}this._setCursorFromEvent(p,m),this._handleEvent(p,"up",A,w),this._groupSelector=null,this._currentTransform=null,m&&(m.__corner=0),v?this.requestRenderAll():w||this.renderTop()}},_simpleEventHandler:function(p,m){var d=this.findTarget(m),g=this.targets,v={e:m,target:d,subTargets:g};if(this.fire(p,v),d&&d.fire(p,v),!g)return d;for(var w=0;w<g.length;w++)g[w].fire(p,v);return d},_handleEvent:function(p,m,d,g){var v=this._target,w=this.targets||[],_={e:p,target:v,subTargets:w,button:d||A,isClick:g||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};m==="up"&&(_.currentTarget=this.findTarget(p),_.currentSubTargets=this.targets),this.fire("mouse:"+m,_),v&&v.fire("mouse"+m,_);for(var y=0;y<w.length;y++)w[y].fire("mouse"+m,_)},_finalizeCurrentTransform:function(p){var m=this._currentTransform,d=m.target,g={e:p,target:d,transform:m,action:m.action};d._scaling&&(d._scaling=!1),d.setCoords(),(m.actionPerformed||this.stateful&&d.hasStateChanged())&&this._fire("modified",g)},_onMouseDownInDrawingMode:function(p){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(p).requestRenderAll();var m=this.getPointer(p);this.freeDrawingBrush.onMouseDown(m,{e:p,pointer:m}),this._handleEvent(p,"down")},_onMouseMoveInDrawingMode:function(p){if(this._isCurrentlyDrawing){var m=this.getPointer(p);this.freeDrawingBrush.onMouseMove(m,{e:p,pointer:m})}this.setCursor(this.freeDrawingCursor),this._handleEvent(p,"move")},_onMouseUpInDrawingMode:function(p){var m=this.getPointer(p);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:p,pointer:m}),this._handleEvent(p,"up")},__onMouseDown:function(p){this._cacheTransformEventData(p),this._handleEvent(p,"down:before");var m=this._target;if(h(p,l)){this.fireRightClick&&this._handleEvent(p,"down",l);return}if(h(p,u)){this.fireMiddleClick&&this._handleEvent(p,"down",u);return}if(this.isDrawingMode){this._onMouseDownInDrawingMode(p);return}if(this._isMainEvent(p)&&!this._currentTransform){var d=this._pointer;this._previousPointer=d;var g=this._shouldRender(m),v=this._shouldGroup(p,m);if(this._shouldClearSelection(p,m)?this.discardActiveObject(p):v&&(this._handleGrouping(p,m),m=this._activeObject),this.selection&&(!m||!m.selectable&&!m.isEditing&&m!==this._activeObject)&&(this._groupSelector={ex:this._absolutePointer.x,ey:this._absolutePointer.y,top:0,left:0}),m){var w=m===this._activeObject;m.selectable&&m.activeOn==="down"&&this.setActiveObject(m,p);var _=m._findTargetCorner(this.getPointer(p,!0),t.util.isTouchEvent(p));if(m.__corner=_,m===this._activeObject&&(_||!v)){this._setupCurrentTransform(p,m,w);var y=m.controls[_],d=this.getPointer(p),C=y&&y.getMouseDownHandler(p,m,y);C&&C(p,this._currentTransform,d.x,d.y)}}this._handleEvent(p,"down"),(g||v)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(p){this._resetTransformEventData(),this._pointer=this.getPointer(p,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(p)||null},_beforeTransform:function(p){var m=this._currentTransform;this.stateful&&m.target.saveState(),this.fire("before:transform",{e:p,transform:m})},__onMouseMove:function(p){this._handleEvent(p,"move:before"),this._cacheTransformEventData(p);var m,d;if(this.isDrawingMode){this._onMouseMoveInDrawingMode(p);return}if(this._isMainEvent(p)){var g=this._groupSelector;g?(d=this._absolutePointer,g.left=d.x-g.ex,g.top=d.y-g.ey,this.renderTop()):this._currentTransform?this._transformObject(p):(m=this.findTarget(p)||null,this._setCursorFromEvent(p,m),this._fireOverOutEvents(m,p)),this._handleEvent(p,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(p,m){var d=this._hoveredTarget,g=this._hoveredTargets,v=this.targets,w=Math.max(g.length,v.length);this.fireSyntheticInOutEvents(p,m,{oldTarget:d,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var _=0;_<w;_++)this.fireSyntheticInOutEvents(v[_],m,{oldTarget:g[_],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=p,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(p,m){var d=this._draggedoverTarget,g=this._hoveredTargets,v=this.targets,w=Math.max(g.length,v.length);this.fireSyntheticInOutEvents(p,m,{oldTarget:d,evtOut:"dragleave",evtIn:"dragenter"});for(var _=0;_<w;_++)this.fireSyntheticInOutEvents(v[_],m,{oldTarget:g[_],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=p},fireSyntheticInOutEvents:function(p,m,d){var g,v,w=d.oldTarget,_,y,C=w!==p,b=d.canvasEvtIn,S=d.canvasEvtOut;C&&(g={e:m,target:p,previousTarget:w},v={e:m,target:w,nextTarget:p}),y=p&&C,_=w&&C,_&&(S&&this.fire(S,v),w.fire(d.evtOut,v)),y&&(b&&this.fire(b,g),p.fire(d.evtIn,g))},__onMouseWheel:function(p){this._cacheTransformEventData(p),this._handleEvent(p,"wheel"),this._resetTransformEventData()},_transformObject:function(p){var m=this.getPointer(p),d=this._currentTransform;d.reset=!1,d.shiftKey=p.shiftKey,d.altKey=p[this.centeredKey],this._performTransformAction(p,d,m),d.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(p,m,d){var g=d.x,v=d.y,w=m.action,_=!1,y=m.actionHandler;y&&(_=y(p,m,g,v)),w==="drag"&&_&&(m.target.isMoving=!0,this.setCursor(m.target.moveCursor||this.moveCursor)),m.actionPerformed=m.actionPerformed||_},_fire:t.controlsUtils.fireEvent,_setCursorFromEvent:function(p,m){if(!m)return this.setCursor(this.defaultCursor),!1;var d=m.hoverCursor||this.hoverCursor,g=this._activeObject&&this._activeObject.type==="activeSelection"?this._activeObject:null,v=(!g||!g.contains(m))&&m._findTargetCorner(this.getPointer(p,!0));v?this.setCursor(this.getCornerCursor(v,m,p)):(m.subTargetCheck&&this.targets.concat().reverse().map(function(w){d=w.hoverCursor||d}),this.setCursor(d))},getCornerCursor:function(p,m,d){var g=m.controls[p];return g.cursorStyleHandler(d,g,m)}})}(),function(){var o=Math.min,s=Math.max;t.util.object.extend(t.Canvas.prototype,{_shouldGroup:function(l,u){var A=this._activeObject;return A&&this._isSelectionKeyPressed(l)&&u&&u.selectable&&this.selection&&(A!==u||A.type==="activeSelection")&&!u.onSelect({e:l})},_handleGrouping:function(l,u){var A=this._activeObject;A.__corner||u===A&&(u=this.findTarget(l,!0),!u||!u.selectable)||(A&&A.type==="activeSelection"?this._updateActiveSelection(u,l):this._createActiveSelection(u,l))},_updateActiveSelection:function(l,u){var A=this._activeObject,c=A._objects.slice(0);A.contains(l)?(A.removeWithUpdate(l),this._hoveredTarget=l,this._hoveredTargets=this.targets.concat(),A.size()===1&&this._setActiveObject(A.item(0),u)):(A.addWithUpdate(l),this._hoveredTarget=A,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(c,u)},_createActiveSelection:function(l,u){var A=this.getActiveObjects(),c=this._createGroup(l);this._hoveredTarget=c,this._setActiveObject(c,u),this._fireSelectionEvents(A,u)},_createGroup:function(l){var u=this._objects,A=u.indexOf(this._activeObject)<u.indexOf(l),c=A?[this._activeObject,l]:[l,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new t.ActiveSelection(c,{canvas:this})},_groupSelectedObjects:function(l){var u=this._collectObjects(l),A;u.length===1?this.setActiveObject(u[0],l):u.length>1&&(A=new t.ActiveSelection(u.reverse(),{canvas:this}),this.setActiveObject(A,l))},_collectObjects:function(l){for(var u=[],A,c=this._groupSelector.ex,h=this._groupSelector.ey,p=c+this._groupSelector.left,m=h+this._groupSelector.top,d=new t.Point(o(c,p),o(h,m)),g=new t.Point(s(c,p),s(h,m)),v=!this.selectionFullyContained,w=c===p&&h===m,_=this._objects.length;_--&&(A=this._objects[_],!(!(!A||!A.selectable||!A.visible)&&(v&&A.intersectsWithRect(d,g,!0)||A.isContainedWithinRect(d,g,!0)||v&&A.containsPoint(d,null,!0)||v&&A.containsPoint(g,null,!0))&&(u.push(A),w))););return u.length>1&&(u=u.filter(function(y){return!y.onSelect({e:l})})),u},_maybeGroupObjects:function(l){this.selection&&this._groupSelector&&this._groupSelectedObjects(l),this.setCursor(this.defaultCursor),this._groupSelector=null}})}(),function(){t.util.object.extend(t.StaticCanvas.prototype,{toDataURL:function(o){o||(o={});var s=o.format||"png",l=o.quality||1,u=(o.multiplier||1)*(o.enableRetinaScaling?this.getRetinaScaling():1),A=this.toCanvasElement(u,o);return t.util.toDataURL(A,s,l)},toCanvasElement:function(o,s){o=o||1,s=s||{};var l=(s.width||this.width)*o,u=(s.height||this.height)*o,A=this.getZoom(),c=this.width,h=this.height,p=A*o,m=this.viewportTransform,d=(m[4]-(s.left||0))*o,g=(m[5]-(s.top||0))*o,v=this.interactive,w=[p,0,0,p,d,g],_=this.enableRetinaScaling,y=t.util.createCanvasElement(),C=this.contextTop;return y.width=l,y.height=u,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=w,this.width=l,this.height=u,this.calcViewportBoundaries(),this.renderCanvas(y.getContext("2d"),this._objects),this.viewportTransform=m,this.width=c,this.height=h,this.calcViewportBoundaries(),this.interactive=v,this.enableRetinaScaling=_,this.contextTop=C,y}})}(),t.util.object.extend(t.StaticCanvas.prototype,{loadFromJSON:function(o,s,l){if(o){var u=typeof o=="string"?JSON.parse(o):t.util.object.clone(o),A=this,c=u.clipPath,h=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete u.clipPath,this._enlivenObjects(u.objects,function(p){A.clear(),A._setBgOverlay(u,function(){c?A._enlivenObjects([c],function(m){A.clipPath=m[0],A.__setupCanvas.call(A,u,p,h,s)}):A.__setupCanvas.call(A,u,p,h,s)})},l),this}},__setupCanvas:function(o,s,l,u){var A=this;s.forEach(function(c,h){A.insertAt(c,h)}),this.renderOnAddRemove=l,delete o.objects,delete o.backgroundImage,delete o.overlayImage,delete o.background,delete o.overlay,this._setOptions(o),this.renderAll(),u&&u()},_setBgOverlay:function(o,s){var l={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(!o.backgroundImage&&!o.overlayImage&&!o.background&&!o.overlay){s&&s();return}var u=function(){l.backgroundImage&&l.overlayImage&&l.backgroundColor&&l.overlayColor&&s&&s()};this.__setBgOverlay("backgroundImage",o.backgroundImage,l,u),this.__setBgOverlay("overlayImage",o.overlayImage,l,u),this.__setBgOverlay("backgroundColor",o.background,l,u),this.__setBgOverlay("overlayColor",o.overlay,l,u)},__setBgOverlay:function(o,s,l,u){var A=this;if(!s){l[o]=!0,u&&u();return}o==="backgroundImage"||o==="overlayImage"?t.util.enlivenObjects([s],function(c){A[o]=c[0],l[o]=!0,u&&u()}):this["set"+t.util.string.capitalize(o,!0)](s,function(){l[o]=!0,u&&u()})},_enlivenObjects:function(o,s,l){if(!o||o.length===0){s&&s([]);return}t.util.enlivenObjects(o,function(u){s&&s(u)},null,l)},_toDataURL:function(o,s){this.clone(function(l){s(l.toDataURL(o))})},_toDataURLWithMultiplier:function(o,s,l){this.clone(function(u){l(u.toDataURLWithMultiplier(o,s))})},clone:function(o,s){var l=JSON.stringify(this.toJSON(s));this.cloneWithoutData(function(u){u.loadFromJSON(l,function(){o&&o(u)})})},cloneWithoutData:function(o){var s=t.util.createCanvasElement();s.width=this.width,s.height=this.height;var l=new t.Canvas(s);this.backgroundImage?(l.setBackgroundImage(this.backgroundImage.src,function(){l.renderAll(),o&&o(l)}),l.backgroundImageOpacity=this.backgroundImageOpacity,l.backgroundImageStretch=this.backgroundImageStretch):o&&o(l)}}),function(o){var s=o.fabric||(o.fabric={}),l=s.util.object.extend,u=s.util.object.clone,A=s.util.toFixed,c=s.util.string.capitalize,h=s.util.degreesToRadians,p=!s.isLikelyNode,m=2;s.Object||(s.Object=s.util.createClass(s.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,perPixelTargetFind:!1,includeDefaultValues:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:p,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",activeOn:"down",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),colorProperties:"fill stroke backgroundColor".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(d){d&&this.setOptions(d)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=s.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(d){var g=s.perfLimitSizeTotal,v=d.width,w=d.height,_=s.maxCacheSideLimit,y=s.minCacheSideLimit;if(v<=_&&w<=_&&v*w<=g)return v<y&&(d.width=y),w<y&&(d.height=y),d;var C=v/w,b=s.util.limitDimsByArea(C,g),S=s.util.capValue,B=S(y,b.x,_),M=S(y,b.y,_);return v>B&&(d.zoomX/=v/B,d.width=B,d.capped=!0),w>M&&(d.zoomY/=w/M,d.height=M,d.capped=!0),d},_getCacheCanvasDimensions:function(){var d=this.getTotalObjectScaling(),g=this._getTransformedDimensions(0,0),v=g.x*d.scaleX/this.scaleX,w=g.y*d.scaleY/this.scaleY;return{width:v+m,height:w+m,zoomX:d.scaleX,zoomY:d.scaleY,x:v,y:w}},_updateCacheCanvas:function(){var d=this.canvas;if(this.noScaleCache&&d&&d._currentTransform){var g=d._currentTransform.target,v=d._currentTransform.action;if(this===g&&v.slice&&v.slice(0,5)==="scale")return!1}var w=this._cacheCanvas,_=this._limitCacheSize(this._getCacheCanvasDimensions()),y=s.minCacheSideLimit,C=_.width,b=_.height,S,B,M=_.zoomX,z=_.zoomY,G=C!==this.cacheWidth||b!==this.cacheHeight,P=this.zoomX!==M||this.zoomY!==z,R=G||P,W=0,K=0,tt=!1;if(G){var j=this._cacheCanvas.width,E=this._cacheCanvas.height,I=C>j||b>E,Q=(C<j*.9||b<E*.9)&&j>y&&E>y;tt=I||Q,I&&!_.capped&&(C>y||b>y)&&(W=C*.1,K=b*.1)}return this instanceof s.Text&&this.path&&(R=!0,tt=!0,W+=this.getHeightOfLine(0)*this.zoomX,K+=this.getHeightOfLine(0)*this.zoomY),R?(tt?(w.width=Math.ceil(C+W),w.height=Math.ceil(b+K)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,w.width,w.height)),S=_.x/2,B=_.y/2,this.cacheTranslationX=Math.round(w.width/2-S)+S,this.cacheTranslationY=Math.round(w.height/2-B)+B,this.cacheWidth=C,this.cacheHeight=b,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(M,z),this.zoomX=M,this.zoomY=z,!0):!1},setOptions:function(d){this._setOptions(d),this._initGradient(d.fill,"fill"),this._initGradient(d.stroke,"stroke"),this._initPattern(d.fill,"fill"),this._initPattern(d.stroke,"stroke")},transform:function(d){var g=this.group&&!this.group._transformDone||this.group&&this.canvas&&d===this.canvas.contextTop,v=this.calcTransformMatrix(!g);d.transform(v[0],v[1],v[2],v[3],v[4],v[5])},toObject:function(d){var g=s.Object.NUM_FRACTION_DIGITS,v={type:this.type,version:s.version,originX:this.originX,originY:this.originY,left:A(this.left,g),top:A(this.top,g),width:A(this.width,g),height:A(this.height,g),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:A(this.strokeWidth,g),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:A(this.strokeMiterLimit,g),scaleX:A(this.scaleX,g),scaleY:A(this.scaleY,g),angle:A(this.angle,g),flipX:this.flipX,flipY:this.flipY,opacity:A(this.opacity,g),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:A(this.skewX,g),skewY:A(this.skewY,g)};return this.clipPath&&!this.clipPath.excludeFromExport&&(v.clipPath=this.clipPath.toObject(d),v.clipPath.inverted=this.clipPath.inverted,v.clipPath.absolutePositioned=this.clipPath.absolutePositioned),s.util.populateWithProperties(this,v,d),this.includeDefaultValues||(v=this._removeDefaultValues(v)),v},toDatalessObject:function(d){return this.toObject(d)},_removeDefaultValues:function(d){var g=s.util.getKlass(d.type).prototype,v=g.stateProperties;return v.forEach(function(w){w==="left"||w==="top"||(d[w]===g[w]&&delete d[w],Array.isArray(d[w])&&Array.isArray(g[w])&&d[w].length===0&&g[w].length===0&&delete d[w])}),d},toString:function(){return"#<fabric."+c(this.type)+">"},getObjectScaling:function(){if(!this.group)return{scaleX:this.scaleX,scaleY:this.scaleY};var d=s.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(d.scaleX),scaleY:Math.abs(d.scaleY)}},getTotalObjectScaling:function(){var d=this.getObjectScaling(),g=d.scaleX,v=d.scaleY;if(this.canvas){var w=this.canvas.getZoom(),_=this.canvas.getRetinaScaling();g*=w*_,v*=w*_}return{scaleX:g,scaleY:v}},getObjectOpacity:function(){var d=this.opacity;return this.group&&(d*=this.group.getObjectOpacity()),d},_set:function(d,g){var v=d==="scaleX"||d==="scaleY",w=this[d]!==g,_=!1;return v&&(g=this._constrainScale(g)),d==="scaleX"&&g<0?(this.flipX=!this.flipX,g*=-1):d==="scaleY"&&g<0?(this.flipY=!this.flipY,g*=-1):d==="shadow"&&g&&!(g instanceof s.Shadow)?g=new s.Shadow(g):d==="dirty"&&this.group&&this.group.set("dirty",g),this[d]=g,w&&(_=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(d)>-1?(this.dirty=!0,_&&this.group.set("dirty",!0)):_&&this.stateProperties.indexOf(d)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:s.iMatrix.concat()},isNotVisible:function(){return this.opacity===0||!this.width&&!this.height&&this.strokeWidth===0||!this.visible},render:function(d){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(d.save(),this._setupCompositeOperation(d),this.drawSelectionBackground(d),this.transform(d),this._setOpacity(d),this._setShadow(d,this),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(d)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(d),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),d.restore())},renderCache:function(d){d=d||{},(!this._cacheCanvas||!this._cacheContext)&&this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,d.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this._cacheContext=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&this.stroke!=="transparent"&&this.strokeWidth!==0},hasFill:function(){return this.fill&&this.fill!=="transparent"},needsItsOwnCache:function(){return!!(this.paintFirst==="stroke"&&this.hasFill()&&this.hasStroke()&&typeof this.shadow=="object"||this.clipPath)},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0)},drawClipPathOnCache:function(d,g){if(d.save(),g.inverted?d.globalCompositeOperation="destination-out":d.globalCompositeOperation="destination-in",g.absolutePositioned){var v=s.util.invertTransform(this.calcTransformMatrix());d.transform(v[0],v[1],v[2],v[3],v[4],v[5])}g.transform(d),d.scale(1/g.zoomX,1/g.zoomY),d.drawImage(g._cacheCanvas,-g.cacheTranslationX,-g.cacheTranslationY),d.restore()},drawObject:function(d,g){var v=this.fill,w=this.stroke;g?(this.fill="black",this.stroke="",this._setClippingProperties(d)):this._renderBackground(d),this._render(d),this._drawClipPath(d,this.clipPath),this.fill=v,this.stroke=w},_drawClipPath:function(d,g){g&&(g.canvas=this.canvas,g.shouldCache(),g._transformDone=!0,g.renderCache({forClipping:!0}),this.drawClipPathOnCache(d,g))},drawCacheOnCanvas:function(d){d.scale(1/this.zoomX,1/this.zoomY),d.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(d){if(this.isNotVisible())return!1;if(this._cacheCanvas&&this._cacheContext&&!d&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&this._cacheContext&&!d){var g=this.cacheWidth/this.zoomX,v=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-g/2,-v/2,g,v)}return!0}return!1},_renderBackground:function(d){if(this.backgroundColor){var g=this._getNonTransformedDimensions();d.fillStyle=this.backgroundColor,d.fillRect(-g.x/2,-g.y/2,g.x,g.y),this._removeShadow(d)}},_setOpacity:function(d){this.group&&!this.group._transformDone?d.globalAlpha=this.getObjectOpacity():d.globalAlpha*=this.opacity},_setStrokeStyles:function(d,g){var v=g.stroke;v&&(d.lineWidth=g.strokeWidth,d.lineCap=g.strokeLineCap,d.lineDashOffset=g.strokeDashOffset,d.lineJoin=g.strokeLineJoin,d.miterLimit=g.strokeMiterLimit,v.toLive?v.gradientUnits==="percentage"||v.gradientTransform||v.patternTransform?this._applyPatternForTransformedGradient(d,v):(d.strokeStyle=v.toLive(d,this),this._applyPatternGradientTransform(d,v)):d.strokeStyle=g.stroke)},_setFillStyles:function(d,g){var v=g.fill;v&&(v.toLive?(d.fillStyle=v.toLive(d,this),this._applyPatternGradientTransform(d,g.fill)):d.fillStyle=v)},_setClippingProperties:function(d){d.globalAlpha=1,d.strokeStyle="transparent",d.fillStyle="#000000"},_setLineDash:function(d,g){!g||g.length===0||(1&g.length&&g.push.apply(g,g),d.setLineDash(g))},_renderControls:function(d,g){var v=this.getViewportTransform(),w=this.calcTransformMatrix(),_,y,C;g=g||{},y=typeof g.hasBorders<"u"?g.hasBorders:this.hasBorders,C=typeof g.hasControls<"u"?g.hasControls:this.hasControls,w=s.util.multiplyTransformMatrices(v,w),_=s.util.qrDecompose(w),d.save(),d.translate(_.translateX,_.translateY),d.lineWidth=1*this.borderScaleFactor,this.group||(d.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(_.angle-=180),d.rotate(h(this.group?_.angle:this.angle)),g.forActiveSelection||this.group?y&&this.drawBordersInGroup(d,_,g):y&&this.drawBorders(d,g),C&&this.drawControls(d,g),d.restore()},_setShadow:function(d){if(this.shadow){var g=this.shadow,v=this.canvas,w,_=v&&v.viewportTransform[0]||1,y=v&&v.viewportTransform[3]||1;g.nonScaling?w={scaleX:1,scaleY:1}:w=this.getObjectScaling(),v&&v._isRetinaScaling()&&(_*=s.devicePixelRatio,y*=s.devicePixelRatio),d.shadowColor=g.color,d.shadowBlur=g.blur*s.browserShadowBlurConstant*(_+y)*(w.scaleX+w.scaleY)/4,d.shadowOffsetX=g.offsetX*_*w.scaleX,d.shadowOffsetY=g.offsetY*y*w.scaleY}},_removeShadow:function(d){this.shadow&&(d.shadowColor="",d.shadowBlur=d.shadowOffsetX=d.shadowOffsetY=0)},_applyPatternGradientTransform:function(d,g){if(!g||!g.toLive)return{offsetX:0,offsetY:0};var v=g.gradientTransform||g.patternTransform,w=-this.width/2+g.offsetX||0,_=-this.height/2+g.offsetY||0;return g.gradientUnits==="percentage"?d.transform(this.width,0,0,this.height,w,_):d.transform(1,0,0,1,w,_),v&&d.transform(v[0],v[1],v[2],v[3],v[4],v[5]),{offsetX:w,offsetY:_}},_renderPaintInOrder:function(d){this.paintFirst==="stroke"?(this._renderStroke(d),this._renderFill(d)):(this._renderFill(d),this._renderStroke(d))},_render:function(){},_renderFill:function(d){this.fill&&(d.save(),this._setFillStyles(d,this),this.fillRule==="evenodd"?d.fill("evenodd"):d.fill(),d.restore())},_renderStroke:function(d){if(!(!this.stroke||this.strokeWidth===0)){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(d),d.save(),this.strokeUniform&&this.group){var g=this.getObjectScaling();d.scale(1/g.scaleX,1/g.scaleY)}else this.strokeUniform&&d.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(d,this.strokeDashArray),this._setStrokeStyles(d,this),d.stroke(),d.restore()}},_applyPatternForTransformedGradient:function(d,g){var v=this._limitCacheSize(this._getCacheCanvasDimensions()),w=s.util.createCanvasElement(),_,y=this.canvas.getRetinaScaling(),C=v.x/this.scaleX/y,b=v.y/this.scaleY/y;w.width=C,w.height=b,_=w.getContext("2d"),_.beginPath(),_.moveTo(0,0),_.lineTo(C,0),_.lineTo(C,b),_.lineTo(0,b),_.closePath(),_.translate(C/2,b/2),_.scale(v.zoomX/this.scaleX/y,v.zoomY/this.scaleY/y),this._applyPatternGradientTransform(_,g),_.fillStyle=g.toLive(d),_.fill(),d.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),d.scale(y*this.scaleX/v.zoomX,y*this.scaleY/v.zoomY),d.strokeStyle=_.createPattern(w,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var d=s.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",d.scaleX),this.set("scaleY",d.scaleY),this.angle=d.angle,this.skewX=d.skewX,this.skewY=0}},_removeTransformMatrix:function(d){var g=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),g=s.util.transformPoint(g,this.transformMatrix)),this.transformMatrix=null,d&&(this.scaleX*=d.scaleX,this.scaleY*=d.scaleY,this.cropX=d.cropX,this.cropY=d.cropY,g.x+=d.offsetLeft,g.y+=d.offsetTop,this.width=d.width,this.height=d.height),this.setPositionByOrigin(g,"center","center")},clone:function(d,g){var v=this.toObject(g);this.constructor.fromObject?this.constructor.fromObject(v,d):s.Object._fromObject("Object",v,d)},cloneAsImage:function(d,g){var v=this.toCanvasElement(g);return d&&d(new s.Image(v)),this},toCanvasElement:function(d){d||(d={});var g=s.util,v=g.saveObjectTransform(this),w=this.group,_=this.shadow,y=Math.abs,C=(d.multiplier||1)*(d.enableRetinaScaling?s.devicePixelRatio:1);delete this.group,d.withoutTransform&&g.resetObjectTransform(this),d.withoutShadow&&(this.shadow=null);var b=s.util.createCanvasElement(),S=this.getBoundingRect(!0,!0),B=this.shadow,M,z={x:0,y:0},G,P,R;B&&(G=B.blur,B.nonScaling?M={scaleX:1,scaleY:1}:M=this.getObjectScaling(),z.x=2*Math.round(y(B.offsetX)+G)*y(M.scaleX),z.y=2*Math.round(y(B.offsetY)+G)*y(M.scaleY)),P=S.width+z.x,R=S.height+z.y,b.width=Math.ceil(P),b.height=Math.ceil(R);var W=new s.StaticCanvas(b,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});d.format==="jpeg"&&(W.backgroundColor="#fff"),this.setPositionByOrigin(new s.Point(W.width/2,W.height/2),"center","center");var K=this.canvas;W.add(this);var tt=W.toCanvasElement(C||1,d);return this.shadow=_,this.set("canvas",K),w&&(this.group=w),this.set(v).setCoords(),W._objects=[],W.dispose(),W=null,tt},toDataURL:function(d){return d||(d={}),s.util.toDataURL(this.toCanvasElement(d),d.format||"png",d.quality||1)},isType:function(d){return arguments.length>1?Array.from(arguments).includes(this.type):this.type===d},complexity:function(){return 1},toJSON:function(d){return this.toObject(d)},rotate:function(d){var g=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;return g&&this._setOriginToCenter(),this.set("angle",d),g&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(d,g){g=g||this.canvas.getPointer(d);var v=new s.Point(g.x,g.y),w=this._getLeftTopCoords();return this.angle&&(v=s.util.rotatePoint(v,w,h(-this.angle))),{x:v.x-w.x,y:v.y-w.y}},_setupCompositeOperation:function(d){this.globalCompositeOperation&&(d.globalCompositeOperation=this.globalCompositeOperation)},dispose:function(){s.runningAnimations&&s.runningAnimations.cancelByTarget(this)}}),s.util.createAccessors&&s.util.createAccessors(s.Object),l(s.Object.prototype,s.Observable),s.Object.NUM_FRACTION_DIGITS=2,s.Object.ENLIVEN_PROPS=["clipPath"],s.Object._fromObject=function(d,g,v,w){var _=s[d];g=u(g,!0),s.util.enlivenPatterns([g.fill,g.stroke],function(y){typeof y[0]<"u"&&(g.fill=y[0]),typeof y[1]<"u"&&(g.stroke=y[1]),s.util.enlivenObjectEnlivables(g,g,function(){var C=w?new _(g[w],g):new _(g);v&&v(C)})})},s.Object.__uid=0)}(n),function(){var o=t.util.degreesToRadians,s={left:-.5,center:0,right:.5},l={top:-.5,center:0,bottom:.5};t.util.object.extend(t.Object.prototype,{translateToGivenOrigin:function(u,A,c,h,p){var m=u.x,d=u.y,g,v,w;return typeof A=="string"?A=s[A]:A-=.5,typeof h=="string"?h=s[h]:h-=.5,g=h-A,typeof c=="string"?c=l[c]:c-=.5,typeof p=="string"?p=l[p]:p-=.5,v=p-c,(g||v)&&(w=this._getTransformedDimensions(),m=u.x+g*w.x,d=u.y+v*w.y),new t.Point(m,d)},translateToCenterPoint:function(u,A,c){var h=this.translateToGivenOrigin(u,A,c,"center","center");return this.angle?t.util.rotatePoint(h,u,o(this.angle)):h},translateToOriginPoint:function(u,A,c){var h=this.translateToGivenOrigin(u,"center","center",A,c);return this.angle?t.util.rotatePoint(h,u,o(this.angle)):h},getCenterPoint:function(){var u=new t.Point(this.left,this.top);return this.translateToCenterPoint(u,this.originX,this.originY)},getPointByOrigin:function(u,A){var c=this.getCenterPoint();return this.translateToOriginPoint(c,u,A)},toLocalPoint:function(u,A,c){var h=this.getCenterPoint(),p,m;return typeof A<"u"&&typeof c<"u"?p=this.translateToGivenOrigin(h,"center","center",A,c):p=new t.Point(this.left,this.top),m=new t.Point(u.x,u.y),this.angle&&(m=t.util.rotatePoint(m,h,-o(this.angle))),m.subtractEquals(p)},setPositionByOrigin:function(u,A,c){var h=this.translateToCenterPoint(u,A,c),p=this.translateToOriginPoint(h,this.originX,this.originY);this.set("left",p.x),this.set("top",p.y)},adjustPosition:function(u){var A=o(this.angle),c=this.getScaledWidth(),h=t.util.cos(A)*c,p=t.util.sin(A)*c,m,d;typeof this.originX=="string"?m=s[this.originX]:m=this.originX-.5,typeof u=="string"?d=s[u]:d=u-.5,this.left+=h*(d-m),this.top+=p*(d-m),this.setCoords(),this.originX=u},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var u=this.getCenterPoint();this.originX="center",this.originY="center",this.left=u.x,this.top=u.y},_resetOrigin:function(){var u=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=u.x,this.top=u.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}})}(),function(){function o(c){return[new t.Point(c.tl.x,c.tl.y),new t.Point(c.tr.x,c.tr.y),new t.Point(c.br.x,c.br.y),new t.Point(c.bl.x,c.bl.y)]}var s=t.util,l=s.degreesToRadians,u=s.multiplyTransformMatrices,A=s.transformPoint;s.object.extend(t.Object.prototype,{oCoords:null,aCoords:null,lineCoords:null,ownMatrixCache:null,matrixCache:null,controls:{},_getCoords:function(c,h){return h?c?this.calcACoords():this.calcLineCoords():((!this.aCoords||!this.lineCoords)&&this.setCoords(!0),c?this.aCoords:this.lineCoords)},getCoords:function(c,h){return o(this._getCoords(c,h))},intersectsWithRect:function(c,h,p,m){var d=this.getCoords(p,m),g=t.Intersection.intersectPolygonRectangle(d,c,h);return g.status==="Intersection"},intersectsWithObject:function(c,h,p){var m=t.Intersection.intersectPolygonPolygon(this.getCoords(h,p),c.getCoords(h,p));return m.status==="Intersection"||c.isContainedWithinObject(this,h,p)||this.isContainedWithinObject(c,h,p)},isContainedWithinObject:function(c,h,p){for(var m=this.getCoords(h,p),d=h?c.aCoords:c.lineCoords,g=0,v=c._getImageLines(d);g<4;g++)if(!c.containsPoint(m[g],v))return!1;return!0},isContainedWithinRect:function(c,h,p,m){var d=this.getBoundingRect(p,m);return d.left>=c.x&&d.left+d.width<=h.x&&d.top>=c.y&&d.top+d.height<=h.y},containsPoint:function(c,g,p,m){var d=this._getCoords(p,m),g=g||this._getImageLines(d),v=this._findCrossPoints(c,g);return v!==0&&v%2===1},isOnScreen:function(c){if(!this.canvas)return!1;var h=this.canvas.vptCoords.tl,p=this.canvas.vptCoords.br,m=this.getCoords(!0,c);return m.some(function(d){return d.x<=p.x&&d.x>=h.x&&d.y<=p.y&&d.y>=h.y})||this.intersectsWithRect(h,p,!0,c)?!0:this._containsCenterOfCanvas(h,p,c)},_containsCenterOfCanvas:function(c,h,p){var m={x:(c.x+h.x)/2,y:(c.y+h.y)/2};return!!this.containsPoint(m,null,!0,p)},isPartiallyOnScreen:function(c){if(!this.canvas)return!1;var h=this.canvas.vptCoords.tl,p=this.canvas.vptCoords.br;if(this.intersectsWithRect(h,p,!0,c))return!0;var m=this.getCoords(!0,c).every(function(d){return(d.x>=p.x||d.x<=h.x)&&(d.y>=p.y||d.y<=h.y)});return m&&this._containsCenterOfCanvas(h,p,c)},_getImageLines:function(c){var h={topline:{o:c.tl,d:c.tr},rightline:{o:c.tr,d:c.br},bottomline:{o:c.br,d:c.bl},leftline:{o:c.bl,d:c.tl}};return h},_findCrossPoints:function(c,h){var p,m,d,g,v,w=0,_;for(var y in h)if(_=h[y],!(_.o.y<c.y&&_.d.y<c.y)&&!(_.o.y>=c.y&&_.d.y>=c.y)&&(_.o.x===_.d.x&&_.o.x>=c.x?v=_.o.x:(p=0,m=(_.d.y-_.o.y)/(_.d.x-_.o.x),d=c.y-p*c.x,g=_.o.y-m*_.o.x,v=-(d-g)/(p-m)),v>=c.x&&(w+=1),w===2))break;return w},getBoundingRect:function(c,h){var p=this.getCoords(c,h);return s.makeBoundingBoxFromPoints(p)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(c){return Math.abs(c)<this.minScaleLimit?c<0?-this.minScaleLimit:this.minScaleLimit:c===0?1e-4:c},scale:function(c){return this._set("scaleX",c),this._set("scaleY",c),this.setCoords()},scaleToWidth:function(c,h){var p=this.getBoundingRect(h).width/this.getScaledWidth();return this.scale(c/this.width/p)},scaleToHeight:function(c,h){var p=this.getBoundingRect(h).height/this.getScaledHeight();return this.scale(c/this.height/p)},calcLineCoords:function(){var c=this.getViewportTransform(),h=this.padding,p=l(this.angle),m=s.cos(p),d=s.sin(p),g=m*h,v=d*h,w=g+v,_=g-v,y=this.calcACoords(),C={tl:A(y.tl,c),tr:A(y.tr,c),bl:A(y.bl,c),br:A(y.br,c)};return h&&(C.tl.x-=_,C.tl.y-=w,C.tr.x+=w,C.tr.y-=_,C.bl.x-=w,C.bl.y+=_,C.br.x+=_,C.br.y+=w),C},calcOCoords:function(){var c=this._calcRotateMatrix(),h=this._calcTranslateMatrix(),p=this.getViewportTransform(),m=u(p,h),d=u(m,c),d=u(d,[1/p[0],0,0,1/p[3],0,0]),g=this._calculateCurrentDimensions(),v={};return this.forEachControl(function(w,_,y){v[_]=w.positionHandler(g,d,y)}),v},calcACoords:function(){var c=this._calcRotateMatrix(),h=this._calcTranslateMatrix(),p=u(h,c),m=this._getTransformedDimensions(),d=m.x/2,g=m.y/2;return{tl:A({x:-d,y:-g},p),tr:A({x:d,y:-g},p),bl:A({x:-d,y:g},p),br:A({x:d,y:g},p)}},setCoords:function(c){return this.aCoords=this.calcACoords(),this.lineCoords=this.group?this.aCoords:this.calcLineCoords(),c?this:(this.oCoords=this.calcOCoords(),this._setCornerCoords&&this._setCornerCoords(),this)},_calcRotateMatrix:function(){return s.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var c=this.getCenterPoint();return[1,0,0,1,c.x,c.y]},transformMatrixKey:function(c){var h="_",p="";return!c&&this.group&&(p=this.group.transformMatrixKey(c)+h),p+this.top+h+this.left+h+this.scaleX+h+this.scaleY+h+this.skewX+h+this.skewY+h+this.angle+h+this.originX+h+this.originY+h+this.width+h+this.height+h+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(c){var h=this.calcOwnMatrix();if(c||!this.group)return h;var p=this.transformMatrixKey(c),m=this.matrixCache||(this.matrixCache={});return m.key===p?m.value:(this.group&&(h=u(this.group.calcTransformMatrix(!1),h)),m.key=p,m.value=h,h)},calcOwnMatrix:function(){var c=this.transformMatrixKey(!0),h=this.ownMatrixCache||(this.ownMatrixCache={});if(h.key===c)return h.value;var p=this._calcTranslateMatrix(),m={angle:this.angle,translateX:p[4],translateY:p[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY};return h.key=c,h.value=s.composeMatrix(m),h.value},_getNonTransformedDimensions:function(){var c=this.strokeWidth,h=this.width+c,p=this.height+c;return{x:h,y:p}},_getTransformedDimensions:function(c,h){typeof c>"u"&&(c=this.skewX),typeof h>"u"&&(h=this.skewY);var p,m,d,g=c===0&&h===0;if(this.strokeUniform?(m=this.width,d=this.height):(p=this._getNonTransformedDimensions(),m=p.x,d=p.y),g)return this._finalizeDimensions(m*this.scaleX,d*this.scaleY);var v=s.sizeAfterTransform(m,d,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:c,skewY:h});return this._finalizeDimensions(v.x,v.y)},_finalizeDimensions:function(c,h){return this.strokeUniform?{x:c+this.strokeWidth,y:h+this.strokeWidth}:{x:c,y:h}},_calculateCurrentDimensions:function(){var c=this.getViewportTransform(),h=this._getTransformedDimensions(),p=A(h,c,!0);return p.scalarAdd(2*this.padding)}})}(),t.util.object.extend(t.Object.prototype,{sendToBack:function(){return this.group?t.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?t.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(o){return this.group?t.StaticCanvas.prototype.sendBackwards.call(this.group,this,o):this.canvas&&this.canvas.sendBackwards(this,o),this},bringForward:function(o){return this.group?t.StaticCanvas.prototype.bringForward.call(this.group,this,o):this.canvas&&this.canvas.bringForward(this,o),this},moveTo:function(o){return this.group&&this.group.type!=="activeSelection"?t.StaticCanvas.prototype.moveTo.call(this.group,this,o):this.canvas&&this.canvas.moveTo(this,o),this}}),function(){function o(l,u){if(u){if(u.toLive)return l+": url(#SVGID_"+u.id+"); ";var A=new t.Color(u),c=l+": "+A.toRgb()+"; ",h=A.getAlpha();return h!==1&&(c+=l+"-opacity: "+h.toString()+"; "),c}else return l+": none; "}var s=t.util.toFixed;t.util.object.extend(t.Object.prototype,{getSvgStyles:function(l){var u=this.fillRule?this.fillRule:"nonzero",A=this.strokeWidth?this.strokeWidth:"0",c=this.strokeDashArray?this.strokeDashArray.join(" "):"none",h=this.strokeDashOffset?this.strokeDashOffset:"0",p=this.strokeLineCap?this.strokeLineCap:"butt",m=this.strokeLineJoin?this.strokeLineJoin:"miter",d=this.strokeMiterLimit?this.strokeMiterLimit:"4",g=typeof this.opacity<"u"?this.opacity:"1",v=this.visible?"":" visibility: hidden;",w=l?"":this.getSvgFilter(),_=o("fill",this.fill),y=o("stroke",this.stroke);return[y,"stroke-width: ",A,"; ","stroke-dasharray: ",c,"; ","stroke-linecap: ",p,"; ","stroke-dashoffset: ",h,"; ","stroke-linejoin: ",m,"; ","stroke-miterlimit: ",d,"; ",_,"fill-rule: ",u,"; ","opacity: ",g,";",w,v].join("")},getSvgSpanStyles:function(l,u){var A="; ",h=l.fontFamily?"font-family: "+(l.fontFamily.indexOf("'")===-1&&l.fontFamily.indexOf('"')===-1?"'"+l.fontFamily+"'":l.fontFamily)+A:"",c=l.strokeWidth?"stroke-width: "+l.strokeWidth+A:"",h=h,p=l.fontSize?"font-size: "+l.fontSize+"px"+A:"",m=l.fontStyle?"font-style: "+l.fontStyle+A:"",d=l.fontWeight?"font-weight: "+l.fontWeight+A:"",g=l.fill?o("fill",l.fill):"",v=l.stroke?o("stroke",l.stroke):"",w=this.getSvgTextDecoration(l),_=l.deltaY?"baseline-shift: "+-l.deltaY+"; ":"";return w&&(w="text-decoration: "+w+A),[v,c,h,p,m,d,w,g,_,u?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(l){return["overline","underline","line-through"].filter(function(u){return l[u.replace("-","")]}).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(l,u){var A=l?this.calcTransformMatrix():this.calcOwnMatrix(),c='transform="'+t.util.matrixToSVG(A);return c+(u||"")+'" '},_setSVGBg:function(l){if(this.backgroundColor){var u=t.Object.NUM_FRACTION_DIGITS;l.push("		<rect ",this._getFillAttributes(this.backgroundColor),' x="',s(-this.width/2,u),'" y="',s(-this.height/2,u),'" width="',s(this.width,u),'" height="',s(this.height,u),`"></rect>
`)}},toSVG:function(l){return this._createBaseSVGMarkup(this._toSVG(l),{reviver:l})},toClipPathSVG:function(l){return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(l),{reviver:l})},_createBaseClipPathSVGMarkup:function(l,u){u=u||{};var A=u.reviver,c=u.additionalTransform||"",h=[this.getSvgTransform(!0,c),this.getSvgCommons()].join(""),p=l.indexOf("COMMON_PARTS");return l[p]=h,A?A(l.join("")):l.join("")},_createBaseSVGMarkup:function(l,u){u=u||{};var A=u.noStyle,c=u.reviver,h=A?"":'style="'+this.getSvgStyles()+'" ',p=u.withShadow?'style="'+this.getSvgFilter()+'" ':"",m=this.clipPath,d=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",g=m&&m.absolutePositioned,v=this.stroke,w=this.fill,_=this.shadow,y,C=[],b,S=l.indexOf("COMMON_PARTS"),B=u.additionalTransform;return m&&(m.clipPathId="CLIPPATH_"+t.Object.__uid++,b='<clipPath id="'+m.clipPathId+`" >
`+m.toClipPathSVG(c)+`</clipPath>
`),g&&C.push("<g ",p,this.getSvgCommons(),` >
`),C.push("<g ",this.getSvgTransform(!1),g?"":p+this.getSvgCommons(),` >
`),y=[h,d,A?"":this.addPaintOrder()," ",B?'transform="'+B+'" ':""].join(""),l[S]=y,w&&w.toLive&&C.push(w.toSVG(this)),v&&v.toLive&&C.push(v.toSVG(this)),_&&C.push(_.toSVG(this)),m&&C.push(b),C.push(l.join("")),C.push(`</g>
`),g&&C.push(`</g>
`),c?c(C.join("")):C.join("")},addPaintOrder:function(){return this.paintFirst!=="fill"?' paint-order="'+this.paintFirst+'" ':""}})}(),function(){var o=t.util.object.extend,s="stateProperties";function l(A,c,h){var p={},m=!0;h.forEach(function(d){p[d]=A[d]}),o(A[c],p,m)}function u(A,c,h){if(A===c)return!0;if(Array.isArray(A)){if(!Array.isArray(c)||A.length!==c.length)return!1;for(var p=0,m=A.length;p<m;p++)if(!u(A[p],c[p]))return!1;return!0}else if(A&&typeof A=="object"){var d=Object.keys(A),g;if(!c||typeof c!="object"||!h&&d.length!==Object.keys(c).length)return!1;for(var p=0,m=d.length;p<m;p++)if(g=d[p],!(g==="canvas"||g==="group")&&!u(A[g],c[g]))return!1;return!0}}t.util.object.extend(t.Object.prototype,{hasStateChanged:function(A){A=A||s;var c="_"+A;return Object.keys(this[c]).length<this[A].length?!0:!u(this[c],this,!0)},saveState:function(A){var c=A&&A.propertySet||s,h="_"+c;return this[h]?(l(this,h,this[c]),A&&A.stateProperties&&l(this,h,A.stateProperties),this):this.setupState(A)},setupState:function(A){A=A||{};var c=A.propertySet||s;return A.propertySet=c,this["_"+c]={},this.saveState(A),this}})}(),function(){var o=t.util.degreesToRadians;t.util.object.extend(t.Object.prototype,{_findTargetCorner:function(s,l){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var u=s.x,A=s.y,c,h,p=Object.keys(this.oCoords),m=p.length-1,d;for(this.__corner=0;m>=0;m--)if(d=p[m],!!this.isControlVisible(d)&&(h=this._getImageLines(l?this.oCoords[d].touchCorner:this.oCoords[d].corner),c=this._findCrossPoints({x:u,y:A},h),c!==0&&c%2===1))return this.__corner=d,d;return!1},forEachControl:function(s){for(var l in this.controls)s(this.controls[l],l,this)},_setCornerCoords:function(){var s=this.oCoords;for(var l in s){var u=this.controls[l];s[l].corner=u.calcCornerCoords(this.angle,this.cornerSize,s[l].x,s[l].y,!1),s[l].touchCorner=u.calcCornerCoords(this.angle,this.touchCornerSize,s[l].x,s[l].y,!0)}},drawSelectionBackground:function(s){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;s.save();var l=this.getCenterPoint(),u=this._calculateCurrentDimensions(),A=this.canvas.viewportTransform;return s.translate(l.x,l.y),s.scale(1/A[0],1/A[3]),s.rotate(o(this.angle)),s.fillStyle=this.selectionBackgroundColor,s.fillRect(-u.x/2,-u.y/2,u.x,u.y),s.restore(),this},drawBorders:function(s,l){l=l||{};var u=this._calculateCurrentDimensions(),A=this.borderScaleFactor,c=u.x+A,h=u.y+A,p=typeof l.hasControls<"u"?l.hasControls:this.hasControls,m=!1;return s.save(),s.strokeStyle=l.borderColor||this.borderColor,this._setLineDash(s,l.borderDashArray||this.borderDashArray),s.strokeRect(-c/2,-h/2,c,h),p&&(s.beginPath(),this.forEachControl(function(d,g,v){d.withConnection&&d.getVisibility(v,g)&&(m=!0,s.moveTo(d.x*c,d.y*h),s.lineTo(d.x*c+d.offsetX,d.y*h+d.offsetY))}),m&&s.stroke()),s.restore(),this},drawBordersInGroup:function(s,l,u){u=u||{};var A=t.util.sizeAfterTransform(this.width,this.height,l),c=this.strokeWidth,h=this.strokeUniform,p=this.borderScaleFactor,m=A.x+c*(h?this.canvas.getZoom():l.scaleX)+p,d=A.y+c*(h?this.canvas.getZoom():l.scaleY)+p;return s.save(),this._setLineDash(s,u.borderDashArray||this.borderDashArray),s.strokeStyle=u.borderColor||this.borderColor,s.strokeRect(-m/2,-d/2,m,d),s.restore(),this},drawControls:function(s,l){l=l||{},s.save();var u=this.canvas.getRetinaScaling(),A,c;return s.setTransform(u,0,0,u,0,0),s.strokeStyle=s.fillStyle=l.cornerColor||this.cornerColor,this.transparentCorners||(s.strokeStyle=l.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(s,l.cornerDashArray||this.cornerDashArray),this.setCoords(),this.group&&(A=this.group.calcTransformMatrix()),this.forEachControl(function(h,p,m){c=m.oCoords[p],h.getVisibility(m,p)&&(A&&(c=t.util.transformPoint(c,A)),h.render(s,c.x,c.y,l,m))}),s.restore(),this},isControlVisible:function(s){return this.controls[s]&&this.controls[s].getVisibility(this,s)},setControlVisible:function(s,l){return this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[s]=l,this},setControlsVisibility:function(s){s||(s={});for(var l in s)this.setControlVisible(l,s[l]);return this},onDeselect:function(){},onSelect:function(){}})}(),t.util.object.extend(t.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(o,s){s=s||{};var l=function(){},u=s.onComplete||l,A=s.onChange||l,c=this;return t.util.animate({target:this,startValue:o.left,endValue:this.getCenterPoint().x,duration:this.FX_DURATION,onChange:function(h){o.set("left",h),c.requestRenderAll(),A()},onComplete:function(){o.setCoords(),u()}})},fxCenterObjectV:function(o,s){s=s||{};var l=function(){},u=s.onComplete||l,A=s.onChange||l,c=this;return t.util.animate({target:this,startValue:o.top,endValue:this.getCenterPoint().y,duration:this.FX_DURATION,onChange:function(h){o.set("top",h),c.requestRenderAll(),A()},onComplete:function(){o.setCoords(),u()}})},fxRemove:function(o,s){s=s||{};var l=function(){},u=s.onComplete||l,A=s.onChange||l,c=this;return t.util.animate({target:this,startValue:o.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(h){o.set("opacity",h),c.requestRenderAll(),A()},onComplete:function(){c.remove(o),u()}})}}),t.util.object.extend(t.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]=="object"){var o=[],s,l,u=[];for(s in arguments[0])o.push(s);for(var A=0,c=o.length;A<c;A++)s=o[A],l=A!==c-1,u.push(this._animate(s,arguments[0][s],arguments[1],l));return u}else return this._animate.apply(this,arguments)},_animate:function(o,s,l,u){var A=this,c;s=s.toString(),l?l=t.util.object.clone(l):l={},~o.indexOf(".")&&(c=o.split("."));var h=A.colorProperties.indexOf(o)>-1||c&&A.colorProperties.indexOf(c[1])>-1,p=c?this.get(c[0])[c[1]]:this.get(o);"from"in l||(l.from=p),h||(~s.indexOf("=")?s=p+parseFloat(s.replace("=","")):s=parseFloat(s));var m={target:this,startValue:l.from,endValue:s,byValue:l.by,easing:l.easing,duration:l.duration,abort:l.abort&&function(d,g,v){return l.abort.call(A,d,g,v)},onChange:function(d,g,v){c?A[c[0]][c[1]]=d:A.set(o,d),!u&&l.onChange&&l.onChange(d,g,v)},onComplete:function(d,g,v){u||(A.setCoords(),l.onComplete&&l.onComplete(d,g,v))}};return h?t.util.animateColor(m.startValue,m.endValue,m.duration,m):t.util.animate(m)}}),function(o){var s=o.fabric||(o.fabric={}),l=s.util.object.extend,u=s.util.object.clone,A={x1:1,x2:1,y1:1,y2:1};if(s.Line){s.warn("fabric.Line is already defined");return}s.Line=s.util.createClass(s.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:s.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(h,p){h||(h=[0,0,0,0]),this.callSuper("initialize",p),this.set("x1",h[0]),this.set("y1",h[1]),this.set("x2",h[2]),this.set("y2",h[3]),this._setWidthHeight(p)},_setWidthHeight:function(h){h||(h={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in h?h.left:this._getLeftToOriginX(),this.top="top"in h?h.top:this._getTopToOriginY()},_set:function(h,p){return this.callSuper("_set",h,p),typeof A[h]<"u"&&this._setWidthHeight(),this},_getLeftToOriginX:c({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:c({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(h){h.beginPath();var p=this.calcLinePoints();h.moveTo(p.x1,p.y1),h.lineTo(p.x2,p.y2),h.lineWidth=this.strokeWidth;var m=h.strokeStyle;h.strokeStyle=this.stroke||h.fillStyle,this.stroke&&this._renderStroke(h),h.strokeStyle=m},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(h){return l(this.callSuper("toObject",h),this.calcLinePoints())},_getNonTransformedDimensions:function(){var h=this.callSuper("_getNonTransformedDimensions");return this.strokeLineCap==="butt"&&(this.width===0&&(h.y-=this.strokeWidth),this.height===0&&(h.x-=this.strokeWidth)),h},calcLinePoints:function(){var h=this.x1<=this.x2?-1:1,p=this.y1<=this.y2?-1:1,m=h*this.width*.5,d=p*this.height*.5,g=h*this.width*-.5,v=p*this.height*-.5;return{x1:m,x2:g,y1:d,y2:v}},_toSVG:function(){var h=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',h.x1,'" y1="',h.y1,'" x2="',h.x2,'" y2="',h.y2,`" />
`]}}),s.Line.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),s.Line.fromElement=function(h,p,m){m=m||{};var d=s.parseAttributes(h,s.Line.ATTRIBUTE_NAMES),g=[d.x1||0,d.y1||0,d.x2||0,d.y2||0];p(new s.Line(g,l(d,m)))},s.Line.fromObject=function(h,p){function m(g){delete g.points,p&&p(g)}var d=u(h,!0);d.points=[h.x1,h.y1,h.x2,h.y2],s.Object._fromObject("Line",d,m,"points")};function c(h,p){var m=h.origin,d=h.axis1,g=h.axis2,v=h.dimension,w=p.nearest,_=p.center,y=p.farthest;return function(){switch(this.get(m)){case w:return Math.min(this.get(d),this.get(g));case _:return Math.min(this.get(d),this.get(g))+.5*this.get(v);case y:return Math.max(this.get(d),this.get(g))}}}}(n),function(o){var s=o.fabric||(o.fabric={}),l=s.util.degreesToRadians;if(s.Circle){s.warn("fabric.Circle is already defined.");return}s.Circle=s.util.createClass(s.Object,{type:"circle",radius:0,startAngle:0,endAngle:360,cacheProperties:s.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(A,c){return this.callSuper("_set",A,c),A==="radius"&&this.setRadius(c),this},toObject:function(A){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(A))},_toSVG:function(){var A,c=0,h=0,p=(this.endAngle-this.startAngle)%360;if(p===0)A=["<circle ","COMMON_PARTS",'cx="'+c+'" cy="'+h+'" ','r="',this.radius,`" />
`];else{var m=l(this.startAngle),d=l(this.endAngle),g=this.radius,v=s.util.cos(m)*g,w=s.util.sin(m)*g,_=s.util.cos(d)*g,y=s.util.sin(d)*g,C=p>180?"1":"0";A=['<path d="M '+v+" "+w," A "+g+" "+g," 0 ",+C+" 1"," "+_+" "+y,'" ',"COMMON_PARTS",` />
`]}return A},_render:function(A){A.beginPath(),A.arc(0,0,this.radius,l(this.startAngle),l(this.endAngle),!1),this._renderPaintInOrder(A)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(A){return this.radius=A,this.set("width",A*2).set("height",A*2)}}),s.Circle.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),s.Circle.fromElement=function(A,c){var h=s.parseAttributes(A,s.Circle.ATTRIBUTE_NAMES);if(!u(h))throw new Error("value of `r` attribute is required and can not be negative");h.left=(h.left||0)-h.radius,h.top=(h.top||0)-h.radius,c(new s.Circle(h))};function u(A){return"radius"in A&&A.radius>=0}s.Circle.fromObject=function(A,c){s.Object._fromObject("Circle",A,c)}}(n),function(o){var s=o.fabric||(o.fabric={});if(s.Triangle){s.warn("fabric.Triangle is already defined");return}s.Triangle=s.util.createClass(s.Object,{type:"triangle",width:100,height:100,_render:function(l){var u=this.width/2,A=this.height/2;l.beginPath(),l.moveTo(-u,A),l.lineTo(0,-A),l.lineTo(u,A),l.closePath(),this._renderPaintInOrder(l)},_toSVG:function(){var l=this.width/2,u=this.height/2,A=[-l+" "+u,"0 "+-u,l+" "+u].join(",");return["<polygon ","COMMON_PARTS",'points="',A,'" />']}}),s.Triangle.fromObject=function(l,u){return s.Object._fromObject("Triangle",l,u)}}(n),function(o){var s=o.fabric||(o.fabric={}),l=Math.PI*2;if(s.Ellipse){s.warn("fabric.Ellipse is already defined.");return}s.Ellipse=s.util.createClass(s.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:s.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(u){this.callSuper("initialize",u),this.set("rx",u&&u.rx||0),this.set("ry",u&&u.ry||0)},_set:function(u,A){switch(this.callSuper("_set",u,A),u){case"rx":this.rx=A,this.set("width",A*2);break;case"ry":this.ry=A,this.set("height",A*2);break}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(u){return this.callSuper("toObject",["rx","ry"].concat(u))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,`" />
`]},_render:function(u){u.beginPath(),u.save(),u.transform(1,0,0,this.ry/this.rx,0,0),u.arc(0,0,this.rx,0,l,!1),u.restore(),this._renderPaintInOrder(u)}}),s.Ellipse.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),s.Ellipse.fromElement=function(u,A){var c=s.parseAttributes(u,s.Ellipse.ATTRIBUTE_NAMES);c.left=(c.left||0)-c.rx,c.top=(c.top||0)-c.ry,A(new s.Ellipse(c))},s.Ellipse.fromObject=function(u,A){s.Object._fromObject("Ellipse",u,A)}}(n),function(o){var s=o.fabric||(o.fabric={}),l=s.util.object.extend;if(s.Rect){s.warn("fabric.Rect is already defined");return}s.Rect=s.util.createClass(s.Object,{stateProperties:s.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:s.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(u){this.callSuper("initialize",u),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(u){var A=this.rx?Math.min(this.rx,this.width/2):0,c=this.ry?Math.min(this.ry,this.height/2):0,h=this.width,p=this.height,m=-this.width/2,d=-this.height/2,g=A!==0||c!==0,v=1-.5522847498;u.beginPath(),u.moveTo(m+A,d),u.lineTo(m+h-A,d),g&&u.bezierCurveTo(m+h-v*A,d,m+h,d+v*c,m+h,d+c),u.lineTo(m+h,d+p-c),g&&u.bezierCurveTo(m+h,d+p-v*c,m+h-v*A,d+p,m+h-A,d+p),u.lineTo(m+A,d+p),g&&u.bezierCurveTo(m+v*A,d+p,m,d+p-v*c,m,d+p-c),u.lineTo(m,d+c),g&&u.bezierCurveTo(m,d+v*c,m+v*A,d,m+A,d),u.closePath(),this._renderPaintInOrder(u)},toObject:function(u){return this.callSuper("toObject",["rx","ry"].concat(u))},_toSVG:function(){var u=-this.width/2,A=-this.height/2;return["<rect ","COMMON_PARTS",'x="',u,'" y="',A,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,`" />
`]}}),s.Rect.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),s.Rect.fromElement=function(u,A,c){if(!u)return A(null);c=c||{};var h=s.parseAttributes(u,s.Rect.ATTRIBUTE_NAMES);h.left=h.left||0,h.top=h.top||0,h.height=h.height||0,h.width=h.width||0;var p=new s.Rect(l(c?s.util.object.clone(c):{},h));p.visible=p.visible&&p.width>0&&p.height>0,A(p)},s.Rect.fromObject=function(u,A){return s.Object._fromObject("Rect",u,A)}}(n),function(o){var s=o.fabric||(o.fabric={}),l=s.util.object.extend,u=s.util.array.min,A=s.util.array.max,c=s.util.toFixed,h=s.util.projectStrokeOnPoints;if(s.Polyline){s.warn("fabric.Polyline is already defined");return}s.Polyline=s.util.createClass(s.Object,{type:"polyline",points:null,exactBoundingBox:!1,cacheProperties:s.Object.prototype.cacheProperties.concat("points"),initialize:function(p,m){m=m||{},this.points=p||[],this.callSuper("initialize",m),this._setPositionDimensions(m)},_projectStrokeOnPoints:function(){return h(this.points,this,!0)},_setPositionDimensions:function(p){var m=this._calcDimensions(p),d,g=this.exactBoundingBox?this.strokeWidth:0;this.width=m.width-g,this.height=m.height-g,p.fromSVG||(d=this.translateToGivenOrigin({x:m.left-this.strokeWidth/2+g/2,y:m.top-this.strokeWidth/2+g/2},"left","top",this.originX,this.originY)),typeof p.left>"u"&&(this.left=p.fromSVG?m.left:d.x),typeof p.top>"u"&&(this.top=p.fromSVG?m.top:d.y),this.pathOffset={x:m.left+this.width/2+g/2,y:m.top+this.height/2+g/2}},_calcDimensions:function(){var p=this.exactBoundingBox?this._projectStrokeOnPoints():this.points,m=u(p,"x")||0,d=u(p,"y")||0,g=A(p,"x")||0,v=A(p,"y")||0,w=g-m,_=v-d;return{left:m,top:d,width:w,height:_}},toObject:function(p){return l(this.callSuper("toObject",p),{points:this.points.concat()})},_toSVG:function(){for(var p=[],m=this.pathOffset.x,d=this.pathOffset.y,g=s.Object.NUM_FRACTION_DIGITS,v=0,w=this.points.length;v<w;v++)p.push(c(this.points[v].x-m,g),",",c(this.points[v].y-d,g)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',p.join(""),`" />
`]},commonRender:function(p){var m,d=this.points.length,g=this.pathOffset.x,v=this.pathOffset.y;if(!d||isNaN(this.points[d-1].y))return!1;p.beginPath(),p.moveTo(this.points[0].x-g,this.points[0].y-v);for(var w=0;w<d;w++)m=this.points[w],p.lineTo(m.x-g,m.y-v);return!0},_render:function(p){this.commonRender(p)&&this._renderPaintInOrder(p)},complexity:function(){return this.get("points").length}}),s.Polyline.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat(),s.Polyline.fromElementGenerator=function(p){return function(m,d,g){if(!m)return d(null);g||(g={});var v=s.parsePointsAttribute(m.getAttribute("points")),w=s.parseAttributes(m,s[p].ATTRIBUTE_NAMES);w.fromSVG=!0,d(new s[p](v,l(w,g)))}},s.Polyline.fromElement=s.Polyline.fromElementGenerator("Polyline"),s.Polyline.fromObject=function(p,m){return s.Object._fromObject("Polyline",p,m,"points")}}(n),function(o){var s=o.fabric||(o.fabric={}),l=s.util.projectStrokeOnPoints;if(s.Polygon){s.warn("fabric.Polygon is already defined");return}s.Polygon=s.util.createClass(s.Polyline,{type:"polygon",_projectStrokeOnPoints:function(){return l(this.points,this)},_render:function(u){this.commonRender(u)&&(u.closePath(),this._renderPaintInOrder(u))}}),s.Polygon.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat(),s.Polygon.fromElement=s.Polyline.fromElementGenerator("Polygon"),s.Polygon.fromObject=function(u,A){s.Object._fromObject("Polygon",u,A,"points")}}(n),function(o){var s=o.fabric||(o.fabric={}),l=s.util.array.min,u=s.util.array.max,A=s.util.object.extend,c=s.util.object.clone,h=s.util.toFixed;if(s.Path){s.warn("fabric.Path is already defined");return}s.Path=s.util.createClass(s.Object,{type:"path",path:null,cacheProperties:s.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:s.Object.prototype.stateProperties.concat("path"),initialize:function(p,m){m=c(m||{}),delete m.path,this.callSuper("initialize",m),this._setPath(p||[],m)},_setPath:function(p,m){this.path=s.util.makePathSimpler(Array.isArray(p)?p:s.util.parsePath(p)),s.Polyline.prototype._setPositionDimensions.call(this,m||{})},_renderPathCommands:function(p){var m,d=0,g=0,v=0,w=0,_=0,y=0,C=-this.pathOffset.x,b=-this.pathOffset.y;p.beginPath();for(var S=0,B=this.path.length;S<B;++S)switch(m=this.path[S],m[0]){case"L":v=m[1],w=m[2],p.lineTo(v+C,w+b);break;case"M":v=m[1],w=m[2],d=v,g=w,p.moveTo(v+C,w+b);break;case"C":v=m[5],w=m[6],_=m[3],y=m[4],p.bezierCurveTo(m[1]+C,m[2]+b,_+C,y+b,v+C,w+b);break;case"Q":p.quadraticCurveTo(m[1]+C,m[2]+b,m[3]+C,m[4]+b),v=m[3],w=m[4],_=m[1],y=m[2];break;case"z":case"Z":v=d,w=g,p.closePath();break}},_render:function(p){this._renderPathCommands(p),this._renderPaintInOrder(p)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(p){return A(this.callSuper("toObject",p),{path:this.path.map(function(m){return m.slice()})})},toDatalessObject:function(p){var m=this.toObject(["sourcePath"].concat(p));return m.sourcePath&&delete m.path,m},_toSVG:function(){var p=s.util.joinPath(this.path);return["<path ","COMMON_PARTS",'d="',p,'" stroke-linecap="round" ',`/>
`]},_getOffsetTransform:function(){var p=s.Object.NUM_FRACTION_DIGITS;return" translate("+h(-this.pathOffset.x,p)+", "+h(-this.pathOffset.y,p)+")"},toClipPathSVG:function(p){var m=this._getOffsetTransform();return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:p,additionalTransform:m})},toSVG:function(p){var m=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:p,additionalTransform:m})},complexity:function(){return this.path.length},_calcDimensions:function(){for(var p=[],m=[],d,g=0,v=0,w=0,_=0,y,C=0,b=this.path.length;C<b;++C){switch(d=this.path[C],d[0]){case"L":w=d[1],_=d[2],y=[];break;case"M":w=d[1],_=d[2],g=w,v=_,y=[];break;case"C":y=s.util.getBoundsOfCurve(w,_,d[1],d[2],d[3],d[4],d[5],d[6]),w=d[5],_=d[6];break;case"Q":y=s.util.getBoundsOfCurve(w,_,d[1],d[2],d[1],d[2],d[3],d[4]),w=d[3],_=d[4];break;case"z":case"Z":w=g,_=v;break}y.forEach(function(R){p.push(R.x),m.push(R.y)}),p.push(w),m.push(_)}var S=l(p)||0,B=l(m)||0,M=u(p)||0,z=u(m)||0,G=M-S,P=z-B;return{left:S,top:B,width:G,height:P}}}),s.Path.fromObject=function(p,m){if(typeof p.sourcePath=="string"){var d=p.sourcePath;s.loadSVGFromURL(d,function(g){var v=g[0];v.setOptions(p),p.clipPath?s.util.enlivenObjects([p.clipPath],function(w){v.clipPath=w[0],m&&m(v)}):m&&m(v)})}else s.Object._fromObject("Path",p,m,"path")},s.Path.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat(["d"]),s.Path.fromElement=function(p,m,d){var g=s.parseAttributes(p,s.Path.ATTRIBUTE_NAMES);g.fromSVG=!0,m(new s.Path(g.d,A(g,d)))}}(n),function(o){var s=o.fabric||(o.fabric={}),l=s.util.array.min,u=s.util.array.max;s.Group||(s.Group=s.util.createClass(s.Object,s.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(A,c,h){c=c||{},this._objects=[],h&&this.callSuper("initialize",c),this._objects=A||[];for(var p=this._objects.length;p--;)this._objects[p].group=this;if(h)this._updateObjectsACoords();else{var m=c&&c.centerPoint;c.originX!==void 0&&(this.originX=c.originX),c.originY!==void 0&&(this.originY=c.originY),m||this._calcBounds(),this._updateObjectsCoords(m),delete c.centerPoint,this.callSuper("initialize",c)}this.setCoords()},_updateObjectsACoords:function(){for(var A=!0,c=this._objects.length;c--;)this._objects[c].setCoords(A)},_updateObjectsCoords:function(c){for(var c=c||this.getCenterPoint(),h=this._objects.length;h--;)this._updateObjectCoords(this._objects[h],c)},_updateObjectCoords:function(A,c){var h=A.left,p=A.top,m=!0;A.set({left:h-c.x,top:p-c.y}),A.group=this,A.setCoords(m)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(A){var c=!!this.group;return this._restoreObjectsState(),s.util.resetObjectTransform(this),A&&(c&&s.util.removeTransformFromObject(A,this.group.calcTransformMatrix()),this._objects.push(A),A.group=this,A._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.dirty=!0,c?this.group.addWithUpdate():this.setCoords(),this},removeWithUpdate:function(A){return this._restoreObjectsState(),s.util.resetObjectTransform(this),this.remove(A),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(A){this.dirty=!0,A.group=this,A._set("canvas",this.canvas)},_onObjectRemoved:function(A){this.dirty=!0,delete A.group},_set:function(A,c){var h=this._objects.length;if(this.useSetOnGroup)for(;h--;)this._objects[h].setOnGroup(A,c);if(A==="canvas")for(;h--;)this._objects[h]._set(A,c);s.Object.prototype._set.call(this,A,c)},toObject:function(A){var c=this.includeDefaultValues,h=this._objects.filter(function(m){return!m.excludeFromExport}).map(function(m){var d=m.includeDefaultValues;m.includeDefaultValues=c;var g=m.toObject(A);return m.includeDefaultValues=d,g}),p=s.Object.prototype.toObject.call(this,A);return p.objects=h,p},toDatalessObject:function(A){var c,h=this.sourcePath;if(h)c=h;else{var p=this.includeDefaultValues;c=this._objects.map(function(d){var g=d.includeDefaultValues;d.includeDefaultValues=p;var v=d.toDatalessObject(A);return d.includeDefaultValues=g,v})}var m=s.Object.prototype.toDatalessObject.call(this,A);return m.objects=c,m},render:function(A){this._transformDone=!0,this.callSuper("render",A),this._transformDone=!1},shouldCache:function(){var A=s.Object.prototype.shouldCache.call(this);if(A){for(var c=0,h=this._objects.length;c<h;c++)if(this._objects[c].willDrawShadow())return this.ownCaching=!1,!1}return A},willDrawShadow:function(){if(s.Object.prototype.willDrawShadow.call(this))return!0;for(var A=0,c=this._objects.length;A<c;A++)if(this._objects[A].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(A){for(var c=0,h=this._objects.length;c<h;c++)this._objects[c].render(A);this._drawClipPath(A,this.clipPath)},isCacheDirty:function(A){if(this.callSuper("isCacheDirty",A))return!0;if(!this.statefullCache)return!1;for(var c=0,h=this._objects.length;c<h;c++)if(this._objects[c].isCacheDirty(!0)){if(this._cacheCanvas){var p=this.cacheWidth/this.zoomX,m=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-p/2,-m/2,p,m)}return!0}return!1},_restoreObjectsState:function(){var A=this.calcOwnMatrix();return this._objects.forEach(function(c){s.util.addTransformToObject(c,A),delete c.group,c.setCoords()}),this},destroy:function(){return this._objects.forEach(function(A){A.set("dirty",!0)}),this._restoreObjectsState()},dispose:function(){this.callSuper("dispose"),this.forEachObject(function(A){A.dispose&&A.dispose()}),this._objects=[]},toActiveSelection:function(){if(this.canvas){var A=this._objects,c=this.canvas;this._objects=[];var h=this.toObject();delete h.objects;var p=new s.ActiveSelection([]);return p.set(h),p.type="activeSelection",c.remove(this),A.forEach(function(m){m.group=p,m.dirty=!0,c.add(m)}),p.canvas=c,p._objects=A,c._activeObject=p,p.setCoords(),p}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){var A=!0;return this.forEachObject(function(c){c.setCoords(A)}),this},_calcBounds:function(A){for(var c=[],h=[],p,m,d,g=["tr","br","bl","tl"],v=0,w=this._objects.length,_,y=g.length;v<w;++v){for(p=this._objects[v],d=p.calcACoords(),_=0;_<y;_++)m=g[_],c.push(d[m].x),h.push(d[m].y);p.aCoords=d}this._getBounds(c,h,A)},_getBounds:function(A,c,h){var p=new s.Point(l(A),l(c)),m=new s.Point(u(A),u(c)),d=p.y||0,g=p.x||0,v=m.x-p.x||0,w=m.y-p.y||0;this.width=v,this.height=w,h||this.setPositionByOrigin({x:g,y:d},"left","top")},_toSVG:function(A){for(var c=["<g ","COMMON_PARTS",` >
`],h=0,p=this._objects.length;h<p;h++)c.push("		",this._objects[h].toSVG(A));return c.push(`</g>
`),c},getSvgStyles:function(){var A=typeof this.opacity<"u"&&this.opacity!==1?"opacity: "+this.opacity+";":"",c=this.visible?"":" visibility: hidden;";return[A,this.getSvgFilter(),c].join("")},toClipPathSVG:function(A){for(var c=[],h=0,p=this._objects.length;h<p;h++)c.push("	",this._objects[h].toClipPathSVG(A));return this._createBaseClipPathSVGMarkup(c,{reviver:A})}}),s.Group.fromObject=function(A,c){var h=A.objects,p=s.util.object.clone(A,!0);if(delete p.objects,typeof h=="string"){s.loadSVGFromURL(h,function(m){var d=s.util.groupSVGElements(m,A,h),g=p.clipPath;delete p.clipPath,d.set(p),g?s.util.enlivenObjects([g],function(v){d.clipPath=v[0],c&&c(d)}):c&&c(d)});return}s.util.enlivenObjects(h,function(m){s.util.enlivenObjectEnlivables(A,p,function(){c&&c(new s.Group(m,p,!0))})})})}(n),function(o){var s=o.fabric||(o.fabric={});s.ActiveSelection||(s.ActiveSelection=s.util.createClass(s.Group,{type:"activeSelection",initialize:function(l,u){u=u||{},this._objects=l||[];for(var A=this._objects.length;A--;)this._objects[A].group=this;u.originX&&(this.originX=u.originX),u.originY&&(this.originY=u.originY),this._calcBounds(),this._updateObjectsCoords(),s.Object.prototype.initialize.call(this,u),this.setCoords()},toGroup:function(){var l=this._objects.concat();this._objects=[];var u=s.Object.prototype.toObject.call(this),A=new s.Group([]);if(delete u.type,A.set(u),l.forEach(function(h){h.canvas.remove(h),h.group=A}),A._objects=l,!this.canvas)return A;var c=this.canvas;return c.add(A),c._activeObject=A,A.setCoords(),A},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(l,u,A){l.save(),l.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",l,u),A=A||{},typeof A.hasControls>"u"&&(A.hasControls=!1),A.forActiveSelection=!0;for(var c=0,h=this._objects.length;c<h;c++)this._objects[c]._renderControls(l,A);l.restore()}}),s.ActiveSelection.fromObject=function(l,u){s.util.enlivenObjects(l.objects,function(A){delete l.objects,u&&u(new s.ActiveSelection(A,l,!0))})})}(n),function(o){var s=t.util.object.extend;if(o.fabric||(o.fabric={}),o.fabric.Image){t.warn("fabric.Image is already defined.");return}t.Image=t.util.createClass(t.Object,{type:"image",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:t.Object.prototype.stateProperties.concat("cropX","cropY"),cacheProperties:t.Object.prototype.cacheProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,imageSmoothing:!0,initialize:function(l,u){u||(u={}),this.filters=[],this.cacheKey="texture"+t.Object.__uid++,this.callSuper("initialize",u),this._initElement(l,u)},getElement:function(){return this._element||{}},setElement:function(l,u){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=l,this._originalElement=l,this._initConfig(u),this.filters.length!==0&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(l){var u=t.filterBackend;u&&u.evictCachesForKey&&u.evictCachesForKey(l)},dispose:function(){this.callSuper("dispose"),this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(function(l){t.util.cleanUpJsdomNode(this[l]),this[l]=void 0}.bind(this))},getCrossOrigin:function(){return this._originalElement&&(this._originalElement.crossOrigin||null)},getOriginalSize:function(){var l=this.getElement();return{width:l.naturalWidth||l.width,height:l.naturalHeight||l.height}},_stroke:function(l){if(!(!this.stroke||this.strokeWidth===0)){var u=this.width/2,A=this.height/2;l.beginPath(),l.moveTo(-u,-A),l.lineTo(u,-A),l.lineTo(u,A),l.lineTo(-u,A),l.lineTo(-u,-A),l.closePath()}},toObject:function(l){var u=[];this.filters.forEach(function(c){c&&u.push(c.toObject())});var A=s(this.callSuper("toObject",["cropX","cropY"].concat(l)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:u});return this.resizeFilter&&(A.resizeFilter=this.resizeFilter.toObject()),A},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var l=[],u=[],A,c=this._element,h=-this.width/2,p=-this.height/2,m="",d="";if(!c)return[];if(this.hasCrop()){var g=t.Object.__uid++;l.push('<clipPath id="imageCrop_'+g+`">
`,'	<rect x="'+h+'" y="'+p+'" width="'+this.width+'" height="'+this.height+`" />
`,`</clipPath>
`),m=' clip-path="url(#imageCrop_'+g+')" '}if(this.imageSmoothing||(d='" image-rendering="optimizeSpeed'),u.push("	<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',h-this.cropX,'" y="',p-this.cropY,'" width="',c.width||c.naturalWidth,'" height="',c.height||c.height,d,'"',m,`></image>
`),this.stroke||this.strokeDashArray){var v=this.fill;this.fill=null,A=["	<rect ",'x="',h,'" y="',p,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),`"/>
`],this.fill=v}return this.paintFirst!=="fill"?l=l.concat(A,u):l=l.concat(u,A),l},getSrc:function(l){var u=l?this._element:this._originalElement;return u?u.toDataURL?u.toDataURL():this.srcFromAttribute?u.getAttribute("src"):u.src:this.src||""},setSrc:function(l,u,A){return t.util.loadImage(l,function(c,h){this.setElement(c,A),this._setWidthHeight(),u&&u(this,h)},this,A&&A.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var l=this.resizeFilter,u=this.minimumScaleTrigger,A=this.getTotalObjectScaling(),c=A.scaleX,h=A.scaleY,p=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!l||c>u&&h>u){this._element=p,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=c,this._lastScaleY=h;return}t.filterBackend||(t.filterBackend=t.initFilterBackend());var m=t.util.createCanvasElement(),d=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,g=p.width,v=p.height;m.width=g,m.height=v,this._element=m,this._lastScaleX=l.scaleX=c,this._lastScaleY=l.scaleY=h,t.filterBackend.applyFilters([l],p,g,v,this._element,d),this._filterScalingX=m.width/this._originalElement.width,this._filterScalingY=m.height/this._originalElement.height},applyFilters:function(l){if(l=l||this.filters||[],l=l.filter(function(p){return p&&!p.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),l.length===0)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var u=this._originalElement,A=u.naturalWidth||u.width,c=u.naturalHeight||u.height;if(this._element===this._originalElement){var h=t.util.createCanvasElement();h.width=A,h.height=c,this._element=h,this._filteredEl=h}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,A,c),this._lastScaleX=1,this._lastScaleY=1;return t.filterBackend||(t.filterBackend=t.initFilterBackend()),t.filterBackend.applyFilters(l,this._originalElement,A,c,this._element,this.cacheKey),(this._originalElement.width!==this._element.width||this._originalElement.height!==this._element.height)&&(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(l){t.util.setImageSmoothing(l,this.imageSmoothing),this.isMoving!==!0&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(l),this._renderPaintInOrder(l)},drawCacheOnCanvas:function(l){t.util.setImageSmoothing(l,this.imageSmoothing),t.Object.prototype.drawCacheOnCanvas.call(this,l)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(l){var u=this._element;if(u){var A=this._filterScalingX,c=this._filterScalingY,h=this.width,p=this.height,m=Math.min,d=Math.max,g=d(this.cropX,0),v=d(this.cropY,0),w=u.naturalWidth||u.width,_=u.naturalHeight||u.height,y=g*A,C=v*c,b=m(h*A,w-y),S=m(p*c,_-C),B=-h/2,M=-p/2,z=m(h,w/A-g),G=m(p,_/c-v);u&&l.drawImage(u,y,C,b,S,B,M,z,G)}},_needsResize:function(){var l=this.getTotalObjectScaling();return l.scaleX!==this._lastScaleX||l.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(l,u){this.setElement(t.util.getById(l),u),t.util.addClass(this.getElement(),t.Image.CSS_CANVAS)},_initConfig:function(l){l||(l={}),this.setOptions(l),this._setWidthHeight(l)},_initFilters:function(l,u){l&&l.length?t.util.enlivenObjects(l,function(A){u&&u(A)},"fabric.Image.filters"):u&&u()},_setWidthHeight:function(l){l||(l={});var u=this.getElement();this.width=l.width||u.naturalWidth||u.width||0,this.height=l.height||u.naturalHeight||u.height||0},parsePreserveAspectRatioAttribute:function(){var l=t.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),u=this._element.width,A=this._element.height,c=1,h=1,p=0,m=0,d=0,g=0,v,w=this.width,_=this.height,y={width:w,height:_};return l&&(l.alignX!=="none"||l.alignY!=="none")?(l.meetOrSlice==="meet"&&(c=h=t.util.findScaleToFit(this._element,y),v=(w-u*c)/2,l.alignX==="Min"&&(p=-v),l.alignX==="Max"&&(p=v),v=(_-A*h)/2,l.alignY==="Min"&&(m=-v),l.alignY==="Max"&&(m=v)),l.meetOrSlice==="slice"&&(c=h=t.util.findScaleToCover(this._element,y),v=u-w/c,l.alignX==="Mid"&&(d=v/2),l.alignX==="Max"&&(d=v),v=A-_/h,l.alignY==="Mid"&&(g=v/2),l.alignY==="Max"&&(g=v),u=w/c,A=_/h)):(c=w/u,h=_/A),{width:u,height:A,scaleX:c,scaleY:h,offsetLeft:p,offsetTop:m,cropX:d,cropY:g}}}),t.Image.CSS_CANVAS="canvas-img",t.Image.prototype.getSvgSrc=t.Image.prototype.getSrc,t.Image.fromObject=function(l,u){var A=t.util.object.clone(l);t.util.loadImage(A.src,function(c,h){if(h){u&&u(null,!0);return}t.Image.prototype._initFilters.call(A,A.filters,function(p){A.filters=p||[],t.Image.prototype._initFilters.call(A,[A.resizeFilter],function(m){A.resizeFilter=m[0],t.util.enlivenObjectEnlivables(A,A,function(){var d=new t.Image(c,A);u(d,!1)})})})},null,A.crossOrigin)},t.Image.fromURL=function(l,u,A){t.util.loadImage(l,function(c,h){u&&u(new t.Image(c,A),h)},null,A&&A.crossOrigin)},t.Image.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin image-rendering".split(" ")),t.Image.fromElement=function(l,u,A){var c=t.parseAttributes(l,t.Image.ATTRIBUTE_NAMES);t.Image.fromURL(c["xlink:href"],u,s(A?t.util.object.clone(A):{},c))}}(n),t.util.object.extend(t.Object.prototype,{_getAngleValueForStraighten:function(){var o=this.angle%360;return o>0?Math.round((o-1)/90)*90:Math.round(o/90)*90},straighten:function(){return this.rotate(this._getAngleValueForStraighten())},fxStraighten:function(o){o=o||{};var s=function(){},l=o.onComplete||s,u=o.onChange||s,A=this;return t.util.animate({target:this,startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(c){A.rotate(c),u()},onComplete:function(){A.setCoords(),l()}})}}),t.util.object.extend(t.StaticCanvas.prototype,{straightenObject:function(o){return o.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(o){return o.fxStraighten({onChange:this.requestRenderAllBound})}}),function(){function o(l,u){var A="precision "+u+` float;
void main(){}`,c=l.createShader(l.FRAGMENT_SHADER);return l.shaderSource(c,A),l.compileShader(c),!!l.getShaderParameter(c,l.COMPILE_STATUS)}t.isWebglSupported=function(l){if(t.isLikelyNode)return!1;l=l||t.WebglFilterBackend.prototype.tileSize;var u=document.createElement("canvas"),A=u.getContext("webgl")||u.getContext("experimental-webgl"),c=!1;if(A){t.maxTextureSize=A.getParameter(A.MAX_TEXTURE_SIZE),c=t.maxTextureSize>=l;for(var h=["highp","mediump","lowp"],p=0;p<3;p++)if(o(A,h[p])){t.webGlPrecision=h[p];break}}return this.isSupported=c,c},t.WebglFilterBackend=s;function s(l){l&&l.tileSize&&(this.tileSize=l.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}s.prototype={tileSize:2048,resources:{},setupGLContext:function(l,u){this.dispose(),this.createWebGLCanvas(l,u),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(l,u)},chooseFastestCopyGLTo2DMethod:function(l,u){var A=typeof window.performance<"u",c;try{new ImageData(1,1),c=!0}catch{c=!1}var h=typeof ArrayBuffer<"u",p=typeof Uint8ClampedArray<"u";if(A&&c&&h&&p){var m=t.util.createCanvasElement(),d=new ArrayBuffer(l*u*4);if(t.forceGLPutImageData){this.imageBuffer=d,this.copyGLTo2D=f;return}var g={imageBuffer:d,destinationWidth:l,destinationHeight:u,targetCanvas:m},v,w,_;m.width=l,m.height=u,v=window.performance.now(),a.call(g,this.gl,g),w=window.performance.now()-v,v=window.performance.now(),f.call(g,this.gl,g),_=window.performance.now()-v,w>_?(this.imageBuffer=d,this.copyGLTo2D=f):this.copyGLTo2D=a}},createWebGLCanvas:function(l,u){var A=t.util.createCanvasElement();A.width=l,A.height=u;var c={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},h=A.getContext("webgl",c);h||(h=A.getContext("experimental-webgl",c)),h&&(h.clearColor(0,0,0,0),this.canvas=A,this.gl=h)},applyFilters:function(l,u,A,c,h,p){var m=this.gl,d;p&&(d=this.getCachedTexture(p,u));var g={originalWidth:u.width||u.originalWidth,originalHeight:u.height||u.originalHeight,sourceWidth:A,sourceHeight:c,destinationWidth:A,destinationHeight:c,context:m,sourceTexture:this.createTexture(m,A,c,!d&&u),targetTexture:this.createTexture(m,A,c),originalTexture:d||this.createTexture(m,A,c,!d&&u),passes:l.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:h},v=m.createFramebuffer();return m.bindFramebuffer(m.FRAMEBUFFER,v),l.forEach(function(w){w&&w.applyTo(g)}),r(g),this.copyGLTo2D(m,g),m.bindTexture(m.TEXTURE_2D,null),m.deleteTexture(g.sourceTexture),m.deleteTexture(g.targetTexture),m.deleteFramebuffer(v),h.getContext("2d").setTransform(1,0,0,1,0,0),g},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(l,u,A,c,h){var p=l.createTexture();return l.bindTexture(l.TEXTURE_2D,p),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,h||l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,h||l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),c?l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,c):l.texImage2D(l.TEXTURE_2D,0,l.RGBA,u,A,0,l.RGBA,l.UNSIGNED_BYTE,null),p},getCachedTexture:function(l,u){if(this.textureCache[l])return this.textureCache[l];var A=this.createTexture(this.gl,u.width,u.height,u);return this.textureCache[l]=A,A},evictCachesForKey:function(l){this.textureCache[l]&&(this.gl.deleteTexture(this.textureCache[l]),delete this.textureCache[l])},copyGLTo2D:a,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var l=this.gl,u={renderer:"",vendor:""};if(!l)return u;var A=l.getExtension("WEBGL_debug_renderer_info");if(A){var c=l.getParameter(A.UNMASKED_RENDERER_WEBGL),h=l.getParameter(A.UNMASKED_VENDOR_WEBGL);c&&(u.renderer=c.toLowerCase()),h&&(u.vendor=h.toLowerCase())}return this.gpuInfo=u,u}}}();function r(o){var s=o.targetCanvas,l=s.width,u=s.height,A=o.destinationWidth,c=o.destinationHeight;(l!==A||u!==c)&&(s.width=A,s.height=c)}function a(o,s){var l=o.canvas,u=s.targetCanvas,A=u.getContext("2d");A.translate(0,u.height),A.scale(1,-1);var c=l.height-u.height;A.drawImage(l,0,c,u.width,u.height,0,0,u.width,u.height)}function f(o,s){var l=s.targetCanvas,u=l.getContext("2d"),A=s.destinationWidth,c=s.destinationHeight,h=A*c*4,p=new Uint8Array(this.imageBuffer,0,h),m=new Uint8ClampedArray(this.imageBuffer,0,h);o.readPixels(0,0,A,c,o.RGBA,o.UNSIGNED_BYTE,p);var d=new ImageData(m,A,c);u.putImageData(d,0,0)}(function(){var o=function(){};t.Canvas2dFilterBackend=s;function s(){}s.prototype={evictCachesForKey:o,dispose:o,clearWebGLCaches:o,resources:{},applyFilters:function(l,u,A,c,h){var p=h.getContext("2d");p.drawImage(u,0,0,A,c);var m=p.getImageData(0,0,A,c),d=p.getImageData(0,0,A,c),g={sourceWidth:A,sourceHeight:c,imageData:m,originalEl:u,originalImageData:d,canvasEl:h,ctx:p,filterBackend:this};return l.forEach(function(v){v.applyTo(g)}),(g.imageData.width!==A||g.imageData.height!==c)&&(h.width=g.imageData.width,h.height=g.imageData.height),p.putImageData(g.imageData,0,0),g}}})(),t.Image=t.Image||{},t.Image.filters=t.Image.filters||{},t.Image.filters.BaseFilter=t.util.createClass({type:"BaseFilter",vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
void main() {
vTexCoord = aPosition;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:`precision highp float;
varying vec2 vTexCoord;
uniform sampler2D uTexture;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
}`,initialize:function(o){o&&this.setOptions(o)},setOptions:function(o){for(var s in o)this[s]=o[s]},createProgram:function(o,s,l){s=s||this.fragmentSource,l=l||this.vertexSource,t.webGlPrecision!=="highp"&&(s=s.replace(/precision highp float/g,"precision "+t.webGlPrecision+" float"));var u=o.createShader(o.VERTEX_SHADER);if(o.shaderSource(u,l),o.compileShader(u),!o.getShaderParameter(u,o.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+o.getShaderInfoLog(u));var A=o.createShader(o.FRAGMENT_SHADER);if(o.shaderSource(A,s),o.compileShader(A),!o.getShaderParameter(A,o.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+o.getShaderInfoLog(A));var c=o.createProgram();if(o.attachShader(c,u),o.attachShader(c,A),o.linkProgram(c),!o.getProgramParameter(c,o.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+o.getProgramInfoLog(c));var h=this.getAttributeLocations(o,c),p=this.getUniformLocations(o,c)||{};return p.uStepW=o.getUniformLocation(c,"uStepW"),p.uStepH=o.getUniformLocation(c,"uStepH"),{program:c,attributeLocations:h,uniformLocations:p}},getAttributeLocations:function(o,s){return{aPosition:o.getAttribLocation(s,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(o,s,l){var u=s.aPosition,A=o.createBuffer();o.bindBuffer(o.ARRAY_BUFFER,A),o.enableVertexAttribArray(u),o.vertexAttribPointer(u,2,o.FLOAT,!1,0,0),o.bufferData(o.ARRAY_BUFFER,l,o.STATIC_DRAW)},_setupFrameBuffer:function(o){var s=o.context,l,u;o.passes>1?(l=o.destinationWidth,u=o.destinationHeight,(o.sourceWidth!==l||o.sourceHeight!==u)&&(s.deleteTexture(o.targetTexture),o.targetTexture=o.filterBackend.createTexture(s,l,u)),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,o.targetTexture,0)):(s.bindFramebuffer(s.FRAMEBUFFER,null),s.finish())},_swapTextures:function(o){o.passes--,o.pass++;var s=o.targetTexture;o.targetTexture=o.sourceTexture,o.sourceTexture=s},isNeutralState:function(){var o=this.mainParameter,s=t.Image.filters[this.type].prototype;if(o)if(Array.isArray(s[o])){for(var l=s[o].length;l--;)if(this[o][l]!==s[o][l])return!1;return!0}else return s[o]===this[o];else return!1},applyTo:function(o){o.webgl?(this._setupFrameBuffer(o),this.applyToWebGL(o),this._swapTextures(o)):this.applyTo2d(o)},retrieveShader:function(o){return o.programCache.hasOwnProperty(this.type)||(o.programCache[this.type]=this.createProgram(o.context)),o.programCache[this.type]},applyToWebGL:function(o){var s=o.context,l=this.retrieveShader(o);o.pass===0&&o.originalTexture?s.bindTexture(s.TEXTURE_2D,o.originalTexture):s.bindTexture(s.TEXTURE_2D,o.sourceTexture),s.useProgram(l.program),this.sendAttributeData(s,l.attributeLocations,o.aPosition),s.uniform1f(l.uniformLocations.uStepW,1/o.sourceWidth),s.uniform1f(l.uniformLocations.uStepH,1/o.sourceHeight),this.sendUniformData(s,l.uniformLocations),s.viewport(0,0,o.destinationWidth,o.destinationHeight),s.drawArrays(s.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(o,s,l){o.activeTexture(l),o.bindTexture(o.TEXTURE_2D,s),o.activeTexture(o.TEXTURE0)},unbindAdditionalTexture:function(o,s){o.activeTexture(s),o.bindTexture(o.TEXTURE_2D,null),o.activeTexture(o.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(o){this[this.mainParameter]=o},sendUniformData:function(){},createHelpLayer:function(o){if(!o.helpLayer){var s=document.createElement("canvas");s.width=o.sourceWidth,s.height=o.sourceHeight,o.helpLayer=s}},toObject:function(){var o={type:this.type},s=this.mainParameter;return s&&(o[s]=this[s]),o},toJSON:function(){return this.toObject()}}),t.Image.filters.BaseFilter.fromObject=function(o,s){var l=new t.Image.filters[o.type](o);return s&&s(l),l},function(o){var s=o.fabric||(o.fabric={}),l=s.Image.filters,u=s.util.createClass;l.ColorMatrix=u(l.BaseFilter,{type:"ColorMatrix",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
uniform mat4 uColorMatrix;
uniform vec4 uConstants;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color *= uColorMatrix;
color += uConstants;
gl_FragColor = color;
}`,matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(A){this.callSuper("initialize",A),this.matrix=this.matrix.slice(0)},applyTo2d:function(A){var c=A.imageData,h=c.data,p=h.length,m=this.matrix,d,g,v,w,_,y=this.colorsOnly;for(_=0;_<p;_+=4)d=h[_],g=h[_+1],v=h[_+2],y?(h[_]=d*m[0]+g*m[1]+v*m[2]+m[4]*255,h[_+1]=d*m[5]+g*m[6]+v*m[7]+m[9]*255,h[_+2]=d*m[10]+g*m[11]+v*m[12]+m[14]*255):(w=h[_+3],h[_]=d*m[0]+g*m[1]+v*m[2]+w*m[3]+m[4]*255,h[_+1]=d*m[5]+g*m[6]+v*m[7]+w*m[8]+m[9]*255,h[_+2]=d*m[10]+g*m[11]+v*m[12]+w*m[13]+m[14]*255,h[_+3]=d*m[15]+g*m[16]+v*m[17]+w*m[18]+m[19]*255)},getUniformLocations:function(A,c){return{uColorMatrix:A.getUniformLocation(c,"uColorMatrix"),uConstants:A.getUniformLocation(c,"uConstants")}},sendUniformData:function(A,c){var h=this.matrix,p=[h[0],h[1],h[2],h[3],h[5],h[6],h[7],h[8],h[10],h[11],h[12],h[13],h[15],h[16],h[17],h[18]],m=[h[4],h[9],h[14],h[19]];A.uniformMatrix4fv(c.uColorMatrix,!1,p),A.uniform4fv(c.uConstants,m)}}),s.Image.filters.ColorMatrix.fromObject=s.Image.filters.BaseFilter.fromObject}(n),function(o){var s=o.fabric||(o.fabric={}),l=s.Image.filters,u=s.util.createClass;l.Brightness=u(l.BaseFilter,{type:"Brightness",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBrightness;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += uBrightness;
gl_FragColor = color;
}`,brightness:0,mainParameter:"brightness",applyTo2d:function(A){if(this.brightness!==0){var c=A.imageData,h=c.data,p,m=h.length,d=Math.round(this.brightness*255);for(p=0;p<m;p+=4)h[p]=h[p]+d,h[p+1]=h[p+1]+d,h[p+2]=h[p+2]+d}},getUniformLocations:function(A,c){return{uBrightness:A.getUniformLocation(c,"uBrightness")}},sendUniformData:function(A,c){A.uniform1f(c.uBrightness,this.brightness)}}),s.Image.filters.Brightness.fromObject=s.Image.filters.BaseFilter.fromObject}(n),function(o){var s=o.fabric||(o.fabric={}),l=s.util.object.extend,u=s.Image.filters,A=s.util.createClass;u.Convolute=A(u.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_3_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_5_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_5_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_7_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_7_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_9_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_9_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`},retrieveShader:function(c){var h=Math.sqrt(this.matrix.length),p=this.type+"_"+h+"_"+(this.opaque?1:0),m=this.fragmentSource[p];return c.programCache.hasOwnProperty(p)||(c.programCache[p]=this.createProgram(c.context,m)),c.programCache[p]},applyTo2d:function(c){var h=c.imageData,p=h.data,m=this.matrix,d=Math.round(Math.sqrt(m.length)),g=Math.floor(d/2),v=h.width,w=h.height,_=c.ctx.createImageData(v,w),y=_.data,C=this.opaque?1:0,b,S,B,M,z,G,P,R,W,K,tt,j,E;for(tt=0;tt<w;tt++)for(K=0;K<v;K++){for(z=(tt*v+K)*4,b=0,S=0,B=0,M=0,E=0;E<d;E++)for(j=0;j<d;j++)P=tt+E-g,G=K+j-g,!(P<0||P>=w||G<0||G>=v)&&(R=(P*v+G)*4,W=m[E*d+j],b+=p[R]*W,S+=p[R+1]*W,B+=p[R+2]*W,C||(M+=p[R+3]*W));y[z]=b,y[z+1]=S,y[z+2]=B,C?y[z+3]=p[z+3]:y[z+3]=M}c.imageData=_},getUniformLocations:function(c,h){return{uMatrix:c.getUniformLocation(h,"uMatrix"),uOpaque:c.getUniformLocation(h,"uOpaque"),uHalfSize:c.getUniformLocation(h,"uHalfSize"),uSize:c.getUniformLocation(h,"uSize")}},sendUniformData:function(c,h){c.uniform1fv(h.uMatrix,this.matrix)},toObject:function(){return l(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),s.Image.filters.Convolute.fromObject=s.Image.filters.BaseFilter.fromObject}(n),function(o){var s=o.fabric||(o.fabric={}),l=s.Image.filters,u=s.util.createClass;l.Grayscale=u(l.BaseFilter,{type:"Grayscale",fragmentSource:{average:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float average = (color.r + color.b + color.g) / 3.0;
gl_FragColor = vec4(average, average, average, color.a);
}`,lightness:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;
gl_FragColor = vec4(average, average, average, col.a);
}`,luminosity:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;
gl_FragColor = vec4(average, average, average, col.a);
}`},mode:"average",mainParameter:"mode",applyTo2d:function(A){var c=A.imageData,h=c.data,p,m=h.length,d,g=this.mode;for(p=0;p<m;p+=4)g==="average"?d=(h[p]+h[p+1]+h[p+2])/3:g==="lightness"?d=(Math.min(h[p],h[p+1],h[p+2])+Math.max(h[p],h[p+1],h[p+2]))/2:g==="luminosity"&&(d=.21*h[p]+.72*h[p+1]+.07*h[p+2]),h[p]=d,h[p+1]=d,h[p+2]=d},retrieveShader:function(A){var c=this.type+"_"+this.mode;if(!A.programCache.hasOwnProperty(c)){var h=this.fragmentSource[this.mode];A.programCache[c]=this.createProgram(A.context,h)}return A.programCache[c]},getUniformLocations:function(A,c){return{uMode:A.getUniformLocation(c,"uMode")}},sendUniformData:function(A,c){var h=1;A.uniform1i(c.uMode,h)},isNeutralState:function(){return!1}}),s.Image.filters.Grayscale.fromObject=s.Image.filters.BaseFilter.fromObject}(n),function(o){var s=o.fabric||(o.fabric={}),l=s.Image.filters,u=s.util.createClass;l.Invert=u(l.BaseFilter,{type:"Invert",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform int uInvert;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
if (uInvert == 1) {
gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);
} else {
gl_FragColor = color;
}
}`,invert:!0,mainParameter:"invert",applyTo2d:function(A){var c=A.imageData,h=c.data,p,m=h.length;for(p=0;p<m;p+=4)h[p]=255-h[p],h[p+1]=255-h[p+1],h[p+2]=255-h[p+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(A,c){return{uInvert:A.getUniformLocation(c,"uInvert")}},sendUniformData:function(A,c){A.uniform1i(c.uInvert,this.invert)}}),s.Image.filters.Invert.fromObject=s.Image.filters.BaseFilter.fromObject}(n),function(o){var s=o.fabric||(o.fabric={}),l=s.util.object.extend,u=s.Image.filters,A=s.util.createClass;u.Noise=A(u.BaseFilter,{type:"Noise",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uStepH;
uniform float uNoise;
uniform float uSeed;
varying vec2 vTexCoord;
float rand(vec2 co, float seed, float vScale) {
return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);
}
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;
gl_FragColor = color;
}`,mainParameter:"noise",noise:0,applyTo2d:function(c){if(this.noise!==0){var h=c.imageData,p=h.data,m,d=p.length,g=this.noise,v;for(m=0,d=p.length;m<d;m+=4)v=(.5-Math.random())*g,p[m]+=v,p[m+1]+=v,p[m+2]+=v}},getUniformLocations:function(c,h){return{uNoise:c.getUniformLocation(h,"uNoise"),uSeed:c.getUniformLocation(h,"uSeed")}},sendUniformData:function(c,h){c.uniform1f(h.uNoise,this.noise/255),c.uniform1f(h.uSeed,Math.random())},toObject:function(){return l(this.callSuper("toObject"),{noise:this.noise})}}),s.Image.filters.Noise.fromObject=s.Image.filters.BaseFilter.fromObject}(n),function(o){var s=o.fabric||(o.fabric={}),l=s.Image.filters,u=s.util.createClass;l.Pixelate=u(l.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBlocksize;
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
float blockW = uBlocksize * uStepW;
float blockH = uBlocksize * uStepW;
int posX = int(vTexCoord.x / blockW);
int posY = int(vTexCoord.y / blockH);
float fposX = float(posX);
float fposY = float(posY);
vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);
vec4 color = texture2D(uTexture, squareCoords);
gl_FragColor = color;
}`,applyTo2d:function(A){var c=A.imageData,h=c.data,p=c.height,m=c.width,d,g,v,w,_,y,C,b,S,B,M;for(g=0;g<p;g+=this.blocksize)for(v=0;v<m;v+=this.blocksize)for(d=g*4*m+v*4,w=h[d],_=h[d+1],y=h[d+2],C=h[d+3],B=Math.min(g+this.blocksize,p),M=Math.min(v+this.blocksize,m),b=g;b<B;b++)for(S=v;S<M;S++)d=b*4*m+S*4,h[d]=w,h[d+1]=_,h[d+2]=y,h[d+3]=C},isNeutralState:function(){return this.blocksize===1},getUniformLocations:function(A,c){return{uBlocksize:A.getUniformLocation(c,"uBlocksize"),uStepW:A.getUniformLocation(c,"uStepW"),uStepH:A.getUniformLocation(c,"uStepH")}},sendUniformData:function(A,c){A.uniform1f(c.uBlocksize,this.blocksize)}}),s.Image.filters.Pixelate.fromObject=s.Image.filters.BaseFilter.fromObject}(n),function(o){var s=o.fabric||(o.fabric={}),l=s.util.object.extend,u=s.Image.filters,A=s.util.createClass;u.RemoveColor=A(u.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uLow;
uniform vec4 uHigh;
varying vec2 vTexCoord;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {
gl_FragColor.a = 0.0;
}
}`,distance:.02,useAlpha:!1,applyTo2d:function(c){var h=c.imageData,p=h.data,m,d=this.distance*255,g,v,w,_=new s.Color(this.color).getSource(),y=[_[0]-d,_[1]-d,_[2]-d],C=[_[0]+d,_[1]+d,_[2]+d];for(m=0;m<p.length;m+=4)g=p[m],v=p[m+1],w=p[m+2],g>y[0]&&v>y[1]&&w>y[2]&&g<C[0]&&v<C[1]&&w<C[2]&&(p[m+3]=0)},getUniformLocations:function(c,h){return{uLow:c.getUniformLocation(h,"uLow"),uHigh:c.getUniformLocation(h,"uHigh")}},sendUniformData:function(c,h){var p=new s.Color(this.color).getSource(),m=parseFloat(this.distance),d=[0+p[0]/255-m,0+p[1]/255-m,0+p[2]/255-m,1],g=[p[0]/255+m,p[1]/255+m,p[2]/255+m,1];c.uniform4fv(h.uLow,d),c.uniform4fv(h.uHigh,g)},toObject:function(){return l(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),s.Image.filters.RemoveColor.fromObject=s.Image.filters.BaseFilter.fromObject}(n),function(o){var s=o.fabric||(o.fabric={}),l=s.Image.filters,u=s.util.createClass,A={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var c in A)l[c]=u(l.ColorMatrix,{type:c,matrix:A[c],mainParameter:!1,colorsOnly:!0}),s.Image.filters[c].fromObject=s.Image.filters.BaseFilter.fromObject}(n),function(o){var s=o.fabric,l=s.Image.filters,u=s.util.createClass;l.BlendColor=u(l.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:`gl_FragColor.rgb *= uColor.rgb;
`,screen:`gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);
`,add:`gl_FragColor.rgb += uColor.rgb;
`,diff:`gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);
`,subtract:`gl_FragColor.rgb -= uColor.rgb;
`,lighten:`gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);
`,darken:`gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);
`,exclusion:`gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);
`,overlay:`if (uColor.r < 0.5) {
gl_FragColor.r *= 2.0 * uColor.r;
} else {
gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);
}
if (uColor.g < 0.5) {
gl_FragColor.g *= 2.0 * uColor.g;
} else {
gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);
}
if (uColor.b < 0.5) {
gl_FragColor.b *= 2.0 * uColor.b;
} else {
gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);
}
`,tint:`gl_FragColor.rgb *= (1.0 - uColor.a);
gl_FragColor.rgb += uColor.rgb;
`},buildSource:function(A){return`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uColor;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
gl_FragColor = color;
if (color.a > 0.0) {
`+this.fragmentSource[A]+`}
}`},retrieveShader:function(A){var c=this.type+"_"+this.mode,h;return A.programCache.hasOwnProperty(c)||(h=this.buildSource(this.mode),A.programCache[c]=this.createProgram(A.context,h)),A.programCache[c]},applyTo2d:function(A){var c=A.imageData,h=c.data,p=h.length,m,d,g,v,w,_,y,C=1-this.alpha;y=new s.Color(this.color).getSource(),m=y[0]*this.alpha,d=y[1]*this.alpha,g=y[2]*this.alpha;for(var b=0;b<p;b+=4)switch(v=h[b],w=h[b+1],_=h[b+2],this.mode){case"multiply":h[b]=v*m/255,h[b+1]=w*d/255,h[b+2]=_*g/255;break;case"screen":h[b]=255-(255-v)*(255-m)/255,h[b+1]=255-(255-w)*(255-d)/255,h[b+2]=255-(255-_)*(255-g)/255;break;case"add":h[b]=v+m,h[b+1]=w+d,h[b+2]=_+g;break;case"diff":case"difference":h[b]=Math.abs(v-m),h[b+1]=Math.abs(w-d),h[b+2]=Math.abs(_-g);break;case"subtract":h[b]=v-m,h[b+1]=w-d,h[b+2]=_-g;break;case"darken":h[b]=Math.min(v,m),h[b+1]=Math.min(w,d),h[b+2]=Math.min(_,g);break;case"lighten":h[b]=Math.max(v,m),h[b+1]=Math.max(w,d),h[b+2]=Math.max(_,g);break;case"overlay":h[b]=m<128?2*v*m/255:255-2*(255-v)*(255-m)/255,h[b+1]=d<128?2*w*d/255:255-2*(255-w)*(255-d)/255,h[b+2]=g<128?2*_*g/255:255-2*(255-_)*(255-g)/255;break;case"exclusion":h[b]=m+v-2*m*v/255,h[b+1]=d+w-2*d*w/255,h[b+2]=g+_-2*g*_/255;break;case"tint":h[b]=m+v*C,h[b+1]=d+w*C,h[b+2]=g+_*C}},getUniformLocations:function(A,c){return{uColor:A.getUniformLocation(c,"uColor")}},sendUniformData:function(A,c){var h=new s.Color(this.color).getSource();h[0]=this.alpha*h[0]/255,h[1]=this.alpha*h[1]/255,h[2]=this.alpha*h[2]/255,h[3]=this.alpha,A.uniform4fv(c.uColor,h)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),s.Image.filters.BlendColor.fromObject=s.Image.filters.BaseFilter.fromObject}(n),function(o){var s=o.fabric,l=s.Image.filters,u=s.util.createClass;l.BlendImage=u(l.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
uniform mat3 uTransformMatrix;
void main() {
vTexCoord = aPosition;
vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:{multiply:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.rgba *= color2.rgba;
gl_FragColor = color;
}`,mask:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.a = color2.a;
gl_FragColor = color;
}`},retrieveShader:function(A){var c=this.type+"_"+this.mode,h=this.fragmentSource[this.mode];return A.programCache.hasOwnProperty(c)||(A.programCache[c]=this.createProgram(A.context,h)),A.programCache[c]},applyToWebGL:function(A){var c=A.context,h=this.createTexture(A.filterBackend,this.image);this.bindAdditionalTexture(c,h,c.TEXTURE1),this.callSuper("applyToWebGL",A),this.unbindAdditionalTexture(c,c.TEXTURE1)},createTexture:function(A,c){return A.getCachedTexture(c.cacheKey,c._element)},calculateMatrix:function(){var A=this.image,c=A._element.width,h=A._element.height;return[1/A.scaleX,0,0,0,1/A.scaleY,0,-A.left/c,-A.top/h,1]},applyTo2d:function(A){var c=A.imageData,h=A.filterBackend.resources,p=c.data,m=p.length,d=c.width,g=c.height,v,w,_,y,C,b,S,B,M,z,G=this.image,P;h.blendImage||(h.blendImage=s.util.createCanvasElement()),M=h.blendImage,z=M.getContext("2d"),M.width!==d||M.height!==g?(M.width=d,M.height=g):z.clearRect(0,0,d,g),z.setTransform(G.scaleX,0,0,G.scaleY,G.left,G.top),z.drawImage(G._element,0,0,d,g),P=z.getImageData(0,0,d,g).data;for(var R=0;R<m;R+=4)switch(C=p[R],b=p[R+1],S=p[R+2],B=p[R+3],v=P[R],w=P[R+1],_=P[R+2],y=P[R+3],this.mode){case"multiply":p[R]=C*v/255,p[R+1]=b*w/255,p[R+2]=S*_/255,p[R+3]=B*y/255;break;case"mask":p[R+3]=y;break}},getUniformLocations:function(A,c){return{uTransformMatrix:A.getUniformLocation(c,"uTransformMatrix"),uImage:A.getUniformLocation(c,"uImage")}},sendUniformData:function(A,c){var h=this.calculateMatrix();A.uniform1i(c.uImage,1),A.uniformMatrix3fv(c.uTransformMatrix,!1,h)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),s.Image.filters.BlendImage.fromObject=function(A,c){s.Image.fromObject(A.image,function(h){var p=s.util.object.clone(A);p.image=h,c(new s.Image.filters.BlendImage(p))})}}(n),function(o){var s=o.fabric||(o.fabric={}),l=Math.pow,u=Math.floor,A=Math.sqrt,c=Math.abs,h=Math.round,p=Math.sin,m=Math.ceil,d=s.Image.filters,g=s.util.createClass;d.Resize=g(d.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(v,w){return{uDelta:v.getUniformLocation(w,"uDelta"),uTaps:v.getUniformLocation(w,"uTaps")}},sendUniformData:function(v,w){v.uniform2fv(w.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),v.uniform1fv(w.uTaps,this.taps)},retrieveShader:function(v){var w=this.getFilterWindow(),_=this.type+"_"+w;if(!v.programCache.hasOwnProperty(_)){var y=this.generateShader(w);v.programCache[_]=this.createProgram(v.context,y)}return v.programCache[_]},getFilterWindow:function(){var v=this.tempScale;return Math.ceil(this.lanczosLobes/v)},getTaps:function(){for(var v=this.lanczosCreate(this.lanczosLobes),w=this.tempScale,_=this.getFilterWindow(),y=new Array(_),C=1;C<=_;C++)y[C-1]=v(C*w);return y},generateShader:function(y){for(var w=new Array(y),_=this.fragmentSourceTOP,y,C=1;C<=y;C++)w[C-1]=C+".0 * uDelta";return _+="uniform float uTaps["+y+`];
`,_+=`void main() {
`,_+=`  vec4 color = texture2D(uTexture, vTexCoord);
`,_+=`  float sum = 1.0;
`,w.forEach(function(b,S){_+="  color += texture2D(uTexture, vTexCoord + "+b+") * uTaps["+S+`];
`,_+="  color += texture2D(uTexture, vTexCoord - "+b+") * uTaps["+S+`];
`,_+="  sum += 2.0 * uTaps["+S+`];
`}),_+=`  gl_FragColor = color / sum;
`,_+="}",_},fragmentSourceTOP:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
`,applyTo:function(v){v.webgl?(v.passes++,this.width=v.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=v.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),v.destinationWidth=this.dW,this._setupFrameBuffer(v),this.applyToWebGL(v),this._swapTextures(v),v.sourceWidth=v.destinationWidth,this.height=v.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),v.destinationHeight=this.dH,this._setupFrameBuffer(v),this.applyToWebGL(v),this._swapTextures(v),v.sourceHeight=v.destinationHeight):this.applyTo2d(v)},isNeutralState:function(){return this.scaleX===1&&this.scaleY===1},lanczosCreate:function(v){return function(w){if(w>=v||w<=-v)return 0;if(w<11920929e-14&&w>-11920929e-14)return 1;w*=Math.PI;var _=w/v;return p(w)/w*p(_)/_}},applyTo2d:function(v){var w=v.imageData,_=this.scaleX,y=this.scaleY;this.rcpScaleX=1/_,this.rcpScaleY=1/y;var C=w.width,b=w.height,S=h(C*_),B=h(b*y),M;this.resizeType==="sliceHack"?M=this.sliceByTwo(v,C,b,S,B):this.resizeType==="hermite"?M=this.hermiteFastResize(v,C,b,S,B):this.resizeType==="bilinear"?M=this.bilinearFiltering(v,C,b,S,B):this.resizeType==="lanczos"&&(M=this.lanczosResize(v,C,b,S,B)),v.imageData=M},sliceByTwo:function(v,w,_,y,C){var b=v.imageData,S=.5,B=!1,M=!1,z=w*S,G=_*S,P=s.filterBackend.resources,R,W,K=0,tt=0,j=w,E=0;for(P.sliceByTwo||(P.sliceByTwo=document.createElement("canvas")),R=P.sliceByTwo,(R.width<w*1.5||R.height<_)&&(R.width=w*1.5,R.height=_),W=R.getContext("2d"),W.clearRect(0,0,w*1.5,_),W.putImageData(b,0,0),y=u(y),C=u(C);!B||!M;)w=z,_=G,y<u(z*S)?z=u(z*S):(z=y,B=!0),C<u(G*S)?G=u(G*S):(G=C,M=!0),W.drawImage(R,K,tt,w,_,j,E,z,G),K=j,tt=E,E+=G;return W.getImageData(K,tt,y,C)},lanczosResize:function(v,w,_,y,C){function b(Q){var D,k,U,T,V,O,et,q,J,st,gt;for(E.x=(Q+.5)*G,I.x=u(E.x),D=0;D<C;D++){for(E.y=(D+.5)*P,I.y=u(E.y),V=0,O=0,et=0,q=0,J=0,k=I.x-K;k<=I.x+K;k++)if(!(k<0||k>=w)){st=u(1e3*c(k-E.x)),j[st]||(j[st]={});for(var Y=I.y-tt;Y<=I.y+tt;Y++)Y<0||Y>=_||(gt=u(1e3*c(Y-E.y)),j[st][gt]||(j[st][gt]=z(A(l(st*R,2)+l(gt*W,2))/1e3)),U=j[st][gt],U>0&&(T=(Y*w+k)*4,V+=U,O+=U*S[T],et+=U*S[T+1],q+=U*S[T+2],J+=U*S[T+3]))}T=(D*y+Q)*4,M[T]=O/V,M[T+1]=et/V,M[T+2]=q/V,M[T+3]=J/V}return++Q<y?b(Q):B}var S=v.imageData.data,B=v.ctx.createImageData(y,C),M=B.data,z=this.lanczosCreate(this.lanczosLobes),G=this.rcpScaleX,P=this.rcpScaleY,R=2/this.rcpScaleX,W=2/this.rcpScaleY,K=m(G*this.lanczosLobes/2),tt=m(P*this.lanczosLobes/2),j={},E={},I={};return b(0)},bilinearFiltering:function(v,w,_,y,C){var b,S,B,M,z,G,P,R,W,K,tt,j,E=0,I,Q=this.rcpScaleX,D=this.rcpScaleY,k=4*(w-1),U=v.imageData,T=U.data,V=v.ctx.createImageData(y,C),O=V.data;for(P=0;P<C;P++)for(R=0;R<y;R++)for(z=u(Q*R),G=u(D*P),W=Q*R-z,K=D*P-G,I=4*(G*w+z),tt=0;tt<4;tt++)b=T[I+tt],S=T[I+4+tt],B=T[I+k+tt],M=T[I+k+4+tt],j=b*(1-W)*(1-K)+S*W*(1-K)+B*K*(1-W)+M*W*K,O[E++]=j;return V},hermiteFastResize:function(v,w,_,y,C){for(var b=this.rcpScaleX,S=this.rcpScaleY,B=m(b/2),M=m(S/2),z=v.imageData,G=z.data,P=v.ctx.createImageData(y,C),R=P.data,W=0;W<C;W++)for(var K=0;K<y;K++){for(var tt=(K+W*y)*4,j=0,E=0,I=0,Q=0,D=0,k=0,U=0,T=(W+.5)*S,V=u(W*S);V<(W+1)*S;V++)for(var O=c(T-(V+.5))/M,et=(K+.5)*b,q=O*O,J=u(K*b);J<(K+1)*b;J++){var st=c(et-(J+.5))/B,gt=A(q+st*st);gt>1&&gt<-1||(j=2*gt*gt*gt-3*gt*gt+1,j>0&&(st=4*(J+V*w),U+=j*G[st+3],I+=j,G[st+3]<255&&(j=j*G[st+3]/250),Q+=j*G[st],D+=j*G[st+1],k+=j*G[st+2],E+=j))}R[tt]=Q/E,R[tt+1]=D/E,R[tt+2]=k/E,R[tt+3]=U/I}return P},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),s.Image.filters.Resize.fromObject=s.Image.filters.BaseFilter.fromObject}(n),function(o){var s=o.fabric||(o.fabric={}),l=s.Image.filters,u=s.util.createClass;l.Contrast=u(l.BaseFilter,{type:"Contrast",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uContrast;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));
color.rgb = contrastF * (color.rgb - 0.5) + 0.5;
gl_FragColor = color;
}`,contrast:0,mainParameter:"contrast",applyTo2d:function(A){if(this.contrast!==0){var c=A.imageData,h,m,p=c.data,m=p.length,d=Math.floor(this.contrast*255),g=259*(d+255)/(255*(259-d));for(h=0;h<m;h+=4)p[h]=g*(p[h]-128)+128,p[h+1]=g*(p[h+1]-128)+128,p[h+2]=g*(p[h+2]-128)+128}},getUniformLocations:function(A,c){return{uContrast:A.getUniformLocation(c,"uContrast")}},sendUniformData:function(A,c){A.uniform1f(c.uContrast,this.contrast)}}),s.Image.filters.Contrast.fromObject=s.Image.filters.BaseFilter.fromObject}(n),function(o){var s=o.fabric||(o.fabric={}),l=s.Image.filters,u=s.util.createClass;l.Saturation=u(l.BaseFilter,{type:"Saturation",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uSaturation;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float rgMax = max(color.r, color.g);
float rgbMax = max(rgMax, color.b);
color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;
color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;
color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;
gl_FragColor = color;
}`,saturation:0,mainParameter:"saturation",applyTo2d:function(A){if(this.saturation!==0){var c=A.imageData,h=c.data,p=h.length,m=-this.saturation,d,g;for(d=0;d<p;d+=4)g=Math.max(h[d],h[d+1],h[d+2]),h[d]+=g!==h[d]?(g-h[d])*m:0,h[d+1]+=g!==h[d+1]?(g-h[d+1])*m:0,h[d+2]+=g!==h[d+2]?(g-h[d+2])*m:0}},getUniformLocations:function(A,c){return{uSaturation:A.getUniformLocation(c,"uSaturation")}},sendUniformData:function(A,c){A.uniform1f(c.uSaturation,-this.saturation)}}),s.Image.filters.Saturation.fromObject=s.Image.filters.BaseFilter.fromObject}(n),function(o){var s=o.fabric||(o.fabric={}),l=s.Image.filters,u=s.util.createClass;l.Vibrance=u(l.BaseFilter,{type:"Vibrance",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uVibrance;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float max = max(color.r, max(color.g, color.b));
float avg = (color.r + color.g + color.b) / 3.0;
float amt = (abs(max - avg) * 2.0) * uVibrance;
color.r += max != color.r ? (max - color.r) * amt : 0.00;
color.g += max != color.g ? (max - color.g) * amt : 0.00;
color.b += max != color.b ? (max - color.b) * amt : 0.00;
gl_FragColor = color;
}`,vibrance:0,mainParameter:"vibrance",applyTo2d:function(A){if(this.vibrance!==0){var c=A.imageData,h=c.data,p=h.length,m=-this.vibrance,d,g,v,w;for(d=0;d<p;d+=4)g=Math.max(h[d],h[d+1],h[d+2]),v=(h[d]+h[d+1]+h[d+2])/3,w=Math.abs(g-v)*2/255*m,h[d]+=g!==h[d]?(g-h[d])*w:0,h[d+1]+=g!==h[d+1]?(g-h[d+1])*w:0,h[d+2]+=g!==h[d+2]?(g-h[d+2])*w:0}},getUniformLocations:function(A,c){return{uVibrance:A.getUniformLocation(c,"uVibrance")}},sendUniformData:function(A,c){A.uniform1f(c.uVibrance,-this.vibrance)}}),s.Image.filters.Vibrance.fromObject=s.Image.filters.BaseFilter.fromObject}(n),function(o){var s=o.fabric||(o.fabric={}),l=s.Image.filters,u=s.util.createClass;l.Blur=u(l.BaseFilter,{type:"Blur",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
const float nSamples = 15.0;
vec3 v3offset = vec3(12.9898, 78.233, 151.7182);
float random(vec3 scale) {
return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);
}
void main() {
vec4 color = vec4(0.0);
float total = 0.0;
float offset = random(v3offset);
for (float t = -nSamples; t <= nSamples; t++) {
float percent = (t + offset - 0.5) / nSamples;
float weight = 1.0 - abs(percent);
color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;
total += weight;
}
gl_FragColor = color / total;
}`,blur:0,mainParameter:"blur",applyTo:function(A){A.webgl?(this.aspectRatio=A.sourceWidth/A.sourceHeight,A.passes++,this._setupFrameBuffer(A),this.horizontal=!0,this.applyToWebGL(A),this._swapTextures(A),this._setupFrameBuffer(A),this.horizontal=!1,this.applyToWebGL(A),this._swapTextures(A)):this.applyTo2d(A)},applyTo2d:function(A){A.imageData=this.simpleBlur(A)},simpleBlur:function(A){var c=A.filterBackend.resources,h,p,m=A.imageData.width,d=A.imageData.height;c.blurLayer1||(c.blurLayer1=s.util.createCanvasElement(),c.blurLayer2=s.util.createCanvasElement()),h=c.blurLayer1,p=c.blurLayer2,(h.width!==m||h.height!==d)&&(p.width=h.width=m,p.height=h.height=d);var g=h.getContext("2d"),v=p.getContext("2d"),w=15,_,y,C,b,S=this.blur*.06*.5;for(g.putImageData(A.imageData,0,0),v.clearRect(0,0,m,d),b=-w;b<=w;b++)_=(Math.random()-.5)/4,y=b/w,C=S*y*m+_,v.globalAlpha=1-Math.abs(y),v.drawImage(h,C,_),g.drawImage(p,0,0),v.globalAlpha=1,v.clearRect(0,0,p.width,p.height);for(b=-w;b<=w;b++)_=(Math.random()-.5)/4,y=b/w,C=S*y*d+_,v.globalAlpha=1-Math.abs(y),v.drawImage(h,_,C),g.drawImage(p,0,0),v.globalAlpha=1,v.clearRect(0,0,p.width,p.height);A.ctx.drawImage(h,0,0);var B=A.ctx.getImageData(0,0,h.width,h.height);return g.globalAlpha=1,g.clearRect(0,0,h.width,h.height),B},getUniformLocations:function(A,c){return{delta:A.getUniformLocation(c,"uDelta")}},sendUniformData:function(A,c){var h=this.chooseRightDelta();A.uniform2fv(c.delta,h)},chooseRightDelta:function(){var A=1,c=[0,0],h;return this.horizontal?this.aspectRatio>1&&(A=1/this.aspectRatio):this.aspectRatio<1&&(A=this.aspectRatio),h=A*this.blur*.12,this.horizontal?c[0]=h:c[1]=h,c}}),l.Blur.fromObject=s.Image.filters.BaseFilter.fromObject}(n),function(o){var s=o.fabric||(o.fabric={}),l=s.Image.filters,u=s.util.createClass;l.Gamma=u(l.BaseFilter,{type:"Gamma",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec3 uGamma;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec3 correction = (1.0 / uGamma);
color.r = pow(color.r, correction.r);
color.g = pow(color.g, correction.g);
color.b = pow(color.b, correction.b);
gl_FragColor = color;
gl_FragColor.rgb *= color.a;
}`,gamma:[1,1,1],mainParameter:"gamma",initialize:function(A){this.gamma=[1,1,1],l.BaseFilter.prototype.initialize.call(this,A)},applyTo2d:function(A){var c=A.imageData,h=c.data,p=this.gamma,m=h.length,d=1/p[0],g=1/p[1],v=1/p[2],w;for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),w=0,m=256;w<m;w++)this.rVals[w]=Math.pow(w/255,d)*255,this.gVals[w]=Math.pow(w/255,g)*255,this.bVals[w]=Math.pow(w/255,v)*255;for(w=0,m=h.length;w<m;w+=4)h[w]=this.rVals[h[w]],h[w+1]=this.gVals[h[w+1]],h[w+2]=this.bVals[h[w+2]]},getUniformLocations:function(A,c){return{uGamma:A.getUniformLocation(c,"uGamma")}},sendUniformData:function(A,c){A.uniform3fv(c.uGamma,this.gamma)}}),s.Image.filters.Gamma.fromObject=s.Image.filters.BaseFilter.fromObject}(n),function(o){var s=o.fabric||(o.fabric={}),l=s.Image.filters,u=s.util.createClass;l.Composed=u(l.BaseFilter,{type:"Composed",subFilters:[],initialize:function(A){this.callSuper("initialize",A),this.subFilters=this.subFilters.slice(0)},applyTo:function(A){A.passes+=this.subFilters.length-1,this.subFilters.forEach(function(c){c.applyTo(A)})},toObject:function(){return s.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(A){return A.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(A){return!A.isNeutralState()})}}),s.Image.filters.Composed.fromObject=function(A,c){var h=A.subFilters||[],p=h.map(function(d){return new s.Image.filters[d.type](d)}),m=new s.Image.filters.Composed({subFilters:p});return c&&c(m),m}}(n),function(o){var s=o.fabric||(o.fabric={}),l=s.Image.filters,u=s.util.createClass;l.HueRotation=u(l.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var A=this.rotation*Math.PI,c=s.util.cos(A),h=s.util.sin(A),p=1/3,m=Math.sqrt(p)*h,d=1-c;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=c+d/3,this.matrix[1]=p*d-m,this.matrix[2]=p*d+m,this.matrix[5]=p*d+m,this.matrix[6]=c+p*d,this.matrix[7]=p*d-m,this.matrix[10]=p*d-m,this.matrix[11]=p*d+m,this.matrix[12]=c+p*d},isNeutralState:function(A){return this.calculateMatrix(),l.BaseFilter.prototype.isNeutralState.call(this,A)},applyTo:function(A){this.calculateMatrix(),l.BaseFilter.prototype.applyTo.call(this,A)}}),s.Image.filters.HueRotation.fromObject=s.Image.filters.BaseFilter.fromObject}(n),function(o){var s=o.fabric||(o.fabric={}),l=s.util.object.clone;if(s.Text){s.warn("fabric.Text is already defined");return}var u="fontFamily fontWeight fontSize text underline overline linethrough textAlign fontStyle lineHeight textBackgroundColor charSpacing styles direction path pathStartOffset pathSide pathAlign".split(" ");s.Text=s.util.createClass(s.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:s.Object.prototype.stateProperties.concat(u),cacheProperties:s.Object.prototype.cacheProperties.concat(u),stroke:null,shadow:null,path:null,pathStartOffset:0,pathSide:"left",pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,direction:"ltr",_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(A,c){this.styles=c?c.styles||{}:{},this.text=A,this.__skipDimension=!0,this.callSuper("initialize",c),this.path&&this.setPathInfo(),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},setPathInfo:function(){var A=this.path;A&&(A.segmentsInfo=s.util.getPathSegmentsInfo(A.path))},getMeasuringContext:function(){return s._measuringContext||(s._measuringContext=this.canvas&&this.canvas.contextCache||s.util.createCanvasElement().getContext("2d")),s._measuringContext},_splitText:function(){var A=this._splitTextIntoLines(this.text);return this.textLines=A.lines,this._textLines=A.graphemeLines,this._unwrappedTextLines=A._unwrappedLines,this._text=A.graphemeText,A},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var A,c,h,p,m,d,g,v=0,w=this._textLines.length;v<w;v++)if(!(this.textAlign!=="justify"&&(v===w-1||this.isEndOfWrapping(v)))&&(p=0,m=this._textLines[v],c=this.getLineWidth(v),c<this.width&&(g=this.textLines[v].match(this._reSpacesAndTabs)))){h=g.length,A=(this.width-c)/h;for(var _=0,y=m.length;_<=y;_++)d=this.__charBounds[v][_],this._reSpaceAndTab.test(m[_])?(d.width+=A,d.kernedWidth+=A,d.left+=p,p+=A):d.left+=p}},isEndOfWrapping:function(A){return A===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var A=this.callSuper("_getCacheCanvasDimensions"),c=this.fontSize;return A.width+=c*A.zoomX,A.height+=c*A.zoomY,A},_render:function(A){var c=this.path;c&&!c.isNotVisible()&&c._render(A),this._setTextStyles(A),this._renderTextLinesBackground(A),this._renderTextDecoration(A,"underline"),this._renderText(A),this._renderTextDecoration(A,"overline"),this._renderTextDecoration(A,"linethrough")},_renderText:function(A){this.paintFirst==="stroke"?(this._renderTextStroke(A),this._renderTextFill(A)):(this._renderTextFill(A),this._renderTextStroke(A))},_setTextStyles:function(A,c,h){if(A.textBaseline="alphabetical",this.path)switch(this.pathAlign){case"center":A.textBaseline="middle";break;case"ascender":A.textBaseline="top";break;case"descender":A.textBaseline="bottom";break}A.font=this._getFontDeclaration(c,h)},calcTextWidth:function(){for(var A=this.getLineWidth(0),c=1,h=this._textLines.length;c<h;c++){var p=this.getLineWidth(c);p>A&&(A=p)}return A},_renderTextLine:function(A,c,h,p,m,d){this._renderChars(A,c,h,p,m,d)},_renderTextLinesBackground:function(A){if(!(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor"))){for(var c,h,p=A.fillStyle,m,d,g=this._getLeftOffset(),v=this._getTopOffset(),w=0,_=0,y,C,b=this.path,S,B=0,M=this._textLines.length;B<M;B++){if(c=this.getHeightOfLine(B),!this.textBackgroundColor&&!this.styleHas("textBackgroundColor",B)){v+=c;continue}m=this._textLines[B],h=this._getLineLeftOffset(B),_=0,w=0,d=this.getValueOfPropertyAt(B,0,"textBackgroundColor");for(var z=0,G=m.length;z<G;z++)y=this.__charBounds[B][z],C=this.getValueOfPropertyAt(B,z,"textBackgroundColor"),b?(A.save(),A.translate(y.renderLeft,y.renderTop),A.rotate(y.angle),A.fillStyle=C,C&&A.fillRect(-y.width/2,-c/this.lineHeight*(1-this._fontSizeFraction),y.width,c/this.lineHeight),A.restore()):C!==d?(S=g+h+w,this.direction==="rtl"&&(S=this.width-S-_),A.fillStyle=d,d&&A.fillRect(S,v,_,c/this.lineHeight),w=y.left,_=y.width,d=C):_+=y.kernedWidth;C&&!b&&(S=g+h+w,this.direction==="rtl"&&(S=this.width-S-_),A.fillStyle=C,A.fillRect(S,v,_,c/this.lineHeight)),v+=c}A.fillStyle=p,this._removeShadow(A)}},getFontCache:function(A){var c=A.fontFamily.toLowerCase();s.charWidthsCache[c]||(s.charWidthsCache[c]={});var h=s.charWidthsCache[c],p=A.fontStyle.toLowerCase()+"_"+(A.fontWeight+"").toLowerCase();return h[p]||(h[p]={}),h[p]},_measureChar:function(A,c,h,p){var m=this.getFontCache(c),d=this._getFontDeclaration(c),g=this._getFontDeclaration(p),v=h+A,w=d===g,_,y,C,b=c.fontSize/this.CACHE_FONT_SIZE,S;if(h&&m[h]!==void 0&&(C=m[h]),m[A]!==void 0&&(S=_=m[A]),w&&m[v]!==void 0&&(y=m[v],S=y-C),_===void 0||C===void 0||y===void 0){var B=this.getMeasuringContext();this._setTextStyles(B,c,!0)}return _===void 0&&(S=_=B.measureText(A).width,m[A]=_),C===void 0&&w&&h&&(C=B.measureText(h).width,m[h]=C),w&&y===void 0&&(y=B.measureText(v).width,m[v]=y,S=y-C),{width:_*b,kernedWidth:S*b}},getHeightOfChar:function(A,c){return this.getValueOfPropertyAt(A,c,"fontSize")},measureLine:function(A){var c=this._measureLine(A);return this.charSpacing!==0&&(c.width-=this._getWidthOfCharSpacing()),c.width<0&&(c.width=0),c},_measureLine:function(A){var c=0,h,p,m=this._textLines[A],d,g,v=0,w=new Array(m.length),_=0,y,C,b=this.path,S=this.pathSide==="right";for(this.__charBounds[A]=w,h=0;h<m.length;h++)p=m[h],g=this._getGraphemeBox(p,A,h,d),w[h]=g,c+=g.kernedWidth,d=p;if(w[h]={left:g?g.left+g.width:0,width:0,kernedWidth:0,height:this.fontSize},b){switch(C=b.segmentsInfo[b.segmentsInfo.length-1].length,y=s.util.getPointOnPath(b.path,0,b.segmentsInfo),y.x+=b.pathOffset.x,y.y+=b.pathOffset.y,this.textAlign){case"left":_=S?C-c:0;break;case"center":_=(C-c)/2;break;case"right":_=S?0:C-c;break}for(_+=this.pathStartOffset*(S?-1:1),h=S?m.length-1:0;S?h>=0:h<m.length;S?h--:h++)g=w[h],_>C?_%=C:_<0&&(_+=C),this._setGraphemeOnPath(_,g,y),_+=g.kernedWidth}return{width:c,numOfSpaces:v}},_setGraphemeOnPath:function(A,c,h){var p=A+c.kernedWidth/2,m=this.path,d=s.util.getPointOnPath(m.path,p,m.segmentsInfo);c.renderLeft=d.x-h.x,c.renderTop=d.y-h.y,c.angle=d.angle+(this.pathSide==="right"?Math.PI:0)},_getGraphemeBox:function(A,c,h,p,m){var d=this.getCompleteStyleDeclaration(c,h),g=p?this.getCompleteStyleDeclaration(c,h-1):{},v=this._measureChar(A,d,p,g),w=v.kernedWidth,_=v.width,y;this.charSpacing!==0&&(y=this._getWidthOfCharSpacing(),_+=y,w+=y);var C={width:_,left:0,height:d.fontSize,kernedWidth:w,deltaY:d.deltaY};if(h>0&&!m){var b=this.__charBounds[c][h-1];C.left=b.left+b.width+v.kernedWidth-v.width}return C},getHeightOfLine:function(A){if(this.__lineHeights[A])return this.__lineHeights[A];for(var c=this._textLines[A],h=this.getHeightOfChar(A,0),p=1,m=c.length;p<m;p++)h=Math.max(this.getHeightOfChar(A,p),h);return this.__lineHeights[A]=h*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var A,c=0,h=0,p=this._textLines.length;h<p;h++)A=this.getHeightOfLine(h),c+=h===p-1?A/this.lineHeight:A;return c},_getLeftOffset:function(){return this.direction==="ltr"?-this.width/2:this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(A,c){A.save();for(var h=0,p=this._getLeftOffset(),m=this._getTopOffset(),d=0,g=this._textLines.length;d<g;d++){var v=this.getHeightOfLine(d),w=v/this.lineHeight,_=this._getLineLeftOffset(d);this._renderTextLine(c,A,this._textLines[d],p+_,m+h+w,d),h+=v}A.restore()},_renderTextFill:function(A){!this.fill&&!this.styleHas("fill")||this._renderTextCommon(A,"fillText")},_renderTextStroke:function(A){(!this.stroke||this.strokeWidth===0)&&this.isEmptyStyles()||(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(A),A.save(),this._setLineDash(A,this.strokeDashArray),A.beginPath(),this._renderTextCommon(A,"strokeText"),A.closePath(),A.restore())},_renderChars:function(A,c,h,p,m,d){var g=this.getHeightOfLine(d),v=this.textAlign.indexOf("justify")!==-1,w,_,y="",C,b=0,S,B=this.path,M=!v&&this.charSpacing===0&&this.isEmptyStyles(d)&&!B,z=this.direction==="ltr",G=this.direction==="ltr"?1:-1,P,R=c.canvas.getAttribute("dir");if(c.save(),R!==this.direction&&(c.canvas.setAttribute("dir",z?"ltr":"rtl"),c.direction=z?"ltr":"rtl",c.textAlign=z?"left":"right"),m-=g*this._fontSizeFraction/this.lineHeight,M){this._renderChar(A,c,d,0,h.join(""),p,m,g),c.restore();return}for(var W=0,K=h.length-1;W<=K;W++)S=W===K||this.charSpacing||B,y+=h[W],C=this.__charBounds[d][W],b===0?(p+=G*(C.kernedWidth-C.width),b+=C.width):b+=C.kernedWidth,v&&!S&&this._reSpaceAndTab.test(h[W])&&(S=!0),S||(w=w||this.getCompleteStyleDeclaration(d,W),_=this.getCompleteStyleDeclaration(d,W+1),S=s.util.hasStyleChanged(w,_,!1)),S&&(B?(c.save(),c.translate(C.renderLeft,C.renderTop),c.rotate(C.angle),this._renderChar(A,c,d,W,y,-b/2,0,g),c.restore()):(P=p,this._renderChar(A,c,d,W,y,P,m,g)),y="",w=_,p+=G*b,b=0);c.restore()},_applyPatternGradientTransformText:function(A){var c=s.util.createCanvasElement(),h,p=this.width+this.strokeWidth,m=this.height+this.strokeWidth;return c.width=p,c.height=m,h=c.getContext("2d"),h.beginPath(),h.moveTo(0,0),h.lineTo(p,0),h.lineTo(p,m),h.lineTo(0,m),h.closePath(),h.translate(p/2,m/2),h.fillStyle=A.toLive(h),this._applyPatternGradientTransform(h,A),h.fill(),h.createPattern(c,"no-repeat")},handleFiller:function(A,c,h){var p,m;return h.toLive?h.gradientUnits==="percentage"||h.gradientTransform||h.patternTransform?(p=-this.width/2,m=-this.height/2,A.translate(p,m),A[c]=this._applyPatternGradientTransformText(h),{offsetX:p,offsetY:m}):(A[c]=h.toLive(A,this),this._applyPatternGradientTransform(A,h)):(A[c]=h,{offsetX:0,offsetY:0})},_setStrokeStyles:function(A,c){return A.lineWidth=c.strokeWidth,A.lineCap=this.strokeLineCap,A.lineDashOffset=this.strokeDashOffset,A.lineJoin=this.strokeLineJoin,A.miterLimit=this.strokeMiterLimit,this.handleFiller(A,"strokeStyle",c.stroke)},_setFillStyles:function(A,c){return this.handleFiller(A,"fillStyle",c.fill)},_renderChar:function(A,c,h,p,m,d,g){var v=this._getStyleDeclaration(h,p),w=this.getCompleteStyleDeclaration(h,p),_=A==="fillText"&&w.fill,y=A==="strokeText"&&w.stroke&&w.strokeWidth,C,b;!y&&!_||(c.save(),_&&(C=this._setFillStyles(c,w)),y&&(b=this._setStrokeStyles(c,w)),c.font=this._getFontDeclaration(w),v&&v.textBackgroundColor&&this._removeShadow(c),v&&v.deltaY&&(g+=v.deltaY),_&&c.fillText(m,d-C.offsetX,g-C.offsetY),y&&c.strokeText(m,d-b.offsetX,g-b.offsetY),c.restore())},setSuperscript:function(A,c){return this._setScript(A,c,this.superscript)},setSubscript:function(A,c){return this._setScript(A,c,this.subscript)},_setScript:function(A,c,h){var p=this.get2DCursorLocation(A,!0),m=this.getValueOfPropertyAt(p.lineIndex,p.charIndex,"fontSize"),d=this.getValueOfPropertyAt(p.lineIndex,p.charIndex,"deltaY"),g={fontSize:m*h.size,deltaY:d+m*h.baseline};return this.setSelectionStyles(g,A,c),this},_getLineLeftOffset:function(A){var c=this.getLineWidth(A),h=this.width-c,p=this.textAlign,m=this.direction,g,d=0,g=this.isEndOfWrapping(A);return p==="justify"||p==="justify-center"&&!g||p==="justify-right"&&!g||p==="justify-left"&&!g?0:(p==="center"&&(d=h/2),p==="right"&&(d=h),p==="justify-center"&&(d=h/2),p==="justify-right"&&(d=h),m==="rtl"&&(d-=h),d)},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var A=this._forceClearCache;return A||(A=this.hasStateChanged("_dimensionAffectingProps")),A&&(this.dirty=!0,this._forceClearCache=!1),A},getLineWidth:function(A){if(this.__lineWidths[A]!==void 0)return this.__lineWidths[A];var c=this.measureLine(A),h=c.width;return this.__lineWidths[A]=h,h},_getWidthOfCharSpacing:function(){return this.charSpacing!==0?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(A,c,h){var p=this._getStyleDeclaration(A,c);return p&&typeof p[h]<"u"?p[h]:this[h]},_renderTextDecoration:function(A,c){if(!(!this[c]&&!this.styleHas(c))){for(var h,p,m,d,g,v,w,_,y=this._getLeftOffset(),C=this._getTopOffset(),b,S,B,M,z,G,P,R,W=this.path,K=this._getWidthOfCharSpacing(),tt=this.offsets[c],j=0,E=this._textLines.length;j<E;j++){if(h=this.getHeightOfLine(j),!this[c]&&!this.styleHas(c,j)){C+=h;continue}w=this._textLines[j],G=h/this.lineHeight,d=this._getLineLeftOffset(j),S=0,B=0,_=this.getValueOfPropertyAt(j,0,c),R=this.getValueOfPropertyAt(j,0,"fill"),b=C+G*(1-this._fontSizeFraction),p=this.getHeightOfChar(j,0),g=this.getValueOfPropertyAt(j,0,"deltaY");for(var I=0,Q=w.length;I<Q;I++)if(M=this.__charBounds[j][I],z=this.getValueOfPropertyAt(j,I,c),P=this.getValueOfPropertyAt(j,I,"fill"),m=this.getHeightOfChar(j,I),v=this.getValueOfPropertyAt(j,I,"deltaY"),W&&z&&P)A.save(),A.fillStyle=R,A.translate(M.renderLeft,M.renderTop),A.rotate(M.angle),A.fillRect(-M.kernedWidth/2,tt*m+v,M.kernedWidth,this.fontSize/15),A.restore();else if((z!==_||P!==R||m!==p||v!==g)&&B>0){var D=y+d+S;this.direction==="rtl"&&(D=this.width-D-B),_&&R&&(A.fillStyle=R,A.fillRect(D,b+tt*p+g,B,this.fontSize/15)),S=M.left,B=M.width,_=z,R=P,p=m,g=v}else B+=M.kernedWidth;var D=y+d+S;this.direction==="rtl"&&(D=this.width-D-B),A.fillStyle=P,z&&P&&A.fillRect(D,b+tt*p+g,B-K,this.fontSize/15),C+=h}this._removeShadow(A)}},_getFontDeclaration:function(A,c){var h=A||this,p=this.fontFamily,m=s.Text.genericFonts.indexOf(p.toLowerCase())>-1,d=p===void 0||p.indexOf("'")>-1||p.indexOf(",")>-1||p.indexOf('"')>-1||m?h.fontFamily:'"'+h.fontFamily+'"';return[s.isLikelyNode?h.fontWeight:h.fontStyle,s.isLikelyNode?h.fontStyle:h.fontWeight,c?this.CACHE_FONT_SIZE+"px":h.fontSize+"px",d].join(" ")},render:function(A){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",A)))},_splitTextIntoLines:function(A){for(var c=A.split(this._reNewline),h=new Array(c.length),p=[`
`],m=[],d=0;d<c.length;d++)h[d]=s.util.string.graphemeSplit(c[d]),m=m.concat(h[d],p);return m.pop(),{_unwrappedLines:h,lines:c,graphemeText:m,graphemeLines:h}},toObject:function(A){var c=u.concat(A),h=this.callSuper("toObject",c);return h.styles=s.util.stylesToArray(this.styles,this.text),h.path&&(h.path=this.path.toObject()),h},set:function(A,c){this.callSuper("set",A,c);var h=!1,p=!1;if(typeof A=="object")for(var m in A)m==="path"&&this.setPathInfo(),h=h||this._dimensionAffectingProps.indexOf(m)!==-1,p=p||m==="path";else h=this._dimensionAffectingProps.indexOf(A)!==-1,p=A==="path";return p&&this.setPathInfo(),h&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),s.Text.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),s.Text.DEFAULT_SVG_FONT_SIZE=16,s.Text.fromElement=function(A,c,h){if(!A)return c(null);var p=s.parseAttributes(A,s.Text.ATTRIBUTE_NAMES),m=p.textAnchor||"left";if(h=s.util.object.extend(h?l(h):{},p),h.top=h.top||0,h.left=h.left||0,p.textDecoration){var d=p.textDecoration;d.indexOf("underline")!==-1&&(h.underline=!0),d.indexOf("overline")!==-1&&(h.overline=!0),d.indexOf("line-through")!==-1&&(h.linethrough=!0),delete h.textDecoration}"dx"in p&&(h.left+=p.dx),"dy"in p&&(h.top+=p.dy),"fontSize"in h||(h.fontSize=s.Text.DEFAULT_SVG_FONT_SIZE);var g="";"textContent"in A?g=A.textContent:"firstChild"in A&&A.firstChild!==null&&"data"in A.firstChild&&A.firstChild.data!==null&&(g=A.firstChild.data),g=g.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var v=h.strokeWidth;h.strokeWidth=0;var w=new s.Text(g,h),_=w.getScaledHeight()/w.height,y=(w.height+w.strokeWidth)*w.lineHeight-w.height,C=y*_,b=w.getScaledHeight()+C,S=0;m==="center"&&(S=w.getScaledWidth()/2),m==="right"&&(S=w.getScaledWidth()),w.set({left:w.left-S,top:w.top-(b-w.fontSize*(.07+w._fontSizeFraction))/w.lineHeight,strokeWidth:typeof v<"u"?v:1}),c(w)},s.Text.fromObject=function(A,c){var h=l(A),p=A.path;return delete h.path,s.Object._fromObject("Text",h,function(m){m.styles=s.util.stylesFromArray(A.styles,A.text),p?s.Object._fromObject("Path",p,function(d){m.set("path",d),c(m)},"path"):c(m)},"text")},s.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],s.util.createAccessors&&s.util.createAccessors(s.Text)}(n),function(){t.util.object.extend(t.Text.prototype,{isEmptyStyles:function(o){if(!this.styles||typeof o<"u"&&!this.styles[o])return!0;var s=typeof o>"u"?this.styles:{line:this.styles[o]};for(var l in s)for(var u in s[l])for(var A in s[l][u])return!1;return!0},styleHas:function(o,s){if(!this.styles||!o||o===""||typeof s<"u"&&!this.styles[s])return!1;var l=typeof s>"u"?this.styles:{0:this.styles[s]};for(var u in l)for(var A in l[u])if(typeof l[u][A][o]<"u")return!0;return!1},cleanStyle:function(o){if(!this.styles||!o||o==="")return!1;var s=this.styles,l=0,u,A,c=!0,h=0,p;for(var m in s){u=0;for(var d in s[m]){var p=s[m][d],g=p.hasOwnProperty(o);l++,g?(A?p[o]!==A&&(c=!1):A=p[o],p[o]===this[o]&&delete p[o]):c=!1,Object.keys(p).length!==0?u++:delete s[m][d]}u===0&&delete s[m]}for(var v=0;v<this._textLines.length;v++)h+=this._textLines[v].length;c&&l===h&&(this[o]=A,this.removeStyle(o))},removeStyle:function(o){if(!(!this.styles||!o||o==="")){var s=this.styles,l,u,A;for(u in s){l=s[u];for(A in l)delete l[A][o],Object.keys(l[A]).length===0&&delete l[A];Object.keys(l).length===0&&delete s[u]}}},_extendStyles:function(o,s){var l=this.get2DCursorLocation(o);this._getLineStyle(l.lineIndex)||this._setLineStyle(l.lineIndex),this._getStyleDeclaration(l.lineIndex,l.charIndex)||this._setStyleDeclaration(l.lineIndex,l.charIndex,{}),t.util.object.extend(this._getStyleDeclaration(l.lineIndex,l.charIndex),s)},get2DCursorLocation:function(o,s){typeof o>"u"&&(o=this.selectionStart);for(var l=s?this._unwrappedTextLines:this._textLines,u=l.length,A=0;A<u;A++){if(o<=l[A].length)return{lineIndex:A,charIndex:o};o-=l[A].length+this.missingNewlineOffset(A)}return{lineIndex:A-1,charIndex:l[A-1].length<o?l[A-1].length:o}},getSelectionStyles:function(o,s,l){typeof o>"u"&&(o=this.selectionStart||0),typeof s>"u"&&(s=this.selectionEnd||o);for(var u=[],A=o;A<s;A++)u.push(this.getStyleAtPosition(A,l));return u},getStyleAtPosition:function(o,s){var l=this.get2DCursorLocation(o),u=s?this.getCompleteStyleDeclaration(l.lineIndex,l.charIndex):this._getStyleDeclaration(l.lineIndex,l.charIndex);return u||{}},setSelectionStyles:function(o,s,l){typeof s>"u"&&(s=this.selectionStart||0),typeof l>"u"&&(l=this.selectionEnd||s);for(var u=s;u<l;u++)this._extendStyles(u,o);return this._forceClearCache=!0,this},_getStyleDeclaration:function(o,s){var l=this.styles&&this.styles[o];return l?l[s]:null},getCompleteStyleDeclaration:function(o,s){for(var l=this._getStyleDeclaration(o,s)||{},u={},A,c=0;c<this._styleProperties.length;c++)A=this._styleProperties[c],u[A]=typeof l[A]>"u"?this[A]:l[A];return u},_setStyleDeclaration:function(o,s,l){this.styles[o][s]=l},_deleteStyleDeclaration:function(o,s){delete this.styles[o][s]},_getLineStyle:function(o){return!!this.styles[o]},_setLineStyle:function(o){this.styles[o]={}},_deleteLineStyle:function(o){delete this.styles[o]}})}(),function(){function o(s){s.textDecoration&&(s.textDecoration.indexOf("underline")>-1&&(s.underline=!0),s.textDecoration.indexOf("line-through")>-1&&(s.linethrough=!0),s.textDecoration.indexOf("overline")>-1&&(s.overline=!0),delete s.textDecoration)}t.IText=t.util.createClass(t.Text,t.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(s,l){this.callSuper("initialize",s,l),this.initBehavior()},setSelectionStart:function(s){s=Math.max(s,0),this._updateAndFire("selectionStart",s)},setSelectionEnd:function(s){s=Math.min(s,this.text.length),this._updateAndFire("selectionEnd",s)},_updateAndFire:function(s,l){this[s]!==l&&(this._fireSelectionChanged(),this[s]=l),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(s){this.clearContextTop(),this.callSuper("render",s),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(s){this.callSuper("_render",s)},clearContextTop:function(s){if(!(!this.isEditing||!this.canvas||!this.canvas.contextTop)){var l=this.canvas.contextTop,u=this.canvas.viewportTransform;l.save(),l.transform(u[0],u[1],u[2],u[3],u[4],u[5]),this.transform(l),this._clearTextArea(l),s||l.restore()}},renderCursorOrSelection:function(){if(!(!this.isEditing||!this.canvas||!this.canvas.contextTop)){var s=this._getCursorBoundaries(),l=this.canvas.contextTop;this.clearContextTop(!0),this.selectionStart===this.selectionEnd?this.renderCursor(s,l):this.renderSelection(s,l),l.restore()}},_clearTextArea:function(s){var l=this.width+4,u=this.height+4;s.clearRect(-l/2,-u/2,l,u)},_getCursorBoundaries:function(s){typeof s>"u"&&(s=this.selectionStart);var l=this._getLeftOffset(),u=this._getTopOffset(),A=this._getCursorBoundariesOffsets(s);return{left:l,top:u,leftOffset:A.left,topOffset:A.top}},_getCursorBoundariesOffsets:function(s){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var l,u,A,c=0,h=0,p,m=this.get2DCursorLocation(s);A=m.charIndex,u=m.lineIndex;for(var d=0;d<u;d++)c+=this.getHeightOfLine(d);l=this._getLineLeftOffset(u);var g=this.__charBounds[u][A];return g&&(h=g.left),this.charSpacing!==0&&A===this._textLines[u].length&&(h-=this._getWidthOfCharSpacing()),p={top:c,left:l+(h>0?h:0)},this.direction==="rtl"&&(p.left*=-1),this.cursorOffsetCache=p,this.cursorOffsetCache},renderCursor:function(s,l){var u=this.get2DCursorLocation(),A=u.lineIndex,c=u.charIndex>0?u.charIndex-1:0,h=this.getValueOfPropertyAt(A,c,"fontSize"),p=this.scaleX*this.canvas.getZoom(),m=this.cursorWidth/p,d=s.topOffset,g=this.getValueOfPropertyAt(A,c,"deltaY");d+=(1-this._fontSizeFraction)*this.getHeightOfLine(A)/this.lineHeight-h*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(s,l),l.fillStyle=this.cursorColor||this.getValueOfPropertyAt(A,c,"fill"),l.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,l.fillRect(s.left+s.leftOffset-m/2,d+s.top+g,m,h)},renderSelection:function(s,l){for(var u=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,A=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,c=this.textAlign.indexOf("justify")!==-1,h=this.get2DCursorLocation(u),p=this.get2DCursorLocation(A),m=h.lineIndex,d=p.lineIndex,g=h.charIndex<0?0:h.charIndex,v=p.charIndex<0?0:p.charIndex,w=m;w<=d;w++){var _=this._getLineLeftOffset(w)||0,y=this.getHeightOfLine(w),C=0,b=0,S=0;if(w===m&&(b=this.__charBounds[m][g].left),w>=m&&w<d)S=c&&!this.isEndOfWrapping(w)?this.width:this.getLineWidth(w)||5;else if(w===d)if(v===0)S=this.__charBounds[d][v].left;else{var B=this._getWidthOfCharSpacing();S=this.__charBounds[d][v-1].left+this.__charBounds[d][v-1].width-B}C=y,(this.lineHeight<1||w===d&&this.lineHeight>1)&&(y/=this.lineHeight);var M=s.left+_+b,z=S-b,G=y,P=0;this.inCompositionMode?(l.fillStyle=this.compositionColor||"black",G=1,P=y):l.fillStyle=this.selectionColor,this.direction==="rtl"&&(M=this.width-M-z),l.fillRect(M,s.top+s.topOffset+P,z,G),s.topOffset+=C}},getCurrentCharFontSize:function(){var s=this._getCurrentCharIndex();return this.getValueOfPropertyAt(s.l,s.c,"fontSize")},getCurrentCharColor:function(){var s=this._getCurrentCharIndex();return this.getValueOfPropertyAt(s.l,s.c,"fill")},_getCurrentCharIndex:function(){var s=this.get2DCursorLocation(this.selectionStart,!0),l=s.charIndex>0?s.charIndex-1:0;return{l:s.lineIndex,c:l}}}),t.IText.fromObject=function(s,l){var u=t.util.stylesFromArray(s.styles,s.text),A=Object.assign({},s,{styles:u});if(o(A),A.styles)for(var c in A.styles)for(var h in A.styles[c])o(A.styles[c][h]);t.Object._fromObject("IText",A,l,"text")}}(),function(){var o=t.util.object.clone;t.util.object.extend(t.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var s=this;this.on("added",function(){var l=s.canvas;l&&(l._hasITextHandlers||(l._hasITextHandlers=!0,s._initCanvasHandlers(l)),l._iTextInstances=l._iTextInstances||[],l._iTextInstances.push(s))})},initRemovedHandler:function(){var s=this;this.on("removed",function(){var l=s.canvas;l&&(l._iTextInstances=l._iTextInstances||[],t.util.removeFromArray(l._iTextInstances,s),l._iTextInstances.length===0&&(l._hasITextHandlers=!1,s._removeCanvasHandlers(l)))})},_initCanvasHandlers:function(s){s._mouseUpITextHandler=function(){s._iTextInstances&&s._iTextInstances.forEach(function(l){l.__isMousedown=!1})},s.on("mouse:up",s._mouseUpITextHandler)},_removeCanvasHandlers:function(s){s.off("mouse:up",s._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(s,l,u,A){var c;return c={isAborted:!1,abort:function(){this.isAborted=!0}},s.animate("_currentCursorOpacity",l,{duration:u,onComplete:function(){c.isAborted||s[A]()},onChange:function(){s.canvas&&s.selectionStart===s.selectionEnd&&s.renderCursorOrSelection()},abort:function(){return c.isAborted}}),c},_onTickComplete:function(){var s=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){s._currentTickCompleteState=s._animateCursor(s,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(s){var l=this,u=s?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){l._tick()},u)},abortCursorAnimation:function(){var s=this._currentTickState||this._currentTickCompleteState,l=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,s&&l&&l.clearContext(l.contextTop||l.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(s){var l=0,u=s-1;if(this._reSpace.test(this._text[u]))for(;this._reSpace.test(this._text[u]);)l++,u--;for(;/\S/.test(this._text[u])&&u>-1;)l++,u--;return s-l},findWordBoundaryRight:function(s){var l=0,u=s;if(this._reSpace.test(this._text[u]))for(;this._reSpace.test(this._text[u]);)l++,u++;for(;/\S/.test(this._text[u])&&u<this._text.length;)l++,u++;return s+l},findLineBoundaryLeft:function(s){for(var l=0,u=s-1;!/\n/.test(this._text[u])&&u>-1;)l++,u--;return s-l},findLineBoundaryRight:function(s){for(var l=0,u=s;!/\n/.test(this._text[u])&&u<this._text.length;)l++,u++;return s+l},searchWordBoundary:function(s,l){for(var u=this._text,A=this._reSpace.test(u[s])?s-1:s,c=u[A],h=t.reNonWord;!h.test(c)&&A>0&&A<u.length;)A+=l,c=u[A];return h.test(c)&&(A+=l===1?0:1),A},selectWord:function(s){s=s||this.selectionStart;var l=this.searchWordBoundary(s,-1),u=this.searchWordBoundary(s,1);this.selectionStart=l,this.selectionEnd=u,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(s){s=s||this.selectionStart;var l=this.findLineBoundaryLeft(s),u=this.findLineBoundaryRight(s);return this.selectionStart=l,this.selectionEnd=u,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(s){if(!(this.isEditing||!this.editable))return this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(s),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this},exitEditingOnOthers:function(s){s._iTextInstances&&s._iTextInstances.forEach(function(l){l.selected=!1,l.isEditing&&l.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(s){if(!(!this.__isMousedown||!this.isEditing)){document.activeElement!==this.hiddenTextarea&&this.hiddenTextarea.focus();var l=this.getSelectionStartFromPointer(s.e),u=this.selectionStart,A=this.selectionEnd;(l!==this.__selectionStartOnMouseDown||u===A)&&(u===l||A===l)||(l>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=l):(this.selectionStart=l,this.selectionEnd=this.__selectionStartOnMouseDown),(this.selectionStart!==u||this.selectionEnd!==A)&&(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(s,l,u){var A=u.slice(0,s),c=t.util.string.graphemeSplit(A).length;if(s===l)return{selectionStart:c,selectionEnd:c};var h=u.slice(s,l),p=t.util.string.graphemeSplit(h).length;return{selectionStart:c,selectionEnd:c+p}},fromGraphemeToStringSelection:function(s,l,u){var A=u.slice(0,s),c=A.join("").length;if(s===l)return{selectionStart:c,selectionEnd:c};var h=u.slice(s,l),p=h.join("").length;return{selectionStart:c,selectionEnd:c+p}},_updateTextarea:function(){if(this.cursorOffsetCache={},!!this.hiddenTextarea){if(!this.inCompositionMode){var s=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=s.selectionStart,this.hiddenTextarea.selectionEnd=s.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var s=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=s.selectionEnd,this.inCompositionMode||(this.selectionStart=s.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var s=this._calcTextareaPosition();this.hiddenTextarea.style.left=s.left,this.hiddenTextarea.style.top=s.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var s=this.inCompositionMode?this.compositionStart:this.selectionStart,l=this._getCursorBoundaries(s),u=this.get2DCursorLocation(s),A=u.lineIndex,c=u.charIndex,h=this.getValueOfPropertyAt(A,c,"fontSize")*this.lineHeight,p=l.leftOffset,m=this.calcTransformMatrix(),d={x:l.left+p,y:l.top+l.topOffset+h},g=this.canvas.getRetinaScaling(),v=this.canvas.upperCanvasEl,w=v.width/g,_=v.height/g,y=w-h,C=_-h,b=v.clientWidth/w,S=v.clientHeight/_;return d=t.util.transformPoint(d,m),d=t.util.transformPoint(d,this.canvas.viewportTransform),d.x*=b,d.y*=S,d.x<0&&(d.x=0),d.x>y&&(d.x=y),d.y<0&&(d.y=0),d.y>C&&(d.y=C),d.x+=this.canvas._offset.left,d.y+=this.canvas._offset.top,{left:d.x+"px",top:d.y+"px",fontSize:h+"px",charHeight:h}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var s=this._textBeforeEdit!==this.text,l=this.hiddenTextarea;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,l&&(l.blur&&l.blur(),l.parentNode&&l.parentNode.removeChild(l)),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),s&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),s&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var s in this.styles)this._textLines[s]||delete this.styles[s]},removeStyleFromTo:function(s,l){var u=this.get2DCursorLocation(s,!0),A=this.get2DCursorLocation(l,!0),c=u.lineIndex,h=u.charIndex,p=A.lineIndex,m=A.charIndex,d,g;if(c!==p){if(this.styles[c])for(d=h;d<this._unwrappedTextLines[c].length;d++)delete this.styles[c][d];if(this.styles[p])for(d=m;d<this._unwrappedTextLines[p].length;d++)g=this.styles[p][d],g&&(this.styles[c]||(this.styles[c]={}),this.styles[c][h+d-m]=g);for(d=c+1;d<=p;d++)delete this.styles[d];this.shiftLineStyles(p,c-p)}else if(this.styles[c]){g=this.styles[c];var v=m-h,w,_;for(d=h;d<m;d++)delete g[d];for(_ in this.styles[c])w=parseInt(_,10),w>=m&&(g[w-v]=g[_],delete g[_])}},shiftLineStyles:function(s,l){var u=o(this.styles);for(var A in this.styles){var c=parseInt(A,10);c>s&&(this.styles[c+l]=u[c],u[c-l]||delete this.styles[c])}},restartCursorIfNeeded:function(){(!this._currentTickState||this._currentTickState.isAborted||!this._currentTickCompleteState||this._currentTickCompleteState.isAborted)&&this.initDelayedCursor()},insertNewlineStyleObject:function(s,l,u,A){var c,h={},p=!1,m=this._unwrappedTextLines[s].length===l;u||(u=1),this.shiftLineStyles(s,u),this.styles[s]&&(c=this.styles[s][l===0?l:l-1]);for(var d in this.styles[s]){var g=parseInt(d,10);g>=l&&(p=!0,h[g-l]=this.styles[s][d],m&&l===0||delete this.styles[s][d])}var v=!1;for(p&&!m&&(this.styles[s+u]=h,v=!0),v&&u--;u>0;)A&&A[u-1]?this.styles[s+u]={0:o(A[u-1])}:c?this.styles[s+u]={0:o(c)}:delete this.styles[s+u],u--;this._forceClearCache=!0},insertCharStyleObject:function(s,l,u,A){this.styles||(this.styles={});var c=this.styles[s],h=c?o(c):{};u||(u=1);for(var p in h){var m=parseInt(p,10);m>=l&&(c[m+u]=h[m],h[m-u]||delete c[m])}if(this._forceClearCache=!0,A){for(;u--;)Object.keys(A[u]).length&&(this.styles[s]||(this.styles[s]={}),this.styles[s][l+u]=o(A[u]));return}if(c)for(var d=c[l?l-1:1];d&&u--;)this.styles[s][l+u]=o(d)},insertNewStyleBlock:function(s,l,u){for(var A=this.get2DCursorLocation(l,!0),c=[0],h=0,p=0;p<s.length;p++)s[p]===`
`?(h++,c[h]=0):c[h]++;c[0]>0&&(this.insertCharStyleObject(A.lineIndex,A.charIndex,c[0],u),u=u&&u.slice(c[0]+1)),h&&this.insertNewlineStyleObject(A.lineIndex,A.charIndex+c[0],h);for(var p=1;p<h;p++)c[p]>0?this.insertCharStyleObject(A.lineIndex+p,0,c[p],u):u&&this.styles[A.lineIndex+p]&&u[0]&&(this.styles[A.lineIndex+p][0]=u[0]),u=u&&u.slice(c[p]+1);c[p]>0&&this.insertCharStyleObject(A.lineIndex+p,0,c[p],u)},setSelectionStartEndWithShift:function(s,l,u){u<=s?(l===s?this._selectionDirection="left":this._selectionDirection==="right"&&(this._selectionDirection="left",this.selectionEnd=s),this.selectionStart=u):u>s&&u<l?this._selectionDirection==="right"?this.selectionEnd=u:this.selectionStart=u:(l===s?this._selectionDirection="right":this._selectionDirection==="left"&&(this._selectionDirection="right",this.selectionStart=l),this.selectionEnd=u)},setSelectionInBoundaries:function(){var s=this.text.length;this.selectionStart>s?this.selectionStart=s:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>s?this.selectionEnd=s:this.selectionEnd<0&&(this.selectionEnd=0)}})}(),t.util.object.extend(t.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(o){if(this.canvas){this.__newClickTime=+new Date;var s=o.pointer;this.isTripleClick(s)&&(this.fire("tripleclick",o),this._stopEvent(o.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=s,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(o){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===o.x&&this.__lastPointer.y===o.y},_stopEvent:function(o){o.preventDefault&&o.preventDefault(),o.stopPropagation&&o.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},doubleClickHandler:function(o){this.isEditing&&this.selectWord(this.getSelectionStartFromPointer(o.e))},tripleClickHandler:function(o){this.isEditing&&this.selectLine(this.getSelectionStartFromPointer(o.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(o){!this.canvas||!this.editable||o.e.button&&o.e.button!==1||(this.__isMousedown=!0,this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(o.e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(o){!this.canvas||!this.editable||o.e.button&&o.e.button!==1||(this.selected=this===this.canvas._activeObject)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(o){if(this.__isMousedown=!1,!(!this.editable||this.group||o.transform&&o.transform.actionPerformed||o.e.button&&o.e.button!==1)){if(this.canvas){var s=this.canvas._activeObject;if(s&&s!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(o.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(o){var s=this.getSelectionStartFromPointer(o),l=this.selectionStart,u=this.selectionEnd;o.shiftKey?this.setSelectionStartEndWithShift(l,u,s):(this.selectionStart=s,this.selectionEnd=s),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(o){for(var s=this.getLocalPointer(o),l=0,u=0,A=0,c=0,h=0,p,m,d=0,g=this._textLines.length;d<g&&A<=s.y;d++)A+=this.getHeightOfLine(d)*this.scaleY,h=d,d>0&&(c+=this._textLines[d-1].length+this.missingNewlineOffset(d-1));p=this._getLineLeftOffset(h),u=p*this.scaleX,m=this._textLines[h],this.direction==="rtl"&&(s.x=this.width*this.scaleX-s.x+u);for(var v=0,w=m.length;v<w&&(l=u,u+=this.__charBounds[h][v].kernedWidth*this.scaleX,u<=s.x);v++)c++;return this._getNewSelectionStartFromOffset(s,l,u,c,w)},_getNewSelectionStartFromOffset:function(o,s,l,u,A){var c=o.x-s,h=l-o.x,p=h>c||h<0?0:1,m=u+p;return this.flipX&&(m=A-m),m>this._text.length&&(m=this._text.length),m}}),t.util.object.extend(t.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=t.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var o=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+o.top+"; left: "+o.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding-top: "+o.fontSize+";",this.hiddenTextareaContainer?this.hiddenTextareaContainer.appendChild(this.hiddenTextarea):t.document.body.appendChild(this.hiddenTextarea),t.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),t.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),t.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),t.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),t.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),t.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),t.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),t.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),t.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(t.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},keysMapRtl:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorLeft",36:"moveCursorRight",37:"moveCursorRight",38:"moveCursorUp",39:"moveCursorLeft",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(o){if(this.isEditing){var s=this.direction==="rtl"?this.keysMapRtl:this.keysMap;if(o.keyCode in s)this[s[o.keyCode]](o);else if(o.keyCode in this.ctrlKeysMapDown&&(o.ctrlKey||o.metaKey))this[this.ctrlKeysMapDown[o.keyCode]](o);else return;o.stopImmediatePropagation(),o.preventDefault(),o.keyCode>=33&&o.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(o){if(!this.isEditing||this._copyDone||this.inCompositionMode){this._copyDone=!1;return}if(o.keyCode in this.ctrlKeysMapUp&&(o.ctrlKey||o.metaKey))this[this.ctrlKeysMapUp[o.keyCode]](o);else return;o.stopImmediatePropagation(),o.preventDefault(),this.canvas&&this.canvas.requestRenderAll()},onInput:function(o){var s=this.fromPaste;if(this.fromPaste=!1,o&&o.stopPropagation(),!!this.isEditing){var l=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,u=this._text.length,A=l.length,c,h,p=A-u,m=this.selectionStart,d=this.selectionEnd,g=m!==d,v,w,_;if(this.hiddenTextarea.value===""){this.styles={},this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll());return}var y=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),C=m>y.selectionStart;g?(c=this._text.slice(m,d),p+=d-m):A<u&&(C?c=this._text.slice(d+p,d):c=this._text.slice(m,m-p)),h=l.slice(y.selectionEnd-p,y.selectionEnd),c&&c.length&&(h.length&&(v=this.getSelectionStyles(m,m+1,!1),v=h.map(function(){return v[0]})),g?(w=m,_=d):C?(w=d-c.length,_=d):(w=d,_=d+c.length),this.removeStyleFromTo(w,_)),h.length&&(s&&h.join("")===t.copiedText&&!t.disableStyleCopyPaste&&(v=t.copiedTextStyle),this.insertNewStyleBlock(h,m,v)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(o){this.compositionStart=o.target.selectionStart,this.compositionEnd=o.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(t.copiedText=this.getSelectedText(),t.disableStyleCopyPaste?t.copiedTextStyle=null:t.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(o){return o&&o.clipboardData||t.window.clipboardData},_getWidthBeforeCursor:function(o,s){var l=this._getLineLeftOffset(o),u;return s>0&&(u=this.__charBounds[o][s-1],l+=u.left+u.width),l},getDownCursorOffset:function(o,s){var l=this._getSelectionForOffset(o,s),u=this.get2DCursorLocation(l),A=u.lineIndex;if(A===this._textLines.length-1||o.metaKey||o.keyCode===34)return this._text.length-l;var c=u.charIndex,h=this._getWidthBeforeCursor(A,c),p=this._getIndexOnLine(A+1,h),m=this._textLines[A].slice(c);return m.length+p+1+this.missingNewlineOffset(A)},_getSelectionForOffset:function(o,s){return o.shiftKey&&this.selectionStart!==this.selectionEnd&&s?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(o,s){var l=this._getSelectionForOffset(o,s),u=this.get2DCursorLocation(l),A=u.lineIndex;if(A===0||o.metaKey||o.keyCode===33)return-l;var c=u.charIndex,h=this._getWidthBeforeCursor(A,c),p=this._getIndexOnLine(A-1,h),m=this._textLines[A].slice(0,c),d=this.missingNewlineOffset(A-1);return-this._textLines[A-1].length+p-m.length+(1-d)},_getIndexOnLine:function(o,s){for(var l=this._textLines[o],u=this._getLineLeftOffset(o),A=u,c=0,h,p,m=0,d=l.length;m<d;m++)if(h=this.__charBounds[o][m].width,A+=h,A>s){p=!0;var g=A-h,v=A,w=Math.abs(g-s),_=Math.abs(v-s);c=_<w?m:m-1;break}return p||(c=l.length-1),c},moveCursorDown:function(o){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",o)},moveCursorUp:function(o){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorUpOrDown("Up",o)},_moveCursorUpOrDown:function(o,s){var l="get"+o+"CursorOffset",u=this[l](s,this._selectionDirection==="right");s.shiftKey?this.moveCursorWithShift(u):this.moveCursorWithoutShift(u),u!==0&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(o){var s=this._selectionDirection==="left"?this.selectionStart+o:this.selectionEnd+o;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,s),o!==0},moveCursorWithoutShift:function(o){return o<0?(this.selectionStart+=o,this.selectionEnd=this.selectionStart):(this.selectionEnd+=o,this.selectionStart=this.selectionEnd),o!==0},moveCursorLeft:function(o){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorLeftOrRight("Left",o)},_move:function(o,s,l){var u;if(o.altKey)u=this["findWordBoundary"+l](this[s]);else if(o.metaKey||o.keyCode===35||o.keyCode===36)u=this["findLineBoundary"+l](this[s]);else return this[s]+=l==="Left"?-1:1,!0;if(typeof u<"u"&&this[s]!==u)return this[s]=u,!0},_moveLeft:function(o,s){return this._move(o,s,"Left")},_moveRight:function(o,s){return this._move(o,s,"Right")},moveCursorLeftWithoutShift:function(o){var s=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&this.selectionStart!==0&&(s=this._moveLeft(o,"selectionStart")),this.selectionEnd=this.selectionStart,s},moveCursorLeftWithShift:function(o){if(this._selectionDirection==="right"&&this.selectionStart!==this.selectionEnd)return this._moveLeft(o,"selectionEnd");if(this.selectionStart!==0)return this._selectionDirection="left",this._moveLeft(o,"selectionStart")},moveCursorRight:function(o){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",o)},_moveCursorLeftOrRight:function(o,s){var l="moveCursor"+o+"With";this._currentCursorOpacity=1,s.shiftKey?l+="Shift":l+="outShift",this[l](s)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(o){if(this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd)return this._moveRight(o,"selectionStart");if(this.selectionEnd!==this._text.length)return this._selectionDirection="right",this._moveRight(o,"selectionEnd")},moveCursorRightWithoutShift:function(o){var s=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(s=this._moveRight(o,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,s},removeChars:function(o,s){typeof s>"u"&&(s=o+1),this.removeStyleFromTo(o,s),this._text.splice(o,s-o),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(o,s,l,u){typeof u>"u"&&(u=l),u>l&&this.removeStyleFromTo(l,u);var A=t.util.string.graphemeSplit(o);this.insertNewStyleBlock(A,l,s),this._text=[].concat(this._text.slice(0,l),A,this._text.slice(u)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),function(){var o=t.util.toFixed,s=/  +/g;t.util.object.extend(t.Text.prototype,{_toSVG:function(){var l=this._getSVGLeftTopOffsets(),u=this._getSVGTextAndBg(l.textTop,l.textLeft);return this._wrapSVGTextAndBg(u)},toSVG:function(l){return this._createBaseSVGMarkup(this._toSVG(),{reviver:l,noStyle:!0,withShadow:!0})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(l){var u=!0,A=this.getSvgTextDecoration(this);return[l.textBgRects.join(""),'		<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",A?'text-decoration="'+A+'" ':"",'style="',this.getSvgStyles(u),'"',this.addPaintOrder()," >",l.textSpans.join(""),`</text>
`]},_getSVGTextAndBg:function(l,u){var A=[],c=[],h=l,p;this._setSVGBg(c);for(var m=0,d=this._textLines.length;m<d;m++)p=this._getLineLeftOffset(m),(this.textBackgroundColor||this.styleHas("textBackgroundColor",m))&&this._setSVGTextLineBg(c,m,u+p,h),this._setSVGTextLineText(A,m,u+p,h),h+=this.getHeightOfLine(m);return{textSpans:A,textBgRects:c}},_createTextCharSpan:function(l,u,A,c){var h=l!==l.trim()||l.match(s),p=this.getSvgSpanStyles(u,h),m=p?'style="'+p+'"':"",d=u.deltaY,g="",v=t.Object.NUM_FRACTION_DIGITS;return d&&(g=' dy="'+o(d,v)+'" '),['<tspan x="',o(A,v),'" y="',o(c,v),'" ',g,m,">",t.util.string.escapeXml(l),"</tspan>"].join("")},_setSVGTextLineText:function(l,u,A,c){var h=this.getHeightOfLine(u),p=this.textAlign.indexOf("justify")!==-1,m,d,g="",v,w,_=0,y=this._textLines[u],C;c+=h*(1-this._fontSizeFraction)/this.lineHeight;for(var b=0,S=y.length-1;b<=S;b++)C=b===S||this.charSpacing,g+=y[b],v=this.__charBounds[u][b],_===0?(A+=v.kernedWidth-v.width,_+=v.width):_+=v.kernedWidth,p&&!C&&this._reSpaceAndTab.test(y[b])&&(C=!0),C||(m=m||this.getCompleteStyleDeclaration(u,b),d=this.getCompleteStyleDeclaration(u,b+1),C=t.util.hasStyleChanged(m,d,!0)),C&&(w=this._getStyleDeclaration(u,b)||{},l.push(this._createTextCharSpan(g,w,A,c)),g="",m=d,A+=_,_=0)},_pushTextBgRect:function(l,u,A,c,h,p){var m=t.Object.NUM_FRACTION_DIGITS;l.push("		<rect ",this._getFillAttributes(u),' x="',o(A,m),'" y="',o(c,m),'" width="',o(h,m),'" height="',o(p,m),`"></rect>
`)},_setSVGTextLineBg:function(l,u,A,c){for(var h=this._textLines[u],p=this.getHeightOfLine(u)/this.lineHeight,m=0,d=0,g,v,w=this.getValueOfPropertyAt(u,0,"textBackgroundColor"),_=0,y=h.length;_<y;_++)g=this.__charBounds[u][_],v=this.getValueOfPropertyAt(u,_,"textBackgroundColor"),v!==w?(w&&this._pushTextBgRect(l,w,A+d,c,m,p),d=g.left,m=g.width,w=v):m+=g.kernedWidth;v&&this._pushTextBgRect(l,v,A+d,c,m,p)},_getFillAttributes:function(l){var u=l&&typeof l=="string"?new t.Color(l):"";return!u||!u.getSource()||u.getAlpha()===1?'fill="'+l+'"':'opacity="'+u.getAlpha()+'" fill="'+u.setAlpha(1).toRgb()+'"'},_getSVGLineTopOffset:function(l){for(var u=0,A=0,c=0;c<l;c++)u+=this.getHeightOfLine(c);return A=this.getHeightOfLine(c),{lineTop:u,offset:(this._fontSizeMult-this._fontSizeFraction)*A/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(l){var u=t.Object.prototype.getSvgStyles.call(this,l);return u+" white-space: pre;"}})}(),function(o){var s=o.fabric||(o.fabric={});s.Textbox=s.util.createClass(s.IText,s.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:s.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(l){for(var u=0,A=0,c=0,h={},p=0;p<l.graphemeLines.length;p++)l.graphemeText[c]===`
`&&p>0?(A=0,c++,u++):!this.splitByGrapheme&&this._reSpaceAndTab.test(l.graphemeText[c])&&p>0&&(A++,c++),h[p]={line:u,offset:A},c+=l.graphemeLines[p].length,A+=l.graphemeLines[p].length;return h},styleHas:function(l,u){if(this._styleMap&&!this.isWrapping){var A=this._styleMap[u];A&&(u=A.line)}return s.Text.prototype.styleHas.call(this,l,u)},isEmptyStyles:function(l){if(!this.styles)return!0;var u=0,A=l+1,c,h,p=!1,m=this._styleMap[l],d=this._styleMap[l+1];m&&(l=m.line,u=m.offset),d&&(A=d.line,p=A===l,c=d.offset),h=typeof l>"u"?this.styles:{line:this.styles[l]};for(var g in h)for(var v in h[g])if(v>=u&&(!p||v<c))for(var w in h[g][v])return!1;return!0},_getStyleDeclaration:function(l,u){if(this._styleMap&&!this.isWrapping){var A=this._styleMap[l];if(!A)return null;l=A.line,u=A.offset+u}return this.callSuper("_getStyleDeclaration",l,u)},_setStyleDeclaration:function(l,u,A){var c=this._styleMap[l];l=c.line,u=c.offset+u,this.styles[l][u]=A},_deleteStyleDeclaration:function(l,u){var A=this._styleMap[l];l=A.line,u=A.offset+u,delete this.styles[l][u]},_getLineStyle:function(l){var u=this._styleMap[l];return!!this.styles[u.line]},_setLineStyle:function(l){var u=this._styleMap[l];this.styles[u.line]={}},_wrapText:function(l,u){var A=[],c;for(this.isWrapping=!0,c=0;c<l.length;c++)A=A.concat(this._wrapLine(l[c],c,u));return this.isWrapping=!1,A},_measureWord:function(l,u,A){var c=0,h,p=!0;A=A||0;for(var m=0,d=l.length;m<d;m++){var g=this._getGraphemeBox(l[m],u,m+A,h,p);c+=g.kernedWidth,h=l[m]}return c},_wrapLine:function(l,u,A,M){var h=0,p=this.splitByGrapheme,m=[],d=[],g=p?s.util.string.graphemeSplit(l):l.split(this._wordJoiners),v="",w=0,_=p?"":" ",y=0,C=0,b=0,S=!0,B=this._getWidthOfCharSpacing(),M=M||0;g.length===0&&g.push([]),A-=M;for(var z=0;z<g.length;z++)v=p?g[z]:s.util.string.graphemeSplit(g[z]),y=this._measureWord(v,u,w),w+=v.length,h+=C+y-B,h>A&&!S?(m.push(d),d=[],h=y,S=!0):h+=B,!S&&!p&&d.push(_),d=d.concat(v),C=p?0:this._measureWord([_],u,w),w++,S=!1,y>b&&(b=y);return z&&m.push(d),b+M>this.dynamicMinWidth&&(this.dynamicMinWidth=b-B+M),m},isEndOfWrapping:function(l){return!this._styleMap[l+1]||this._styleMap[l+1].line!==this._styleMap[l].line},missingNewlineOffset:function(l){return this.splitByGrapheme?this.isEndOfWrapping(l)?1:0:1},_splitTextIntoLines:function(l){for(var u=s.Text.prototype._splitTextIntoLines.call(this,l),A=this._wrapText(u.lines,this.width),c=new Array(A.length),h=0;h<A.length;h++)c[h]=A[h].join("");return u.lines=c,u.graphemeLines=A,u},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var l={};for(var u in this._styleMap)this._textLines[u]&&(l[this._styleMap[u].line]=1);for(var u in this.styles)l[u]||delete this.styles[u]},toObject:function(l){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(l))}}),s.Textbox.fromObject=function(l,u){var A=s.util.stylesFromArray(l.styles,l.text),c=Object.assign({},l,{styles:A});return s.Object._fromObject("Textbox",c,u,"text")}}(n),function(){var o=t.controlsUtils,s=o.scaleSkewCursorStyleHandler,l=o.scaleCursorStyleHandler,u=o.scalingEqually,A=o.scalingYOrSkewingX,c=o.scalingXOrSkewingY,h=o.scaleOrSkewActionName,p=t.Object.prototype.controls;if(p.ml=new t.Control({x:-.5,y:0,cursorStyleHandler:s,actionHandler:c,getActionName:h}),p.mr=new t.Control({x:.5,y:0,cursorStyleHandler:s,actionHandler:c,getActionName:h}),p.mb=new t.Control({x:0,y:.5,cursorStyleHandler:s,actionHandler:A,getActionName:h}),p.mt=new t.Control({x:0,y:-.5,cursorStyleHandler:s,actionHandler:A,getActionName:h}),p.tl=new t.Control({x:-.5,y:-.5,cursorStyleHandler:l,actionHandler:u}),p.tr=new t.Control({x:.5,y:-.5,cursorStyleHandler:l,actionHandler:u}),p.bl=new t.Control({x:-.5,y:.5,cursorStyleHandler:l,actionHandler:u}),p.br=new t.Control({x:.5,y:.5,cursorStyleHandler:l,actionHandler:u}),p.mtr=new t.Control({x:0,y:-.5,actionHandler:o.rotationWithSnapping,cursorStyleHandler:o.rotationStyleHandler,offsetY:-40,withConnection:!0,actionName:"rotate"}),t.Textbox){var m=t.Textbox.prototype.controls={};m.mtr=p.mtr,m.tr=p.tr,m.br=p.br,m.tl=p.tl,m.bl=p.bl,m.mt=p.mt,m.mb=p.mb,m.mr=new t.Control({x:.5,y:0,actionHandler:o.changeWidth,cursorStyleHandler:s,actionName:"resizing"}),m.ml=new t.Control({x:-.5,y:0,actionHandler:o.changeWidth,cursorStyleHandler:s,actionName:"resizing"})}}()})(sr);class WP{constructor(t,e){x(this,"canvas");x(this,"drawWidth",1);x(this,"drawColor","#000");x(this,"mouseFrom",{x:0,y:0});x(this,"mouseTo",{x:0,y:0});x(this,"textbox");x(this,"doDrawing",!1);x(this,"drawType","");x(this,"drawingObject",null);x(this,"moveCount",1);x(this,"removeObj",t=>{t.keyCode==46&&this.deleteObj(),t.keyCode==90&&t.ctrlKey&&this.canvas.remove(this.canvas.getObjects()[this.canvas.getObjects().length-1])});x(this,"mousedown",t=>{if(!t.target){var e=t.absolutePointer||this.transformMouse(t.e.offsetX,t.e.offsetY);this.mouseFrom.x=e.x,this.mouseFrom.y=e.y,this.doDrawing=!0,this.drawType=="text"&&this.drawing(t)}});x(this,"mousemove",t=>{if(!(this.moveCount%2&&!this.doDrawing)){this.moveCount++;var e=t.absolutePointer||this.transformMouse(t.e.offsetX,t.e.offsetY);this.mouseTo.x=e.x,this.mouseTo.y=e.y,this.drawType!="text"&&this.drawing(t)}});x(this,"mouseup",t=>{var e=t.absolutePointer||this.transformMouse(t.e.offsetX,t.e.offsetY);this.mouseTo.x=e.x,this.mouseTo.y=e.y,this.drawingObject&&(this.canvas.setActiveObject(this.drawingObject),this.drawingObject=null),this.moveCount=1,this.doDrawing=!1});sr.fabric.Canvas.prototype._checkTarget=function(r,a,f){if(a&&a.visible&&a.evented&&a.containsPoint(r))if((this.perPixelTargetFind||a.perPixelTargetFind)&&!a.isEditing){var o=this.isTargetTransparent(a,f.x,f.y);if(!o)return!0}else{var s=this.isInsideBorder(a);if(!s)return!0}},sr.fabric.Canvas.prototype.isInsideBorder=function(r){var a=r.getLocalPointer();if(a.x>15&&a.x<r.getScaledWidth()-15&&a.y>15&&a.y<r.getScaledHeight()-15)return!0},this.canvas=new sr.fabric.Canvas(t,{containerClass:e}),this.canvas.selectionColor="rgba(0,0,0,0.05)"}drawTypeChange(t){return this.drawType=t,this.textbox&&(this.textbox.exitEditing(),this.textbox.text||this.canvas.remove(this.textbox)),t=="pen"?this.canvas.isDrawingMode=!0:this.canvas.isDrawingMode=!1,t}deleteObj(){this.canvas.getActiveObjects().map(t=>{this.canvas.remove(t)})}transformMouse(t,e){return{x:t/1,y:e/1}}drawing(t){var y;this.drawingObject&&this.canvas.remove(this.drawingObject);var e=null,i=this.mouseFrom.x,r=this.mouseFrom.y,a=this.mouseFrom,f=this.mouseTo;switch(this.drawType){case"arrow":var o=a.x,s=f.x,l=a.y,u=f.y,A=s-o,c=u-l,h=Math.cos(Math.PI/4)*16,p=c/Math.sqrt(Math.pow(A,2)+Math.pow(c,2)),m=A/Math.sqrt(Math.pow(A,2)+Math.pow(c,2)),d=16*p/4,g=16*m/4,v=h*m,w=h*p,_=" M "+o+" "+l;_+=" L "+(s-v+d)+" "+(u-w-g),_+=" L "+(s-v+d*2)+" "+(u-w-g*2),_+=" L "+s+" "+u,_+=" L "+(s-v-d*2)+" "+(u-w+g*2),_+=" L "+(s-v-d)+" "+(u-w+g),_+=" Z",e=new sr.fabric.Path(_,{stroke:this.drawColor,fill:this.drawColor,strokeWidth:this.drawWidth});break;case"ellipse":t.e.shiftKey&&(f.x-i>f.y-r?f.y=r+f.x-i:f.x=i+f.y-r),Math.sqrt((f.x-i)*(f.x-i)+(f.y-r)*(f.y-r))/2,e=new sr.fabric.Ellipse({left:(f.x-i)/2+i,top:(f.y-r)/2+r,stroke:this.drawColor,fill:"rgba(255, 255, 255, 0)",originX:"center",originY:"center",selectable:!0,rx:Math.abs(i-f.x)/2,ry:Math.abs(r-f.y)/2,strokeWidth:this.drawWidth});break;case"rectangle":const C=new sr.fabric.Rect({left:a.x,top:a.y,stroke:this.drawColor,strokeWidth:this.drawWidth,fill:"rgba(255, 255, 255, 0)",selectable:!0,hasControls:!0});C.set({width:Math.abs(a.x-f.x),height:Math.abs(a.y-f.y)}),C.set({left:Math.min(f.x,a.x)}),C.set({top:Math.min(f.y,a.y)}),e=C;break;case"text":this.textbox&&!this.textbox.text&&this.canvas.remove(this.textbox),this.textbox=new sr.fabric.Textbox("",{left:a.x,top:a.y-10,width:100,fontSize:16,hasBorders:!0,borderOpacityWhenMoving:0,editingBorderColor:this.drawColor,borderColor:this.drawColor,fill:this.drawColor,hasControls:!0,hiddenTextareaContainer:this.canvas.getElement().parentElement}),this.canvas.add(this.textbox),this.textbox.enterEditing(),this.textbox.hiddenTextarea.style.top="0",this.textbox.hiddenTextarea.oninput=()=>{this.textbox.hiddenTextarea.style.top="0"},(y=this.textbox.hiddenTextarea)==null||y.scrollIntoView(!1),this.drawingObject=this.textbox;break}e&&(this.canvas.add(e),this.drawingObject=e)}undo(){this.canvas.remove(this.canvas.getObjects()[this.canvas.getObjects().length-1])}toJson(){return this.canvas.toObject()}getCenterPoint(){}disableControl(){this.canvas.skipTargetFind=!0,this.canvas.discardActiveObject(),this.canvas.selection=!1}enableControl(){this.canvas.selection=!0,this.canvas.skipTargetFind=!1}show(){this.canvas.on("mouse:down",this.mousedown),this.canvas.on("mouse:move",this.mousemove),this.canvas.on("mouse:up",this.mouseup),document.addEventListener("keydown",this.removeObj)}clear(){this.canvas.clear(),this.canvas.off("mouse:down",this.mousedown),this.canvas.off("mouse:move",this.mousemove),this.canvas.off("mouse:up",this.mouseup),document.removeEventListener("keydown",this.removeObj)}}class KP{constructor(t,e){x(this,"container");x(this,"canvasDom");x(this,"fabric");x(this,"oriHeight",0);x(this,"oriWidth",0);x(this,"handleResize",()=>{const t=this.container.offsetWidth,e=this.container.offsetHeight,i=e/this.oriHeight;let r=this.oriWidth*i,a=this.oriHeight*i,f=.5*(t-r),o=.5*(e-a);this.fabric.canvas.viewportTransform=[i,0,0,i,f,o],this.fabric.canvas.setWidth(t),this.fabric.canvas.setHeight(e),this.fabric.canvas.calcOffset(),this.fabric.canvas.calcViewportBoundaries(),this.fabric.canvas.renderAll()});x(this,"freeSelect",()=>{this.fabric.drawTypeChange("")});x(this,"pen",()=>{this.fabric.drawTypeChange("pen")});x(this,"drawRect",()=>{this.fabric.drawTypeChange("rectangle")});x(this,"drawCircle",()=>{this.fabric.drawTypeChange("ellipse")});x(this,"drawArrow",()=>{this.fabric.drawTypeChange("arrow")});x(this,"drawText",()=>{this.fabric.drawTypeChange("text")});x(this,"onContainerClick",()=>{});this.canvasDom=document.createElement("canvas"),this.canvasDom.id="_annolayer",this.canvasDom.className="fill-prt",t.appendChild(this.canvasDom),this.fabric=new WP(this.canvasDom,"draw_board"),this.container=this.canvasDom.parentElement,this.oriHeight=this.container.clientHeight,this.oriWidth=this.container.clientWidth,this.fabric.canvas.setWidth(this.oriWidth),this.fabric.canvas.setHeight(this.oriHeight),e.add(this.handleResize)}show(){hc(this.container,!0),this.fabric.show()}hide(){this.fabric.clear(),this.freeSelect(),hc(this.container,!1)}clear(){this.hide(),this.fabric.clear()}get drawType(){return this.fabric.drawType}toObject(){const t=this.fabric.toJson();return!t.objects||t.objects.length==0?null:{width:this.oriWidth,height:this.oriHeight,canvasJson:t}}fromObject(t){this.oriHeight=t.height,this.oriWidth=t.width,this.fabric.canvas.loadFromJSON(t.canvasJson,()=>{}),this.fabric.canvas.setWidth(t.width),this.fabric.canvas.setHeight(t.height),this.handleResize()}}class XP{constructor(t,e,i){x(this,"wrapper");x(this,"svg");x(this,"svgContainer");x(this,"lastX");x(this,"lastY");x(this,"onClick",new Ot);x(this,"vector",new xt);x(this,"items",[]);x(this,"onChangeEvent");x(this,"onControlChanged",()=>{this.items.length!=0&&(this.items.forEach(t=>t.update()),this.sort())});this.svgContainer=e,this.wrapper=t,this.svg=f_().addTo(e),this.svg.addClass("fill-prt"),this.onChangeEvent=i,this.onChangeEvent.add(this.onControlChanged),window.addEventListener("resize",this.onControlChanged),t.addEventListener("pointerdown",r=>{this.lastX=r.clientX,this.lastY=r.clientY}),t.addEventListener("pointerup",r=>{r.clientX!=this.lastX||r.clientY!=this.lastY||this.onClick.dispatch(this.vector.set(this.lastX,this.lastY))})}get div(){return this.wrapper}show(){hc(this.wrapper,!0)}hide(){hc(this.wrapper,!1)}clear(){this.items.forEach(t=>t.dispose()),this.items=[],this.svg.clear(),this.wrapper.removeChild(this.svgContainer),this.wrapper.innerHTML="",this.wrapper.appendChild(this.svgContainer)}addItem(t){this.items.push(t),this.sort()}removeItem(t){const e=this.items.indexOf(t);e!=-1&&this.items.splice(e,1),t.dispose(),this.sort()}sort(){const t=this.items.map((e,i)=>({i,value:e.calCameraDistance()}));t.sort((e,i)=>i.value-e.value),this.items=t.map((e,i)=>{const r=this.items[e.i];return r.sortableDom.forEach(a=>{a.style.zIndex=i.toString()}),r})}}class pu{constructor(t,e){x(this,"dom");x(this,"label");this.label=t;let i=document.createElement("div");i.innerText=t+":",i.style.backgroundColor="blue",i.style.color="white",i.style.fontSize="15px",i.style.paddingTop="2px",i.style.paddingLeft="10px",i.style.paddingRight="10px",i.style.margin="3px",i.style.borderRadius="100px",i.style.border="solid 3px white",i.style.backgroundColor=e,this.dom=i}setValue(t){this.dom.innerText=this.label+" = "+t}}class jP{constructor(t,e,i){x(this,"dom");x(this,"xlabel");x(this,"ylabel");x(this,"zlabel");x(this,"sortableDom",[]);x(this,"refPoint");x(this,"drawboard");x(this,"vp");x(this,"onDelete",new Ot);x(this,"screenVec",new xt);x(this,"cameraPosVec",new H);x(this,"coordsTranslator",(t,e,i)=>(t=t*1e3,["FR"+Math.floor(t/700)+"+"+(t%700).toFixed(0),(e*1e3).toFixed(0),(i*1e3).toFixed(0)]));this.refPoint=t,this.drawboard=e,this.vp=i;let r=document.createElement("div");r.style.position="absolute";let a=document.createElement("div");a.innerHTML=`
        <svg t="1689932328195" class="icon" viewBox="0 0 1024 1024" version="1.1"
    xmlns="http://www.w3.org/2000/svg" p-id="4179" xmlns:xlink="http://www.w3.org/1999/xlink"
    width="26" height="26" style="padding-top:4px;padding-left:5px">
    <path
        d="M170.666667 213.333333h128V170.666667a85.333333 85.333333 0 0 1 85.333333-85.333334h256a85.333333 85.333333 0 0 1 85.333333 85.333334v42.666666h128a42.666667 42.666667 0 0 1 0 85.333334h-42.666666v554.666666a85.333333 85.333333 0 0 1-85.333334 85.333334H298.666667a85.333333 85.333333 0 0 1-85.333334-85.333334V298.666667H170.666667a42.666667 42.666667 0 1 1 0-85.333334z m128 85.333334v554.666666h426.666666V298.666667H298.666667z m85.333333-85.333334h256V170.666667H384v42.666666z m0 170.666667h85.333333v384H384V384z m170.666667 0h85.333333v384h-85.333333V384z"
        fill="#ffffff" p-id="4180"></path>
</svg>
        
        `,a.style.width="36px",a.style.height="36px",a.style.border="solid 3px white",a.style.borderRadius="100px",a.style.backgroundColor="#222222",a.style.position="absolute",a.style.right="-36px",a.style.display="none",r.addEventListener("pointerdown",s=>{s.stopPropagation(),a.style.display="block"}),r.addEventListener("mousemove",s=>{s.stopPropagation(),a.style.display="block"}),r.addEventListener("mouseleave",s=>{s.stopPropagation(),a.style.display="none"}),a.addEventListener("pointerup",s=>{s.stopPropagation(),this.onDelete.dispatch(this)});const f=this.coordsTranslator(t.x,t.y,t.z);r.appendChild(a);{let s=new pu("X","red");r.appendChild(s.dom),this.xlabel=s}{let s=new pu("Y","green");r.appendChild(s.dom),this.ylabel=s}{let s=new pu("Z","blue");r.appendChild(s.dom),this.zlabel=s}this.setValue(f[0],f[1],f[2]);let o=document.createElement("div");o.innerHTML='<svg t="1689595614321" class="icon" viewBox="0 0 1088 1024" version="1.1" p-id="6548" width="20" height="20"><path d="M542.016 1.344c-193.024 0-349.44 146.944-349.44 328.32 0 46.848 10.624 91.392 29.312 131.648l320.128 554.752 320-554.752a309.76 309.76 0 0 0 29.376-131.648c0-181.44-156.416-328.32-349.376-328.32z m1.472 577.344c-125.248 0-226.688-102.144-226.688-228.288 0-126.016 101.44-228.16 226.688-228.16 125.056 0 226.496 102.208 226.496 228.16 0 126.144-101.44 228.288-226.496 228.288z" fill="#f4ea2a" p-id="6549"></path><path d="M702.656 352.256A159.04 159.04 0 0 1 544 511.744a159.04 159.04 0 0 1-158.528-159.488A159.04 159.04 0 0 1 544 192.896a159.04 159.04 0 0 1 158.656 159.36z" fill="#f4ea2a" p-id="6550"></path></svg>',o.style.marginBottom="-3px",r.appendChild(o),r.style.marginLeft="-10px",r.style.filter="drop-shadow(rgba(0, 0, 0, 0.4) 1px 1px 1px)",this.dom=r,this.sortableDom=[this.dom],this.drawboard.div.appendChild(this.dom)}update(){if(!this.vp.isPointVisible(this.refPoint)){this.dom.hidden=!0;return}this.dom.hidden=!1,this.vp.toScreenVector(this.refPoint,this.screenVec),this.dom.style.top=this.screenVec.y-this.dom.offsetHeight+"px",this.dom.style.left=this.screenVec.x+"px"}dispose(){this.dom.remove()}calCameraDistance(){return this.vp.camera.getWorldPosition(this.cameraPosVec),this.refPoint.distanceTo(this.cameraPosVec)}setValue(t,e,i){this.xlabel.setValue(t),this.ylabel.setValue(e),this.zlabel.setValue(i)}}class YP extends kd{constructor(e,i){super(i);x(this,"vp");x(this,"items",[]);x(this,"vpClicked",e=>{if(!e.intersectPoint)return;e.cancel();let i=e.intersectPoint;this.createItem(i)});this.vp=e,this.drawBoard=i}startDraw(){super.startDraw(),this.vp.initSize(),this.vp.modelClickedEvent.add(this.vpClicked)}endDraw(){super.endDraw(),this.vp.modelClickedEvent.remove(this.vpClicked)}createItem(e){const i=new jP(e,this.drawBoard,this.vp);this.addItem(i),i.update(),i.onDelete.add(this.removeItem.bind(this))}}class qP{constructor(t){x(this,"drawboard");x(this,"canvasDrawboard");x(this,"measureDistanceTool");x(this,"labelTool");x(this,"canvasDrawtool");x(this,"coordsTool");x(this,"currentTool");x(this,"viewer");this.viewer=t}getDrawboard(){return this.drawboard||(this.drawboard=new XP(this.viewer.domLayer,this.viewer.svgLayer,this.viewer.mainViewport.controls.changedEvent)),this.drawboard}getCanvasDrawboard(t){return this.canvasDrawboard||(this.canvasDrawboard=new KP(this.viewer.canvasContainer,t.resizeEvent)),this.canvasDrawboard}getMeasureDistanceTool(t){const e=this.getDrawboard();return this.measureDistanceTool||(this.measureDistanceTool=new xP(e,t)),this.measureDistanceTool.startDraw(),this.currentTool=this.measureDistanceTool,this.measureDistanceTool}getLabelTool(t){const e=this.getDrawboard();return this.labelTool||(this.labelTool=new BP(e,t)),this.labelTool.startDraw(),this.currentTool=this.labelTool,this.labelTool}getCoord2DTool(t){const e=this.getDrawboard();return this.coordsTool||(this.coordsTool=new YP(t,e)),this.coordsTool.startDraw(),this.currentTool=this.coordsTool,this.coordsTool}getCanvasDrawtool(t){const e=this.getCanvasDrawboard(t);return this.canvasDrawtool||(this.canvasDrawtool=new NP(e,t)),this.canvasDrawtool.startDraw(),this.currentTool=this.canvasDrawtool,this.canvasDrawtool}disableDraw(){this.currentTool&&this.currentTool.endDraw()}}function $P(n){let t=new ge;return t.title="",t.key="zoom2fit",t.bs_icon="bi-box",t.viewer=n,t.onclick=()=>{n.mainViewport.zoomToSelection()},new ue(t)}function JP(n){let t=new ge;return t.title="",t.key="select_parent",t.icon="./static/maintoolbar/select_parent.svg",t.viewer=n,t.onclick=()=>{let i=n.mainViewport,r=i.selectedObjects;if(r&&r.length>0){let a=r[0];a!=i.rootGroup&&a.parent&&i.selectModels(a.parent)}},new ue(t)}function ZP(n){let t=new ge;return t.title="",t.key="pcam",t.icon="./static/maintoolbar/pcam.svg",t.viewer=n,t.onclick=()=>{let i=n.mainViewport;i.camera!=i.perspectiveCamera&&i.toggleCameraType()},t.oninit=i=>{let r=n.mainViewport;i.active=r.camera==r.perspectiveCamera,r.cameraChangedEvent.add(a=>{i.active=a.camera==r.perspectiveCamera})},new ue(t)}function tO(n){let t=new ge;return t.title="",t.key="ocam",t.icon="./static/maintoolbar/ocam.svg",t.viewer=n,t.onclick=()=>{let i=n.mainViewport;console.log(229,i.controls.camera==i.orthographicCamera,i.camera==i.orthographicCamera),i.camera!=i.orthographicCamera&&i.toggleCameraType()},t.oninit=i=>{let r=n.mainViewport;i.active=r.camera==r.orthographicCamera,r.cameraChangedEvent.add(a=>{i.active=a.camera==r.orthographicCamera})},new ue(t)}function eO(n){let t=new ge;return t.title="",t.key="freeStyleControls",t.icon="./static/maintoolbar/freeControl.svg",t.viewer=n,t.onclick=()=>{let i=n.mainViewport.controls;i.style!="free"&&(i.style="free")},t.oninit=i=>{let r=n.mainViewport.controls;i.active=r.style=="free",r.controlParamChangedEvent.add(()=>{i.active=r.style=="free"})},new ue(t)}function iO(n){let t=new ge;return t.title="",t.key="natureStyleControls",t.icon="./static/maintoolbar/restrictedControl.svg",t.viewer=n,t.onclick=()=>{let i=n.mainViewport.controls;i.style!="nature"&&(i.style="nature")},t.oninit=i=>{let r=n.mainViewport.controls;i.active=r.style=="nature",r.controlParamChangedEvent.add(()=>{i.active=r.style=="nature"})},new ue(t)}function nO(n){let t=new ge;t.title="",t.key="staticmoving",t.icon="./static/maintoolbar/dynamic.svg",t.viewer=n,t.onclick=()=>{let i=n.mainViewport.controls;i.staticMoving=!i.staticMoving,e.active=!i.staticMoving},t.oninit=i=>{let r=n.mainViewport.controls;i.active=!r.staticMoving};let e=new ue(t);return e}function rO(n){let t=new ge;return t.title="Zoom in",t.key="",t.icon="./static/maintoolbar/zoomin.svg",t.viewer=n,t.onclick=()=>{n.mainViewport.zoomIn()},t.oninit=i=>{},new ue(t)}function sO(n){let t=new ge;return t.title="",t.key="zoomrect",t.icon="./static/maintoolbar/zoomout.svg",t.viewer=n,t.onclick=()=>{n.mainViewport.zoomOut()},t.oninit=i=>{n.mainViewport.controls},new ue(t)}function aO(n){let t=new ge;return t.title="",t.key="home",t.bs_icon="bi-house",t.viewer=n,t.onclick=()=>{n.mainViewport.controls.lookAtDir("iso"),n.mainViewport.zoomToFit()},t.oninit=i=>{n.mainViewport.controls},new ue(t)}function oO(n){let t=new ge;return t.title="",t.key="snap",t.icon="./static/maintoolbar/snap.svg",t.viewer=n,t.onclick=()=>{n.mainViewport.snapHelper.enabled=!n.mainViewport.snapHelper.enabled},t.oninit=i=>{let r=n.mainViewport.snapHelper;i.active=r.enabled,r.enableStatusChanged.add(a=>{i.active=a})},new ue(t)}function AO(n){let t=new ge;return t.title="",t.key="clip",t.icon="./static/maintoolbar/clip.svg",t.viewer=n,t.onclick=()=>{n.mainViewport.clippingHelper.enabled=!n.mainViewport.clippingHelper.enabled},t.oninit=i=>{let r=n.mainViewport.clippingHelper;i.active=r.enabled,r.enableStatusChanged.add(a=>{i.active=a})},new ue(t)}function lO(n){let t=new ge;return t.title="",t.key="clipbox",t.icon="./static/maintoolbar/clipbox.svg",t.viewer=n,t.onclick=()=>{n.mainViewport.clippingHelper.clippingBoxEnabled=!n.mainViewport.clippingHelper.clippingBoxEnabled},t.oninit=i=>{let r=n.mainViewport.clippingHelper;i.active=r.clippingBoxEnabled,i.visible=r.enabled,r.enableStatusChanged.add(a=>{i.visible=a}),r.boxEnableStatusChanged.add(a=>{i.active=a})},new ue(t)}function cO(n){let t=new ge;return t.title="",t.key="resetclip",t.icon="./static/maintoolbar/clipfit2.svg",t.viewer=n,t.onclick=()=>{n.mainViewport.clippingHelper.fit()},t.oninit=i=>{let r=n.mainViewport.clippingHelper;i.visible=r.enabled,r.enableStatusChanged.add(a=>{i.visible=a})},new ue(t)}function hO(n){let t=new ge;return t.title="",t.key="save_scene",t.icon="./static/maintoolbar/save.svg",t.viewer=n,t.onclick=()=>{n.savedViewManager.save()},new ue(t)}function uO(n){let t=new ge;return t.title="",t.key="save_scene_as",t.icon="./static/maintoolbar/saveas.svg",t.viewer=n,t.onclick=()=>{n.savedViewManager.saveAs()},new ue(t)}function fO(n){let t=new ge;t.title="",t.key="toggle-darkmode",t.bs_icon="bi-moon-stars",t.viewer=n,t.onclick=()=>{localStorage.getItem("colortheme")=="light"?(localStorage.setItem("colortheme","dark"),e.img.classList.replace("bi-moon-stars","bi-sun")):(localStorage.setItem("colortheme","light"),e.img.classList.replace("bi-sun","bi-moon-stars")),document.body.classList.toggle("night")},t.oninit=i=>{let r=localStorage.getItem("colortheme");r||(r="light",localStorage.setItem("colortheme",r)),r=="dark"?(i.img.classList.replace("bi-moon-stars","bi-sun"),document.body.classList.add("night")):(i.img.classList.replace("bi-sun","bi-moon-stars"),document.body.classList.remove("night"))};let e=new ue(t);return e.style.float="right",e}function dO(n){let t=new ge;t.title="",t.key="fullscreen",t.bs_icon="bi-fullscreen",t.viewer=n,t.onclick=()=>{n.fullscreen=!n.fullscreen},t.oninit=i=>{function r(){document.fullscreenElement!=n.dom?(i.img.classList.remove("bi-fullscreen-exit"),i.img.classList.add("bi-fullscreen")):(i.img.classList.add("bi-fullscreen-exit"),i.img.classList.remove("bi-fullscreen"))}document.addEventListener("fullscreenchange",()=>{r()}),r()};let e=new ue(t);return e.style.float="right",e}function pO(n){let t=new ge;t.title="",t.key="isolate",t.icon="./static/maintoolbar/isolate.svg",t.viewer=n,t.onclick=()=>{n.mainViewport.isolated=!n.mainViewport.isolated,e.active=n.mainViewport.isolated},t.oninit=i=>{i.active=n.mainViewport.isolated};let e=new ue(t);return e}function gO(n){let t=new zc;return t.title="",t.mode=n.measureMode,t.key="measure",t.viewer=n,t.icon="./static/maintoolbar/measure.svg",new Gc(t)}function mO(n){let t=new zc;return t.title="2D",t.icon="",t.mode=n.label2DMode,t.key="label2d",t.viewer=n,t.icon="./static/maintoolbar/label2d.svg",new Gc(t)}function vO(n){let t=new zc;return t.title="",t.icon="",t.mode=n.annoMode,t.key="anno",t.viewer=n,t.icon="./static/maintoolbar/anno.svg",new Gc(t)}function wO(n){let t=new zc;return t.title="",t.icon="",t.mode=n.coordsMode,t.key="coords",t.viewer=n,t.icon="./static/maintoolbar/coords.svg",new Gc(t)}function _O(n){let t=new ge;return t.title="",t.key="clearAll",t.icon="./static/maintoolbar/clearAll.svg",t.viewer=n,t.onclick=()=>{n.annoMode.clear(),n.label2DMode.clear(),n.measureMode.clear(),n.coordsMode.clear()},new ue(t)}function yO(n,t){let e=new Me;e.addClass("tv-product-logo"),e.dom.innerHTML='<span style="font-weight:100;xfont-size:18px;">t</span><span>omato</span>';let i=[e,ZP(t),tO(t),new lr,eO(t),iO(t),nO(t),new lr,aO(t),$P(t),JP(t),pO(t),rO(t),sO(t),new lr,gO(t),mO(t),vO(t),wO(t),_O(t),new lr,AO(t),lO(t),cO(t),new lr,oO(t),new lr,hO(t),uO(t)];for(let r of i)n.add(r)}class Wc{constructor(t){x(this,"viewer");x(this,"enabled",!1);x(this,"key");this.viewer=t}enable(){this.enabled=!0,console.log(this.key,"on")}disable(){this.enabled=!1,console.log(this.key,"off")}toObject(){throw"not implemented"}fromObject(t){}clear(){}}class xO extends Wc{constructor(e){super(e);x(this,"tool");x(this,"update",()=>{var e;(e=this.tool)==null||e.items.forEach(i=>{i.update()})});x(this,"onDone",()=>{this.viewer.mode=null});this.key="measure"}enable(){if(this.enabled)return;this.viewer.mainViewport.clippingHelper.enabled=!1;const e=this.viewer.mainToolbar.getButtonByKey("clip");e&&(e.enabled=!1);const i=this.viewer.mainToolbar.getButtonByKey("fullscreen");i&&(i.enabled=!1),this.viewer.mainViewport.allowSelect=!1,this.tool=this.viewer.editorToolFactory.getMeasureDistanceTool(this.viewer.mainViewport),this.tool.onDone.add(this.onDone),this.tool.onDrawFinish.add(()=>{this.viewer.mode=null}),super.enable()}disable(){var r;if(!this.enabled)return;const e=this.viewer.mainToolbar.getButtonByKey("clip");e&&(e.enabled=!0);const i=this.viewer.mainToolbar.getButtonByKey("fullscreen");i&&(i.enabled=!0),(r=this.tool)==null||r.endDraw(),this.tool.items.forEach(a=>a.active=!1),this.tool.onDone.remove(this.onDone),this.viewer.mainViewport.allowSelect=!0,super.disable()}toObject(){var e;return((e=this.tool)==null?void 0:e.items.map(i=>i.toJson()))??null}clear(){var e;(e=this.tool)==null||e.clear()}fromObject(e){if(this.tool=this.viewer.editorToolFactory.getMeasureDistanceTool(this.viewer.mainViewport),this.tool.drawBoard,this.clear(),!e||e.length==0){this.tool.endDraw();return}for(const i of e){const r=i.pointA,a=i.pointB,f=this.tool.createItem(new H(r.x,r.y,r.z),new H(a.x,a.y,a.z));f.active=!1}this.tool.endDraw()}}class CO extends Wc{constructor(e){super(e);x(this,"tool");x(this,"update",()=>{var e;(e=this.tool)==null||e.items.forEach(i=>{i.update()})});this.key="label2d"}enable(){this.enabled||(super.enable(),this.viewer.mainViewport.allowSelect=!1,this.tool=this.viewer.editorToolFactory.getLabelTool(this.viewer.mainViewport),this.tool.onDrawFinish.add(()=>{this.viewer.mode=null}))}disable(){var e,i;this.enabled&&((e=this.tool)==null||e.deleteEmptyItem(),this.viewer.mainViewport.allowSelect=!0,super.disable(),(i=this.tool)==null||i.endDraw())}toObject(){var i;return((i=this.tool)==null?void 0:i.items.map(r=>r.toJson()))??null}clear(){var e;(e=this.tool)==null||e.clear()}fromObject(e){this.tool=this.viewer.editorToolFactory.getLabelTool(this.viewer.mainViewport);const i=this.tool.drawBoard;if(this.clear(),!e){this.tool.endDraw();return}for(const r of e){const a=new bP(r.dy,r.dx,new H(r.refPoint.x,r.refPoint.y,r.refPoint.z),r.content,this.tool.viewport,i.svg,i.div);a.onItemDelete.add(this.tool.removeItem),this.tool.addItem(a)}this.tool.endDraw()}}class bO extends Wc{constructor(e){super(e);x(this,"tool");x(this,"lastObj");x(this,"sceneInfo");x(this,"enabledChangedEvent",new Ot);x(this,"onCancel",()=>{this.viewer.mode=null});this.key="anno"}enable(){if(this.enabled)return;super.enable();const e=this.viewer.mainViewport;this.tool=this.viewer.editorToolFactory.getCanvasDrawtool(e),this.tool.onDrawCancel.add(this.onCancel),e.controls.enabled=!1,e.allowSelect=!1,this.lastObj&&(console.log(this.lastObj),Rd(this.viewer.mainViewport,this.sceneInfo),this.fromObject(this.lastObj)),this.enabledChangedEvent.dispatch(!0)}disable(){var i;if(!this.enabled)return;super.disable(),this.toObject(),(i=this.tool)==null||i.endDraw();const e=this.viewer.mainViewport;e.controls.enabled=!0,e.allowSelect=!0,this.tool.onDrawCancel.remove(this.onCancel),this.enabledChangedEvent.dispatch(!1)}toObject(){var e;return this.sceneInfo=Qd(this.viewer.mainViewport),this.lastObj=(e=this.tool)==null?void 0:e.drawBoard.toObject(),console.log(this.lastObj),this.lastObj}clear(){var e;super.clear(),this.lastObj=null,(e=this.tool)==null||e.clear()}fromObject(e){this.tool.fromObject(e)}}class m_{constructor(){x(this,"id");x(this,"name","Unknown");x(this,"owner");x(this,"ts");x(this,"version");x(this,"thumbnail");x(this,"data")}}class BO{constructor(){x(this,"scene");x(this,"coords");x(this,"label2d");x(this,"measure");x(this,"anno")}}/*!
 * html2canvas 1.4.1 <https://html2canvas.hertzen.com>
 * Copyright (c) 2022 Niklas von Hertzen <https://hertzen.com>
 * Released under MIT License
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var xf=function(n,t){return xf=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])},xf(n,t)};function cn(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");xf(n,t);function e(){this.constructor=n}n.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var Cf=function(){return Cf=Object.assign||function(t){for(var e,i=1,r=arguments.length;i<r;i++){e=arguments[i];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])}return t},Cf.apply(this,arguments)};function hi(n,t,e,i){function r(a){return a instanceof e?a:new e(function(f){f(a)})}return new(e||(e=Promise))(function(a,f){function o(u){try{l(i.next(u))}catch(A){f(A)}}function s(u){try{l(i.throw(u))}catch(A){f(A)}}function l(u){u.done?a(u.value):r(u.value).then(o,s)}l((i=i.apply(n,t||[])).next())})}function ri(n,t){var e={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},i,r,a,f;return f={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function o(l){return function(u){return s([l,u])}}function s(l){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,r&&(a=l[0]&2?r.return:l[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,l[1])).done)return a;switch(r=0,a&&(l=[l[0]&2,a.value]),l[0]){case 0:case 1:a=l;break;case 4:return e.label++,{value:l[1],done:!1};case 5:e.label++,r=l[1],l=[0];continue;case 7:l=e.ops.pop(),e.trys.pop();continue;default:if(a=e.trys,!(a=a.length>0&&a[a.length-1])&&(l[0]===6||l[0]===2)){e=0;continue}if(l[0]===3&&(!a||l[1]>a[0]&&l[1]<a[3])){e.label=l[1];break}if(l[0]===6&&e.label<a[1]){e.label=a[1],a=l;break}if(a&&e.label<a[2]){e.label=a[2],e.ops.push(l);break}a[2]&&e.ops.pop(),e.trys.pop();continue}l=t.call(n,e)}catch(u){l=[6,u],r=0}finally{i=a=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function gl(n,t,e){if(e||arguments.length===2)for(var i=0,r=t.length,a;i<r;i++)(a||!(i in t))&&(a||(a=Array.prototype.slice.call(t,0,i)),a[i]=t[i]);return n.concat(a||t)}var Xn=function(){function n(t,e,i,r){this.left=t,this.top=e,this.width=i,this.height=r}return n.prototype.add=function(t,e,i,r){return new n(this.left+t,this.top+e,this.width+i,this.height+r)},n.fromClientRect=function(t,e){return new n(e.left+t.windowBounds.left,e.top+t.windowBounds.top,e.width,e.height)},n.fromDOMRectList=function(t,e){var i=Array.from(e).find(function(r){return r.width!==0});return i?new n(i.left+t.windowBounds.left,i.top+t.windowBounds.top,i.width,i.height):n.EMPTY},n.EMPTY=new n(0,0,0,0),n}(),Kc=function(n,t){return Xn.fromClientRect(n,t.getBoundingClientRect())},SO=function(n){var t=n.body,e=n.documentElement;if(!t||!e)throw new Error("Unable to get document size");var i=Math.max(Math.max(t.scrollWidth,e.scrollWidth),Math.max(t.offsetWidth,e.offsetWidth),Math.max(t.clientWidth,e.clientWidth)),r=Math.max(Math.max(t.scrollHeight,e.scrollHeight),Math.max(t.offsetHeight,e.offsetHeight),Math.max(t.clientHeight,e.clientHeight));return new Xn(0,0,i,r)},Xc=function(n){for(var t=[],e=0,i=n.length;e<i;){var r=n.charCodeAt(e++);if(r>=55296&&r<=56319&&e<i){var a=n.charCodeAt(e++);(a&64512)===56320?t.push(((r&1023)<<10)+(a&1023)+65536):(t.push(r),e--)}else t.push(r)}return t},Ie=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];if(String.fromCodePoint)return String.fromCodePoint.apply(String,n);var e=n.length;if(!e)return"";for(var i=[],r=-1,a="";++r<e;){var f=n[r];f<=65535?i.push(f):(f-=65536,i.push((f>>10)+55296,f%1024+56320)),(r+1===e||i.length>16384)&&(a+=String.fromCharCode.apply(String,i),i.length=0)}return a},zm="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",EO=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var ml=0;ml<zm.length;ml++)EO[zm.charCodeAt(ml)]=ml;var Gm="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bo=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var vl=0;vl<Gm.length;vl++)bo[Gm.charCodeAt(vl)]=vl;var MO=function(n){var t=n.length*.75,e=n.length,i,r=0,a,f,o,s;n[n.length-1]==="="&&(t--,n[n.length-2]==="="&&t--);var l=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&typeof Uint8Array.prototype.slice<"u"?new ArrayBuffer(t):new Array(t),u=Array.isArray(l)?l:new Uint8Array(l);for(i=0;i<e;i+=4)a=bo[n.charCodeAt(i)],f=bo[n.charCodeAt(i+1)],o=bo[n.charCodeAt(i+2)],s=bo[n.charCodeAt(i+3)],u[r++]=a<<2|f>>4,u[r++]=(f&15)<<4|o>>2,u[r++]=(o&3)<<6|s&63;return l},TO=function(n){for(var t=n.length,e=[],i=0;i<t;i+=2)e.push(n[i+1]<<8|n[i]);return e},FO=function(n){for(var t=n.length,e=[],i=0;i<t;i+=4)e.push(n[i+3]<<24|n[i+2]<<16|n[i+1]<<8|n[i]);return e},ns=5,Nd=6+5,gu=2,UO=Nd-ns,v_=65536>>ns,LO=1<<ns,mu=LO-1,IO=1024>>ns,DO=v_+IO,PO=DO,OO=32,QO=PO+OO,RO=65536>>Nd,HO=1<<UO,kO=HO-1,Wm=function(n,t,e){return n.slice?n.slice(t,e):new Uint16Array(Array.prototype.slice.call(n,t,e))},NO=function(n,t,e){return n.slice?n.slice(t,e):new Uint32Array(Array.prototype.slice.call(n,t,e))},VO=function(n,t){var e=MO(n),i=Array.isArray(e)?FO(e):new Uint32Array(e),r=Array.isArray(e)?TO(e):new Uint16Array(e),a=24,f=Wm(r,a/2,i[4]/2),o=i[5]===2?Wm(r,(a+i[4])/2):NO(i,Math.ceil((a+i[4])/4));return new zO(i[0],i[1],i[2],i[3],f,o)},zO=function(){function n(t,e,i,r,a,f){this.initialValue=t,this.errorValue=e,this.highStart=i,this.highValueIndex=r,this.index=a,this.data=f}return n.prototype.get=function(t){var e;if(t>=0){if(t<55296||t>56319&&t<=65535)return e=this.index[t>>ns],e=(e<<gu)+(t&mu),this.data[e];if(t<=65535)return e=this.index[v_+(t-55296>>ns)],e=(e<<gu)+(t&mu),this.data[e];if(t<this.highStart)return e=QO-RO+(t>>Nd),e=this.index[e],e+=t>>ns&kO,e=this.index[e],e=(e<<gu)+(t&mu),this.data[e];if(t<=1114111)return this.data[this.highValueIndex]}return this.errorValue},n}(),Km="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",GO=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var wl=0;wl<Km.length;wl++)GO[Km.charCodeAt(wl)]=wl;var WO="KwAAAAAAAAAACA4AUD0AADAgAAACAAAAAAAIABAAGABAAEgAUABYAGAAaABgAGgAYgBqAF8AZwBgAGgAcQB5AHUAfQCFAI0AlQCdAKIAqgCyALoAYABoAGAAaABgAGgAwgDKAGAAaADGAM4A0wDbAOEA6QDxAPkAAQEJAQ8BFwF1AH0AHAEkASwBNAE6AUIBQQFJAVEBWQFhAWgBcAF4ATAAgAGGAY4BlQGXAZ8BpwGvAbUBvQHFAc0B0wHbAeMB6wHxAfkBAQIJAvEBEQIZAiECKQIxAjgCQAJGAk4CVgJeAmQCbAJ0AnwCgQKJApECmQKgAqgCsAK4ArwCxAIwAMwC0wLbAjAA4wLrAvMC+AIAAwcDDwMwABcDHQMlAy0DNQN1AD0DQQNJA0kDSQNRA1EDVwNZA1kDdQB1AGEDdQBpA20DdQN1AHsDdQCBA4kDkQN1AHUAmQOhA3UAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AKYDrgN1AHUAtgO+A8YDzgPWAxcD3gPjA+sD8wN1AHUA+wMDBAkEdQANBBUEHQQlBCoEFwMyBDgEYABABBcDSARQBFgEYARoBDAAcAQzAXgEgASIBJAEdQCXBHUAnwSnBK4EtgS6BMIEyAR1AHUAdQB1AHUAdQCVANAEYABgAGAAYABgAGAAYABgANgEYADcBOQEYADsBPQE/AQEBQwFFAUcBSQFLAU0BWQEPAVEBUsFUwVbBWAAYgVgAGoFcgV6BYIFigWRBWAAmQWfBaYFYABgAGAAYABgAKoFYACxBbAFuQW6BcEFwQXHBcEFwQXPBdMF2wXjBeoF8gX6BQIGCgYSBhoGIgYqBjIGOgZgAD4GRgZMBmAAUwZaBmAAYABgAGAAYABgAGAAYABgAGAAYABgAGIGYABpBnAGYABgAGAAYABgAGAAYABgAGAAYAB4Bn8GhQZgAGAAYAB1AHcDFQSLBmAAYABgAJMGdQA9A3UAmwajBqsGqwaVALMGuwbDBjAAywbSBtIG1QbSBtIG0gbSBtIG0gbdBuMG6wbzBvsGAwcLBxMHAwcbByMHJwcsBywHMQcsB9IGOAdAB0gHTgfSBkgHVgfSBtIG0gbSBtIG0gbSBtIG0gbSBiwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdgAGAALAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdbB2MHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB2kH0gZwB64EdQB1AHUAdQB1AHUAdQB1AHUHfQdgAIUHjQd1AHUAlQedB2AAYAClB6sHYACzB7YHvgfGB3UAzgfWBzMB3gfmB1EB7gf1B/0HlQENAQUIDQh1ABUIHQglCBcDLQg1CD0IRQhNCEEDUwh1AHUAdQBbCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIcAh3CHoIMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIgggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAALAcsBywHLAcsBywHLAcsBywHLAcsB4oILAcsB44I0gaWCJ4Ipgh1AHUAqgiyCHUAdQB1AHUAdQB1AHUAdQB1AHUAtwh8AXUAvwh1AMUIyQjRCNkI4AjoCHUAdQB1AO4I9gj+CAYJDgkTCS0HGwkjCYIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiAAIAAAAFAAYABgAGIAXwBgAHEAdQBFAJUAogCyAKAAYABgAEIA4ABGANMA4QDxAMEBDwE1AFwBLAE6AQEBUQF4QkhCmEKoQrhCgAHIQsAB0MLAAcABwAHAAeDC6ABoAHDCwMMAAcABwAHAAdDDGMMAAcAB6MM4wwjDWMNow3jDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEjDqABWw6bDqABpg6gAaABoAHcDvwOPA+gAaABfA/8DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DpcPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB9cPKwkyCToJMAB1AHUAdQBCCUoJTQl1AFUJXAljCWcJawkwADAAMAAwAHMJdQB2CX4JdQCECYoJjgmWCXUAngkwAGAAYABxAHUApgn3A64JtAl1ALkJdQDACTAAMAAwADAAdQB1AHUAdQB1AHUAdQB1AHUAowYNBMUIMAAwADAAMADICcsJ0wnZCRUE4QkwAOkJ8An4CTAAMAB1AAAKvwh1AAgKDwoXCh8KdQAwACcKLgp1ADYKqAmICT4KRgowADAAdQB1AE4KMAB1AFYKdQBeCnUAZQowADAAMAAwADAAMAAwADAAMAAVBHUAbQowADAAdQC5CXUKMAAwAHwBxAijBogEMgF9CoQKiASMCpQKmgqIBKIKqgquCogEDQG2Cr4KxgrLCjAAMADTCtsKCgHjCusK8Qr5CgELMAAwADAAMAB1AIsECQsRC3UANAEZCzAAMAAwADAAMAB1ACELKQswAHUANAExCzkLdQBBC0kLMABRC1kLMAAwADAAMAAwADAAdQBhCzAAMAAwAGAAYABpC3ELdwt/CzAAMACHC4sLkwubC58Lpwt1AK4Ltgt1APsDMAAwADAAMAAwADAAMAAwAL4LwwvLC9IL1wvdCzAAMADlC+kL8Qv5C/8LSQswADAAMAAwADAAMAAwADAAMAAHDDAAMAAwADAAMAAODBYMHgx1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1ACYMMAAwADAAdQB1AHUALgx1AHUAdQB1AHUAdQA2DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AD4MdQBGDHUAdQB1AHUAdQB1AEkMdQB1AHUAdQB1AFAMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQBYDHUAdQB1AF8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUA+wMVBGcMMAAwAHwBbwx1AHcMfwyHDI8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAYABgAJcMMAAwADAAdQB1AJ8MlQClDDAAMACtDCwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB7UMLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AA0EMAC9DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAsBywHLAcsBywHLAcsBywHLQcwAMEMyAwsBywHLAcsBywHLAcsBywHLAcsBywHzAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1ANQM2QzhDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMABgAGAAYABgAGAAYABgAOkMYADxDGAA+AwADQYNYABhCWAAYAAODTAAMAAwADAAFg1gAGAAHg37AzAAMAAwADAAYABgACYNYAAsDTQNPA1gAEMNPg1LDWAAYABgAGAAYABgAGAAYABgAGAAUg1aDYsGVglhDV0NcQBnDW0NdQ15DWAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAlQCBDZUAiA2PDZcNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAnw2nDTAAMAAwADAAMAAwAHUArw23DTAAMAAwADAAMAAwADAAMAAwADAAMAB1AL8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQDHDTAAYABgAM8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA1w11ANwNMAAwAD0B5A0wADAAMAAwADAAMADsDfQN/A0EDgwOFA4wABsOMAAwADAAMAAwADAAMAAwANIG0gbSBtIG0gbSBtIG0gYjDigOwQUuDsEFMw7SBjoO0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGQg5KDlIOVg7SBtIGXg5lDm0OdQ7SBtIGfQ6EDooOjQ6UDtIGmg6hDtIG0gaoDqwO0ga0DrwO0gZgAGAAYADEDmAAYAAkBtIGzA5gANIOYADaDokO0gbSBt8O5w7SBu8O0gb1DvwO0gZgAGAAxA7SBtIG0gbSBtIGYABgAGAAYAAED2AAsAUMD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHJA8sBywHLAcsBywHLAccDywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywPLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAc0D9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHPA/SBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gYUD0QPlQCVAJUAMAAwADAAMACVAJUAlQCVAJUAlQCVAEwPMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA//8EAAQABAAEAAQABAAEAAQABAANAAMAAQABAAIABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQACgATABcAHgAbABoAHgAXABYAEgAeABsAGAAPABgAHABLAEsASwBLAEsASwBLAEsASwBLABgAGAAeAB4AHgATAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAGwASAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWAA0AEQAeAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAFAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJABYAGgAbABsAGwAeAB0AHQAeAE8AFwAeAA0AHgAeABoAGwBPAE8ADgBQAB0AHQAdAE8ATwAXAE8ATwBPABYAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwBWAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsABAAbABsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEAA0ADQBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABABQACsAKwArACsAKwArACsAKwAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUAAaABoAUABQAFAAUABQAEwAHgAbAFAAHgAEACsAKwAEAAQABAArAFAAUABQAFAAUABQACsAKwArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQACsAUABQACsAKwAEACsABAAEAAQABAAEACsAKwArACsABAAEACsAKwAEAAQABAArACsAKwAEACsAKwArACsAKwArACsAUABQAFAAUAArAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAAQABABQAFAAUAAEAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAArACsAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AGwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAKwArACsAKwArAAQABAAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAAQAUAArAFAAUABQAFAAUABQACsAKwArAFAAUABQACsAUABQAFAAUAArACsAKwBQAFAAKwBQACsAUABQACsAKwArAFAAUAArACsAKwBQAFAAUAArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAArACsAKwAEAAQABAArAAQABAAEAAQAKwArAFAAKwArACsAKwArACsABAArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAHgAeAB4AHgAeAB4AGwAeACsAKwArACsAKwAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAUABQAFAAKwArACsAKwArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwAOAFAAUABQAFAAUABQAFAAHgBQAAQABAAEAA4AUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAKwArAAQAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAKwArACsAKwArACsAUAArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAXABcAFwAXABcACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAXAArAFwAXABcAFwAXABcAFwAXABcAFwAKgBcAFwAKgAqACoAKgAqACoAKgAqACoAXAArACsAXABcAFwAXABcACsAXAArACoAKgAqACoAKgAqACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwBcAFwAXABcAFAADgAOAA4ADgAeAA4ADgAJAA4ADgANAAkAEwATABMAEwATAAkAHgATAB4AHgAeAAQABAAeAB4AHgAeAB4AHgBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAADQAEAB4ABAAeAAQAFgARABYAEQAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAAQABAAEAAQADQAEAAQAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAA0ADQAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeACsAHgAeAA4ADgANAA4AHgAeAB4AHgAeAAkACQArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgBcAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4AHgAeAB4AXABcAFwAXABcAFwAKgAqACoAKgBcAFwAXABcACoAKgAqAFwAKgAqACoAXABcACoAKgAqACoAKgAqACoAXABcAFwAKgAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwAKgBLAEsASwBLAEsASwBLAEsASwBLACoAKgAqACoAKgAqAFAAUABQAFAAUABQACsAUAArACsAKwArACsAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAKwBQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsABAAEAAQAHgANAB4AHgAeAB4AHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUAArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWABEAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAANAA0AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUAArAAQABAArACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAA0ADQAVAFwADQAeAA0AGwBcACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwAeAB4AEwATAA0ADQAOAB4AEwATAB4ABAAEAAQACQArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAHgArACsAKwATABMASwBLAEsASwBLAEsASwBLAEsASwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAXABcAFwAXABcACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXAArACsAKwAqACoAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsAHgAeAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKwArAAQASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACoAKgAqACoAKgAqACoAXAAqACoAKgAqACoAKgArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABABQAFAAUABQAFAAUABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgANAA0ADQANAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwAeAB4AHgAeAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArAA0ADQANAA0ADQBLAEsASwBLAEsASwBLAEsASwBLACsAKwArAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUAAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAAQAUABQAFAAUABQAFAABABQAFAABAAEAAQAUAArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQACsAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQACsAKwAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQACsAHgAeAB4AHgAeAB4AHgAOAB4AKwANAA0ADQANAA0ADQANAAkADQANAA0ACAAEAAsABAAEAA0ACQANAA0ADAAdAB0AHgAXABcAFgAXABcAFwAWABcAHQAdAB4AHgAUABQAFAANAAEAAQAEAAQABAAEAAQACQAaABoAGgAaABoAGgAaABoAHgAXABcAHQAVABUAHgAeAB4AHgAeAB4AGAAWABEAFQAVABUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ADQAeAA0ADQANAA0AHgANAA0ADQAHAB4AHgAeAB4AKwAEAAQABAAEAAQABAAEAAQABAAEAFAAUAArACsATwBQAFAAUABQAFAAHgAeAB4AFgARAE8AUABPAE8ATwBPAFAAUABQAFAAUAAeAB4AHgAWABEAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArABsAGwAbABsAGwAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGgAbABsAGwAbABoAGwAbABoAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAFAAGgAeAB0AHgBQAB4AGgAeAB4AHgAeAB4AHgAeAB4AHgBPAB4AUAAbAB4AHgBQAFAAUABQAFAAHgAeAB4AHQAdAB4AUAAeAFAAHgBQAB4AUABPAFAAUAAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgBQAFAAUABQAE8ATwBQAFAAUABQAFAATwBQAFAATwBQAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAUABQAFAATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABPAB4AHgArACsAKwArAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAdAB4AHgAeAB0AHQAeAB4AHQAeAB4AHgAdAB4AHQAbABsAHgAdAB4AHgAeAB4AHQAeAB4AHQAdAB0AHQAeAB4AHQAeAB0AHgAdAB0AHQAdAB0AHQAeAB0AHgAeAB4AHgAeAB0AHQAdAB0AHgAeAB4AHgAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB0AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAdAB0AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHQAdAB0AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHQAdAB4AHgAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AJQAlAB0AHQAlAB4AJQAlACUAIAAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAeAB0AJQAdAB0AHgAdAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAdAB0AHQAdACUAHgAlACUAJQAdACUAJQAdAB0AHQAlACUAHQAdACUAHQAdACUAJQAlAB4AHQAeAB4AHgAeAB0AHQAlAB0AHQAdAB0AHQAdACUAJQAlACUAJQAdACUAJQAgACUAHQAdACUAJQAlACUAJQAlACUAJQAeAB4AHgAlACUAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AFwAXABcAFwAXABcAHgATABMAJQAeAB4AHgAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARABYAEQAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANAA0AHgANAB4ADQANAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwAlACUAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACsAKwArACsAKwArACsAKwArACsAKwArAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBPAE8ATwBPAE8ATwBPAE8AJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeAAQAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUABQAAQAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAUABQAFAAUABQAAQABAAEACsABAAEACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAKwBQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAA0ADQANAA0ADQANAA0ADQAeACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAArACsAKwArAFAAUABQAFAAUAANAA0ADQANAA0ADQAUACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQANAA0ADQANAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAANACsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAB4AHgAeAB4AHgArACsAKwArACsAKwAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANAFAABAAEAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAEAAQABAAEAB4ABAAEAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsABAAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLAA0ADQArAB4ABABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUAAeAFAAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAAEAAQADgANAA0AEwATAB4AHgAeAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAFAAUABQAFAABAAEACsAKwAEAA0ADQAeAFAAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcAFwADQANAA0AKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQAKwAEAAQAKwArAAQABAAEAAQAUAAEAFAABAAEAA0ADQANACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABABQAA4AUAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANAFAADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAaABoAGgAaAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAJAAkACQAJAAkACQAJABYAEQArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AHgAeACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAARwBHABUARwAJACsAKwArACsAKwArACsAKwArACsAKwAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAKwArACsAKwArACsAKwArACsAKwArACsAKwBRAFEAUQBRACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAHgAEAAQADQAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAeAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQAHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAKwArAFAAKwArAFAAUAArACsAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAHgAeAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeACsAKwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4ABAAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAHgAeAA0ADQANAA0AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArAAQABAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwBQAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArABsAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAB4AHgAeAB4ABAAEAAQABAAEAAQABABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArABYAFgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAGgBQAFAAUAAaAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUAArACsAKwArACsAKwBQACsAKwArACsAUAArAFAAKwBQACsAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUAArAFAAKwBQACsAUAArAFAAUAArAFAAKwArAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAKwBQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeACUAJQAlAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAHgAlACUAJQAlACUAIAAgACAAJQAlACAAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACEAIQAhACEAIQAlACUAIAAgACUAJQAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAlACUAJQAlACAAIAAgACUAIAAgACAAJQAlACUAJQAlACUAJQAgACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAlAB4AJQAeACUAJQAlACUAJQAgACUAJQAlACUAHgAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACAAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABcAFwAXABUAFQAVAB4AHgAeAB4AJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAgACUAJQAgACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAIAAgACUAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACAAIAAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACAAIAAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAA==",Xm=50,KO=1,w_=2,__=3,XO=4,jO=5,jm=7,y_=8,Ym=9,fr=10,bf=11,qm=12,Bf=13,YO=14,Bo=15,Sf=16,_l=17,ho=18,qO=19,$m=20,Ef=21,uo=22,vu=23,Ws=24,Mi=25,So=26,Eo=27,Ks=28,$O=29,Kr=30,JO=31,yl=32,xl=33,Mf=34,Tf=35,Ff=36,tA=37,Uf=38,jl=39,Yl=40,wu=41,x_=42,ZO=43,tQ=[9001,65288],C_="!",te="",Cl="",Lf=VO(WO),On=[Kr,Ff],If=[KO,w_,__,jO],b_=[fr,y_],Jm=[Eo,So],eQ=If.concat(b_),Zm=[Uf,jl,Yl,Mf,Tf],iQ=[Bo,Bf],nQ=function(n,t){t===void 0&&(t="strict");var e=[],i=[],r=[];return n.forEach(function(a,f){var o=Lf.get(a);if(o>Xm?(r.push(!0),o-=Xm):r.push(!1),["normal","auto","loose"].indexOf(t)!==-1&&[8208,8211,12316,12448].indexOf(a)!==-1)return i.push(f),e.push(Sf);if(o===XO||o===bf){if(f===0)return i.push(f),e.push(Kr);var s=e[f-1];return eQ.indexOf(s)===-1?(i.push(i[f-1]),e.push(s)):(i.push(f),e.push(Kr))}if(i.push(f),o===JO)return e.push(t==="strict"?Ef:tA);if(o===x_||o===$O)return e.push(Kr);if(o===ZO)return a>=131072&&a<=196605||a>=196608&&a<=262141?e.push(tA):e.push(Kr);e.push(o)}),[i,e,r]},_u=function(n,t,e,i){var r=i[e];if(Array.isArray(n)?n.indexOf(r)!==-1:n===r)for(var a=e;a<=i.length;){a++;var f=i[a];if(f===t)return!0;if(f!==fr)break}if(r===fr)for(var a=e;a>0;){a--;var o=i[a];if(Array.isArray(n)?n.indexOf(o)!==-1:n===o)for(var s=e;s<=i.length;){s++;var f=i[s];if(f===t)return!0;if(f!==fr)break}if(o!==fr)break}return!1},tv=function(n,t){for(var e=n;e>=0;){var i=t[e];if(i===fr)e--;else return i}return 0},rQ=function(n,t,e,i,r){if(e[i]===0)return te;var a=i-1;if(Array.isArray(r)&&r[a]===!0)return te;var f=a-1,o=a+1,s=t[a],l=f>=0?t[f]:0,u=t[o];if(s===w_&&u===__)return te;if(If.indexOf(s)!==-1)return C_;if(If.indexOf(u)!==-1||b_.indexOf(u)!==-1)return te;if(tv(a,t)===y_)return Cl;if(Lf.get(n[a])===bf||(s===yl||s===xl)&&Lf.get(n[o])===bf||s===jm||u===jm||s===Ym||[fr,Bf,Bo].indexOf(s)===-1&&u===Ym||[_l,ho,qO,Ws,Ks].indexOf(u)!==-1||tv(a,t)===uo||_u(vu,uo,a,t)||_u([_l,ho],Ef,a,t)||_u(qm,qm,a,t))return te;if(s===fr)return Cl;if(s===vu||u===vu)return te;if(u===Sf||s===Sf)return Cl;if([Bf,Bo,Ef].indexOf(u)!==-1||s===YO||l===Ff&&iQ.indexOf(s)!==-1||s===Ks&&u===Ff||u===$m||On.indexOf(u)!==-1&&s===Mi||On.indexOf(s)!==-1&&u===Mi||s===Eo&&[tA,yl,xl].indexOf(u)!==-1||[tA,yl,xl].indexOf(s)!==-1&&u===So||On.indexOf(s)!==-1&&Jm.indexOf(u)!==-1||Jm.indexOf(s)!==-1&&On.indexOf(u)!==-1||[Eo,So].indexOf(s)!==-1&&(u===Mi||[uo,Bo].indexOf(u)!==-1&&t[o+1]===Mi)||[uo,Bo].indexOf(s)!==-1&&u===Mi||s===Mi&&[Mi,Ks,Ws].indexOf(u)!==-1)return te;if([Mi,Ks,Ws,_l,ho].indexOf(u)!==-1)for(var A=a;A>=0;){var c=t[A];if(c===Mi)return te;if([Ks,Ws].indexOf(c)!==-1)A--;else break}if([Eo,So].indexOf(u)!==-1)for(var A=[_l,ho].indexOf(s)!==-1?f:a;A>=0;){var c=t[A];if(c===Mi)return te;if([Ks,Ws].indexOf(c)!==-1)A--;else break}if(Uf===s&&[Uf,jl,Mf,Tf].indexOf(u)!==-1||[jl,Mf].indexOf(s)!==-1&&[jl,Yl].indexOf(u)!==-1||[Yl,Tf].indexOf(s)!==-1&&u===Yl||Zm.indexOf(s)!==-1&&[$m,So].indexOf(u)!==-1||Zm.indexOf(u)!==-1&&s===Eo||On.indexOf(s)!==-1&&On.indexOf(u)!==-1||s===Ws&&On.indexOf(u)!==-1||On.concat(Mi).indexOf(s)!==-1&&u===uo&&tQ.indexOf(n[o])===-1||On.concat(Mi).indexOf(u)!==-1&&s===ho)return te;if(s===wu&&u===wu){for(var h=e[a],p=1;h>0&&(h--,t[h]===wu);)p++;if(p%2!==0)return te}return s===yl&&u===xl?te:Cl},sQ=function(n,t){t||(t={lineBreak:"normal",wordBreak:"normal"});var e=nQ(n,t.lineBreak),i=e[0],r=e[1],a=e[2];(t.wordBreak==="break-all"||t.wordBreak==="break-word")&&(r=r.map(function(o){return[Mi,Kr,x_].indexOf(o)!==-1?tA:o}));var f=t.wordBreak==="keep-all"?a.map(function(o,s){return o&&n[s]>=19968&&n[s]<=40959}):void 0;return[i,r,f]},aQ=function(){function n(t,e,i,r){this.codePoints=t,this.required=e===C_,this.start=i,this.end=r}return n.prototype.slice=function(){return Ie.apply(void 0,this.codePoints.slice(this.start,this.end))},n}(),oQ=function(n,t){var e=Xc(n),i=sQ(e,t),r=i[0],a=i[1],f=i[2],o=e.length,s=0,l=0;return{next:function(){if(l>=o)return{done:!0,value:null};for(var u=te;l<o&&(u=rQ(e,a,r,++l,f))===te;);if(u!==te||l===o){var A=new aQ(e,u,s,l);return s=l,{value:A,done:!1}}return{done:!0,value:null}}}},AQ=1<<0,lQ=1<<1,_A=1<<2,ev=1<<3,uc=10,iv=47,Oo=92,cQ=9,hQ=32,bl=34,fo=61,uQ=35,fQ=36,dQ=37,Bl=39,Sl=40,po=41,pQ=95,mi=45,gQ=33,mQ=60,vQ=62,wQ=64,_Q=91,yQ=93,xQ=61,CQ=123,El=63,bQ=125,nv=124,BQ=126,SQ=128,rv=65533,yu=42,$r=43,EQ=44,MQ=58,TQ=59,eA=46,FQ=0,UQ=8,LQ=11,IQ=14,DQ=31,PQ=127,dn=-1,B_=48,S_=97,E_=101,OQ=102,QQ=117,RQ=122,M_=65,T_=69,F_=70,HQ=85,kQ=90,si=function(n){return n>=B_&&n<=57},NQ=function(n){return n>=55296&&n<=57343},Xs=function(n){return si(n)||n>=M_&&n<=F_||n>=S_&&n<=OQ},VQ=function(n){return n>=S_&&n<=RQ},zQ=function(n){return n>=M_&&n<=kQ},GQ=function(n){return VQ(n)||zQ(n)},WQ=function(n){return n>=SQ},Ml=function(n){return n===uc||n===cQ||n===hQ},fc=function(n){return GQ(n)||WQ(n)||n===pQ},sv=function(n){return fc(n)||si(n)||n===mi},KQ=function(n){return n>=FQ&&n<=UQ||n===LQ||n>=IQ&&n<=DQ||n===PQ},cr=function(n,t){return n!==Oo?!1:t!==uc},Tl=function(n,t,e){return n===mi?fc(t)||cr(t,e):fc(n)?!0:!!(n===Oo&&cr(n,t))},xu=function(n,t,e){return n===$r||n===mi?si(t)?!0:t===eA&&si(e):si(n===eA?t:n)},XQ=function(n){var t=0,e=1;(n[t]===$r||n[t]===mi)&&(n[t]===mi&&(e=-1),t++);for(var i=[];si(n[t]);)i.push(n[t++]);var r=i.length?parseInt(Ie.apply(void 0,i),10):0;n[t]===eA&&t++;for(var a=[];si(n[t]);)a.push(n[t++]);var f=a.length,o=f?parseInt(Ie.apply(void 0,a),10):0;(n[t]===T_||n[t]===E_)&&t++;var s=1;(n[t]===$r||n[t]===mi)&&(n[t]===mi&&(s=-1),t++);for(var l=[];si(n[t]);)l.push(n[t++]);var u=l.length?parseInt(Ie.apply(void 0,l),10):0;return e*(r+o*Math.pow(10,-f))*Math.pow(10,s*u)},jQ={type:2},YQ={type:3},qQ={type:4},$Q={type:13},JQ={type:8},ZQ={type:21},tR={type:9},eR={type:10},iR={type:11},nR={type:12},rR={type:14},Fl={type:23},sR={type:1},aR={type:25},oR={type:24},AR={type:26},lR={type:27},cR={type:28},hR={type:29},uR={type:31},Df={type:32},U_=function(){function n(){this._value=[]}return n.prototype.write=function(t){this._value=this._value.concat(Xc(t))},n.prototype.read=function(){for(var t=[],e=this.consumeToken();e!==Df;)t.push(e),e=this.consumeToken();return t},n.prototype.consumeToken=function(){var t=this.consumeCodePoint();switch(t){case bl:return this.consumeStringToken(bl);case uQ:var e=this.peekCodePoint(0),i=this.peekCodePoint(1),r=this.peekCodePoint(2);if(sv(e)||cr(i,r)){var a=Tl(e,i,r)?lQ:AQ,f=this.consumeName();return{type:5,value:f,flags:a}}break;case fQ:if(this.peekCodePoint(0)===fo)return this.consumeCodePoint(),$Q;break;case Bl:return this.consumeStringToken(Bl);case Sl:return jQ;case po:return YQ;case yu:if(this.peekCodePoint(0)===fo)return this.consumeCodePoint(),rR;break;case $r:if(xu(t,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(t),this.consumeNumericToken();break;case EQ:return qQ;case mi:var o=t,s=this.peekCodePoint(0),l=this.peekCodePoint(1);if(xu(o,s,l))return this.reconsumeCodePoint(t),this.consumeNumericToken();if(Tl(o,s,l))return this.reconsumeCodePoint(t),this.consumeIdentLikeToken();if(s===mi&&l===vQ)return this.consumeCodePoint(),this.consumeCodePoint(),oR;break;case eA:if(xu(t,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(t),this.consumeNumericToken();break;case iv:if(this.peekCodePoint(0)===yu)for(this.consumeCodePoint();;){var u=this.consumeCodePoint();if(u===yu&&(u=this.consumeCodePoint(),u===iv))return this.consumeToken();if(u===dn)return this.consumeToken()}break;case MQ:return AR;case TQ:return lR;case mQ:if(this.peekCodePoint(0)===gQ&&this.peekCodePoint(1)===mi&&this.peekCodePoint(2)===mi)return this.consumeCodePoint(),this.consumeCodePoint(),aR;break;case wQ:var A=this.peekCodePoint(0),c=this.peekCodePoint(1),h=this.peekCodePoint(2);if(Tl(A,c,h)){var f=this.consumeName();return{type:7,value:f}}break;case _Q:return cR;case Oo:if(cr(t,this.peekCodePoint(0)))return this.reconsumeCodePoint(t),this.consumeIdentLikeToken();break;case yQ:return hR;case xQ:if(this.peekCodePoint(0)===fo)return this.consumeCodePoint(),JQ;break;case CQ:return iR;case bQ:return nR;case QQ:case HQ:var p=this.peekCodePoint(0),m=this.peekCodePoint(1);return p===$r&&(Xs(m)||m===El)&&(this.consumeCodePoint(),this.consumeUnicodeRangeToken()),this.reconsumeCodePoint(t),this.consumeIdentLikeToken();case nv:if(this.peekCodePoint(0)===fo)return this.consumeCodePoint(),tR;if(this.peekCodePoint(0)===nv)return this.consumeCodePoint(),ZQ;break;case BQ:if(this.peekCodePoint(0)===fo)return this.consumeCodePoint(),eR;break;case dn:return Df}return Ml(t)?(this.consumeWhiteSpace(),uR):si(t)?(this.reconsumeCodePoint(t),this.consumeNumericToken()):fc(t)?(this.reconsumeCodePoint(t),this.consumeIdentLikeToken()):{type:6,value:Ie(t)}},n.prototype.consumeCodePoint=function(){var t=this._value.shift();return typeof t>"u"?-1:t},n.prototype.reconsumeCodePoint=function(t){this._value.unshift(t)},n.prototype.peekCodePoint=function(t){return t>=this._value.length?-1:this._value[t]},n.prototype.consumeUnicodeRangeToken=function(){for(var t=[],e=this.consumeCodePoint();Xs(e)&&t.length<6;)t.push(e),e=this.consumeCodePoint();for(var i=!1;e===El&&t.length<6;)t.push(e),e=this.consumeCodePoint(),i=!0;if(i){var r=parseInt(Ie.apply(void 0,t.map(function(s){return s===El?B_:s})),16),a=parseInt(Ie.apply(void 0,t.map(function(s){return s===El?F_:s})),16);return{type:30,start:r,end:a}}var f=parseInt(Ie.apply(void 0,t),16);if(this.peekCodePoint(0)===mi&&Xs(this.peekCodePoint(1))){this.consumeCodePoint(),e=this.consumeCodePoint();for(var o=[];Xs(e)&&o.length<6;)o.push(e),e=this.consumeCodePoint();var a=parseInt(Ie.apply(void 0,o),16);return{type:30,start:f,end:a}}else return{type:30,start:f,end:f}},n.prototype.consumeIdentLikeToken=function(){var t=this.consumeName();return t.toLowerCase()==="url"&&this.peekCodePoint(0)===Sl?(this.consumeCodePoint(),this.consumeUrlToken()):this.peekCodePoint(0)===Sl?(this.consumeCodePoint(),{type:19,value:t}):{type:20,value:t}},n.prototype.consumeUrlToken=function(){var t=[];if(this.consumeWhiteSpace(),this.peekCodePoint(0)===dn)return{type:22,value:""};var e=this.peekCodePoint(0);if(e===Bl||e===bl){var i=this.consumeStringToken(this.consumeCodePoint());return i.type===0&&(this.consumeWhiteSpace(),this.peekCodePoint(0)===dn||this.peekCodePoint(0)===po)?(this.consumeCodePoint(),{type:22,value:i.value}):(this.consumeBadUrlRemnants(),Fl)}for(;;){var r=this.consumeCodePoint();if(r===dn||r===po)return{type:22,value:Ie.apply(void 0,t)};if(Ml(r))return this.consumeWhiteSpace(),this.peekCodePoint(0)===dn||this.peekCodePoint(0)===po?(this.consumeCodePoint(),{type:22,value:Ie.apply(void 0,t)}):(this.consumeBadUrlRemnants(),Fl);if(r===bl||r===Bl||r===Sl||KQ(r))return this.consumeBadUrlRemnants(),Fl;if(r===Oo)if(cr(r,this.peekCodePoint(0)))t.push(this.consumeEscapedCodePoint());else return this.consumeBadUrlRemnants(),Fl;else t.push(r)}},n.prototype.consumeWhiteSpace=function(){for(;Ml(this.peekCodePoint(0));)this.consumeCodePoint()},n.prototype.consumeBadUrlRemnants=function(){for(;;){var t=this.consumeCodePoint();if(t===po||t===dn)return;cr(t,this.peekCodePoint(0))&&this.consumeEscapedCodePoint()}},n.prototype.consumeStringSlice=function(t){for(var e=5e4,i="";t>0;){var r=Math.min(e,t);i+=Ie.apply(void 0,this._value.splice(0,r)),t-=r}return this._value.shift(),i},n.prototype.consumeStringToken=function(t){var e="",i=0;do{var r=this._value[i];if(r===dn||r===void 0||r===t)return e+=this.consumeStringSlice(i),{type:0,value:e};if(r===uc)return this._value.splice(0,i),sR;if(r===Oo){var a=this._value[i+1];a!==dn&&a!==void 0&&(a===uc?(e+=this.consumeStringSlice(i),i=-1,this._value.shift()):cr(r,a)&&(e+=this.consumeStringSlice(i),e+=Ie(this.consumeEscapedCodePoint()),i=-1))}i++}while(!0)},n.prototype.consumeNumber=function(){var t=[],e=_A,i=this.peekCodePoint(0);for((i===$r||i===mi)&&t.push(this.consumeCodePoint());si(this.peekCodePoint(0));)t.push(this.consumeCodePoint());i=this.peekCodePoint(0);var r=this.peekCodePoint(1);if(i===eA&&si(r))for(t.push(this.consumeCodePoint(),this.consumeCodePoint()),e=ev;si(this.peekCodePoint(0));)t.push(this.consumeCodePoint());i=this.peekCodePoint(0),r=this.peekCodePoint(1);var a=this.peekCodePoint(2);if((i===T_||i===E_)&&((r===$r||r===mi)&&si(a)||si(r)))for(t.push(this.consumeCodePoint(),this.consumeCodePoint()),e=ev;si(this.peekCodePoint(0));)t.push(this.consumeCodePoint());return[XQ(t),e]},n.prototype.consumeNumericToken=function(){var t=this.consumeNumber(),e=t[0],i=t[1],r=this.peekCodePoint(0),a=this.peekCodePoint(1),f=this.peekCodePoint(2);if(Tl(r,a,f)){var o=this.consumeName();return{type:15,number:e,flags:i,unit:o}}return r===dQ?(this.consumeCodePoint(),{type:16,number:e,flags:i}):{type:17,number:e,flags:i}},n.prototype.consumeEscapedCodePoint=function(){var t=this.consumeCodePoint();if(Xs(t)){for(var e=Ie(t);Xs(this.peekCodePoint(0))&&e.length<6;)e+=Ie(this.consumeCodePoint());Ml(this.peekCodePoint(0))&&this.consumeCodePoint();var i=parseInt(e,16);return i===0||NQ(i)||i>1114111?rv:i}return t===dn?rv:t},n.prototype.consumeName=function(){for(var t="";;){var e=this.consumeCodePoint();if(sv(e))t+=Ie(e);else if(cr(e,this.peekCodePoint(0)))t+=Ie(this.consumeEscapedCodePoint());else return this.reconsumeCodePoint(e),t}},n}(),L_=function(){function n(t){this._tokens=t}return n.create=function(t){var e=new U_;return e.write(t),new n(e.read())},n.parseValue=function(t){return n.create(t).parseComponentValue()},n.parseValues=function(t){return n.create(t).parseComponentValues()},n.prototype.parseComponentValue=function(){for(var t=this.consumeToken();t.type===31;)t=this.consumeToken();if(t.type===32)throw new SyntaxError("Error parsing CSS component value, unexpected EOF");this.reconsumeToken(t);var e=this.consumeComponentValue();do t=this.consumeToken();while(t.type===31);if(t.type===32)return e;throw new SyntaxError("Error parsing CSS component value, multiple values found when expecting only one")},n.prototype.parseComponentValues=function(){for(var t=[];;){var e=this.consumeComponentValue();if(e.type===32)return t;t.push(e),t.push()}},n.prototype.consumeComponentValue=function(){var t=this.consumeToken();switch(t.type){case 11:case 28:case 2:return this.consumeSimpleBlock(t.type);case 19:return this.consumeFunction(t)}return t},n.prototype.consumeSimpleBlock=function(t){for(var e={type:t,values:[]},i=this.consumeToken();;){if(i.type===32||dR(i,t))return e;this.reconsumeToken(i),e.values.push(this.consumeComponentValue()),i=this.consumeToken()}},n.prototype.consumeFunction=function(t){for(var e={name:t.value,values:[],type:18};;){var i=this.consumeToken();if(i.type===32||i.type===3)return e;this.reconsumeToken(i),e.values.push(this.consumeComponentValue())}},n.prototype.consumeToken=function(){var t=this._tokens.shift();return typeof t>"u"?Df:t},n.prototype.reconsumeToken=function(t){this._tokens.unshift(t)},n}(),yA=function(n){return n.type===15},Ka=function(n){return n.type===17},me=function(n){return n.type===20},fR=function(n){return n.type===0},Pf=function(n,t){return me(n)&&n.value===t},I_=function(n){return n.type!==31},Da=function(n){return n.type!==31&&n.type!==4},En=function(n){var t=[],e=[];return n.forEach(function(i){if(i.type===4){if(e.length===0)throw new Error("Error parsing function args, zero tokens for arg");t.push(e),e=[];return}i.type!==31&&e.push(i)}),e.length&&t.push(e),t},dR=function(n,t){return t===11&&n.type===12||t===28&&n.type===29?!0:t===2&&n.type===3},Sr=function(n){return n.type===17||n.type===15},He=function(n){return n.type===16||Sr(n)},D_=function(n){return n.length>1?[n[0],n[1]]:[n[0]]},Ze={type:17,number:0,flags:_A},Vd={type:16,number:50,flags:_A},dr={type:16,number:100,flags:_A},Mo=function(n,t,e){var i=n[0],r=n[1];return[_e(i,t),_e(typeof r<"u"?r:i,e)]},_e=function(n,t){if(n.type===16)return n.number/100*t;if(yA(n))switch(n.unit){case"rem":case"em":return 16*n.number;case"px":default:return n.number}return n.number},P_="deg",O_="grad",Q_="rad",R_="turn",jc={name:"angle",parse:function(n,t){if(t.type===15)switch(t.unit){case P_:return Math.PI*t.number/180;case O_:return Math.PI/200*t.number;case Q_:return t.number;case R_:return Math.PI*2*t.number}throw new Error("Unsupported angle type")}},H_=function(n){return n.type===15&&(n.unit===P_||n.unit===O_||n.unit===Q_||n.unit===R_)},k_=function(n){var t=n.filter(me).map(function(e){return e.value}).join(" ");switch(t){case"to bottom right":case"to right bottom":case"left top":case"top left":return[Ze,Ze];case"to top":case"bottom":return Xi(0);case"to bottom left":case"to left bottom":case"right top":case"top right":return[Ze,dr];case"to right":case"left":return Xi(90);case"to top left":case"to left top":case"right bottom":case"bottom right":return[dr,dr];case"to bottom":case"top":return Xi(180);case"to top right":case"to right top":case"left bottom":case"bottom left":return[dr,Ze];case"to left":case"right":return Xi(270)}return 0},Xi=function(n){return Math.PI*n/180},mr={name:"color",parse:function(n,t){if(t.type===18){var e=pR[t.name];if(typeof e>"u")throw new Error('Attempting to parse an unsupported color function "'+t.name+'"');return e(n,t.values)}if(t.type===5){if(t.value.length===3){var i=t.value.substring(0,1),r=t.value.substring(1,2),a=t.value.substring(2,3);return pr(parseInt(i+i,16),parseInt(r+r,16),parseInt(a+a,16),1)}if(t.value.length===4){var i=t.value.substring(0,1),r=t.value.substring(1,2),a=t.value.substring(2,3),f=t.value.substring(3,4);return pr(parseInt(i+i,16),parseInt(r+r,16),parseInt(a+a,16),parseInt(f+f,16)/255)}if(t.value.length===6){var i=t.value.substring(0,2),r=t.value.substring(2,4),a=t.value.substring(4,6);return pr(parseInt(i,16),parseInt(r,16),parseInt(a,16),1)}if(t.value.length===8){var i=t.value.substring(0,2),r=t.value.substring(2,4),a=t.value.substring(4,6),f=t.value.substring(6,8);return pr(parseInt(i,16),parseInt(r,16),parseInt(a,16),parseInt(f,16)/255)}}if(t.type===20){var o=zn[t.value.toUpperCase()];if(typeof o<"u")return o}return zn.TRANSPARENT}},vr=function(n){return(255&n)===0},Ke=function(n){var t=255&n,e=255&n>>8,i=255&n>>16,r=255&n>>24;return t<255?"rgba("+r+","+i+","+e+","+t/255+")":"rgb("+r+","+i+","+e+")"},pr=function(n,t,e,i){return(n<<24|t<<16|e<<8|Math.round(i*255)<<0)>>>0},av=function(n,t){if(n.type===17)return n.number;if(n.type===16){var e=t===3?1:255;return t===3?n.number/100*e:Math.round(n.number/100*e)}return 0},ov=function(n,t){var e=t.filter(Da);if(e.length===3){var i=e.map(av),r=i[0],a=i[1],f=i[2];return pr(r,a,f,1)}if(e.length===4){var o=e.map(av),r=o[0],a=o[1],f=o[2],s=o[3];return pr(r,a,f,s)}return 0};function Cu(n,t,e){return e<0&&(e+=1),e>=1&&(e-=1),e<1/6?(t-n)*e*6+n:e<1/2?t:e<2/3?(t-n)*6*(2/3-e)+n:n}var Av=function(n,t){var e=t.filter(Da),i=e[0],r=e[1],a=e[2],f=e[3],o=(i.type===17?Xi(i.number):jc.parse(n,i))/(Math.PI*2),s=He(r)?r.number/100:0,l=He(a)?a.number/100:0,u=typeof f<"u"&&He(f)?_e(f,1):1;if(s===0)return pr(l*255,l*255,l*255,1);var A=l<=.5?l*(s+1):l+s-l*s,c=l*2-A,h=Cu(c,A,o+1/3),p=Cu(c,A,o),m=Cu(c,A,o-1/3);return pr(h*255,p*255,m*255,u)},pR={hsl:Av,hsla:Av,rgb:ov,rgba:ov},Qo=function(n,t){return mr.parse(n,L_.create(t).parseComponentValue())},zn={ALICEBLUE:4042850303,ANTIQUEWHITE:4209760255,AQUA:16777215,AQUAMARINE:2147472639,AZURE:4043309055,BEIGE:4126530815,BISQUE:4293182719,BLACK:255,BLANCHEDALMOND:4293643775,BLUE:65535,BLUEVIOLET:2318131967,BROWN:2771004159,BURLYWOOD:3736635391,CADETBLUE:1604231423,CHARTREUSE:2147418367,CHOCOLATE:3530104575,CORAL:4286533887,CORNFLOWERBLUE:1687547391,CORNSILK:4294499583,CRIMSON:3692313855,CYAN:16777215,DARKBLUE:35839,DARKCYAN:9145343,DARKGOLDENROD:3095837695,DARKGRAY:2846468607,DARKGREEN:6553855,DARKGREY:2846468607,DARKKHAKI:3182914559,DARKMAGENTA:2332068863,DARKOLIVEGREEN:1433087999,DARKORANGE:4287365375,DARKORCHID:2570243327,DARKRED:2332033279,DARKSALMON:3918953215,DARKSEAGREEN:2411499519,DARKSLATEBLUE:1211993087,DARKSLATEGRAY:793726975,DARKSLATEGREY:793726975,DARKTURQUOISE:13554175,DARKVIOLET:2483082239,DEEPPINK:4279538687,DEEPSKYBLUE:12582911,DIMGRAY:1768516095,DIMGREY:1768516095,DODGERBLUE:512819199,FIREBRICK:2988581631,FLORALWHITE:4294635775,FORESTGREEN:579543807,FUCHSIA:4278255615,GAINSBORO:3705462015,GHOSTWHITE:4177068031,GOLD:4292280575,GOLDENROD:3668254975,GRAY:2155905279,GREEN:8388863,GREENYELLOW:2919182335,GREY:2155905279,HONEYDEW:4043305215,HOTPINK:4285117695,INDIANRED:3445382399,INDIGO:1258324735,IVORY:4294963455,KHAKI:4041641215,LAVENDER:3873897215,LAVENDERBLUSH:4293981695,LAWNGREEN:2096890111,LEMONCHIFFON:4294626815,LIGHTBLUE:2916673279,LIGHTCORAL:4034953471,LIGHTCYAN:3774873599,LIGHTGOLDENRODYELLOW:4210742015,LIGHTGRAY:3553874943,LIGHTGREEN:2431553791,LIGHTGREY:3553874943,LIGHTPINK:4290167295,LIGHTSALMON:4288707327,LIGHTSEAGREEN:548580095,LIGHTSKYBLUE:2278488831,LIGHTSLATEGRAY:2005441023,LIGHTSLATEGREY:2005441023,LIGHTSTEELBLUE:2965692159,LIGHTYELLOW:4294959359,LIME:16711935,LIMEGREEN:852308735,LINEN:4210091775,MAGENTA:4278255615,MAROON:2147483903,MEDIUMAQUAMARINE:1724754687,MEDIUMBLUE:52735,MEDIUMORCHID:3126187007,MEDIUMPURPLE:2473647103,MEDIUMSEAGREEN:1018393087,MEDIUMSLATEBLUE:2070474495,MEDIUMSPRINGGREEN:16423679,MEDIUMTURQUOISE:1221709055,MEDIUMVIOLETRED:3340076543,MIDNIGHTBLUE:421097727,MINTCREAM:4127193855,MISTYROSE:4293190143,MOCCASIN:4293178879,NAVAJOWHITE:4292783615,NAVY:33023,OLDLACE:4260751103,OLIVE:2155872511,OLIVEDRAB:1804477439,ORANGE:4289003775,ORANGERED:4282712319,ORCHID:3664828159,PALEGOLDENROD:4008225535,PALEGREEN:2566625535,PALETURQUOISE:2951671551,PALEVIOLETRED:3681588223,PAPAYAWHIP:4293907967,PEACHPUFF:4292524543,PERU:3448061951,PINK:4290825215,PLUM:3718307327,POWDERBLUE:2967529215,PURPLE:2147516671,REBECCAPURPLE:1714657791,RED:4278190335,ROSYBROWN:3163525119,ROYALBLUE:1097458175,SADDLEBROWN:2336560127,SALMON:4202722047,SANDYBROWN:4104413439,SEAGREEN:780883967,SEASHELL:4294307583,SIENNA:2689740287,SILVER:3233857791,SKYBLUE:2278484991,SLATEBLUE:1784335871,SLATEGRAY:1887473919,SLATEGREY:1887473919,SNOW:4294638335,SPRINGGREEN:16744447,STEELBLUE:1182971135,TAN:3535047935,TEAL:8421631,THISTLE:3636451583,TOMATO:4284696575,TRANSPARENT:0,TURQUOISE:1088475391,VIOLET:4001558271,WHEAT:4125012991,WHITE:4294967295,WHITESMOKE:4126537215,YELLOW:4294902015,YELLOWGREEN:2597139199},gR={name:"background-clip",initialValue:"border-box",prefix:!1,type:1,parse:function(n,t){return t.map(function(e){if(me(e))switch(e.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},mR={name:"background-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},Yc=function(n,t){var e=mr.parse(n,t[0]),i=t[1];return i&&He(i)?{color:e,stop:i}:{color:e,stop:null}},lv=function(n,t){var e=n[0],i=n[n.length-1];e.stop===null&&(e.stop=Ze),i.stop===null&&(i.stop=dr);for(var r=[],a=0,f=0;f<n.length;f++){var o=n[f].stop;if(o!==null){var s=_e(o,t);s>a?r.push(s):r.push(a),a=s}else r.push(null)}for(var l=null,f=0;f<r.length;f++){var u=r[f];if(u===null)l===null&&(l=f);else if(l!==null){for(var A=f-l,c=r[l-1],h=(u-c)/(A+1),p=1;p<=A;p++)r[l+p-1]=h*p;l=null}}return n.map(function(m,d){var g=m.color;return{color:g,stop:Math.max(Math.min(1,r[d]/t),0)}})},vR=function(n,t,e){var i=t/2,r=e/2,a=_e(n[0],t)-i,f=r-_e(n[1],e);return(Math.atan2(f,a)+Math.PI*2)%(Math.PI*2)},wR=function(n,t,e){var i=typeof n=="number"?n:vR(n,t,e),r=Math.abs(t*Math.sin(i))+Math.abs(e*Math.cos(i)),a=t/2,f=e/2,o=r/2,s=Math.sin(i-Math.PI/2)*o,l=Math.cos(i-Math.PI/2)*o;return[r,a-l,a+l,f-s,f+s]},rn=function(n,t){return Math.sqrt(n*n+t*t)},cv=function(n,t,e,i,r){var a=[[0,0],[0,t],[n,0],[n,t]];return a.reduce(function(f,o){var s=o[0],l=o[1],u=rn(e-s,i-l);return(r?u<f.optimumDistance:u>f.optimumDistance)?{optimumCorner:o,optimumDistance:u}:f},{optimumDistance:r?1/0:-1/0,optimumCorner:null}).optimumCorner},_R=function(n,t,e,i,r){var a=0,f=0;switch(n.size){case 0:n.shape===0?a=f=Math.min(Math.abs(t),Math.abs(t-i),Math.abs(e),Math.abs(e-r)):n.shape===1&&(a=Math.min(Math.abs(t),Math.abs(t-i)),f=Math.min(Math.abs(e),Math.abs(e-r)));break;case 2:if(n.shape===0)a=f=Math.min(rn(t,e),rn(t,e-r),rn(t-i,e),rn(t-i,e-r));else if(n.shape===1){var o=Math.min(Math.abs(e),Math.abs(e-r))/Math.min(Math.abs(t),Math.abs(t-i)),s=cv(i,r,t,e,!0),l=s[0],u=s[1];a=rn(l-t,(u-e)/o),f=o*a}break;case 1:n.shape===0?a=f=Math.max(Math.abs(t),Math.abs(t-i),Math.abs(e),Math.abs(e-r)):n.shape===1&&(a=Math.max(Math.abs(t),Math.abs(t-i)),f=Math.max(Math.abs(e),Math.abs(e-r)));break;case 3:if(n.shape===0)a=f=Math.max(rn(t,e),rn(t,e-r),rn(t-i,e),rn(t-i,e-r));else if(n.shape===1){var o=Math.max(Math.abs(e),Math.abs(e-r))/Math.max(Math.abs(t),Math.abs(t-i)),A=cv(i,r,t,e,!1),l=A[0],u=A[1];a=rn(l-t,(u-e)/o),f=o*a}break}return Array.isArray(n.size)&&(a=_e(n.size[0],i),f=n.size.length===2?_e(n.size[1],r):a),[a,f]},yR=function(n,t){var e=Xi(180),i=[];return En(t).forEach(function(r,a){if(a===0){var f=r[0];if(f.type===20&&f.value==="to"){e=k_(r);return}else if(H_(f)){e=jc.parse(n,f);return}}var o=Yc(n,r);i.push(o)}),{angle:e,stops:i,type:1}},Ul=function(n,t){var e=Xi(180),i=[];return En(t).forEach(function(r,a){if(a===0){var f=r[0];if(f.type===20&&["top","left","right","bottom"].indexOf(f.value)!==-1){e=k_(r);return}else if(H_(f)){e=(jc.parse(n,f)+Xi(270))%Xi(360);return}}var o=Yc(n,r);i.push(o)}),{angle:e,stops:i,type:1}},xR=function(n,t){var e=Xi(180),i=[],r=1,a=0,f=3,o=[];return En(t).forEach(function(s,l){var u=s[0];if(l===0){if(me(u)&&u.value==="linear"){r=1;return}else if(me(u)&&u.value==="radial"){r=2;return}}if(u.type===18){if(u.name==="from"){var A=mr.parse(n,u.values[0]);i.push({stop:Ze,color:A})}else if(u.name==="to"){var A=mr.parse(n,u.values[0]);i.push({stop:dr,color:A})}else if(u.name==="color-stop"){var c=u.values.filter(Da);if(c.length===2){var A=mr.parse(n,c[1]),h=c[0];Ka(h)&&i.push({stop:{type:16,number:h.number*100,flags:h.flags},color:A})}}}}),r===1?{angle:(e+Xi(180))%Xi(360),stops:i,type:r}:{size:f,shape:a,stops:i,position:o,type:r}},N_="closest-side",V_="farthest-side",z_="closest-corner",G_="farthest-corner",W_="circle",K_="ellipse",X_="cover",j_="contain",CR=function(n,t){var e=0,i=3,r=[],a=[];return En(t).forEach(function(f,o){var s=!0;if(o===0){var l=!1;s=f.reduce(function(A,c){if(l)if(me(c))switch(c.value){case"center":return a.push(Vd),A;case"top":case"left":return a.push(Ze),A;case"right":case"bottom":return a.push(dr),A}else(He(c)||Sr(c))&&a.push(c);else if(me(c))switch(c.value){case W_:return e=0,!1;case K_:return e=1,!1;case"at":return l=!0,!1;case N_:return i=0,!1;case X_:case V_:return i=1,!1;case j_:case z_:return i=2,!1;case G_:return i=3,!1}else if(Sr(c)||He(c))return Array.isArray(i)||(i=[]),i.push(c),!1;return A},s)}if(s){var u=Yc(n,f);r.push(u)}}),{size:i,shape:e,stops:r,position:a,type:2}},Ll=function(n,t){var e=0,i=3,r=[],a=[];return En(t).forEach(function(f,o){var s=!0;if(o===0?s=f.reduce(function(u,A){if(me(A))switch(A.value){case"center":return a.push(Vd),!1;case"top":case"left":return a.push(Ze),!1;case"right":case"bottom":return a.push(dr),!1}else if(He(A)||Sr(A))return a.push(A),!1;return u},s):o===1&&(s=f.reduce(function(u,A){if(me(A))switch(A.value){case W_:return e=0,!1;case K_:return e=1,!1;case j_:case N_:return i=0,!1;case V_:return i=1,!1;case z_:return i=2,!1;case X_:case G_:return i=3,!1}else if(Sr(A)||He(A))return Array.isArray(i)||(i=[]),i.push(A),!1;return u},s)),s){var l=Yc(n,f);r.push(l)}}),{size:i,shape:e,stops:r,position:a,type:2}},bR=function(n){return n.type===1},BR=function(n){return n.type===2},zd={name:"image",parse:function(n,t){if(t.type===22){var e={url:t.value,type:0};return n.cache.addImage(t.value),e}if(t.type===18){var i=Y_[t.name];if(typeof i>"u")throw new Error('Attempting to parse an unsupported image function "'+t.name+'"');return i(n,t.values)}throw new Error("Unsupported image type "+t.type)}};function SR(n){return!(n.type===20&&n.value==="none")&&(n.type!==18||!!Y_[n.name])}var Y_={"linear-gradient":yR,"-moz-linear-gradient":Ul,"-ms-linear-gradient":Ul,"-o-linear-gradient":Ul,"-webkit-linear-gradient":Ul,"radial-gradient":CR,"-moz-radial-gradient":Ll,"-ms-radial-gradient":Ll,"-o-radial-gradient":Ll,"-webkit-radial-gradient":Ll,"-webkit-gradient":xR},ER={name:"background-image",initialValue:"none",type:1,prefix:!1,parse:function(n,t){if(t.length===0)return[];var e=t[0];return e.type===20&&e.value==="none"?[]:t.filter(function(i){return Da(i)&&SR(i)}).map(function(i){return zd.parse(n,i)})}},MR={name:"background-origin",initialValue:"border-box",prefix:!1,type:1,parse:function(n,t){return t.map(function(e){if(me(e))switch(e.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},TR={name:"background-position",initialValue:"0% 0%",type:1,prefix:!1,parse:function(n,t){return En(t).map(function(e){return e.filter(He)}).map(D_)}},FR={name:"background-repeat",initialValue:"repeat",prefix:!1,type:1,parse:function(n,t){return En(t).map(function(e){return e.filter(me).map(function(i){return i.value}).join(" ")}).map(UR)}},UR=function(n){switch(n){case"no-repeat":return 1;case"repeat-x":case"repeat no-repeat":return 2;case"repeat-y":case"no-repeat repeat":return 3;case"repeat":default:return 0}},ga;(function(n){n.AUTO="auto",n.CONTAIN="contain",n.COVER="cover"})(ga||(ga={}));var LR={name:"background-size",initialValue:"0",prefix:!1,type:1,parse:function(n,t){return En(t).map(function(e){return e.filter(IR)})}},IR=function(n){return me(n)||He(n)},qc=function(n){return{name:"border-"+n+"-color",initialValue:"transparent",prefix:!1,type:3,format:"color"}},DR=qc("top"),PR=qc("right"),OR=qc("bottom"),QR=qc("left"),$c=function(n){return{name:"border-radius-"+n,initialValue:"0 0",prefix:!1,type:1,parse:function(t,e){return D_(e.filter(He))}}},RR=$c("top-left"),HR=$c("top-right"),kR=$c("bottom-right"),NR=$c("bottom-left"),Jc=function(n){return{name:"border-"+n+"-style",initialValue:"solid",prefix:!1,type:2,parse:function(t,e){switch(e){case"none":return 0;case"dashed":return 2;case"dotted":return 3;case"double":return 4}return 1}}},VR=Jc("top"),zR=Jc("right"),GR=Jc("bottom"),WR=Jc("left"),Zc=function(n){return{name:"border-"+n+"-width",initialValue:"0",type:0,prefix:!1,parse:function(t,e){return yA(e)?e.number:0}}},KR=Zc("top"),XR=Zc("right"),jR=Zc("bottom"),YR=Zc("left"),qR={name:"color",initialValue:"transparent",prefix:!1,type:3,format:"color"},$R={name:"direction",initialValue:"ltr",prefix:!1,type:2,parse:function(n,t){switch(t){case"rtl":return 1;case"ltr":default:return 0}}},JR={name:"display",initialValue:"inline-block",prefix:!1,type:1,parse:function(n,t){return t.filter(me).reduce(function(e,i){return e|ZR(i.value)},0)}},ZR=function(n){switch(n){case"block":case"-webkit-box":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0},tH={name:"float",initialValue:"none",prefix:!1,type:2,parse:function(n,t){switch(t){case"left":return 1;case"right":return 2;case"inline-start":return 3;case"inline-end":return 4}return 0}},eH={name:"letter-spacing",initialValue:"0",prefix:!1,type:0,parse:function(n,t){return t.type===20&&t.value==="normal"?0:t.type===17||t.type===15?t.number:0}},dc;(function(n){n.NORMAL="normal",n.STRICT="strict"})(dc||(dc={}));var iH={name:"line-break",initialValue:"normal",prefix:!1,type:2,parse:function(n,t){switch(t){case"strict":return dc.STRICT;case"normal":default:return dc.NORMAL}}},nH={name:"line-height",initialValue:"normal",prefix:!1,type:4},hv=function(n,t){return me(n)&&n.value==="normal"?1.2*t:n.type===17?t*n.number:He(n)?_e(n,t):t},rH={name:"list-style-image",initialValue:"none",type:0,prefix:!1,parse:function(n,t){return t.type===20&&t.value==="none"?null:zd.parse(n,t)}},sH={name:"list-style-position",initialValue:"outside",prefix:!1,type:2,parse:function(n,t){switch(t){case"inside":return 0;case"outside":default:return 1}}},Of={name:"list-style-type",initialValue:"none",prefix:!1,type:2,parse:function(n,t){switch(t){case"disc":return 0;case"circle":return 1;case"square":return 2;case"decimal":return 3;case"cjk-decimal":return 4;case"decimal-leading-zero":return 5;case"lower-roman":return 6;case"upper-roman":return 7;case"lower-greek":return 8;case"lower-alpha":return 9;case"upper-alpha":return 10;case"arabic-indic":return 11;case"armenian":return 12;case"bengali":return 13;case"cambodian":return 14;case"cjk-earthly-branch":return 15;case"cjk-heavenly-stem":return 16;case"cjk-ideographic":return 17;case"devanagari":return 18;case"ethiopic-numeric":return 19;case"georgian":return 20;case"gujarati":return 21;case"gurmukhi":return 22;case"hebrew":return 22;case"hiragana":return 23;case"hiragana-iroha":return 24;case"japanese-formal":return 25;case"japanese-informal":return 26;case"kannada":return 27;case"katakana":return 28;case"katakana-iroha":return 29;case"khmer":return 30;case"korean-hangul-formal":return 31;case"korean-hanja-formal":return 32;case"korean-hanja-informal":return 33;case"lao":return 34;case"lower-armenian":return 35;case"malayalam":return 36;case"mongolian":return 37;case"myanmar":return 38;case"oriya":return 39;case"persian":return 40;case"simp-chinese-formal":return 41;case"simp-chinese-informal":return 42;case"tamil":return 43;case"telugu":return 44;case"thai":return 45;case"tibetan":return 46;case"trad-chinese-formal":return 47;case"trad-chinese-informal":return 48;case"upper-armenian":return 49;case"disclosure-open":return 50;case"disclosure-closed":return 51;case"none":default:return-1}}},th=function(n){return{name:"margin-"+n,initialValue:"0",prefix:!1,type:4}},aH=th("top"),oH=th("right"),AH=th("bottom"),lH=th("left"),cH={name:"overflow",initialValue:"visible",prefix:!1,type:1,parse:function(n,t){return t.filter(me).map(function(e){switch(e.value){case"hidden":return 1;case"scroll":return 2;case"clip":return 3;case"auto":return 4;case"visible":default:return 0}})}},hH={name:"overflow-wrap",initialValue:"normal",prefix:!1,type:2,parse:function(n,t){switch(t){case"break-word":return"break-word";case"normal":default:return"normal"}}},eh=function(n){return{name:"padding-"+n,initialValue:"0",prefix:!1,type:3,format:"length-percentage"}},uH=eh("top"),fH=eh("right"),dH=eh("bottom"),pH=eh("left"),gH={name:"text-align",initialValue:"left",prefix:!1,type:2,parse:function(n,t){switch(t){case"right":return 2;case"center":case"justify":return 1;case"left":default:return 0}}},mH={name:"position",initialValue:"static",prefix:!1,type:2,parse:function(n,t){switch(t){case"relative":return 1;case"absolute":return 2;case"fixed":return 3;case"sticky":return 4}return 0}},vH={name:"text-shadow",initialValue:"none",type:1,prefix:!1,parse:function(n,t){return t.length===1&&Pf(t[0],"none")?[]:En(t).map(function(e){for(var i={color:zn.TRANSPARENT,offsetX:Ze,offsetY:Ze,blur:Ze},r=0,a=0;a<e.length;a++){var f=e[a];Sr(f)?(r===0?i.offsetX=f:r===1?i.offsetY=f:i.blur=f,r++):i.color=mr.parse(n,f)}return i})}},wH={name:"text-transform",initialValue:"none",prefix:!1,type:2,parse:function(n,t){switch(t){case"uppercase":return 2;case"lowercase":return 1;case"capitalize":return 3}return 0}},_H={name:"transform",initialValue:"none",prefix:!0,type:0,parse:function(n,t){if(t.type===20&&t.value==="none")return null;if(t.type===18){var e=CH[t.name];if(typeof e>"u")throw new Error('Attempting to parse an unsupported transform function "'+t.name+'"');return e(t.values)}return null}},yH=function(n){var t=n.filter(function(e){return e.type===17}).map(function(e){return e.number});return t.length===6?t:null},xH=function(n){var t=n.filter(function(s){return s.type===17}).map(function(s){return s.number}),e=t[0],i=t[1];t[2],t[3];var r=t[4],a=t[5];t[6],t[7],t[8],t[9],t[10],t[11];var f=t[12],o=t[13];return t[14],t[15],t.length===16?[e,i,r,a,f,o]:null},CH={matrix:yH,matrix3d:xH},uv={type:16,number:50,flags:_A},bH=[uv,uv],BH={name:"transform-origin",initialValue:"50% 50%",prefix:!0,type:1,parse:function(n,t){var e=t.filter(He);return e.length!==2?bH:[e[0],e[1]]}},SH={name:"visible",initialValue:"none",prefix:!1,type:2,parse:function(n,t){switch(t){case"hidden":return 1;case"collapse":return 2;case"visible":default:return 0}}},Ro;(function(n){n.NORMAL="normal",n.BREAK_ALL="break-all",n.KEEP_ALL="keep-all"})(Ro||(Ro={}));var EH={name:"word-break",initialValue:"normal",prefix:!1,type:2,parse:function(n,t){switch(t){case"break-all":return Ro.BREAK_ALL;case"keep-all":return Ro.KEEP_ALL;case"normal":default:return Ro.NORMAL}}},MH={name:"z-index",initialValue:"auto",prefix:!1,type:0,parse:function(n,t){if(t.type===20)return{auto:!0,order:0};if(Ka(t))return{auto:!1,order:t.number};throw new Error("Invalid z-index number parsed")}},q_={name:"time",parse:function(n,t){if(t.type===15)switch(t.unit.toLowerCase()){case"s":return 1e3*t.number;case"ms":return t.number}throw new Error("Unsupported time type")}},TH={name:"opacity",initialValue:"1",type:0,prefix:!1,parse:function(n,t){return Ka(t)?t.number:1}},FH={name:"text-decoration-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},UH={name:"text-decoration-line",initialValue:"none",prefix:!1,type:1,parse:function(n,t){return t.filter(me).map(function(e){switch(e.value){case"underline":return 1;case"overline":return 2;case"line-through":return 3;case"none":return 4}return 0}).filter(function(e){return e!==0})}},LH={name:"font-family",initialValue:"",prefix:!1,type:1,parse:function(n,t){var e=[],i=[];return t.forEach(function(r){switch(r.type){case 20:case 0:e.push(r.value);break;case 17:e.push(r.number.toString());break;case 4:i.push(e.join(" ")),e.length=0;break}}),e.length&&i.push(e.join(" ")),i.map(function(r){return r.indexOf(" ")===-1?r:"'"+r+"'"})}},IH={name:"font-size",initialValue:"0",prefix:!1,type:3,format:"length"},DH={name:"font-weight",initialValue:"normal",type:0,prefix:!1,parse:function(n,t){if(Ka(t))return t.number;if(me(t))switch(t.value){case"bold":return 700;case"normal":default:return 400}return 400}},PH={name:"font-variant",initialValue:"none",type:1,prefix:!1,parse:function(n,t){return t.filter(me).map(function(e){return e.value})}},OH={name:"font-style",initialValue:"normal",prefix:!1,type:2,parse:function(n,t){switch(t){case"oblique":return"oblique";case"italic":return"italic";case"normal":default:return"normal"}}},Ne=function(n,t){return(n&t)!==0},QH={name:"content",initialValue:"none",type:1,prefix:!1,parse:function(n,t){if(t.length===0)return[];var e=t[0];return e.type===20&&e.value==="none"?[]:t}},RH={name:"counter-increment",initialValue:"none",prefix:!0,type:1,parse:function(n,t){if(t.length===0)return null;var e=t[0];if(e.type===20&&e.value==="none")return null;for(var i=[],r=t.filter(I_),a=0;a<r.length;a++){var f=r[a],o=r[a+1];if(f.type===20){var s=o&&Ka(o)?o.number:1;i.push({counter:f.value,increment:s})}}return i}},HH={name:"counter-reset",initialValue:"none",prefix:!0,type:1,parse:function(n,t){if(t.length===0)return[];for(var e=[],i=t.filter(I_),r=0;r<i.length;r++){var a=i[r],f=i[r+1];if(me(a)&&a.value!=="none"){var o=f&&Ka(f)?f.number:0;e.push({counter:a.value,reset:o})}}return e}},kH={name:"duration",initialValue:"0s",prefix:!1,type:1,parse:function(n,t){return t.filter(yA).map(function(e){return q_.parse(n,e)})}},NH={name:"quotes",initialValue:"none",prefix:!0,type:1,parse:function(n,t){if(t.length===0)return null;var e=t[0];if(e.type===20&&e.value==="none")return null;var i=[],r=t.filter(fR);if(r.length%2!==0)return null;for(var a=0;a<r.length;a+=2){var f=r[a].value,o=r[a+1].value;i.push({open:f,close:o})}return i}},fv=function(n,t,e){if(!n)return"";var i=n[Math.min(t,n.length-1)];return i?e?i.open:i.close:""},VH={name:"box-shadow",initialValue:"none",type:1,prefix:!1,parse:function(n,t){return t.length===1&&Pf(t[0],"none")?[]:En(t).map(function(e){for(var i={color:255,offsetX:Ze,offsetY:Ze,blur:Ze,spread:Ze,inset:!1},r=0,a=0;a<e.length;a++){var f=e[a];Pf(f,"inset")?i.inset=!0:Sr(f)?(r===0?i.offsetX=f:r===1?i.offsetY=f:r===2?i.blur=f:i.spread=f,r++):i.color=mr.parse(n,f)}return i})}},zH={name:"paint-order",initialValue:"normal",prefix:!1,type:1,parse:function(n,t){var e=[0,1,2],i=[];return t.filter(me).forEach(function(r){switch(r.value){case"stroke":i.push(1);break;case"fill":i.push(0);break;case"markers":i.push(2);break}}),e.forEach(function(r){i.indexOf(r)===-1&&i.push(r)}),i}},GH={name:"-webkit-text-stroke-color",initialValue:"currentcolor",prefix:!1,type:3,format:"color"},WH={name:"-webkit-text-stroke-width",initialValue:"0",type:0,prefix:!1,parse:function(n,t){return yA(t)?t.number:0}},KH=function(){function n(t,e){var i,r;this.animationDuration=Mt(t,kH,e.animationDuration),this.backgroundClip=Mt(t,gR,e.backgroundClip),this.backgroundColor=Mt(t,mR,e.backgroundColor),this.backgroundImage=Mt(t,ER,e.backgroundImage),this.backgroundOrigin=Mt(t,MR,e.backgroundOrigin),this.backgroundPosition=Mt(t,TR,e.backgroundPosition),this.backgroundRepeat=Mt(t,FR,e.backgroundRepeat),this.backgroundSize=Mt(t,LR,e.backgroundSize),this.borderTopColor=Mt(t,DR,e.borderTopColor),this.borderRightColor=Mt(t,PR,e.borderRightColor),this.borderBottomColor=Mt(t,OR,e.borderBottomColor),this.borderLeftColor=Mt(t,QR,e.borderLeftColor),this.borderTopLeftRadius=Mt(t,RR,e.borderTopLeftRadius),this.borderTopRightRadius=Mt(t,HR,e.borderTopRightRadius),this.borderBottomRightRadius=Mt(t,kR,e.borderBottomRightRadius),this.borderBottomLeftRadius=Mt(t,NR,e.borderBottomLeftRadius),this.borderTopStyle=Mt(t,VR,e.borderTopStyle),this.borderRightStyle=Mt(t,zR,e.borderRightStyle),this.borderBottomStyle=Mt(t,GR,e.borderBottomStyle),this.borderLeftStyle=Mt(t,WR,e.borderLeftStyle),this.borderTopWidth=Mt(t,KR,e.borderTopWidth),this.borderRightWidth=Mt(t,XR,e.borderRightWidth),this.borderBottomWidth=Mt(t,jR,e.borderBottomWidth),this.borderLeftWidth=Mt(t,YR,e.borderLeftWidth),this.boxShadow=Mt(t,VH,e.boxShadow),this.color=Mt(t,qR,e.color),this.direction=Mt(t,$R,e.direction),this.display=Mt(t,JR,e.display),this.float=Mt(t,tH,e.cssFloat),this.fontFamily=Mt(t,LH,e.fontFamily),this.fontSize=Mt(t,IH,e.fontSize),this.fontStyle=Mt(t,OH,e.fontStyle),this.fontVariant=Mt(t,PH,e.fontVariant),this.fontWeight=Mt(t,DH,e.fontWeight),this.letterSpacing=Mt(t,eH,e.letterSpacing),this.lineBreak=Mt(t,iH,e.lineBreak),this.lineHeight=Mt(t,nH,e.lineHeight),this.listStyleImage=Mt(t,rH,e.listStyleImage),this.listStylePosition=Mt(t,sH,e.listStylePosition),this.listStyleType=Mt(t,Of,e.listStyleType),this.marginTop=Mt(t,aH,e.marginTop),this.marginRight=Mt(t,oH,e.marginRight),this.marginBottom=Mt(t,AH,e.marginBottom),this.marginLeft=Mt(t,lH,e.marginLeft),this.opacity=Mt(t,TH,e.opacity);var a=Mt(t,cH,e.overflow);this.overflowX=a[0],this.overflowY=a[a.length>1?1:0],this.overflowWrap=Mt(t,hH,e.overflowWrap),this.paddingTop=Mt(t,uH,e.paddingTop),this.paddingRight=Mt(t,fH,e.paddingRight),this.paddingBottom=Mt(t,dH,e.paddingBottom),this.paddingLeft=Mt(t,pH,e.paddingLeft),this.paintOrder=Mt(t,zH,e.paintOrder),this.position=Mt(t,mH,e.position),this.textAlign=Mt(t,gH,e.textAlign),this.textDecorationColor=Mt(t,FH,(i=e.textDecorationColor)!==null&&i!==void 0?i:e.color),this.textDecorationLine=Mt(t,UH,(r=e.textDecorationLine)!==null&&r!==void 0?r:e.textDecoration),this.textShadow=Mt(t,vH,e.textShadow),this.textTransform=Mt(t,wH,e.textTransform),this.transform=Mt(t,_H,e.transform),this.transformOrigin=Mt(t,BH,e.transformOrigin),this.visibility=Mt(t,SH,e.visibility),this.webkitTextStrokeColor=Mt(t,GH,e.webkitTextStrokeColor),this.webkitTextStrokeWidth=Mt(t,WH,e.webkitTextStrokeWidth),this.wordBreak=Mt(t,EH,e.wordBreak),this.zIndex=Mt(t,MH,e.zIndex)}return n.prototype.isVisible=function(){return this.display>0&&this.opacity>0&&this.visibility===0},n.prototype.isTransparent=function(){return vr(this.backgroundColor)},n.prototype.isTransformed=function(){return this.transform!==null},n.prototype.isPositioned=function(){return this.position!==0},n.prototype.isPositionedWithZIndex=function(){return this.isPositioned()&&!this.zIndex.auto},n.prototype.isFloating=function(){return this.float!==0},n.prototype.isInlineLevel=function(){return Ne(this.display,4)||Ne(this.display,33554432)||Ne(this.display,268435456)||Ne(this.display,536870912)||Ne(this.display,67108864)||Ne(this.display,134217728)},n}(),XH=function(){function n(t,e){this.content=Mt(t,QH,e.content),this.quotes=Mt(t,NH,e.quotes)}return n}(),dv=function(){function n(t,e){this.counterIncrement=Mt(t,RH,e.counterIncrement),this.counterReset=Mt(t,HH,e.counterReset)}return n}(),Mt=function(n,t,e){var i=new U_,r=e!==null&&typeof e<"u"?e.toString():t.initialValue;i.write(r);var a=new L_(i.read());switch(t.type){case 2:var f=a.parseComponentValue();return t.parse(n,me(f)?f.value:t.initialValue);case 0:return t.parse(n,a.parseComponentValue());case 1:return t.parse(n,a.parseComponentValues());case 4:return a.parseComponentValue();case 3:switch(t.format){case"angle":return jc.parse(n,a.parseComponentValue());case"color":return mr.parse(n,a.parseComponentValue());case"image":return zd.parse(n,a.parseComponentValue());case"length":var o=a.parseComponentValue();return Sr(o)?o:Ze;case"length-percentage":var s=a.parseComponentValue();return He(s)?s:Ze;case"time":return q_.parse(n,a.parseComponentValue())}break}},jH="data-html2canvas-debug",YH=function(n){var t=n.getAttribute(jH);switch(t){case"all":return 1;case"clone":return 2;case"parse":return 3;case"render":return 4;default:return 0}},Qf=function(n,t){var e=YH(n);return e===1||t===e},Mn=function(){function n(t,e){if(this.context=t,this.textNodes=[],this.elements=[],this.flags=0,Qf(e,3))debugger;this.styles=new KH(t,window.getComputedStyle(e,null)),kf(e)&&(this.styles.animationDuration.some(function(i){return i>0})&&(e.style.animationDuration="0s"),this.styles.transform!==null&&(e.style.transform="none")),this.bounds=Kc(this.context,e),Qf(e,4)&&(this.flags|=16)}return n}(),qH="AAAAAAAAAAAAEA4AGBkAAFAaAAACAAAAAAAIABAAGAAwADgACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAAQABIAEQATAAIABAACAAQAAgAEAAIABAAVABcAAgAEAAIABAACAAQAGAAaABwAHgAgACIAI4AlgAIABAAmwCjAKgAsAC2AL4AvQDFAMoA0gBPAVYBWgEIAAgACACMANoAYgFkAWwBdAF8AX0BhQGNAZUBlgGeAaMBlQGWAasBswF8AbsBwwF0AcsBYwHTAQgA2wG/AOMBdAF8AekB8QF0AfkB+wHiAHQBfAEIAAMC5gQIAAsCEgIIAAgAFgIeAggAIgIpAggAMQI5AkACygEIAAgASAJQAlgCYAIIAAgACAAKBQoFCgUTBRMFGQUrBSsFCAAIAAgACAAIAAgACAAIAAgACABdAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABoAmgCrwGvAQgAbgJ2AggAHgEIAAgACADnAXsCCAAIAAgAgwIIAAgACAAIAAgACACKAggAkQKZAggAPADJAAgAoQKkAqwCsgK6AsICCADJAggA0AIIAAgACAAIANYC3gIIAAgACAAIAAgACABAAOYCCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAkASoB+QIEAAgACAA8AEMCCABCBQgACABJBVAFCAAIAAgACAAIAAgACAAIAAgACABTBVoFCAAIAFoFCABfBWUFCAAIAAgACAAIAAgAbQUIAAgACAAIAAgACABzBXsFfQWFBYoFigWKBZEFigWKBYoFmAWfBaYFrgWxBbkFCAAIAAgACAAIAAgACAAIAAgACAAIAMEFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAMgFCADQBQgACAAIAAgACAAIAAgACAAIAAgACAAIAO4CCAAIAAgAiQAIAAgACABAAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAD0AggACAD8AggACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIANYFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAMDvwAIAAgAJAIIAAgACAAIAAgACAAIAAgACwMTAwgACAB9BOsEGwMjAwgAKwMyAwsFYgE3A/MEPwMIAEUDTQNRAwgAWQOsAGEDCAAIAAgACAAIAAgACABpAzQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFIQUoBSwFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABtAwgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABMAEwACAAIAAgACAAIABgACAAIAAgACAC/AAgACAAyAQgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACAAIAAwAAgACAAIAAgACAAIAAgACAAIAAAARABIAAgACAAIABQASAAIAAgAIABwAEAAjgCIABsAqAC2AL0AigDQAtwC+IJIQqVAZUBWQqVAZUBlQGVAZUBlQGrC5UBlQGVAZUBlQGVAZUBlQGVAXsKlQGVAbAK6wsrDGUMpQzlDJUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAfAKAAuZA64AtwCJALoC6ADwAAgAuACgA/oEpgO6AqsD+AAIAAgAswMIAAgACAAIAIkAuwP5AfsBwwPLAwgACAAIAAgACADRA9kDCAAIAOED6QMIAAgACAAIAAgACADuA/YDCAAIAP4DyQAIAAgABgQIAAgAXQAOBAgACAAIAAgACAAIABMECAAIAAgACAAIAAgACAD8AAQBCAAIAAgAGgQiBCoECAExBAgAEAEIAAgACAAIAAgACAAIAAgACAAIAAgACAA4BAgACABABEYECAAIAAgATAQYAQgAVAQIAAgACAAIAAgACAAIAAgACAAIAFoECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAOQEIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAB+BAcACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAEABhgSMBAgACAAIAAgAlAQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAwAEAAQABAADAAMAAwADAAQABAAEAAQABAAEAAQABHATAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAdQMIAAgACAAIAAgACAAIAMkACAAIAAgAfQMIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACFA4kDCAAIAAgACAAIAOcBCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAIcDCAAIAAgACAAIAAgACAAIAAgACAAIAJEDCAAIAAgACADFAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABgBAgAZgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAbAQCBXIECAAIAHkECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABAAJwEQACjBKoEsgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAC6BMIECAAIAAgACAAIAAgACABmBAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAxwQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAGYECAAIAAgAzgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBd0FXwUIAOIF6gXxBYoF3gT5BQAGCAaKBYoFigWKBYoFigWKBYoFigWKBYoFigXWBIoFigWKBYoFigWKBYoFigWKBYsFEAaKBYoFigWKBYoFigWKBRQGCACKBYoFigWKBQgACAAIANEECAAIABgGigUgBggAJgYIAC4GMwaKBYoF0wQ3Bj4GigWKBYoFigWKBYoFigWKBYoFigWKBYoFigUIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWLBf///////wQABAAEAAQABAAEAAQABAAEAAQAAwAEAAQAAgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAQADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUAAAAFAAUAAAAFAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAQAAAAUABQAFAAUABQAFAAAAAAAFAAUAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAFAAUAAQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAAABwAHAAcAAAAHAAcABwAFAAEAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAcABwAFAAUAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQABAAAAAAAAAAAAAAAFAAUABQAFAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAHAAcAAAAHAAcAAAAAAAUABQAHAAUAAQAHAAEABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwABAAUABQAFAAUAAAAAAAAAAAAAAAEAAQABAAEAAQABAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABQANAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAABQAHAAUABQAFAAAAAAAAAAcABQAFAAUABQAFAAQABAAEAAQABAAEAAQABAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUAAAAFAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAUAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAcABwAFAAcABwAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUABwAHAAUABQAFAAUAAAAAAAcABwAAAAAABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAAAAAAAAAAABQAFAAAAAAAFAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAFAAUABQAFAAUAAAAFAAUABwAAAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABwAFAAUABQAFAAAAAAAHAAcAAAAAAAcABwAFAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAAAAAAAAAHAAcABwAAAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAUABQAFAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAHAAcABQAHAAcAAAAFAAcABwAAAAcABwAFAAUAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAFAAcABwAFAAUABQAAAAUAAAAHAAcABwAHAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAHAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUAAAAFAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAUAAAAFAAUAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABwAFAAUABQAFAAUABQAAAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABQAFAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAFAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAHAAUABQAFAAUABQAFAAUABwAHAAcABwAHAAcABwAHAAUABwAHAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABwAHAAcABwAFAAUABwAHAAcAAAAAAAAAAAAHAAcABQAHAAcABwAHAAcABwAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAUABQAFAAUABQAFAAUAAAAFAAAABQAAAAAABQAFAAUABQAFAAUABQAFAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAUABQAFAAUABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABwAFAAcABwAHAAcABwAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAUABQAFAAUABwAHAAUABQAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABQAFAAcABwAHAAUABwAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAcABQAFAAUABQAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAAAAAABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAUABQAHAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAFAAUABQAFAAcABwAFAAUABwAHAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAcABwAFAAUABwAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABQAAAAAABQAFAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAcABwAAAAAAAAAAAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAcABwAFAAcABwAAAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAFAAUABQAAAAUABQAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABwAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAHAAcABQAHAAUABQAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAAABwAHAAAAAAAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAFAAUABwAFAAcABwAFAAcABQAFAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAAAAAABwAHAAcABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAFAAcABwAFAAUABQAFAAUABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAUABQAFAAcABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABQAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAAAAAAFAAUABwAHAAcABwAFAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAHAAUABQAFAAUABQAFAAUABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAABQAAAAUABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAHAAcAAAAFAAUAAAAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABQAFAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAABQAFAAUABQAFAAUABQAAAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAFAAUABQAFAAUADgAOAA4ADgAOAA4ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAMAAwADAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkAAAAAAAAAAAAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAAAAAAAAAAAAsADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwACwAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAADgAOAA4AAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAAAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4AAAAOAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAAAAAAAAAAAA4AAAAOAAAAAAAAAAAADgAOAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAA=",pv="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",To=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var Il=0;Il<pv.length;Il++)To[pv.charCodeAt(Il)]=Il;var $H=function(n){var t=n.length*.75,e=n.length,i,r=0,a,f,o,s;n[n.length-1]==="="&&(t--,n[n.length-2]==="="&&t--);var l=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&typeof Uint8Array.prototype.slice<"u"?new ArrayBuffer(t):new Array(t),u=Array.isArray(l)?l:new Uint8Array(l);for(i=0;i<e;i+=4)a=To[n.charCodeAt(i)],f=To[n.charCodeAt(i+1)],o=To[n.charCodeAt(i+2)],s=To[n.charCodeAt(i+3)],u[r++]=a<<2|f>>4,u[r++]=(f&15)<<4|o>>2,u[r++]=(o&3)<<6|s&63;return l},JH=function(n){for(var t=n.length,e=[],i=0;i<t;i+=2)e.push(n[i+1]<<8|n[i]);return e},ZH=function(n){for(var t=n.length,e=[],i=0;i<t;i+=4)e.push(n[i+3]<<24|n[i+2]<<16|n[i+1]<<8|n[i]);return e},rs=5,Gd=6+5,bu=2,t3=Gd-rs,$_=65536>>rs,e3=1<<rs,Bu=e3-1,i3=1024>>rs,n3=$_+i3,r3=n3,s3=32,a3=r3+s3,o3=65536>>Gd,A3=1<<t3,l3=A3-1,gv=function(n,t,e){return n.slice?n.slice(t,e):new Uint16Array(Array.prototype.slice.call(n,t,e))},c3=function(n,t,e){return n.slice?n.slice(t,e):new Uint32Array(Array.prototype.slice.call(n,t,e))},h3=function(n,t){var e=$H(n),i=Array.isArray(e)?ZH(e):new Uint32Array(e),r=Array.isArray(e)?JH(e):new Uint16Array(e),a=24,f=gv(r,a/2,i[4]/2),o=i[5]===2?gv(r,(a+i[4])/2):c3(i,Math.ceil((a+i[4])/4));return new u3(i[0],i[1],i[2],i[3],f,o)},u3=function(){function n(t,e,i,r,a,f){this.initialValue=t,this.errorValue=e,this.highStart=i,this.highValueIndex=r,this.index=a,this.data=f}return n.prototype.get=function(t){var e;if(t>=0){if(t<55296||t>56319&&t<=65535)return e=this.index[t>>rs],e=(e<<bu)+(t&Bu),this.data[e];if(t<=65535)return e=this.index[$_+(t-55296>>rs)],e=(e<<bu)+(t&Bu),this.data[e];if(t<this.highStart)return e=a3-o3+(t>>Gd),e=this.index[e],e+=t>>rs&l3,e=this.index[e],e=(e<<bu)+(t&Bu),this.data[e];if(t<=1114111)return this.data[this.highValueIndex]}return this.errorValue},n}(),mv="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",f3=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var Dl=0;Dl<mv.length;Dl++)f3[mv.charCodeAt(Dl)]=Dl;var d3=1,Su=2,Eu=3,vv=4,wv=5,p3=7,_v=8,Mu=9,Tu=10,yv=11,xv=12,Cv=13,bv=14,Fu=15,g3=function(n){for(var t=[],e=0,i=n.length;e<i;){var r=n.charCodeAt(e++);if(r>=55296&&r<=56319&&e<i){var a=n.charCodeAt(e++);(a&64512)===56320?t.push(((r&1023)<<10)+(a&1023)+65536):(t.push(r),e--)}else t.push(r)}return t},m3=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];if(String.fromCodePoint)return String.fromCodePoint.apply(String,n);var e=n.length;if(!e)return"";for(var i=[],r=-1,a="";++r<e;){var f=n[r];f<=65535?i.push(f):(f-=65536,i.push((f>>10)+55296,f%1024+56320)),(r+1===e||i.length>16384)&&(a+=String.fromCharCode.apply(String,i),i.length=0)}return a},v3=h3(qH),Vi="",Uu="",w3=function(n){return v3.get(n)},_3=function(n,t,e){var i=e-2,r=t[i],a=t[e-1],f=t[e];if(a===Su&&f===Eu)return Vi;if(a===Su||a===Eu||a===vv||f===Su||f===Eu||f===vv)return Uu;if(a===_v&&[_v,Mu,yv,xv].indexOf(f)!==-1||(a===yv||a===Mu)&&(f===Mu||f===Tu)||(a===xv||a===Tu)&&f===Tu||f===Cv||f===wv||f===p3||a===d3)return Vi;if(a===Cv&&f===bv){for(;r===wv;)r=t[--i];if(r===bv)return Vi}if(a===Fu&&f===Fu){for(var o=0;r===Fu;)o++,r=t[--i];if(o%2===0)return Vi}return Uu},y3=function(n){var t=g3(n),e=t.length,i=0,r=0,a=t.map(w3);return{next:function(){if(i>=e)return{done:!0,value:null};for(var f=Vi;i<e&&(f=_3(t,a,++i))===Vi;);if(f!==Vi||i===e){var o=m3.apply(null,t.slice(r,i));return r=i,{value:o,done:!1}}return{done:!0,value:null}}}},x3=function(n){for(var t=y3(n),e=[],i;!(i=t.next()).done;)i.value&&e.push(i.value.slice());return e},C3=function(n){var t=123;if(n.createRange){var e=n.createRange();if(e.getBoundingClientRect){var i=n.createElement("boundtest");i.style.height=t+"px",i.style.display="block",n.body.appendChild(i),e.selectNode(i);var r=e.getBoundingClientRect(),a=Math.round(r.height);if(n.body.removeChild(i),a===t)return!0}}return!1},b3=function(n){var t=n.createElement("boundtest");t.style.width="50px",t.style.display="block",t.style.fontSize="12px",t.style.letterSpacing="0px",t.style.wordSpacing="0px",n.body.appendChild(t);var e=n.createRange();t.innerHTML=typeof"".repeat=="function"?"&#128104;".repeat(10):"";var i=t.firstChild,r=Xc(i.data).map(function(s){return Ie(s)}),a=0,f={},o=r.every(function(s,l){e.setStart(i,a),e.setEnd(i,a+s.length);var u=e.getBoundingClientRect();a+=s.length;var A=u.x>f.x||u.y>f.y;return f=u,l===0?!0:A});return n.body.removeChild(t),o},B3=function(){return typeof new Image().crossOrigin<"u"},S3=function(){return typeof new XMLHttpRequest().responseType=="string"},E3=function(n){var t=new Image,e=n.createElement("canvas"),i=e.getContext("2d");if(!i)return!1;t.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{i.drawImage(t,0,0),e.toDataURL()}catch{return!1}return!0},Bv=function(n){return n[0]===0&&n[1]===255&&n[2]===0&&n[3]===255},M3=function(n){var t=n.createElement("canvas"),e=100;t.width=e,t.height=e;var i=t.getContext("2d");if(!i)return Promise.reject(!1);i.fillStyle="rgb(0, 255, 0)",i.fillRect(0,0,e,e);var r=new Image,a=t.toDataURL();r.src=a;var f=Rf(e,e,0,0,r);return i.fillStyle="red",i.fillRect(0,0,e,e),Sv(f).then(function(o){i.drawImage(o,0,0);var s=i.getImageData(0,0,e,e).data;i.fillStyle="red",i.fillRect(0,0,e,e);var l=n.createElement("div");return l.style.backgroundImage="url("+a+")",l.style.height=e+"px",Bv(s)?Sv(Rf(e,e,0,0,l)):Promise.reject(!1)}).then(function(o){return i.drawImage(o,0,0),Bv(i.getImageData(0,0,e,e).data)}).catch(function(){return!1})},Rf=function(n,t,e,i,r){var a="http://www.w3.org/2000/svg",f=document.createElementNS(a,"svg"),o=document.createElementNS(a,"foreignObject");return f.setAttributeNS(null,"width",n.toString()),f.setAttributeNS(null,"height",t.toString()),o.setAttributeNS(null,"width","100%"),o.setAttributeNS(null,"height","100%"),o.setAttributeNS(null,"x",e.toString()),o.setAttributeNS(null,"y",i.toString()),o.setAttributeNS(null,"externalResourcesRequired","true"),f.appendChild(o),o.appendChild(r),f},Sv=function(n){return new Promise(function(t,e){var i=new Image;i.onload=function(){return t(i)},i.onerror=e,i.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(n))})},$e={get SUPPORT_RANGE_BOUNDS(){var n=C3(document);return Object.defineProperty($e,"SUPPORT_RANGE_BOUNDS",{value:n}),n},get SUPPORT_WORD_BREAKING(){var n=$e.SUPPORT_RANGE_BOUNDS&&b3(document);return Object.defineProperty($e,"SUPPORT_WORD_BREAKING",{value:n}),n},get SUPPORT_SVG_DRAWING(){var n=E3(document);return Object.defineProperty($e,"SUPPORT_SVG_DRAWING",{value:n}),n},get SUPPORT_FOREIGNOBJECT_DRAWING(){var n=typeof Array.from=="function"&&typeof window.fetch=="function"?M3(document):Promise.resolve(!1);return Object.defineProperty($e,"SUPPORT_FOREIGNOBJECT_DRAWING",{value:n}),n},get SUPPORT_CORS_IMAGES(){var n=B3();return Object.defineProperty($e,"SUPPORT_CORS_IMAGES",{value:n}),n},get SUPPORT_RESPONSE_TYPE(){var n=S3();return Object.defineProperty($e,"SUPPORT_RESPONSE_TYPE",{value:n}),n},get SUPPORT_CORS_XHR(){var n="withCredentials"in new XMLHttpRequest;return Object.defineProperty($e,"SUPPORT_CORS_XHR",{value:n}),n},get SUPPORT_NATIVE_TEXT_SEGMENTATION(){var n=!!(typeof Intl<"u"&&Intl.Segmenter);return Object.defineProperty($e,"SUPPORT_NATIVE_TEXT_SEGMENTATION",{value:n}),n}},Ho=function(){function n(t,e){this.text=t,this.bounds=e}return n}(),T3=function(n,t,e,i){var r=L3(t,e),a=[],f=0;return r.forEach(function(o){if(e.textDecorationLine.length||o.trim().length>0)if($e.SUPPORT_RANGE_BOUNDS){var s=Ev(i,f,o.length).getClientRects();if(s.length>1){var l=Wd(o),u=0;l.forEach(function(c){a.push(new Ho(c,Xn.fromDOMRectList(n,Ev(i,u+f,c.length).getClientRects()))),u+=c.length})}else a.push(new Ho(o,Xn.fromDOMRectList(n,s)))}else{var A=i.splitText(o.length);a.push(new Ho(o,F3(n,i))),i=A}else $e.SUPPORT_RANGE_BOUNDS||(i=i.splitText(o.length));f+=o.length}),a},F3=function(n,t){var e=t.ownerDocument;if(e){var i=e.createElement("html2canvaswrapper");i.appendChild(t.cloneNode(!0));var r=t.parentNode;if(r){r.replaceChild(i,t);var a=Kc(n,i);return i.firstChild&&r.replaceChild(i.firstChild,i),a}}return Xn.EMPTY},Ev=function(n,t,e){var i=n.ownerDocument;if(!i)throw new Error("Node has no owner document");var r=i.createRange();return r.setStart(n,t),r.setEnd(n,t+e),r},Wd=function(n){if($e.SUPPORT_NATIVE_TEXT_SEGMENTATION){var t=new Intl.Segmenter(void 0,{granularity:"grapheme"});return Array.from(t.segment(n)).map(function(e){return e.segment})}return x3(n)},U3=function(n,t){if($e.SUPPORT_NATIVE_TEXT_SEGMENTATION){var e=new Intl.Segmenter(void 0,{granularity:"word"});return Array.from(e.segment(n)).map(function(i){return i.segment})}return D3(n,t)},L3=function(n,t){return t.letterSpacing!==0?Wd(n):U3(n,t)},I3=[32,160,4961,65792,65793,4153,4241],D3=function(n,t){for(var e=oQ(n,{lineBreak:t.lineBreak,wordBreak:t.overflowWrap==="break-word"?"break-word":t.wordBreak}),i=[],r,a=function(){if(r.value){var f=r.value.slice(),o=Xc(f),s="";o.forEach(function(l){I3.indexOf(l)===-1?s+=Ie(l):(s.length&&i.push(s),i.push(Ie(l)),s="")}),s.length&&i.push(s)}};!(r=e.next()).done;)a();return i},P3=function(){function n(t,e,i){this.text=O3(e.data,i.textTransform),this.textBounds=T3(t,this.text,i,e)}return n}(),O3=function(n,t){switch(t){case 1:return n.toLowerCase();case 3:return n.replace(Q3,R3);case 2:return n.toUpperCase();default:return n}},Q3=/(^|\s|:|-|\(|\))([a-z])/g,R3=function(n,t,e){return n.length>0?t+e.toUpperCase():n},J_=function(n){cn(t,n);function t(e,i){var r=n.call(this,e,i)||this;return r.src=i.currentSrc||i.src,r.intrinsicWidth=i.naturalWidth,r.intrinsicHeight=i.naturalHeight,r.context.cache.addImage(r.src),r}return t}(Mn),Z_=function(n){cn(t,n);function t(e,i){var r=n.call(this,e,i)||this;return r.canvas=i,r.intrinsicWidth=i.width,r.intrinsicHeight=i.height,r}return t}(Mn),ty=function(n){cn(t,n);function t(e,i){var r=n.call(this,e,i)||this,a=new XMLSerializer,f=Kc(e,i);return i.setAttribute("width",f.width+"px"),i.setAttribute("height",f.height+"px"),r.svg="data:image/svg+xml,"+encodeURIComponent(a.serializeToString(i)),r.intrinsicWidth=i.width.baseVal.value,r.intrinsicHeight=i.height.baseVal.value,r.context.cache.addImage(r.svg),r}return t}(Mn),ey=function(n){cn(t,n);function t(e,i){var r=n.call(this,e,i)||this;return r.value=i.value,r}return t}(Mn),Hf=function(n){cn(t,n);function t(e,i){var r=n.call(this,e,i)||this;return r.start=i.start,r.reversed=typeof i.reversed=="boolean"&&i.reversed===!0,r}return t}(Mn),H3=[{type:15,flags:0,unit:"px",number:3}],k3=[{type:16,flags:0,number:50}],N3=function(n){return n.width>n.height?new Xn(n.left+(n.width-n.height)/2,n.top,n.height,n.height):n.width<n.height?new Xn(n.left,n.top+(n.height-n.width)/2,n.width,n.width):n},V3=function(n){var t=n.type===z3?new Array(n.value.length+1).join(""):n.value;return t.length===0?n.placeholder||"":t},pc="checkbox",gc="radio",z3="password",Mv=707406591,Kd=function(n){cn(t,n);function t(e,i){var r=n.call(this,e,i)||this;switch(r.type=i.type.toLowerCase(),r.checked=i.checked,r.value=V3(i),(r.type===pc||r.type===gc)&&(r.styles.backgroundColor=3739148031,r.styles.borderTopColor=r.styles.borderRightColor=r.styles.borderBottomColor=r.styles.borderLeftColor=2779096575,r.styles.borderTopWidth=r.styles.borderRightWidth=r.styles.borderBottomWidth=r.styles.borderLeftWidth=1,r.styles.borderTopStyle=r.styles.borderRightStyle=r.styles.borderBottomStyle=r.styles.borderLeftStyle=1,r.styles.backgroundClip=[0],r.styles.backgroundOrigin=[0],r.bounds=N3(r.bounds)),r.type){case pc:r.styles.borderTopRightRadius=r.styles.borderTopLeftRadius=r.styles.borderBottomRightRadius=r.styles.borderBottomLeftRadius=H3;break;case gc:r.styles.borderTopRightRadius=r.styles.borderTopLeftRadius=r.styles.borderBottomRightRadius=r.styles.borderBottomLeftRadius=k3;break}return r}return t}(Mn),iy=function(n){cn(t,n);function t(e,i){var r=n.call(this,e,i)||this,a=i.options[i.selectedIndex||0];return r.value=a&&a.text||"",r}return t}(Mn),ny=function(n){cn(t,n);function t(e,i){var r=n.call(this,e,i)||this;return r.value=i.value,r}return t}(Mn),ry=function(n){cn(t,n);function t(e,i){var r=n.call(this,e,i)||this;r.src=i.src,r.width=parseInt(i.width,10)||0,r.height=parseInt(i.height,10)||0,r.backgroundColor=r.styles.backgroundColor;try{if(i.contentWindow&&i.contentWindow.document&&i.contentWindow.document.documentElement){r.tree=ay(e,i.contentWindow.document.documentElement);var a=i.contentWindow.document.documentElement?Qo(e,getComputedStyle(i.contentWindow.document.documentElement).backgroundColor):zn.TRANSPARENT,f=i.contentWindow.document.body?Qo(e,getComputedStyle(i.contentWindow.document.body).backgroundColor):zn.TRANSPARENT;r.backgroundColor=vr(a)?vr(f)?r.styles.backgroundColor:f:a}}catch{}return r}return t}(Mn),G3=["OL","UL","MENU"],ql=function(n,t,e,i){for(var r=t.firstChild,a=void 0;r;r=a)if(a=r.nextSibling,oy(r)&&r.data.trim().length>0)e.textNodes.push(new P3(n,r,e.styles));else if(ca(r))if(hy(r)&&r.assignedNodes)r.assignedNodes().forEach(function(o){return ql(n,o,e,i)});else{var f=sy(n,r);f.styles.isVisible()&&(W3(r,f,i)?f.flags|=4:K3(f.styles)&&(f.flags|=2),G3.indexOf(r.tagName)!==-1&&(f.flags|=8),e.elements.push(f),r.slot,r.shadowRoot?ql(n,r.shadowRoot,f,i):!mc(r)&&!Ay(r)&&!vc(r)&&ql(n,r,f,i))}},sy=function(n,t){return Nf(t)?new J_(n,t):ly(t)?new Z_(n,t):Ay(t)?new ty(n,t):X3(t)?new ey(n,t):j3(t)?new Hf(n,t):Y3(t)?new Kd(n,t):vc(t)?new iy(n,t):mc(t)?new ny(n,t):cy(t)?new ry(n,t):new Mn(n,t)},ay=function(n,t){var e=sy(n,t);return e.flags|=4,ql(n,t,e,e),e},W3=function(n,t,e){return t.styles.isPositionedWithZIndex()||t.styles.opacity<1||t.styles.isTransformed()||Xd(n)&&e.styles.isTransparent()},K3=function(n){return n.isPositioned()||n.isFloating()},oy=function(n){return n.nodeType===Node.TEXT_NODE},ca=function(n){return n.nodeType===Node.ELEMENT_NODE},kf=function(n){return ca(n)&&typeof n.style<"u"&&!$l(n)},$l=function(n){return typeof n.className=="object"},X3=function(n){return n.tagName==="LI"},j3=function(n){return n.tagName==="OL"},Y3=function(n){return n.tagName==="INPUT"},q3=function(n){return n.tagName==="HTML"},Ay=function(n){return n.tagName==="svg"},Xd=function(n){return n.tagName==="BODY"},ly=function(n){return n.tagName==="CANVAS"},Tv=function(n){return n.tagName==="VIDEO"},Nf=function(n){return n.tagName==="IMG"},cy=function(n){return n.tagName==="IFRAME"},Fv=function(n){return n.tagName==="STYLE"},$3=function(n){return n.tagName==="SCRIPT"},mc=function(n){return n.tagName==="TEXTAREA"},vc=function(n){return n.tagName==="SELECT"},hy=function(n){return n.tagName==="SLOT"},Uv=function(n){return n.tagName.indexOf("-")>0},J3=function(){function n(){this.counters={}}return n.prototype.getCounterValue=function(t){var e=this.counters[t];return e&&e.length?e[e.length-1]:1},n.prototype.getCounterValues=function(t){var e=this.counters[t];return e||[]},n.prototype.pop=function(t){var e=this;t.forEach(function(i){return e.counters[i].pop()})},n.prototype.parse=function(t){var e=this,i=t.counterIncrement,r=t.counterReset,a=!0;i!==null&&i.forEach(function(o){var s=e.counters[o.counter];s&&o.increment!==0&&(a=!1,s.length||s.push(1),s[Math.max(0,s.length-1)]+=o.increment)});var f=[];return a&&r.forEach(function(o){var s=e.counters[o.counter];f.push(o.counter),s||(s=e.counters[o.counter]=[]),s.push(o.reset)}),f},n}(),Lv={integers:[1e3,900,500,400,100,90,50,40,10,9,5,4,1],values:["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]},Iv={integers:[9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},Z3={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,400,300,200,100,90,80,70,60,50,40,30,20,19,18,17,16,15,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},tk={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},js=function(n,t,e,i,r,a){return n<t||n>e?iA(n,r,a.length>0):i.integers.reduce(function(f,o,s){for(;n>=o;)n-=o,f+=i.values[s];return f},"")+a},uy=function(n,t,e,i){var r="";do e||n--,r=i(n)+r,n/=t;while(n*t>=t);return r},Le=function(n,t,e,i,r){var a=e-t+1;return(n<0?"-":"")+(uy(Math.abs(n),a,i,function(f){return Ie(Math.floor(f%a)+t)})+r)},Rr=function(n,t,e){e===void 0&&(e=". ");var i=t.length;return uy(Math.abs(n),i,!1,function(r){return t[Math.floor(r%i)]})+e},ea=1<<0,ar=1<<1,or=1<<2,Fo=1<<3,Qn=function(n,t,e,i,r,a){if(n<-9999||n>9999)return iA(n,4,r.length>0);var f=Math.abs(n),o=r;if(f===0)return t[0]+o;for(var s=0;f>0&&s<=4;s++){var l=f%10;l===0&&Ne(a,ea)&&o!==""?o=t[l]+o:l>1||l===1&&s===0||l===1&&s===1&&Ne(a,ar)||l===1&&s===1&&Ne(a,or)&&n>100||l===1&&s>1&&Ne(a,Fo)?o=t[l]+(s>0?e[s-1]:"")+o:l===1&&s>0&&(o=e[s-1]+o),f=Math.floor(f/10)}return(n<0?i:"")+o},Dv="",Pv="",Ov="",Lu="",iA=function(n,t,e){var i=e?". ":"",r=e?"":"",a=e?", ":"",f=e?" ":"";switch(t){case 0:return""+f;case 1:return""+f;case 2:return""+f;case 5:var o=Le(n,48,57,!0,i);return o.length<4?"0"+o:o;case 4:return Rr(n,"",r);case 6:return js(n,1,3999,Lv,3,i).toLowerCase();case 7:return js(n,1,3999,Lv,3,i);case 8:return Le(n,945,969,!1,i);case 9:return Le(n,97,122,!1,i);case 10:return Le(n,65,90,!1,i);case 11:return Le(n,1632,1641,!0,i);case 12:case 49:return js(n,1,9999,Iv,3,i);case 35:return js(n,1,9999,Iv,3,i).toLowerCase();case 13:return Le(n,2534,2543,!0,i);case 14:case 30:return Le(n,6112,6121,!0,i);case 15:return Rr(n,"",r);case 16:return Rr(n,"",r);case 17:case 48:return Qn(n,"",Dv,"",r,ar|or|Fo);case 47:return Qn(n,"",Pv,"",r,ea|ar|or|Fo);case 42:return Qn(n,"",Dv,"",r,ar|or|Fo);case 41:return Qn(n,"",Pv,"",r,ea|ar|or|Fo);case 26:return Qn(n,"","",Ov,r,0);case 25:return Qn(n,"","",Ov,r,ea|ar|or);case 31:return Qn(n,"","",Lu,a,ea|ar|or);case 33:return Qn(n,"","",Lu,a,0);case 32:return Qn(n,"","",Lu,a,ea|ar|or);case 18:return Le(n,2406,2415,!0,i);case 20:return js(n,1,19999,tk,3,i);case 21:return Le(n,2790,2799,!0,i);case 22:return Le(n,2662,2671,!0,i);case 22:return js(n,1,10999,Z3,3,i);case 23:return Rr(n,"");case 24:return Rr(n,"");case 27:return Le(n,3302,3311,!0,i);case 28:return Rr(n,"",r);case 29:return Rr(n,"",r);case 34:return Le(n,3792,3801,!0,i);case 37:return Le(n,6160,6169,!0,i);case 38:return Le(n,4160,4169,!0,i);case 39:return Le(n,2918,2927,!0,i);case 40:return Le(n,1776,1785,!0,i);case 43:return Le(n,3046,3055,!0,i);case 44:return Le(n,3174,3183,!0,i);case 45:return Le(n,3664,3673,!0,i);case 46:return Le(n,3872,3881,!0,i);case 3:default:return Le(n,48,57,!0,i)}},fy="data-html2canvas-ignore",Qv=function(){function n(t,e,i){if(this.context=t,this.options=i,this.scrolledElements=[],this.referenceElement=e,this.counters=new J3,this.quoteDepth=0,!e.ownerDocument)throw new Error("Cloned element does not have an owner document");this.documentElement=this.cloneNode(e.ownerDocument.documentElement,!1)}return n.prototype.toIFrame=function(t,e){var i=this,r=ek(t,e);if(!r.contentWindow)return Promise.reject("Unable to find iframe window");var a=t.defaultView.pageXOffset,f=t.defaultView.pageYOffset,o=r.contentWindow,s=o.document,l=rk(r).then(function(){return hi(i,void 0,void 0,function(){var u,A;return ri(this,function(c){switch(c.label){case 0:return this.scrolledElements.forEach(Ak),o&&(o.scrollTo(e.left,e.top),/(iPad|iPhone|iPod)/g.test(navigator.userAgent)&&(o.scrollY!==e.top||o.scrollX!==e.left)&&(this.context.logger.warn("Unable to restore scroll position for cloned document"),this.context.windowBounds=this.context.windowBounds.add(o.scrollX-e.left,o.scrollY-e.top,0,0))),u=this.options.onclone,A=this.clonedReferenceElement,typeof A>"u"?[2,Promise.reject("Error finding the "+this.referenceElement.nodeName+" in the cloned document")]:s.fonts&&s.fonts.ready?[4,s.fonts.ready]:[3,2];case 1:c.sent(),c.label=2;case 2:return/(AppleWebKit)/g.test(navigator.userAgent)?[4,nk(s)]:[3,4];case 3:c.sent(),c.label=4;case 4:return typeof u=="function"?[2,Promise.resolve().then(function(){return u(s,A)}).then(function(){return r})]:[2,r]}})})});return s.open(),s.write(ak(document.doctype)+"<html></html>"),ok(this.referenceElement.ownerDocument,a,f),s.replaceChild(s.adoptNode(this.documentElement),s.documentElement),s.close(),l},n.prototype.createElementClone=function(t){if(Qf(t,2))debugger;if(ly(t))return this.createCanvasClone(t);if(Tv(t))return this.createVideoClone(t);if(Fv(t))return this.createStyleClone(t);var e=t.cloneNode(!1);return Nf(e)&&(Nf(t)&&t.currentSrc&&t.currentSrc!==t.src&&(e.src=t.currentSrc,e.srcset=""),e.loading==="lazy"&&(e.loading="eager")),Uv(e)?this.createCustomElementClone(e):e},n.prototype.createCustomElementClone=function(t){var e=document.createElement("html2canvascustomelement");return Iu(t.style,e),e},n.prototype.createStyleClone=function(t){try{var e=t.sheet;if(e&&e.cssRules){var i=[].slice.call(e.cssRules,0).reduce(function(a,f){return f&&typeof f.cssText=="string"?a+f.cssText:a},""),r=t.cloneNode(!1);return r.textContent=i,r}}catch(a){if(this.context.logger.error("Unable to access cssRules property",a),a.name!=="SecurityError")throw a}return t.cloneNode(!1)},n.prototype.createCanvasClone=function(t){var e;if(this.options.inlineImages&&t.ownerDocument){var i=t.ownerDocument.createElement("img");try{return i.src=t.toDataURL(),i}catch{this.context.logger.info("Unable to inline canvas contents, canvas is tainted",t)}}var r=t.cloneNode(!1);try{r.width=t.width,r.height=t.height;var a=t.getContext("2d"),f=r.getContext("2d");if(f)if(!this.options.allowTaint&&a)f.putImageData(a.getImageData(0,0,t.width,t.height),0,0);else{var o=(e=t.getContext("webgl2"))!==null&&e!==void 0?e:t.getContext("webgl");if(o){var s=o.getContextAttributes();(s==null?void 0:s.preserveDrawingBuffer)===!1&&this.context.logger.warn("Unable to clone WebGL context as it has preserveDrawingBuffer=false",t)}f.drawImage(t,0,0)}return r}catch{this.context.logger.info("Unable to clone canvas as it is tainted",t)}return r},n.prototype.createVideoClone=function(t){var e=t.ownerDocument.createElement("canvas");e.width=t.offsetWidth,e.height=t.offsetHeight;var i=e.getContext("2d");try{return i&&(i.drawImage(t,0,0,e.width,e.height),this.options.allowTaint||i.getImageData(0,0,e.width,e.height)),e}catch{this.context.logger.info("Unable to clone video as it is tainted",t)}var r=t.ownerDocument.createElement("canvas");return r.width=t.offsetWidth,r.height=t.offsetHeight,r},n.prototype.appendChildNode=function(t,e,i){(!ca(e)||!$3(e)&&!e.hasAttribute(fy)&&(typeof this.options.ignoreElements!="function"||!this.options.ignoreElements(e)))&&(!this.options.copyStyles||!ca(e)||!Fv(e))&&t.appendChild(this.cloneNode(e,i))},n.prototype.cloneChildNodes=function(t,e,i){for(var r=this,a=t.shadowRoot?t.shadowRoot.firstChild:t.firstChild;a;a=a.nextSibling)if(ca(a)&&hy(a)&&typeof a.assignedNodes=="function"){var f=a.assignedNodes();f.length&&f.forEach(function(o){return r.appendChildNode(e,o,i)})}else this.appendChildNode(e,a,i)},n.prototype.cloneNode=function(t,e){if(oy(t))return document.createTextNode(t.data);if(!t.ownerDocument)return t.cloneNode(!1);var i=t.ownerDocument.defaultView;if(i&&ca(t)&&(kf(t)||$l(t))){var r=this.createElementClone(t);r.style.transitionProperty="none";var a=i.getComputedStyle(t),f=i.getComputedStyle(t,":before"),o=i.getComputedStyle(t,":after");this.referenceElement===t&&kf(r)&&(this.clonedReferenceElement=r),Xd(r)&&hk(r);var s=this.counters.parse(new dv(this.context,a)),l=this.resolvePseudoContent(t,r,f,ko.BEFORE);Uv(t)&&(e=!0),Tv(t)||this.cloneChildNodes(t,r,e),l&&r.insertBefore(l,r.firstChild);var u=this.resolvePseudoContent(t,r,o,ko.AFTER);return u&&r.appendChild(u),this.counters.pop(s),(a&&(this.options.copyStyles||$l(t))&&!cy(t)||e)&&Iu(a,r),(t.scrollTop!==0||t.scrollLeft!==0)&&this.scrolledElements.push([r,t.scrollLeft,t.scrollTop]),(mc(t)||vc(t))&&(mc(r)||vc(r))&&(r.value=t.value),r}return t.cloneNode(!1)},n.prototype.resolvePseudoContent=function(t,e,i,r){var a=this;if(i){var f=i.content,o=e.ownerDocument;if(!(!o||!f||f==="none"||f==="-moz-alt-content"||i.display==="none")){this.counters.parse(new dv(this.context,i));var s=new XH(this.context,i),l=o.createElement("html2canvaspseudoelement");Iu(i,l),s.content.forEach(function(A){if(A.type===0)l.appendChild(o.createTextNode(A.value));else if(A.type===22){var c=o.createElement("img");c.src=A.value,c.style.opacity="1",l.appendChild(c)}else if(A.type===18){if(A.name==="attr"){var h=A.values.filter(me);h.length&&l.appendChild(o.createTextNode(t.getAttribute(h[0].value)||""))}else if(A.name==="counter"){var p=A.values.filter(Da),m=p[0],d=p[1];if(m&&me(m)){var g=a.counters.getCounterValue(m.value),v=d&&me(d)?Of.parse(a.context,d.value):3;l.appendChild(o.createTextNode(iA(g,v,!1)))}}else if(A.name==="counters"){var w=A.values.filter(Da),m=w[0],_=w[1],d=w[2];if(m&&me(m)){var y=a.counters.getCounterValues(m.value),C=d&&me(d)?Of.parse(a.context,d.value):3,b=_&&_.type===0?_.value:"",S=y.map(function(z){return iA(z,C,!1)}).join(b);l.appendChild(o.createTextNode(S))}}}else if(A.type===20)switch(A.value){case"open-quote":l.appendChild(o.createTextNode(fv(s.quotes,a.quoteDepth++,!0)));break;case"close-quote":l.appendChild(o.createTextNode(fv(s.quotes,--a.quoteDepth,!1)));break;default:l.appendChild(o.createTextNode(A.value))}}),l.className=Vf+" "+zf;var u=r===ko.BEFORE?" "+Vf:" "+zf;return $l(e)?e.className.baseValue+=u:e.className+=u,l}}},n.destroy=function(t){return t.parentNode?(t.parentNode.removeChild(t),!0):!1},n}(),ko;(function(n){n[n.BEFORE=0]="BEFORE",n[n.AFTER=1]="AFTER"})(ko||(ko={}));var ek=function(n,t){var e=n.createElement("iframe");return e.className="html2canvas-container",e.style.visibility="hidden",e.style.position="fixed",e.style.left="-10000px",e.style.top="0px",e.style.border="0",e.width=t.width.toString(),e.height=t.height.toString(),e.scrolling="no",e.setAttribute(fy,"true"),n.body.appendChild(e),e},ik=function(n){return new Promise(function(t){if(n.complete){t();return}if(!n.src){t();return}n.onload=t,n.onerror=t})},nk=function(n){return Promise.all([].slice.call(n.images,0).map(ik))},rk=function(n){return new Promise(function(t,e){var i=n.contentWindow;if(!i)return e("No window assigned for iframe");var r=i.document;i.onload=n.onload=function(){i.onload=n.onload=null;var a=setInterval(function(){r.body.childNodes.length>0&&r.readyState==="complete"&&(clearInterval(a),t(n))},50)}})},sk=["all","d","content"],Iu=function(n,t){for(var e=n.length-1;e>=0;e--){var i=n.item(e);sk.indexOf(i)===-1&&t.style.setProperty(i,n.getPropertyValue(i))}return t},ak=function(n){var t="";return n&&(t+="<!DOCTYPE ",n.name&&(t+=n.name),n.internalSubset&&(t+=n.internalSubset),n.publicId&&(t+='"'+n.publicId+'"'),n.systemId&&(t+='"'+n.systemId+'"'),t+=">"),t},ok=function(n,t,e){n&&n.defaultView&&(t!==n.defaultView.pageXOffset||e!==n.defaultView.pageYOffset)&&n.defaultView.scrollTo(t,e)},Ak=function(n){var t=n[0],e=n[1],i=n[2];t.scrollLeft=e,t.scrollTop=i},lk=":before",ck=":after",Vf="___html2canvas___pseudoelement_before",zf="___html2canvas___pseudoelement_after",Rv=`{
    content: "" !important;
    display: none !important;
}`,hk=function(n){uk(n,"."+Vf+lk+Rv+`
         .`+zf+ck+Rv)},uk=function(n,t){var e=n.ownerDocument;if(e){var i=e.createElement("style");i.textContent=t,n.appendChild(i)}},dy=function(){function n(){}return n.getOrigin=function(t){var e=n._link;return e?(e.href=t,e.href=e.href,e.protocol+e.hostname+e.port):"about:blank"},n.isSameOrigin=function(t){return n.getOrigin(t)===n._origin},n.setContext=function(t){n._link=t.document.createElement("a"),n._origin=n.getOrigin(t.location.href)},n._origin="about:blank",n}(),fk=function(){function n(t,e){this.context=t,this._options=e,this._cache={}}return n.prototype.addImage=function(t){var e=Promise.resolve();return this.has(t)||(Pu(t)||mk(t))&&(this._cache[t]=this.loadImage(t)).catch(function(){}),e},n.prototype.match=function(t){return this._cache[t]},n.prototype.loadImage=function(t){return hi(this,void 0,void 0,function(){var e,i,r,a,f=this;return ri(this,function(o){switch(o.label){case 0:return e=dy.isSameOrigin(t),i=!Du(t)&&this._options.useCORS===!0&&$e.SUPPORT_CORS_IMAGES&&!e,r=!Du(t)&&!e&&!Pu(t)&&typeof this._options.proxy=="string"&&$e.SUPPORT_CORS_XHR&&!i,!e&&this._options.allowTaint===!1&&!Du(t)&&!Pu(t)&&!r&&!i?[2]:(a=t,r?[4,this.proxy(a)]:[3,2]);case 1:a=o.sent(),o.label=2;case 2:return this.context.logger.debug("Added image "+t.substring(0,256)),[4,new Promise(function(s,l){var u=new Image;u.onload=function(){return s(u)},u.onerror=l,(vk(a)||i)&&(u.crossOrigin="anonymous"),u.src=a,u.complete===!0&&setTimeout(function(){return s(u)},500),f._options.imageTimeout>0&&setTimeout(function(){return l("Timed out ("+f._options.imageTimeout+"ms) loading image")},f._options.imageTimeout)})];case 3:return[2,o.sent()]}})})},n.prototype.has=function(t){return typeof this._cache[t]<"u"},n.prototype.keys=function(){return Promise.resolve(Object.keys(this._cache))},n.prototype.proxy=function(t){var e=this,i=this._options.proxy;if(!i)throw new Error("No proxy defined");var r=t.substring(0,256);return new Promise(function(a,f){var o=$e.SUPPORT_RESPONSE_TYPE?"blob":"text",s=new XMLHttpRequest;s.onload=function(){if(s.status===200)if(o==="text")a(s.response);else{var A=new FileReader;A.addEventListener("load",function(){return a(A.result)},!1),A.addEventListener("error",function(c){return f(c)},!1),A.readAsDataURL(s.response)}else f("Failed to proxy resource "+r+" with status code "+s.status)},s.onerror=f;var l=i.indexOf("?")>-1?"&":"?";if(s.open("GET",""+i+l+"url="+encodeURIComponent(t)+"&responseType="+o),o!=="text"&&s instanceof XMLHttpRequest&&(s.responseType=o),e._options.imageTimeout){var u=e._options.imageTimeout;s.timeout=u,s.ontimeout=function(){return f("Timed out ("+u+"ms) proxying "+r)}}s.send()})},n}(),dk=/^data:image\/svg\+xml/i,pk=/^data:image\/.*;base64,/i,gk=/^data:image\/.*/i,mk=function(n){return $e.SUPPORT_SVG_DRAWING||!wk(n)},Du=function(n){return gk.test(n)},vk=function(n){return pk.test(n)},Pu=function(n){return n.substr(0,4)==="blob"},wk=function(n){return n.substr(-3).toLowerCase()==="svg"||dk.test(n)},Et=function(){function n(t,e){this.type=0,this.x=t,this.y=e}return n.prototype.add=function(t,e){return new n(this.x+t,this.y+e)},n}(),Ys=function(n,t,e){return new Et(n.x+(t.x-n.x)*e,n.y+(t.y-n.y)*e)},Pl=function(){function n(t,e,i,r){this.type=1,this.start=t,this.startControl=e,this.endControl=i,this.end=r}return n.prototype.subdivide=function(t,e){var i=Ys(this.start,this.startControl,t),r=Ys(this.startControl,this.endControl,t),a=Ys(this.endControl,this.end,t),f=Ys(i,r,t),o=Ys(r,a,t),s=Ys(f,o,t);return e?new n(this.start,i,f,s):new n(s,o,a,this.end)},n.prototype.add=function(t,e){return new n(this.start.add(t,e),this.startControl.add(t,e),this.endControl.add(t,e),this.end.add(t,e))},n.prototype.reverse=function(){return new n(this.end,this.endControl,this.startControl,this.start)},n}(),Gi=function(n){return n.type===1},_k=function(){function n(t){var e=t.styles,i=t.bounds,r=Mo(e.borderTopLeftRadius,i.width,i.height),a=r[0],f=r[1],o=Mo(e.borderTopRightRadius,i.width,i.height),s=o[0],l=o[1],u=Mo(e.borderBottomRightRadius,i.width,i.height),A=u[0],c=u[1],h=Mo(e.borderBottomLeftRadius,i.width,i.height),p=h[0],m=h[1],d=[];d.push((a+s)/i.width),d.push((p+A)/i.width),d.push((f+m)/i.height),d.push((l+c)/i.height);var g=Math.max.apply(Math,d);g>1&&(a/=g,f/=g,s/=g,l/=g,A/=g,c/=g,p/=g,m/=g);var v=i.width-s,w=i.height-c,_=i.width-A,y=i.height-m,C=e.borderTopWidth,b=e.borderRightWidth,S=e.borderBottomWidth,B=e.borderLeftWidth,M=_e(e.paddingTop,t.bounds.width),z=_e(e.paddingRight,t.bounds.width),G=_e(e.paddingBottom,t.bounds.width),P=_e(e.paddingLeft,t.bounds.width);this.topLeftBorderDoubleOuterBox=a>0||f>0?be(i.left+B/3,i.top+C/3,a-B/3,f-C/3,Ae.TOP_LEFT):new Et(i.left+B/3,i.top+C/3),this.topRightBorderDoubleOuterBox=a>0||f>0?be(i.left+v,i.top+C/3,s-b/3,l-C/3,Ae.TOP_RIGHT):new Et(i.left+i.width-b/3,i.top+C/3),this.bottomRightBorderDoubleOuterBox=A>0||c>0?be(i.left+_,i.top+w,A-b/3,c-S/3,Ae.BOTTOM_RIGHT):new Et(i.left+i.width-b/3,i.top+i.height-S/3),this.bottomLeftBorderDoubleOuterBox=p>0||m>0?be(i.left+B/3,i.top+y,p-B/3,m-S/3,Ae.BOTTOM_LEFT):new Et(i.left+B/3,i.top+i.height-S/3),this.topLeftBorderDoubleInnerBox=a>0||f>0?be(i.left+B*2/3,i.top+C*2/3,a-B*2/3,f-C*2/3,Ae.TOP_LEFT):new Et(i.left+B*2/3,i.top+C*2/3),this.topRightBorderDoubleInnerBox=a>0||f>0?be(i.left+v,i.top+C*2/3,s-b*2/3,l-C*2/3,Ae.TOP_RIGHT):new Et(i.left+i.width-b*2/3,i.top+C*2/3),this.bottomRightBorderDoubleInnerBox=A>0||c>0?be(i.left+_,i.top+w,A-b*2/3,c-S*2/3,Ae.BOTTOM_RIGHT):new Et(i.left+i.width-b*2/3,i.top+i.height-S*2/3),this.bottomLeftBorderDoubleInnerBox=p>0||m>0?be(i.left+B*2/3,i.top+y,p-B*2/3,m-S*2/3,Ae.BOTTOM_LEFT):new Et(i.left+B*2/3,i.top+i.height-S*2/3),this.topLeftBorderStroke=a>0||f>0?be(i.left+B/2,i.top+C/2,a-B/2,f-C/2,Ae.TOP_LEFT):new Et(i.left+B/2,i.top+C/2),this.topRightBorderStroke=a>0||f>0?be(i.left+v,i.top+C/2,s-b/2,l-C/2,Ae.TOP_RIGHT):new Et(i.left+i.width-b/2,i.top+C/2),this.bottomRightBorderStroke=A>0||c>0?be(i.left+_,i.top+w,A-b/2,c-S/2,Ae.BOTTOM_RIGHT):new Et(i.left+i.width-b/2,i.top+i.height-S/2),this.bottomLeftBorderStroke=p>0||m>0?be(i.left+B/2,i.top+y,p-B/2,m-S/2,Ae.BOTTOM_LEFT):new Et(i.left+B/2,i.top+i.height-S/2),this.topLeftBorderBox=a>0||f>0?be(i.left,i.top,a,f,Ae.TOP_LEFT):new Et(i.left,i.top),this.topRightBorderBox=s>0||l>0?be(i.left+v,i.top,s,l,Ae.TOP_RIGHT):new Et(i.left+i.width,i.top),this.bottomRightBorderBox=A>0||c>0?be(i.left+_,i.top+w,A,c,Ae.BOTTOM_RIGHT):new Et(i.left+i.width,i.top+i.height),this.bottomLeftBorderBox=p>0||m>0?be(i.left,i.top+y,p,m,Ae.BOTTOM_LEFT):new Et(i.left,i.top+i.height),this.topLeftPaddingBox=a>0||f>0?be(i.left+B,i.top+C,Math.max(0,a-B),Math.max(0,f-C),Ae.TOP_LEFT):new Et(i.left+B,i.top+C),this.topRightPaddingBox=s>0||l>0?be(i.left+Math.min(v,i.width-b),i.top+C,v>i.width+b?0:Math.max(0,s-b),Math.max(0,l-C),Ae.TOP_RIGHT):new Et(i.left+i.width-b,i.top+C),this.bottomRightPaddingBox=A>0||c>0?be(i.left+Math.min(_,i.width-B),i.top+Math.min(w,i.height-S),Math.max(0,A-b),Math.max(0,c-S),Ae.BOTTOM_RIGHT):new Et(i.left+i.width-b,i.top+i.height-S),this.bottomLeftPaddingBox=p>0||m>0?be(i.left+B,i.top+Math.min(y,i.height-S),Math.max(0,p-B),Math.max(0,m-S),Ae.BOTTOM_LEFT):new Et(i.left+B,i.top+i.height-S),this.topLeftContentBox=a>0||f>0?be(i.left+B+P,i.top+C+M,Math.max(0,a-(B+P)),Math.max(0,f-(C+M)),Ae.TOP_LEFT):new Et(i.left+B+P,i.top+C+M),this.topRightContentBox=s>0||l>0?be(i.left+Math.min(v,i.width+B+P),i.top+C+M,v>i.width+B+P?0:s-B+P,l-(C+M),Ae.TOP_RIGHT):new Et(i.left+i.width-(b+z),i.top+C+M),this.bottomRightContentBox=A>0||c>0?be(i.left+Math.min(_,i.width-(B+P)),i.top+Math.min(w,i.height+C+M),Math.max(0,A-(b+z)),c-(S+G),Ae.BOTTOM_RIGHT):new Et(i.left+i.width-(b+z),i.top+i.height-(S+G)),this.bottomLeftContentBox=p>0||m>0?be(i.left+B+P,i.top+y,Math.max(0,p-(B+P)),m-(S+G),Ae.BOTTOM_LEFT):new Et(i.left+B+P,i.top+i.height-(S+G))}return n}(),Ae;(function(n){n[n.TOP_LEFT=0]="TOP_LEFT",n[n.TOP_RIGHT=1]="TOP_RIGHT",n[n.BOTTOM_RIGHT=2]="BOTTOM_RIGHT",n[n.BOTTOM_LEFT=3]="BOTTOM_LEFT"})(Ae||(Ae={}));var be=function(n,t,e,i,r){var a=4*((Math.sqrt(2)-1)/3),f=e*a,o=i*a,s=n+e,l=t+i;switch(r){case Ae.TOP_LEFT:return new Pl(new Et(n,l),new Et(n,l-o),new Et(s-f,t),new Et(s,t));case Ae.TOP_RIGHT:return new Pl(new Et(n,t),new Et(n+f,t),new Et(s,l-o),new Et(s,l));case Ae.BOTTOM_RIGHT:return new Pl(new Et(s,t),new Et(s,t+o),new Et(n+f,l),new Et(n,l));case Ae.BOTTOM_LEFT:default:return new Pl(new Et(s,l),new Et(s-f,l),new Et(n,t+o),new Et(n,t))}},wc=function(n){return[n.topLeftBorderBox,n.topRightBorderBox,n.bottomRightBorderBox,n.bottomLeftBorderBox]},yk=function(n){return[n.topLeftContentBox,n.topRightContentBox,n.bottomRightContentBox,n.bottomLeftContentBox]},_c=function(n){return[n.topLeftPaddingBox,n.topRightPaddingBox,n.bottomRightPaddingBox,n.bottomLeftPaddingBox]},xk=function(){function n(t,e,i){this.offsetX=t,this.offsetY=e,this.matrix=i,this.type=0,this.target=6}return n}(),Ol=function(){function n(t,e){this.path=t,this.target=e,this.type=1}return n}(),Ck=function(){function n(t){this.opacity=t,this.type=2,this.target=6}return n}(),bk=function(n){return n.type===0},py=function(n){return n.type===1},Bk=function(n){return n.type===2},Hv=function(n,t){return n.length===t.length?n.some(function(e,i){return e===t[i]}):!1},Sk=function(n,t,e,i,r){return n.map(function(a,f){switch(f){case 0:return a.add(t,e);case 1:return a.add(t+i,e);case 2:return a.add(t+i,e+r);case 3:return a.add(t,e+r)}return a})},gy=function(){function n(t){this.element=t,this.inlineLevel=[],this.nonInlineLevel=[],this.negativeZIndex=[],this.zeroOrAutoZIndexOrTransformedOrOpacity=[],this.positiveZIndex=[],this.nonPositionedFloats=[],this.nonPositionedInlineLevel=[]}return n}(),my=function(){function n(t,e){if(this.container=t,this.parent=e,this.effects=[],this.curves=new _k(this.container),this.container.styles.opacity<1&&this.effects.push(new Ck(this.container.styles.opacity)),this.container.styles.transform!==null){var i=this.container.bounds.left+this.container.styles.transformOrigin[0].number,r=this.container.bounds.top+this.container.styles.transformOrigin[1].number,a=this.container.styles.transform;this.effects.push(new xk(i,r,a))}if(this.container.styles.overflowX!==0){var f=wc(this.curves),o=_c(this.curves);Hv(f,o)?this.effects.push(new Ol(f,6)):(this.effects.push(new Ol(f,2)),this.effects.push(new Ol(o,4)))}}return n.prototype.getEffects=function(t){for(var e=[2,3].indexOf(this.container.styles.position)===-1,i=this.parent,r=this.effects.slice(0);i;){var a=i.effects.filter(function(s){return!py(s)});if(e||i.container.styles.position!==0||!i.parent){if(r.unshift.apply(r,a),e=[2,3].indexOf(i.container.styles.position)===-1,i.container.styles.overflowX!==0){var f=wc(i.curves),o=_c(i.curves);Hv(f,o)||r.unshift(new Ol(o,6))}}else r.unshift.apply(r,a);i=i.parent}return r.filter(function(s){return Ne(s.target,t)})},n}(),Gf=function(n,t,e,i){n.container.elements.forEach(function(r){var a=Ne(r.flags,4),f=Ne(r.flags,2),o=new my(r,n);Ne(r.styles.display,2048)&&i.push(o);var s=Ne(r.flags,8)?[]:i;if(a||f){var l=a||r.styles.isPositioned()?e:t,u=new gy(o);if(r.styles.isPositioned()||r.styles.opacity<1||r.styles.isTransformed()){var A=r.styles.zIndex.order;if(A<0){var c=0;l.negativeZIndex.some(function(p,m){return A>p.element.container.styles.zIndex.order?(c=m,!1):c>0}),l.negativeZIndex.splice(c,0,u)}else if(A>0){var h=0;l.positiveZIndex.some(function(p,m){return A>=p.element.container.styles.zIndex.order?(h=m+1,!1):h>0}),l.positiveZIndex.splice(h,0,u)}else l.zeroOrAutoZIndexOrTransformedOrOpacity.push(u)}else r.styles.isFloating()?l.nonPositionedFloats.push(u):l.nonPositionedInlineLevel.push(u);Gf(o,u,a?u:e,s)}else r.styles.isInlineLevel()?t.inlineLevel.push(o):t.nonInlineLevel.push(o),Gf(o,t,e,s);Ne(r.flags,8)&&vy(r,s)})},vy=function(n,t){for(var e=n instanceof Hf?n.start:1,i=n instanceof Hf?n.reversed:!1,r=0;r<t.length;r++){var a=t[r];a.container instanceof ey&&typeof a.container.value=="number"&&a.container.value!==0&&(e=a.container.value),a.listValue=iA(e,a.container.styles.listStyleType,!0),e+=i?-1:1}},Ek=function(n){var t=new my(n,null),e=new gy(t),i=[];return Gf(t,e,e,i),vy(t.container,i),e},kv=function(n,t){switch(t){case 0:return ji(n.topLeftBorderBox,n.topLeftPaddingBox,n.topRightBorderBox,n.topRightPaddingBox);case 1:return ji(n.topRightBorderBox,n.topRightPaddingBox,n.bottomRightBorderBox,n.bottomRightPaddingBox);case 2:return ji(n.bottomRightBorderBox,n.bottomRightPaddingBox,n.bottomLeftBorderBox,n.bottomLeftPaddingBox);case 3:default:return ji(n.bottomLeftBorderBox,n.bottomLeftPaddingBox,n.topLeftBorderBox,n.topLeftPaddingBox)}},Mk=function(n,t){switch(t){case 0:return ji(n.topLeftBorderBox,n.topLeftBorderDoubleOuterBox,n.topRightBorderBox,n.topRightBorderDoubleOuterBox);case 1:return ji(n.topRightBorderBox,n.topRightBorderDoubleOuterBox,n.bottomRightBorderBox,n.bottomRightBorderDoubleOuterBox);case 2:return ji(n.bottomRightBorderBox,n.bottomRightBorderDoubleOuterBox,n.bottomLeftBorderBox,n.bottomLeftBorderDoubleOuterBox);case 3:default:return ji(n.bottomLeftBorderBox,n.bottomLeftBorderDoubleOuterBox,n.topLeftBorderBox,n.topLeftBorderDoubleOuterBox)}},Tk=function(n,t){switch(t){case 0:return ji(n.topLeftBorderDoubleInnerBox,n.topLeftPaddingBox,n.topRightBorderDoubleInnerBox,n.topRightPaddingBox);case 1:return ji(n.topRightBorderDoubleInnerBox,n.topRightPaddingBox,n.bottomRightBorderDoubleInnerBox,n.bottomRightPaddingBox);case 2:return ji(n.bottomRightBorderDoubleInnerBox,n.bottomRightPaddingBox,n.bottomLeftBorderDoubleInnerBox,n.bottomLeftPaddingBox);case 3:default:return ji(n.bottomLeftBorderDoubleInnerBox,n.bottomLeftPaddingBox,n.topLeftBorderDoubleInnerBox,n.topLeftPaddingBox)}},Fk=function(n,t){switch(t){case 0:return Ql(n.topLeftBorderStroke,n.topRightBorderStroke);case 1:return Ql(n.topRightBorderStroke,n.bottomRightBorderStroke);case 2:return Ql(n.bottomRightBorderStroke,n.bottomLeftBorderStroke);case 3:default:return Ql(n.bottomLeftBorderStroke,n.topLeftBorderStroke)}},Ql=function(n,t){var e=[];return Gi(n)?e.push(n.subdivide(.5,!1)):e.push(n),Gi(t)?e.push(t.subdivide(.5,!0)):e.push(t),e},ji=function(n,t,e,i){var r=[];return Gi(n)?r.push(n.subdivide(.5,!1)):r.push(n),Gi(e)?r.push(e.subdivide(.5,!0)):r.push(e),Gi(i)?r.push(i.subdivide(.5,!0).reverse()):r.push(i),Gi(t)?r.push(t.subdivide(.5,!1).reverse()):r.push(t),r},wy=function(n){var t=n.bounds,e=n.styles;return t.add(e.borderLeftWidth,e.borderTopWidth,-(e.borderRightWidth+e.borderLeftWidth),-(e.borderTopWidth+e.borderBottomWidth))},yc=function(n){var t=n.styles,e=n.bounds,i=_e(t.paddingLeft,e.width),r=_e(t.paddingRight,e.width),a=_e(t.paddingTop,e.width),f=_e(t.paddingBottom,e.width);return e.add(i+t.borderLeftWidth,a+t.borderTopWidth,-(t.borderRightWidth+t.borderLeftWidth+i+r),-(t.borderTopWidth+t.borderBottomWidth+a+f))},Uk=function(n,t){return n===0?t.bounds:n===2?yc(t):wy(t)},Lk=function(n,t){return n===0?t.bounds:n===2?yc(t):wy(t)},Ou=function(n,t,e){var i=Uk(ia(n.styles.backgroundOrigin,t),n),r=Lk(ia(n.styles.backgroundClip,t),n),a=Ik(ia(n.styles.backgroundSize,t),e,i),f=a[0],o=a[1],s=Mo(ia(n.styles.backgroundPosition,t),i.width-f,i.height-o),l=Dk(ia(n.styles.backgroundRepeat,t),s,a,i,r),u=Math.round(i.left+s[0]),A=Math.round(i.top+s[1]);return[l,u,A,f,o]},qs=function(n){return me(n)&&n.value===ga.AUTO},Rl=function(n){return typeof n=="number"},Ik=function(n,t,e){var i=t[0],r=t[1],a=t[2],f=n[0],o=n[1];if(!f)return[0,0];if(He(f)&&o&&He(o))return[_e(f,e.width),_e(o,e.height)];var s=Rl(a);if(me(f)&&(f.value===ga.CONTAIN||f.value===ga.COVER)){if(Rl(a)){var l=e.width/e.height;return l<a!=(f.value===ga.COVER)?[e.width,e.width/a]:[e.height*a,e.height]}return[e.width,e.height]}var u=Rl(i),A=Rl(r),c=u||A;if(qs(f)&&(!o||qs(o))){if(u&&A)return[i,r];if(!s&&!c)return[e.width,e.height];if(c&&s){var h=u?i:r*a,p=A?r:i/a;return[h,p]}var m=u?i:e.width,d=A?r:e.height;return[m,d]}if(s){var g=0,v=0;return He(f)?g=_e(f,e.width):He(o)&&(v=_e(o,e.height)),qs(f)?g=v*a:(!o||qs(o))&&(v=g/a),[g,v]}var w=null,_=null;if(He(f)?w=_e(f,e.width):o&&He(o)&&(_=_e(o,e.height)),w!==null&&(!o||qs(o))&&(_=u&&A?w/i*r:e.height),_!==null&&qs(f)&&(w=u&&A?_/r*i:e.width),w!==null&&_!==null)return[w,_];throw new Error("Unable to calculate background-size for element")},ia=function(n,t){var e=n[t];return typeof e>"u"?n[0]:e},Dk=function(n,t,e,i,r){var a=t[0],f=t[1],o=e[0],s=e[1];switch(n){case 2:return[new Et(Math.round(i.left),Math.round(i.top+f)),new Et(Math.round(i.left+i.width),Math.round(i.top+f)),new Et(Math.round(i.left+i.width),Math.round(s+i.top+f)),new Et(Math.round(i.left),Math.round(s+i.top+f))];case 3:return[new Et(Math.round(i.left+a),Math.round(i.top)),new Et(Math.round(i.left+a+o),Math.round(i.top)),new Et(Math.round(i.left+a+o),Math.round(i.height+i.top)),new Et(Math.round(i.left+a),Math.round(i.height+i.top))];case 1:return[new Et(Math.round(i.left+a),Math.round(i.top+f)),new Et(Math.round(i.left+a+o),Math.round(i.top+f)),new Et(Math.round(i.left+a+o),Math.round(i.top+f+s)),new Et(Math.round(i.left+a),Math.round(i.top+f+s))];default:return[new Et(Math.round(r.left),Math.round(r.top)),new Et(Math.round(r.left+r.width),Math.round(r.top)),new Et(Math.round(r.left+r.width),Math.round(r.height+r.top)),new Et(Math.round(r.left),Math.round(r.height+r.top))]}},Pk="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",Nv="Hidden Text",Ok=function(){function n(t){this._data={},this._document=t}return n.prototype.parseMetrics=function(t,e){var i=this._document.createElement("div"),r=this._document.createElement("img"),a=this._document.createElement("span"),f=this._document.body;i.style.visibility="hidden",i.style.fontFamily=t,i.style.fontSize=e,i.style.margin="0",i.style.padding="0",i.style.whiteSpace="nowrap",f.appendChild(i),r.src=Pk,r.width=1,r.height=1,r.style.margin="0",r.style.padding="0",r.style.verticalAlign="baseline",a.style.fontFamily=t,a.style.fontSize=e,a.style.margin="0",a.style.padding="0",a.appendChild(this._document.createTextNode(Nv)),i.appendChild(a),i.appendChild(r);var o=r.offsetTop-a.offsetTop+2;i.removeChild(a),i.appendChild(this._document.createTextNode(Nv)),i.style.lineHeight="normal",r.style.verticalAlign="super";var s=r.offsetTop-i.offsetTop+2;return f.removeChild(i),{baseline:o,middle:s}},n.prototype.getMetrics=function(t,e){var i=t+" "+e;return typeof this._data[i]>"u"&&(this._data[i]=this.parseMetrics(t,e)),this._data[i]},n}(),_y=function(){function n(t,e){this.context=t,this.options=e}return n}(),Qk=1e4,Rk=function(n){cn(t,n);function t(e,i){var r=n.call(this,e,i)||this;return r._activeEffects=[],r.canvas=i.canvas?i.canvas:document.createElement("canvas"),r.ctx=r.canvas.getContext("2d"),i.canvas||(r.canvas.width=Math.floor(i.width*i.scale),r.canvas.height=Math.floor(i.height*i.scale),r.canvas.style.width=i.width+"px",r.canvas.style.height=i.height+"px"),r.fontMetrics=new Ok(document),r.ctx.scale(r.options.scale,r.options.scale),r.ctx.translate(-i.x,-i.y),r.ctx.textBaseline="bottom",r._activeEffects=[],r.context.logger.debug("Canvas renderer initialized ("+i.width+"x"+i.height+") with scale "+i.scale),r}return t.prototype.applyEffects=function(e){for(var i=this;this._activeEffects.length;)this.popEffect();e.forEach(function(r){return i.applyEffect(r)})},t.prototype.applyEffect=function(e){this.ctx.save(),Bk(e)&&(this.ctx.globalAlpha=e.opacity),bk(e)&&(this.ctx.translate(e.offsetX,e.offsetY),this.ctx.transform(e.matrix[0],e.matrix[1],e.matrix[2],e.matrix[3],e.matrix[4],e.matrix[5]),this.ctx.translate(-e.offsetX,-e.offsetY)),py(e)&&(this.path(e.path),this.ctx.clip()),this._activeEffects.push(e)},t.prototype.popEffect=function(){this._activeEffects.pop(),this.ctx.restore()},t.prototype.renderStack=function(e){return hi(this,void 0,void 0,function(){var i;return ri(this,function(r){switch(r.label){case 0:return i=e.element.container.styles,i.isVisible()?[4,this.renderStackContent(e)]:[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}})})},t.prototype.renderNode=function(e){return hi(this,void 0,void 0,function(){return ri(this,function(i){switch(i.label){case 0:if(Ne(e.container.flags,16))debugger;return e.container.styles.isVisible()?[4,this.renderNodeBackgroundAndBorders(e)]:[3,3];case 1:return i.sent(),[4,this.renderNodeContent(e)];case 2:i.sent(),i.label=3;case 3:return[2]}})})},t.prototype.renderTextWithLetterSpacing=function(e,i,r){var a=this;if(i===0)this.ctx.fillText(e.text,e.bounds.left,e.bounds.top+r);else{var f=Wd(e.text);f.reduce(function(o,s){return a.ctx.fillText(s,o,e.bounds.top+r),o+a.ctx.measureText(s).width},e.bounds.left)}},t.prototype.createFontStyle=function(e){var i=e.fontVariant.filter(function(f){return f==="normal"||f==="small-caps"}).join(""),r=zk(e.fontFamily).join(", "),a=yA(e.fontSize)?""+e.fontSize.number+e.fontSize.unit:e.fontSize.number+"px";return[[e.fontStyle,i,e.fontWeight,a,r].join(" "),r,a]},t.prototype.renderTextNode=function(e,i){return hi(this,void 0,void 0,function(){var r,a,f,o,s,l,u,A,c=this;return ri(this,function(h){return r=this.createFontStyle(i),a=r[0],f=r[1],o=r[2],this.ctx.font=a,this.ctx.direction=i.direction===1?"rtl":"ltr",this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic",s=this.fontMetrics.getMetrics(f,o),l=s.baseline,u=s.middle,A=i.paintOrder,e.textBounds.forEach(function(p){A.forEach(function(m){switch(m){case 0:c.ctx.fillStyle=Ke(i.color),c.renderTextWithLetterSpacing(p,i.letterSpacing,l);var d=i.textShadow;d.length&&p.text.trim().length&&(d.slice(0).reverse().forEach(function(g){c.ctx.shadowColor=Ke(g.color),c.ctx.shadowOffsetX=g.offsetX.number*c.options.scale,c.ctx.shadowOffsetY=g.offsetY.number*c.options.scale,c.ctx.shadowBlur=g.blur.number,c.renderTextWithLetterSpacing(p,i.letterSpacing,l)}),c.ctx.shadowColor="",c.ctx.shadowOffsetX=0,c.ctx.shadowOffsetY=0,c.ctx.shadowBlur=0),i.textDecorationLine.length&&(c.ctx.fillStyle=Ke(i.textDecorationColor||i.color),i.textDecorationLine.forEach(function(g){switch(g){case 1:c.ctx.fillRect(p.bounds.left,Math.round(p.bounds.top+l),p.bounds.width,1);break;case 2:c.ctx.fillRect(p.bounds.left,Math.round(p.bounds.top),p.bounds.width,1);break;case 3:c.ctx.fillRect(p.bounds.left,Math.ceil(p.bounds.top+u),p.bounds.width,1);break}}));break;case 1:i.webkitTextStrokeWidth&&p.text.trim().length&&(c.ctx.strokeStyle=Ke(i.webkitTextStrokeColor),c.ctx.lineWidth=i.webkitTextStrokeWidth,c.ctx.lineJoin=window.chrome?"miter":"round",c.ctx.strokeText(p.text,p.bounds.left,p.bounds.top+l)),c.ctx.strokeStyle="",c.ctx.lineWidth=0,c.ctx.lineJoin="miter";break}})}),[2]})})},t.prototype.renderReplacedElement=function(e,i,r){if(r&&e.intrinsicWidth>0&&e.intrinsicHeight>0){var a=yc(e),f=_c(i);this.path(f),this.ctx.save(),this.ctx.clip(),this.ctx.drawImage(r,0,0,e.intrinsicWidth,e.intrinsicHeight,a.left,a.top,a.width,a.height),this.ctx.restore()}},t.prototype.renderNodeContent=function(e){return hi(this,void 0,void 0,function(){var i,r,a,f,o,s,v,v,l,u,A,c,_,h,p,y,m,d,g,v,w,_,y;return ri(this,function(C){switch(C.label){case 0:this.applyEffects(e.getEffects(4)),i=e.container,r=e.curves,a=i.styles,f=0,o=i.textNodes,C.label=1;case 1:return f<o.length?(s=o[f],[4,this.renderTextNode(s,a)]):[3,4];case 2:C.sent(),C.label=3;case 3:return f++,[3,1];case 4:if(!(i instanceof J_))return[3,8];C.label=5;case 5:return C.trys.push([5,7,,8]),[4,this.context.cache.match(i.src)];case 6:return v=C.sent(),this.renderReplacedElement(i,r,v),[3,8];case 7:return C.sent(),this.context.logger.error("Error loading image "+i.src),[3,8];case 8:if(i instanceof Z_&&this.renderReplacedElement(i,r,i.canvas),!(i instanceof ty))return[3,12];C.label=9;case 9:return C.trys.push([9,11,,12]),[4,this.context.cache.match(i.svg)];case 10:return v=C.sent(),this.renderReplacedElement(i,r,v),[3,12];case 11:return C.sent(),this.context.logger.error("Error loading svg "+i.svg.substring(0,255)),[3,12];case 12:return i instanceof ry&&i.tree?(l=new t(this.context,{scale:this.options.scale,backgroundColor:i.backgroundColor,x:0,y:0,width:i.width,height:i.height}),[4,l.render(i.tree)]):[3,14];case 13:u=C.sent(),i.width&&i.height&&this.ctx.drawImage(u,0,0,i.width,i.height,i.bounds.left,i.bounds.top,i.bounds.width,i.bounds.height),C.label=14;case 14:if(i instanceof Kd&&(A=Math.min(i.bounds.width,i.bounds.height),i.type===pc?i.checked&&(this.ctx.save(),this.path([new Et(i.bounds.left+A*.39363,i.bounds.top+A*.79),new Et(i.bounds.left+A*.16,i.bounds.top+A*.5549),new Et(i.bounds.left+A*.27347,i.bounds.top+A*.44071),new Et(i.bounds.left+A*.39694,i.bounds.top+A*.5649),new Et(i.bounds.left+A*.72983,i.bounds.top+A*.23),new Et(i.bounds.left+A*.84,i.bounds.top+A*.34085),new Et(i.bounds.left+A*.39363,i.bounds.top+A*.79)]),this.ctx.fillStyle=Ke(Mv),this.ctx.fill(),this.ctx.restore()):i.type===gc&&i.checked&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(i.bounds.left+A/2,i.bounds.top+A/2,A/4,0,Math.PI*2,!0),this.ctx.fillStyle=Ke(Mv),this.ctx.fill(),this.ctx.restore())),Hk(i)&&i.value.length){switch(c=this.createFontStyle(a),_=c[0],h=c[1],p=this.fontMetrics.getMetrics(_,h).baseline,this.ctx.font=_,this.ctx.fillStyle=Ke(a.color),this.ctx.textBaseline="alphabetic",this.ctx.textAlign=Nk(i.styles.textAlign),y=yc(i),m=0,i.styles.textAlign){case 1:m+=y.width/2;break;case 2:m+=y.width;break}d=y.add(m,0,0,-y.height/2+1),this.ctx.save(),this.path([new Et(y.left,y.top),new Et(y.left+y.width,y.top),new Et(y.left+y.width,y.top+y.height),new Et(y.left,y.top+y.height)]),this.ctx.clip(),this.renderTextWithLetterSpacing(new Ho(i.value,d),a.letterSpacing,p),this.ctx.restore(),this.ctx.textBaseline="alphabetic",this.ctx.textAlign="left"}if(!Ne(i.styles.display,2048))return[3,20];if(i.styles.listStyleImage===null)return[3,19];if(g=i.styles.listStyleImage,g.type!==0)return[3,18];v=void 0,w=g.url,C.label=15;case 15:return C.trys.push([15,17,,18]),[4,this.context.cache.match(w)];case 16:return v=C.sent(),this.ctx.drawImage(v,i.bounds.left-(v.width+10),i.bounds.top),[3,18];case 17:return C.sent(),this.context.logger.error("Error loading list-style-image "+w),[3,18];case 18:return[3,20];case 19:e.listValue&&i.styles.listStyleType!==-1&&(_=this.createFontStyle(a)[0],this.ctx.font=_,this.ctx.fillStyle=Ke(a.color),this.ctx.textBaseline="middle",this.ctx.textAlign="right",y=new Xn(i.bounds.left,i.bounds.top+_e(i.styles.paddingTop,i.bounds.width),i.bounds.width,hv(a.lineHeight,a.fontSize.number)/2+1),this.renderTextWithLetterSpacing(new Ho(e.listValue,y),a.letterSpacing,hv(a.lineHeight,a.fontSize.number)/2+2),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"),C.label=20;case 20:return[2]}})})},t.prototype.renderStackContent=function(e){return hi(this,void 0,void 0,function(){var i,r,g,a,f,g,o,s,g,l,u,g,A,c,g,h,p,g,m,d,g;return ri(this,function(v){switch(v.label){case 0:if(Ne(e.element.container.flags,16))debugger;return[4,this.renderNodeBackgroundAndBorders(e.element)];case 1:v.sent(),i=0,r=e.negativeZIndex,v.label=2;case 2:return i<r.length?(g=r[i],[4,this.renderStack(g)]):[3,5];case 3:v.sent(),v.label=4;case 4:return i++,[3,2];case 5:return[4,this.renderNodeContent(e.element)];case 6:v.sent(),a=0,f=e.nonInlineLevel,v.label=7;case 7:return a<f.length?(g=f[a],[4,this.renderNode(g)]):[3,10];case 8:v.sent(),v.label=9;case 9:return a++,[3,7];case 10:o=0,s=e.nonPositionedFloats,v.label=11;case 11:return o<s.length?(g=s[o],[4,this.renderStack(g)]):[3,14];case 12:v.sent(),v.label=13;case 13:return o++,[3,11];case 14:l=0,u=e.nonPositionedInlineLevel,v.label=15;case 15:return l<u.length?(g=u[l],[4,this.renderStack(g)]):[3,18];case 16:v.sent(),v.label=17;case 17:return l++,[3,15];case 18:A=0,c=e.inlineLevel,v.label=19;case 19:return A<c.length?(g=c[A],[4,this.renderNode(g)]):[3,22];case 20:v.sent(),v.label=21;case 21:return A++,[3,19];case 22:h=0,p=e.zeroOrAutoZIndexOrTransformedOrOpacity,v.label=23;case 23:return h<p.length?(g=p[h],[4,this.renderStack(g)]):[3,26];case 24:v.sent(),v.label=25;case 25:return h++,[3,23];case 26:m=0,d=e.positiveZIndex,v.label=27;case 27:return m<d.length?(g=d[m],[4,this.renderStack(g)]):[3,30];case 28:v.sent(),v.label=29;case 29:return m++,[3,27];case 30:return[2]}})})},t.prototype.mask=function(e){this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,0),this.formatPath(e.slice(0).reverse()),this.ctx.closePath()},t.prototype.path=function(e){this.ctx.beginPath(),this.formatPath(e),this.ctx.closePath()},t.prototype.formatPath=function(e){var i=this;e.forEach(function(r,a){var f=Gi(r)?r.start:r;a===0?i.ctx.moveTo(f.x,f.y):i.ctx.lineTo(f.x,f.y),Gi(r)&&i.ctx.bezierCurveTo(r.startControl.x,r.startControl.y,r.endControl.x,r.endControl.y,r.end.x,r.end.y)})},t.prototype.renderRepeat=function(e,i,r,a){this.path(e),this.ctx.fillStyle=i,this.ctx.translate(r,a),this.ctx.fill(),this.ctx.translate(-r,-a)},t.prototype.resizeImage=function(e,i,r){var a;if(e.width===i&&e.height===r)return e;var f=(a=this.canvas.ownerDocument)!==null&&a!==void 0?a:document,o=f.createElement("canvas");o.width=Math.max(1,i),o.height=Math.max(1,r);var s=o.getContext("2d");return s.drawImage(e,0,0,e.width,e.height,0,0,i,r),o},t.prototype.renderBackgroundImage=function(e){return hi(this,void 0,void 0,function(){var i,r,a,f,o,s;return ri(this,function(l){switch(l.label){case 0:i=e.styles.backgroundImage.length-1,r=function(u){var A,c,h,M,K,tt,P,R,S,p,M,K,tt,P,R,m,d,g,v,w,_,y,C,b,S,B,M,z,G,P,R,W,K,tt,j,E,I,Q,D,k,U,T;return ri(this,function(V){switch(V.label){case 0:if(u.type!==0)return[3,5];A=void 0,c=u.url,V.label=1;case 1:return V.trys.push([1,3,,4]),[4,a.context.cache.match(c)];case 2:return A=V.sent(),[3,4];case 3:return V.sent(),a.context.logger.error("Error loading background-image "+c),[3,4];case 4:return A&&(h=Ou(e,i,[A.width,A.height,A.width/A.height]),M=h[0],K=h[1],tt=h[2],P=h[3],R=h[4],S=a.ctx.createPattern(a.resizeImage(A,P,R),"repeat"),a.renderRepeat(M,S,K,tt)),[3,6];case 5:bR(u)?(p=Ou(e,i,[null,null,null]),M=p[0],K=p[1],tt=p[2],P=p[3],R=p[4],m=wR(u.angle,P,R),d=m[0],g=m[1],v=m[2],w=m[3],_=m[4],y=document.createElement("canvas"),y.width=P,y.height=R,C=y.getContext("2d"),b=C.createLinearGradient(g,w,v,_),lv(u.stops,d).forEach(function(O){return b.addColorStop(O.stop,Ke(O.color))}),C.fillStyle=b,C.fillRect(0,0,P,R),P>0&&R>0&&(S=a.ctx.createPattern(y,"repeat"),a.renderRepeat(M,S,K,tt))):BR(u)&&(B=Ou(e,i,[null,null,null]),M=B[0],z=B[1],G=B[2],P=B[3],R=B[4],W=u.position.length===0?[Vd]:u.position,K=_e(W[0],P),tt=_e(W[W.length-1],R),j=_R(u,K,tt,P,R),E=j[0],I=j[1],E>0&&I>0&&(Q=a.ctx.createRadialGradient(z+K,G+tt,0,z+K,G+tt,E),lv(u.stops,E*2).forEach(function(O){return Q.addColorStop(O.stop,Ke(O.color))}),a.path(M),a.ctx.fillStyle=Q,E!==I?(D=e.bounds.left+.5*e.bounds.width,k=e.bounds.top+.5*e.bounds.height,U=I/E,T=1/U,a.ctx.save(),a.ctx.translate(D,k),a.ctx.transform(1,0,0,U,0,0),a.ctx.translate(-D,-k),a.ctx.fillRect(z,T*(G-k)+k,P,R*T),a.ctx.restore()):a.ctx.fill())),V.label=6;case 6:return i--,[2]}})},a=this,f=0,o=e.styles.backgroundImage.slice(0).reverse(),l.label=1;case 1:return f<o.length?(s=o[f],[5,r(s)]):[3,4];case 2:l.sent(),l.label=3;case 3:return f++,[3,1];case 4:return[2]}})})},t.prototype.renderSolidBorder=function(e,i,r){return hi(this,void 0,void 0,function(){return ri(this,function(a){return this.path(kv(r,i)),this.ctx.fillStyle=Ke(e),this.ctx.fill(),[2]})})},t.prototype.renderDoubleBorder=function(e,i,r,a){return hi(this,void 0,void 0,function(){var f,o;return ri(this,function(s){switch(s.label){case 0:return i<3?[4,this.renderSolidBorder(e,r,a)]:[3,2];case 1:return s.sent(),[2];case 2:return f=Mk(a,r),this.path(f),this.ctx.fillStyle=Ke(e),this.ctx.fill(),o=Tk(a,r),this.path(o),this.ctx.fill(),[2]}})})},t.prototype.renderNodeBackgroundAndBorders=function(e){return hi(this,void 0,void 0,function(){var i,r,a,f,o,s,l,u,A=this;return ri(this,function(c){switch(c.label){case 0:return this.applyEffects(e.getEffects(2)),i=e.container.styles,r=!vr(i.backgroundColor)||i.backgroundImage.length,a=[{style:i.borderTopStyle,color:i.borderTopColor,width:i.borderTopWidth},{style:i.borderRightStyle,color:i.borderRightColor,width:i.borderRightWidth},{style:i.borderBottomStyle,color:i.borderBottomColor,width:i.borderBottomWidth},{style:i.borderLeftStyle,color:i.borderLeftColor,width:i.borderLeftWidth}],f=kk(ia(i.backgroundClip,0),e.curves),r||i.boxShadow.length?(this.ctx.save(),this.path(f),this.ctx.clip(),vr(i.backgroundColor)||(this.ctx.fillStyle=Ke(i.backgroundColor),this.ctx.fill()),[4,this.renderBackgroundImage(e.container)]):[3,2];case 1:c.sent(),this.ctx.restore(),i.boxShadow.slice(0).reverse().forEach(function(h){A.ctx.save();var p=wc(e.curves),m=h.inset?0:Qk,d=Sk(p,-m+(h.inset?1:-1)*h.spread.number,(h.inset?1:-1)*h.spread.number,h.spread.number*(h.inset?-2:2),h.spread.number*(h.inset?-2:2));h.inset?(A.path(p),A.ctx.clip(),A.mask(d)):(A.mask(p),A.ctx.clip(),A.path(d)),A.ctx.shadowOffsetX=h.offsetX.number+m,A.ctx.shadowOffsetY=h.offsetY.number,A.ctx.shadowColor=Ke(h.color),A.ctx.shadowBlur=h.blur.number,A.ctx.fillStyle=h.inset?Ke(h.color):"rgba(0,0,0,1)",A.ctx.fill(),A.ctx.restore()}),c.label=2;case 2:o=0,s=0,l=a,c.label=3;case 3:return s<l.length?(u=l[s],u.style!==0&&!vr(u.color)&&u.width>0?u.style!==2?[3,5]:[4,this.renderDashedDottedBorder(u.color,u.width,o,e.curves,2)]:[3,11]):[3,13];case 4:return c.sent(),[3,11];case 5:return u.style!==3?[3,7]:[4,this.renderDashedDottedBorder(u.color,u.width,o,e.curves,3)];case 6:return c.sent(),[3,11];case 7:return u.style!==4?[3,9]:[4,this.renderDoubleBorder(u.color,u.width,o,e.curves)];case 8:return c.sent(),[3,11];case 9:return[4,this.renderSolidBorder(u.color,o,e.curves)];case 10:c.sent(),c.label=11;case 11:o++,c.label=12;case 12:return s++,[3,3];case 13:return[2]}})})},t.prototype.renderDashedDottedBorder=function(e,i,r,a,f){return hi(this,void 0,void 0,function(){var o,s,l,u,A,c,h,p,m,d,g,v,w,_,y,C,y,C;return ri(this,function(b){return this.ctx.save(),o=Fk(a,r),s=kv(a,r),f===2&&(this.path(s),this.ctx.clip()),Gi(s[0])?(l=s[0].start.x,u=s[0].start.y):(l=s[0].x,u=s[0].y),Gi(s[1])?(A=s[1].end.x,c=s[1].end.y):(A=s[1].x,c=s[1].y),r===0||r===2?h=Math.abs(l-A):h=Math.abs(u-c),this.ctx.beginPath(),f===3?this.formatPath(o):this.formatPath(s.slice(0,2)),p=i<3?i*3:i*2,m=i<3?i*2:i,f===3&&(p=i,m=i),d=!0,h<=p*2?d=!1:h<=p*2+m?(g=h/(2*p+m),p*=g,m*=g):(v=Math.floor((h+m)/(p+m)),w=(h-v*p)/(v-1),_=(h-(v+1)*p)/v,m=_<=0||Math.abs(m-w)<Math.abs(m-_)?w:_),d&&(f===3?this.ctx.setLineDash([0,p+m]):this.ctx.setLineDash([p,m])),f===3?(this.ctx.lineCap="round",this.ctx.lineWidth=i):this.ctx.lineWidth=i*2+1.1,this.ctx.strokeStyle=Ke(e),this.ctx.stroke(),this.ctx.setLineDash([]),f===2&&(Gi(s[0])&&(y=s[3],C=s[0],this.ctx.beginPath(),this.formatPath([new Et(y.end.x,y.end.y),new Et(C.start.x,C.start.y)]),this.ctx.stroke()),Gi(s[1])&&(y=s[1],C=s[2],this.ctx.beginPath(),this.formatPath([new Et(y.end.x,y.end.y),new Et(C.start.x,C.start.y)]),this.ctx.stroke())),this.ctx.restore(),[2]})})},t.prototype.render=function(e){return hi(this,void 0,void 0,function(){var i;return ri(this,function(r){switch(r.label){case 0:return this.options.backgroundColor&&(this.ctx.fillStyle=Ke(this.options.backgroundColor),this.ctx.fillRect(this.options.x,this.options.y,this.options.width,this.options.height)),i=Ek(e),[4,this.renderStack(i)];case 1:return r.sent(),this.applyEffects([]),[2,this.canvas]}})})},t}(_y),Hk=function(n){return n instanceof ny||n instanceof iy?!0:n instanceof Kd&&n.type!==gc&&n.type!==pc},kk=function(n,t){switch(n){case 0:return wc(t);case 2:return yk(t);case 1:default:return _c(t)}},Nk=function(n){switch(n){case 1:return"center";case 2:return"right";case 0:default:return"left"}},Vk=["-apple-system","system-ui"],zk=function(n){return/iPhone OS 15_(0|1)/.test(window.navigator.userAgent)?n.filter(function(t){return Vk.indexOf(t)===-1}):n},Gk=function(n){cn(t,n);function t(e,i){var r=n.call(this,e,i)||this;return r.canvas=i.canvas?i.canvas:document.createElement("canvas"),r.ctx=r.canvas.getContext("2d"),r.options=i,r.canvas.width=Math.floor(i.width*i.scale),r.canvas.height=Math.floor(i.height*i.scale),r.canvas.style.width=i.width+"px",r.canvas.style.height=i.height+"px",r.ctx.scale(r.options.scale,r.options.scale),r.ctx.translate(-i.x,-i.y),r.context.logger.debug("EXPERIMENTAL ForeignObject renderer initialized ("+i.width+"x"+i.height+" at "+i.x+","+i.y+") with scale "+i.scale),r}return t.prototype.render=function(e){return hi(this,void 0,void 0,function(){var i,r;return ri(this,function(a){switch(a.label){case 0:return i=Rf(this.options.width*this.options.scale,this.options.height*this.options.scale,this.options.scale,this.options.scale,e),[4,Wk(i)];case 1:return r=a.sent(),this.options.backgroundColor&&(this.ctx.fillStyle=Ke(this.options.backgroundColor),this.ctx.fillRect(0,0,this.options.width*this.options.scale,this.options.height*this.options.scale)),this.ctx.drawImage(r,-this.options.x*this.options.scale,-this.options.y*this.options.scale),[2,this.canvas]}})})},t}(_y),Wk=function(n){return new Promise(function(t,e){var i=new Image;i.onload=function(){t(i)},i.onerror=e,i.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(n))})},Kk=function(){function n(t){var e=t.id,i=t.enabled;this.id=e,this.enabled=i,this.start=Date.now()}return n.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.enabled&&(typeof window<"u"&&window.console&&typeof console.debug=="function"?console.debug.apply(console,gl([this.id,this.getTime()+"ms"],t)):this.info.apply(this,t))},n.prototype.getTime=function(){return Date.now()-this.start},n.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.enabled&&typeof window<"u"&&window.console&&typeof console.info=="function"&&console.info.apply(console,gl([this.id,this.getTime()+"ms"],t))},n.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.enabled&&(typeof window<"u"&&window.console&&typeof console.warn=="function"?console.warn.apply(console,gl([this.id,this.getTime()+"ms"],t)):this.info.apply(this,t))},n.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.enabled&&(typeof window<"u"&&window.console&&typeof console.error=="function"?console.error.apply(console,gl([this.id,this.getTime()+"ms"],t)):this.info.apply(this,t))},n.instances={},n}(),Xk=function(){function n(t,e){var i;this.windowBounds=e,this.instanceName="#"+n.instanceCount++,this.logger=new Kk({id:this.instanceName,enabled:t.logging}),this.cache=(i=t.cache)!==null&&i!==void 0?i:new fk(this,t)}return n.instanceCount=1,n}(),jk=function(n,t){return t===void 0&&(t={}),Yk(n,t)};typeof window<"u"&&dy.setContext(window);var Yk=function(n,t){return hi(void 0,void 0,void 0,function(){var e,i,r,a,f,o,s,l,u,A,c,h,p,m,d,g,v,w,_,y,b,C,b,S,B,M,z,G,P,R,W,K,tt,j,E,I,Q,D,k,U;return ri(this,function(T){switch(T.label){case 0:if(!n||typeof n!="object")return[2,Promise.reject("Invalid element provided as first argument")];if(e=n.ownerDocument,!e)throw new Error("Element is not attached to a Document");if(i=e.defaultView,!i)throw new Error("Document is not attached to a Window");return r={allowTaint:(S=t.allowTaint)!==null&&S!==void 0?S:!1,imageTimeout:(B=t.imageTimeout)!==null&&B!==void 0?B:15e3,proxy:t.proxy,useCORS:(M=t.useCORS)!==null&&M!==void 0?M:!1},a=Cf({logging:(z=t.logging)!==null&&z!==void 0?z:!0,cache:t.cache},r),f={windowWidth:(G=t.windowWidth)!==null&&G!==void 0?G:i.innerWidth,windowHeight:(P=t.windowHeight)!==null&&P!==void 0?P:i.innerHeight,scrollX:(R=t.scrollX)!==null&&R!==void 0?R:i.pageXOffset,scrollY:(W=t.scrollY)!==null&&W!==void 0?W:i.pageYOffset},o=new Xn(f.scrollX,f.scrollY,f.windowWidth,f.windowHeight),s=new Xk(a,o),l=(K=t.foreignObjectRendering)!==null&&K!==void 0?K:!1,u={allowTaint:(tt=t.allowTaint)!==null&&tt!==void 0?tt:!1,onclone:t.onclone,ignoreElements:t.ignoreElements,inlineImages:l,copyStyles:l},s.logger.debug("Starting document clone with size "+o.width+"x"+o.height+" scrolled to "+-o.left+","+-o.top),A=new Qv(s,n,u),c=A.clonedReferenceElement,c?[4,A.toIFrame(e,o)]:[2,Promise.reject("Unable to find element in cloned iframe")];case 1:return h=T.sent(),p=Xd(c)||q3(c)?SO(c.ownerDocument):Kc(s,c),m=p.width,d=p.height,g=p.left,v=p.top,w=qk(s,c,t.backgroundColor),_={canvas:t.canvas,backgroundColor:w,scale:(E=(j=t.scale)!==null&&j!==void 0?j:i.devicePixelRatio)!==null&&E!==void 0?E:1,x:((I=t.x)!==null&&I!==void 0?I:0)+g,y:((Q=t.y)!==null&&Q!==void 0?Q:0)+v,width:(D=t.width)!==null&&D!==void 0?D:Math.ceil(m),height:(k=t.height)!==null&&k!==void 0?k:Math.ceil(d)},l?(s.logger.debug("Document cloned, using foreign object rendering"),b=new Gk(s,_),[4,b.render(c)]):[3,3];case 2:return y=T.sent(),[3,5];case 3:return s.logger.debug("Document cloned, element located at "+g+","+v+" with size "+m+"x"+d+" using computed rendering"),s.logger.debug("Starting DOM parsing"),C=ay(s,c),w===C.styles.backgroundColor&&(C.styles.backgroundColor=zn.TRANSPARENT),s.logger.debug("Starting renderer for element at "+_.x+","+_.y+" with size "+_.width+"x"+_.height),b=new Rk(s,_),[4,b.render(C)];case 4:y=T.sent(),T.label=5;case 5:return(!((U=t.removeContainer)!==null&&U!==void 0)||U)&&(Qv.destroy(h)||s.logger.error("Cannot detach cloned iframe as it is not in the DOM anymore")),s.logger.debug("Finished rendering"),[2,y]}})})},qk=function(n,t,e){var i=t.ownerDocument,r=i.documentElement?Qo(n,getComputedStyle(i.documentElement).backgroundColor):zn.TRANSPARENT,a=i.body?Qo(n,getComputedStyle(i.body).backgroundColor):zn.TRANSPARENT,f=typeof e=="string"?Qo(n,e):e===null?zn.TRANSPARENT:4294967295;return t===i.documentElement?vr(r)?vr(a)?f:a:r:f};class yy{constructor(){x(this,"modal");x(this,"dom");x(this,"titleElement");this.modal=this.createModal()}createModal(){var a,f,o,s;const e=`
        <div class="modal fade" id="staticBackdrop" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
              <div class="modal-content" style="transform: scale(0.8);">
                <div class="modal-header">
                 <h1 id="title" class="modal-title fs-5" id="staticBackdropLabel"></h1>
                 <button id='close' type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                ${this.SetContent()}
                </div>
                <div class="modal-footer">
                  <button type="button" id="modal-confirm" class="btn btn-primary"></button>
                  <button id='cancel' type="button" class="btn btn-secondary" data-bs-dismiss="modal"></button>
                </div>
              </div>
            </div>
        </div>`,i=this.htmlToElement(e);(a=document.getElementById("viewerdom"))==null||a.appendChild(i);const r=new os(i,{backdrop:"static",keyboard:!0});return this.titleElement=i.querySelector("#title"),(f=i.querySelector("#modal-confirm"))==null||f.addEventListener("click",this.onConfirm.bind(this)),i.addEventListener("hidden.bs.modal",this.onHide.bind(this)),(o=i.querySelector("#close"))==null||o.addEventListener("click",this.onCancel.bind(this)),(s=i.querySelector("#cancel"))==null||s.addEventListener("click",this.onCancel.bind(this)),this.dom=i,r}htmlToElement(t){var e=document.createElement("template");return t=t.trim(),e.innerHTML=t,e.content.firstChild}SetContent(){return""}onConfirm(){}onCancel(){this.modal.hide()}onHide(){}}class $k extends yy{constructor(){super();x(this,"formLabelElement");x(this,"modalInput");x(this,"resolve");x(this,"reject");this.formLabelElement=this.dom.querySelector("#form-label"),this.modalInput=this.dom.querySelector("#message-text"),console.log(this.modalInput)}SetContent(){return`<label id="form-label" for="message-text" class="col-form-label"></label>
    <textarea class="form-control" id="message-text" style="height:100px"></textarea>`}onConfirm(){this.resolve(this.modalInput.value),this.modal.hide(),super.onConfirm()}onHide(){this.modalInput.value="",super.onHide()}onCancel(){this.reject(),super.onCancel()}async show(e,i){return this.titleElement.innerText=e,this.formLabelElement.innerHTML=i,this.modal.show(),new Promise((r,a)=>{this.resolve=r,this.reject=a})}}class Jk extends yy{constructor(){super();x(this,"bodyTextElement");x(this,"resolve");x(this,"reject");this.bodyTextElement=this.dom.querySelector("#body-text")}SetContent(){return'<div id="body-text"></div>'}onConfirm(){this.resolve(),this.modal.hide(),super.onConfirm()}onCancel(){this.reject(),super.onCancel()}async show(e,i){return this.titleElement.innerText=e,this.bodyTextElement.innerText=i,this.modal.show(),new Promise((r,a)=>{this.resolve=r,this.reject=a})}}let Qu=null,Ru=null;function Zk(n,t){return Qu||(Qu=new $k),Qu.show(n,t)}function Hl(n,t){return Ru||(Ru=new Jk),Ru.show(n,t)}class tN{constructor(){x(this,"loadingText");x(this,"dom");x(this,"parent");this.dom=this.createModal()}createModal(){const t=`
        <div class="spinner-border" role="status">
        </div>
        <div id="loading-text">loading</div>
        `,e=document.createElement("div");return e.setAttribute("data-html2canvas-ignore","true"),e.innerHTML=t,e.style.display="none",e.style.zIndex="999",e.style.position="absolute",e.style.inset="0",e.style.background="#ffffffc9",e.className="flex-column justify-content-center align-items-center",this.loadingText=e.querySelector("#loading-text"),e}show(t,e){this.dom.style.display="flex",this.loadingText.innerText=t??"loading",this.parent=e??document.body,this.parent.appendChild(this.dom),console.log("append")}hide(){var t;(t=this.parent)==null||t.removeChild(this.dom),this.dom.style.display="none"}}let kl;async function xc(n,t,e){kl||(kl=new tN),n?kl.show(t,e):kl.hide()}class eN{constructor(t){x(this,"SavedViewAddedEvent");x(this,"SavedViewUpdatedEvent");x(this,"SavedViewDeletedEvent");x(this,"CurrentSavedViewChangedEvent");x(this,"viewer");x(this,"_currentSavedView");x(this,"store");this.SavedViewAddedEvent=new Ot,this.SavedViewUpdatedEvent=new Ot,this.SavedViewDeletedEvent=new Ot,this.CurrentSavedViewChangedEvent=new Ot,this.viewer=t}get currentSavedView(){return this._currentSavedView}set currentSavedView(t){t&&this.load(t.data),this._currentSavedView=t,this.CurrentSavedViewChangedEvent.dispatch(t)}async getCurrent(){const t=new BO;return t.anno=this.viewer.annoMode.toObject(),t.label2d=this.viewer.label2DMode.toObject(),t.measure=this.viewer.measureMode.toObject(),t.coords=this.viewer.coordsMode.toObject(),t.scene=Qd(this.viewer.mainViewport),t}async _saveAsNew(){let t=await Zk("","");await xc(!0,"",this.viewer.dom);try{let e=new m_;t||(t=""),e.name=t;let i=await this.getCurrent();e.data=i,console.log("start"),e.thumbnail=await this.genThumb(),console.log("end"),this.store.add(e),this.SavedViewAddedEvent.dispatch(e),this.currentSavedView=e}catch(e){await Hl("",e)}finally{xc(!1)}}async _saveAsUpdate(t){try{let e=await this.getCurrent();t.data=e,t.thumbnail=await this.genThumb(),this.store.update(t),this.SavedViewUpdatedEvent.dispatch(t),this.currentSavedView=t}catch(e){await Hl("",e)}}async save(){this.currentSavedView?await this._saveAsUpdate(this.currentSavedView):await this._saveAsNew()}async saveAs(){await this._saveAsNew()}async delete(t){await Hl("","?");try{this.store.delete(t),t==this.currentSavedView&&(this.currentSavedView=null),this.SavedViewDeletedEvent.dispatch(t)}catch(e){await Hl("",e)}}load(t){const e=this.viewer;let i=()=>{e.annoMode.lastObj=null,e.coordsMode.fromObject(t.coords),e.label2DMode.fromObject(t.label2d),e.measureMode.fromObject(t.measure),t.anno&&t.anno.canvasJson&&t.anno.canvasJson.objects.length>0&&(e.mode=e.annoMode,e.annoMode.fromObject(t.anno),e.annoMode.tool.edit=!1)};Rd(e.mainViewport,t.scene),e.mode=null,i()}async genThumb(){console.log(this.viewer.canvasContainer);const t=await jk(this.viewer.canvasContainer,{backgroundColor:null}),e=300;let i=this.viewer.canvasContainer.clientHeight,r=this.viewer.canvasContainer.clientWidth;const a=i/r;return a>1?(r=e,i=r*a):(i=e,r=i/a),this.resample_single(t,r,i,!0),t.toDataURL()}resample_single(t,e,i,r){var a=t.width,f=t.height;e=Math.round(e),i=Math.round(i);for(var o=a/e,s=f/i,l=Math.ceil(o/2),u=Math.ceil(s/2),A=t.getContext("2d"),c=A.getImageData(0,0,a,f),h=A.createImageData(e,i),p=c.data,m=h.data,d=0;d<i;d++)for(var g=0;g<e;g++){for(var v=(g+d*e)*4,w=0,_=0,y=0,C=0,b=0,S=0,B=0,M=(d+.5)*s,z=Math.floor(d*s),G=Math.ceil((d+1)*s),P=z;P<G;P++)for(var R=Math.abs(M-(P+.5))/u,W=(g+.5)*o,K=R*R,tt=Math.floor(g*o),j=Math.ceil((g+1)*o),E=tt;E<j;E++){var I=Math.abs(W-(E+.5))/l,Q=Math.sqrt(K+I*I);if(!(Q>=1)){w=2*Q*Q*Q-3*Q*Q+1;var D=4*(E+P*a);B+=w*p[D+3],y+=w,p[D+3]<255&&(w=w*p[D+3]/250),C+=w*p[D],b+=w*p[D+1],S+=w*p[D+2],_+=w}}m[v]=C/_,m[v+1]=b/_,m[v+2]=S/_,m[v+3]=B/y}r===!0?(t.width=e,t.height=i):A.clearRect(0,0,a,f),A.putImageData(h,0,0)}}class iN{getAll(){throw"not implemented"}add(t){}update(t){}delete(t){}}class nN extends iN{constructor(){super(...arguments);x(this,"svs",[])}getAll(){return this.svs}add(e){e.ts=new Date().toLocaleString(),e.version="A1.1",e.owner="",this.svs.push(e)}delete(e){let i=this.svs.indexOf(e);i!=-1&&this.svs.splice(i,1)}update(e){}}class rN extends Wc{constructor(e){super(e);x(this,"tool");this.key="coords"}enable(){this.enabled||(super.enable(),this.tool=this.viewer.editorToolFactory.getCoord2DTool(this.viewer.mainViewport))}disable(){this.enabled&&(super.disable(),this.tool.endDraw())}toObject(){this.tool||(this.tool=this.viewer.editorToolFactory.getCoord2DTool(this.viewer.mainViewport));const e=this.tool.items.map(i=>{const r=i.refPoint;return{x:r.x,y:r.y,z:r.z}});return this.tool.endDraw(),e}fromObject(e){if(this.tool||(this.tool=this.viewer.editorToolFactory.getCoord2DTool(this.viewer.mainViewport)),this.clear(),e)try{for(let i of e)this.tool.createItem(new H(i.x,i.y,i.z))}catch(i){console.error("coords mode, from obj fail",i)}}clear(){this.tool.clear()}}function sN(n,t){let e=n.indexOf(t);e!=-1&&n.splice(e,1)}function aN(n,t){let e=null,i=a=>{a.preventDefault();const f=a.clientX-e;t.onSplit(f)},r=a=>{n.removeEventListener("pointermove",i),n.removeEventListener("pointerup",r),n.releasePointerCapture(a.pointerId),e=null};n.addEventListener("pointerdown",a=>{a.preventDefault(),n.addEventListener("pointermove",i),n.addEventListener("pointerup",r),n.setPointerCapture(a.pointerId),e=a.clientX,t.onSplitStart()})}function oN(n,t,e){let i=null;aN(n,{onSplitStart:()=>{i=pP(t)},onSplit:r=>{e(i,r)}})}class AN{constructor(){x(this,"title");x(this,"key");x(this,"icon")}}class Nl extends mn{constructor(e){e||(e=new AN);super();x(this,"config");x(this,"btn");x(this,"titleArea");x(this,"contentArea");x(this,"panelGroup",null);x(this,"_active",!1);this.config=e,this.titleArea=new mn,this.titleArea.class="tv-p-title",this.titleArea.text=e.title,this.titleArea.style.top="0",this.titleArea.style.left="0",this.titleArea.style.right="0",this.titleArea.style.height="40px",this.titleArea.style.lineHeight="40px",this.titleArea.style.paddingLeft="10px",this.contentArea=new mn,this.contentArea.class="tv-p-content",this.contentArea.style.top="40px",this.contentArea.style.left="0",this.contentArea.style.right="0",this.contentArea.style.bottom="0px",this.contentArea.style.overflow="auto",this.add(this.titleArea),this.add(this.contentArea);let i=new ge;i.title=e.title,i.key=e.key,i.icon=e.icon,i.onclick=()=>{this.panelGroup&&(this.panelGroup.currentPanel==this?this.panelGroup.currentPanel=null:this.panelGroup.currentPanel=this)};let r=a=>{console.log("drag start"),Wf=this};this.btn=new lN(i),this.btn.dom.addEventListener("dragstart",r),this.btn.dragStart=r}get key(){return this.config.key}get active(){return this._active}set active(e){e?this.show():this.hide(),this.visible=e,this.btn.active=e,this._active=e}}class lN extends ue{constructor(t){super(t),this.dom.draggable=!0,this.addClass("tv-panel-tab-btn"),this.img.setAttribute("alt","")}}class cN{constructor(){x(this,"orientation","left");x(this,"id")}}let Wf;class Vv extends mn{constructor(e){super();x(this,"panels",[]);x(this,"tabArea");x(this,"contentArea");x(this,"collapseSize",40);x(this,"tabbarSize",40);x(this,"movebarSize",10);x(this,"movebarArea");x(this,"config");x(this,"panelChangedEvent",new Ot);x(this,"activeChangedEvent",new Ot);x(this,"_dragEnterClassName","");x(this,"_inactiveClassName","");x(this,"_currentPanel");x(this,"_minExpandSize",300);x(this,"_lastExpandSize",300);x(this,"minWidth",100);e||(e=new cN),this.config=e,this.isVertical&&(this._dragEnterClassName="tv-vpg-dragenter",this._inactiveClassName="tv-vpg-inactive"),e.id&&(this.id=e.id),this.style.overflow="hidden",this.addClass("tv-pg"),this.addClass(this._inactiveClassName);let i=new mn;i.addClass("tv-pg-tab"),this.isLeft?i.addClass("tv-lpg-tab"):this.isRight&&i.addClass("tv-rpg-tab"),i.style.zIndex="2";let r=new mn;r.addClass("tv-pg-content");let a=new mn;a.addClass("tv-pg-movebar"),a.style.display="flex";let f=new mn;f.class="tv-pg-movebar-symbol",this.isVertical&&(a.style.flexDirection="column",a.style.justifyContent="center",a.style.alignItems="center",a.style.touchAction="none"),a.add(f),this.add(i),this.add(r),this.add(a),this.tabArea=i,this.contentArea=r,this.movebarArea=a,this.setOrientation(e.orientation),this.currentPanel=null,oN(this.movebarArea.dom,this.dom,this.onSplitChanged.bind(this)),this.tabArea.dom.addEventListener("dragenter",this.dragEnter.bind(this)),this.tabArea.dom.addEventListener("dragleave",this.dragLeave.bind(this)),this.tabArea.dom.addEventListener("dragover",o=>{o.preventDefault()}),this.tabArea.dom.addEventListener("drop",this.drop.bind(this))}dragEnter(e){super.dragEnter(e),this.addClass(this._dragEnterClassName)}dragLeave(e){super.dragEnter(e),this.removeClass(this._dragEnterClassName)}drop(e){e.preventDefault(),Wf&&this.addPanel(Wf)}get isLeft(){return this.config.orientation=="left"}get isRight(){return this.config.orientation=="right"}get isVertical(){return this.config.orientation=="left"||this.config.orientation=="right"}setOrientation(e){let i=this.tabArea,r=this.contentArea,a=this.movebarArea;this.isLeft?(i.style.left="0",i.style.top="0",i.style.bottom="0",i.style.width=this.tabbarSize+"px",r.style.left=this.tabbarSize+"px",r.style.top="0",r.style.bottom="0",r.style.right=this.movebarSize+"px",a.style.right="0",a.style.top="0",a.style.bottom="0",a.style.width=this.movebarSize+"px",this.style.minWidth=this.tabbarSize+"px",this.style.top="0",this.style.bottom="0",this.style.left="0",this.style.width=this.tabbarSize+"px"):this.isRight&&(i.style.right="0",i.style.top="0",i.style.bottom="0",i.style.width=this.tabbarSize+"px",r.style.right=this.tabbarSize+"px",r.style.top="0",r.style.bottom="0",r.style.left=this.movebarSize+"px",a.style.left="0",a.style.top="0",a.style.bottom="0",a.style.width=this.movebarSize+"px",this.style.minWidth=this.tabbarSize+"px",this.style.top="0",this.style.bottom="0",this.style.right="0",this.style.width=this.tabbarSize+"px")}addPanel(e){e.panelGroup&&e.panelGroup.removePanel(e),this.currentPanel=e,this.contentArea.add(e),e.absFillParent(),e.panelGroup=this,this.tabArea.add(e.btn),this.panels.push(e),this.removeClass(this._inactiveClassName),this.panelChangedEvent.dispatch(this)}removePanel(e){this.currentPanel==e&&(this.currentPanel=null),sN(this.panels,e),e.btn.removeFromParent(),e.removeFromParent(),e.panelGroup=null,this.panels.length==0&&this.addClass(this._inactiveClassName),this.panelChangedEvent.dispatch(this)}get currentPanel(){return this._currentPanel}set currentPanel(e){this._currentPanel&&(this._currentPanel.active=!1),e?(e.active=!0,this._expand()):this._collapse(),this._currentPanel=e,this.activeChangedEvent.dispatch(e)}_collapse(){let e=this.config.orientation;if(e=="left"||e=="right"){let i=this.dom.offsetWidth;i<this._minExpandSize&&(i=this._minExpandSize),this._lastExpandSize=i,this.style.width=this.collapseSize+"px"}this.movebarArea.hide()}_expand(){let e=this.config.orientation;(e=="left"||e=="right")&&(this.style.width=this._lastExpandSize+"px"),this.movebarArea.show()}expand(){this.currentPanel||this.panels.length>0&&(this.currentPanel=this.panels[0]),this.currentPanel&&this._expand()}collapse(){this.currentPanel=null}setWidth(e){e<this.minWidth&&(e=this.minWidth),this._lastExpandSize=e,this.style.width=e+"px"}onSplitChanged(e,i){if(this.isVertical){let r=e+i*(this.isLeft?1:-1);this.setWidth(r)}}}class hN extends Me{constructor(e){super();x(this,"viewer");x(this,"tree");x(this,"enable");x(this,"leafNodeType",["EQUI","PSPOOL"]);this.fill(),this.viewer=e,this.tree=null,this.enable=!0}initTree(e){let i=this;const r="./images/asm.svg",a="./images/hpart.svg";this.tree=$(this.dom).jstree({core:{themes:{dots:!1,stripes:!0},data:e,dblclick_toggle:!1},plugins:["checkbox","types"],checkbox:{tie_selection:!1,whole_node:!1},types:{ASBLOCK:{icon:r},ASMBLY:{icon:r},FPLANU:{icon:r},MPLANU:{icon:r},MBLOCK:{icon:r},MMBLOCK:{icon:r},default:{icon:a}}}).bind().on("ready.jstree",(f,o)=>{const s=o.instance.get_json();i.defaultExpandAtLevel(s,1)})}checkNode(e){this.tree&&this.tree.jstree(!0).check_node(e)}uncheckNode(e){this.tree&&this.tree.jstree(!0).uncheck_node(e)}selectNode(e){if(!this.tree)return;if(!e){this.tree.jstree(!0).deselect_all(!0);return}this.tree.jstree(!0).deselect_all(!0),this.tree.jstree("select_node",e,!0),this.tree.jstree(!0).get_node(e,!0).children(".jstree-anchor").focus()}toggleTree(){this.enable=!this.enable,this.enable?$(this.dom).show():$(this.dom).hide()}modelSelected(e){console.log(e)}defaultExpandAtLevel(e,i){let r=this;if(!e.length||e.length==0||i<0)return;function a(f,o){if(f.length==0)return;const s=f[0];r.tree.jstree(!0).open_node(s),o!=i&&a(s.children,o+1)}a(e,0)}getIcon(e){let i=asm;return e||(i=asm),e=="ASMBLY"||e=="FPLANU"||e=="MPLANU"||e=="MBLOCK"||e=="MMBLOCK"||e=="ASBLOCK"?i=asm:i=part,{icon:i}}treeEvents(){let e=this.viewer,i=this;e.mainViewport.objectVisibilityChangedEvent.add(r=>{r.visible?i.tree.jstree(!0).check_node(r.uuid):i.tree.jstree(!0).uncheck_node(r.uuid)}),e.mainViewport.selectionChangedEvent.add(r=>{}),$(this.dom).on("select_node.jstree",function(r,a){const f=a.node.id;if(!f)return;let o=e.mainViewport.rootGroup.getObjectByProperty("uuid",f);o&&e.mainViewport.selectModels(o)}),$(this.dom).on("dblclick.jstree",function(r,a){e.mainViewport.zoomToSelection()}),$(this.dom).on("check_node.jstree uncheck_node.jstree",function(r,a){const f=e.mainViewport.getObjectByUUID(a.node.id);e.mainViewport.ensureObjectVisible(f,a.node.state.checked),e.mainViewport.render()})}loadObject3d(e){let i=this;function r(f){let o;f.userData.type&&f.userData.alias?o=`${f.userData.type} ${f.userData.alias}`:f.userData.type?o=`${f.userData.type} ${f.name}`:o=f.name;const s={id:f.uuid,text:o,state:{checked:!0},type:f.userData.type??"",children:null};if(!i.leafNodeType.includes(s.type)){if(f.children&&f.children.length>0){s.children=[];for(const l of f.children){if(l.name.startsWith("mesh"))continue;const u=r(l);s.children.push(u)}}}return s}let a=r(e);this.initTree(a)}}class xy extends Me{constructor(e,i){super();x(this,"thumbnail");x(this,"editBtn");x(this,"deleteBtn");x(this,"nameLabel");x(this,"ownerLabel");x(this,"tsLabel");x(this,"verLabel");x(this,"viewer");x(this,"onSVDelete",e=>{var i;e==this.sv&&((i=this.viewer)==null||i.savedViewManager.SavedViewDeletedEvent.remove(this.onSVDelete))});x(this,"onclick",()=>{var e;(e=this.clickAction)==null||e.call(this)});x(this,"clickAction",()=>{this.viewer.savedViewManager.currentSavedView=this.sv});x(this,"_sv");x(this,"onDelete",e=>{this.viewer.savedViewManager.delete(this.sv)});this.addClass("svi"),this.thumbnail=new Sn("img"),this.thumbnail.dom.className="svi-img",this.add(this.thumbnail);let r=new Me;r.class="svi-info-bg",this.add(r);let a=new Me;a.addClass("svi-info-last"),r.add(a),this.nameLabel=new pl,this.nameLabel.addClass("svi-info"),this.nameLabel.addClass("svi-info-name"),a.add(this.nameLabel),this.deleteBtn=new TP(this.onDelete,g_),this.deleteBtn.addClass("svi-del-btn"),this.deleteBtn.text="delete",a.add(this.deleteBtn);let f=new Me;f.addClass("svi-info-last"),r.add(f),this.tsLabel=new pl,this.tsLabel.addClass("svi-info"),f.add(this.tsLabel),this.ownerLabel=new pl,this.ownerLabel.addClass("svi-info"),f.add(this.ownerLabel),this.verLabel=new pl,this.verLabel.addClass("svi-info"),f.add(this.verLabel),e&&(this.sv=e),i&&(this.viewer=i),this.dom.addEventListener("click",this.onclick),i==null||i.savedViewManager.SavedViewDeletedEvent.add(this.onSVDelete)}get active(){return this.dom.classList.contains("svi-selected")}set active(e){e?this.addClass("svi-selected"):this.dom.classList.remove("svi-selected")}get sv(){return this._sv}set sv(e){this._sv=e,this.thumbnail.src=e.thumbnail,this.nameLabel.text=e.name,this.tsLabel.text=e.ts,this.verLabel.text=e.version,this.ownerLabel.text=e.owner}handleResize(){this.dom;let e=this.dom.scrollWidth;this.dom.style.height=e/16*9+"px"}}class uN extends xy{constructor(e){super(null,e);x(this,"__changeEnd",async()=>{let e=new m_;e.name="";let i=await this.viewer.savedViewManager.getCurrent();e.data=i,e.thumbnail=await this.viewer.savedViewManager.genThumb(),this.sv=e,this.viewer.mainViewport.changeEndEvent.remove(this.__changeEnd)});x(this,"clickAction",()=>{this.viewer.savedViewManager.currentSavedView=null,this.viewer.savedViewManager.load(this.sv.data),this.active=!0});this.deleteBtn.hide(),this.ownerLabel.hide(),this.tsLabel.hide(),this.verLabel.hide(),e.mainViewport.afterModelsAddEvent.add(()=>{e.mainViewport.changeEndEvent.add(this.__changeEnd)}),e.savedViewManager.CurrentSavedViewChangedEvent.add(i=>{i&&(this.active=!1)})}}class fN extends mn{constructor(e){super();x(this,"savedViewItems",[]);x(this,"viewer");x(this,"onUpdate",e=>{for(let i of this.savedViewItems)i.sv==e&&(i.sv=e)});x(this,"onCurrentChanged",e=>{for(let i of this.savedViewItems)i.sv==e?i.active=!0:i.active=!1});x(this,"onDelete",e=>{let i=this.savedViewItems.find(r=>r.sv==e);i&&(i.addClass("svi-hidden"),setTimeout(()=>{this.dom.removeChild(i.dom)},1e3))});this.absFillParent(),this.viewer=e;let i=e.savedViewManager.store.getAll(),r=new uN(e);super.add(r);for(let a of i)this.add(a);e.savedViewManager.SavedViewAddedEvent.add(a=>{this.add(a)}),e.savedViewManager.SavedViewDeletedEvent.add(this.onDelete),e.savedViewManager.CurrentSavedViewChangedEvent.add(this.onCurrentChanged),e.savedViewManager.SavedViewUpdatedEvent.add(this.onUpdate)}add(e){for(let r of this.savedViewItems)r.active=!1;let i=new xy(e,this.viewer);this.dom.appendChild(i.dom),this.savedViewItems.push(i),i.dom.scrollIntoView()}}class dN extends mn{constructor(t){super(),this.dom.classList.add("accordion","pmi-accordion"),this.absFillParent()}reset(){this.dom.innerHTML=""}createItem(t,e){const i=document.createElement("div");i.classList.add("accordion-item","pmi-accordion-item");const r=`<button class="accordion-button accordion-button-pmi" type="button" data-bs-toggle="collapse" data-bs-target="#${t}" aria-expanded="true" aria-controls="panelsStayOpen-collapseOne">
        ${t}</button>`;Gs(i,"accordion-header",r);const a=Gs(i,"");a.id=`${t}`,a.classList.add("accordion-collapse","collapse","show");const f=Gs(a,"pmi-item-flex");for(const o of e){const s=Gs(f,"");Gs(s,"pmi-item-flex-key",o.name),Gs(s,"pmi-item-flex-value",o.value)}return this.dom.appendChild(i),i}}const zv="bi-caret-right-fill",Kf="bi-gear-fill",Gv="bi-eye-fill",pN="bi-eye",gN="bi-eye-slash-fill";class mN{constructor(){x(this,"indent",13);x(this,"rowHeight",26);x(this,"showStripLine",!0);x(this,"showNodeLine",!0);x(this,"fontSize",12);x(this,"nodeExpandAnimation",!0);x(this,"zoom",1.5)}}const Cy=new mN;class by extends SP{constructor(){super(),this.addClass("bi"),this.style.cursor="pointer",this.style.textAlign="center",this.addClass("tv-treenode-btn"),this.addClass(Kf)}set enabled(t){}}class By extends Me{constructor(){super(),this.addClass("tv-treenode-title")}}const Uo="p",Xr="v",Jl="i";class Sy extends Sn{constructor(){super("i");x(this,"img");x(this,"option");x(this,"_status",Xr);this.addClass("bi"),this.style.textAlign="center",this.class="tv-treenode-action-btn",this.addClass(Gv)}get status(){return this._status}classForStatus(e){return e==Xr?Gv:e==Jl?gN:e==Uo?pN:""}set status(e){let i=this.classForStatus(this._status),r=this.classForStatus(e);this.dom.classList.replace(i,r),this._status=e}}class Wv extends Me{constructor(e,i=Cy){super();x(this,"dirty",!0);x(this,"children",[]);x(this,"nodeButton");x(this,"titleArea");x(this,"actionButton");x(this,"nodeArea");x(this,"expanded",!1);x(this,"_parentNode",null);x(this,"nodeLine");x(this,"data");x(this,"option");x(this,"_childrenArea");x(this,"nodeId");x(this,"nodeType");x(this,"nodeText");x(this,"indent",0);x(this,"_visibleStatus",Xr);x(this,"onNodeButtonPointerUp",e=>{e.stopPropagation(),this.expanded=!this.expanded});x(this,"onActionButtonPointerUp",e=>{e.stopPropagation(),this.setVisible(this.visibleStatus!=Xr)});x(this,"_maxChildrenHeight",-1);this.data=e,this.option=i,this.addClass("tv-treenode-whole"),this.style.display="flex",this.style.flexDirection="column",this.style.overflow="auto",this.style.height="auto",this.nodeArea=new Me,this.nodeArea.class="tv-treenode",this.nodeArea.style.width="100%",this.add(this.nodeArea),this.nodeButton=new by,this.titleArea=new By,this.actionButton=new Sy,this.nodeArea.add(this.nodeButton),this.nodeArea.add(this.titleArea),this.nodeArea.add(this.actionButton),this.nodeId=e.id,this.nodeText=e.text,this.nodeType=e.type,this.config()}get childrenArea(){if(!this._childrenArea){this._childrenArea=new Me,this._childrenArea.class="tv-treenode-children",this._childrenArea.style.overflow="hidden",this._childrenArea.style.height="auto",this._childrenArea.style.maxHeight="0",this._childrenArea.style.position="relative",this._childrenArea.hide(),this.nodeLine=new Me,this.nodeLine.class="tv-treenode-line",this._childrenArea.add(this.nodeLine);let e=this.option.indent;this.nodeLine.style.left=this.indent+e+"px",this.add(this._childrenArea)}return this._childrenArea}get parentNode(){return this._parentNode}set parentNode(e){if(!e)return;this._parentNode=e;let i=this.option.indent;this.indent=this._parentNode.indent+i,this.nodeArea.style.paddingLeft=this.indent+"px"}config(){this.titleArea.text=this.nodeText,this.configNodeButton()}configNodeButton(){this.data.children&&this.data.children.length>0?(this.nodeButton.removeClass(Kf),this.nodeButton.addClass(zv)):(this.nodeButton.removeClass(zv),this.nodeButton.addClass(Kf))}setVisible(e){e?this.visibleStatus=Xr:this.visibleStatus=Jl,this._updateParentVisibleStatus(),this._updateChildrenVisibleStatus()}setSelected(e){e?this.titleArea.addClass("tv-treenode-selected"):this.titleArea.removeClass("tv-treenode-selected")}get visibleStatus(){return this._visibleStatus}set visibleStatus(e){this.actionButton.status=e,this._visibleStatus=e}_updateParentVisibleStatus(){if(this.parentNode){let e=!0,i=!0,r=!1;for(let a of this.parentNode.children){let f=a.visibleStatus;if(f==Xr)i=!1;else if(f==Jl)e=!1;else if(f==Uo){r=!0;break}}r?this.parentNode.visibleStatus=Uo:e?this.parentNode.visibleStatus=Xr:i?this.parentNode.visibleStatus=Jl:this.parentNode.visibleStatus=Uo,this.parentNode._updateParentVisibleStatus()}}_updateChildrenVisibleStatus(){this.visibleStatus!=Uo&&this._setChildrenVisibleStatus(this.visibleStatus)}_setChildrenVisibleStatus(e){if(this.children)for(let i of this.children)i.visibleStatus=e,i._setChildrenVisibleStatus(e)}addNode(e){this.childrenArea.add(e),this.children.push(e),e.parentNode=this}get rowHeight(){return this.option.rowHeight}get maxChildrenHeight(){return this._maxChildrenHeight==-1&&(this._maxChildrenHeight=this.children.length*this.rowHeight),this._maxChildrenHeight}set maxChildrenHeight(e){this._maxChildrenHeight=e}addParentMaxChildrenHeight(e){this.parentNode&&(this.parentNode.maxChildrenHeight+=e,this.parentNode.childrenArea.style.maxHeight=this.parentNode.maxChildrenHeight+"px",this.parentNode.addParentMaxChildrenHeight(e))}}class vN extends Me{constructor(e=Cy){super();x(this,"children",[]);x(this,"nodeMap",new Map);x(this,"nodeSelectedEvent");x(this,"nodeVisibleChangedEvent");x(this,"option");x(this,"selectedNode",null);this.option=e;const i=getComputedStyle(document.documentElement);try{this.option.rowHeight=parseInt(i.getPropertyValue("--tree-row-height")),this.option.indent=parseInt(i.getPropertyValue("--tree-indent")),this.option.zoom=parseFloat(i.getPropertyValue("--tree-zoom"))}catch(r){console.error("load tree root css var fail",r)}this.addClass("tv-tree"),this.style.width="100%",this.style.zoom=e.zoom,this.nodeSelectedEvent=new Ot,this.nodeVisibleChangedEvent=new Ot,this.dom.onpointerup=r=>{var f,o,s;let a=r.target.__tinyUI;if(a instanceof Sy){let l=(f=a.owner)==null?void 0:f.owner;l&&(l.onActionButtonPointerUp(r),this.nodeVisibleChangedEvent.dispatch(l))}else if(a instanceof By){let l=(o=a.owner)==null?void 0:o.owner;l&&(this.selectNode(l),this.nodeSelectedEvent.dispatch(l))}else if(a instanceof by){let l=(s=a.owner)==null?void 0:s.owner;l&&(l.expanded?this.collapseNode(l):this.expandNode(l))}}}expandNode(e){if(!e.expanded){if(e.childrenArea.show(),e.dirty){if(e.children&&e.children.length>0)for(let i of e.children)e.childrenArea.add(i);e.dirty=!1}e.configNodeButton(),setTimeout(()=>{e.childrenArea.style.maxHeight=e.maxChildrenHeight+"px",e.addParentMaxChildrenHeight(e.maxChildrenHeight)},30),e.nodeButton.addClass("tv-treenode-btn-expand"),e.expanded=!0}}collapseNode(e){e.expanded&&(e.childrenArea.style.maxHeight="0px",e.addParentMaxChildrenHeight(-e.maxChildrenHeight),e.nodeButton.removeClass("tv-treenode-btn-expand"),setTimeout(()=>{e.childrenArea.hide()},300),e.expanded=!1)}addNodeToNode(e,i){this.nodeMap.set(e.nodeId,e),i==null||i.addNode(e)}getNodeById(e){return this.nodeMap.get(e)}ensureNodeVisible(e){let i=e.parentNode;i&&(i.childrenArea.style.transition="none",this.expandNode(i),setTimeout(()=>{i.childrenArea.style.transition="max-height 0.3s"},500),this.ensureNodeVisible(i))}collapseAll(){function e(i){i.expanded=!1;for(let r of i.children)r.expanded=!1}for(let i of this.children)e(i)}selectNodeById(e){let i=this.getNodeById(e);i&&this.selectNode(i)}selectNode(e){this.selectedNode&&this.selectedNode.setSelected(!1),this.selectedNode=null,e&&(this.selectedNode=e,this.ensureNodeVisible(e),setTimeout(()=>{e.dom.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})},100),e.setSelected(!0))}loadTreeData(e){let i=(a,f)=>{let o=new Wv(a,this.option);if(this.addNodeToNode(o,f),a.children)for(let s of a.children)i(s,o);o.config()},r=new Wv(e,this.option);if(this.addNodeToNode(r),this.addNode(r),e.children)for(let a of e.children)i(a,r);for(let a of this.children){this.expandNode(a);break}}addNode(e){this.add(e),this.children.push(e)}clear(){for(let e of this.children)this.dom.removeChild(e.dom);this.children=[]}}class wN extends vN{constructor(e){super();x(this,"viewer");this.viewer=e,e.mainViewport.selectionChangedEvent.add(i=>{if(i.models.length==0){this.selectNode(null);return}else for(const r of i.models){let a=r.uuid;this.selectNodeById(a)}}),e.mainViewport.objectVisibilityChangedEvent.add(i=>{let r=this.getNodeById(i.uuid);r==null||r.setVisible(i.visible)}),this.nodeVisibleChangedEvent.add(i=>{let r=this.viewer;const a=r.mainViewport.getObjectByUUID(i.nodeId);r.mainViewport.ensureObjectVisible(a,i.visibleStatus=="v"),r.mainViewport.render()}),this.nodeSelectedEvent.add(i=>{let r=this.viewer;const a=i.nodeId;let f=r.mainViewport.rootGroup.getObjectByProperty("uuid",a);f&&r.mainViewport.selectModels(f)})}_getJsTreeData(e){let i=a=>{let f="N/A";a.userData.type&&a.userData.alias?f=`${a.userData.type} ${a.userData.alias}`:a.userData.type?f=`${a.userData.type} ${a.name}`:f=a.name;const o={id:a.uuid,text:f,state:{checked:!0},type:a.userData.type??"",children:null};if(!a.__isLeafNode&&a.children&&a.children.length>0){o.children=[];for(const s of a.children){if(s.name.startsWith("mesh"))continue;const l=i(s);o.children.push(l)}}return o};return i(e)}loadModel(e){this.clear();let i=this._getJsTreeData(e);this.loadTreeData(i)}}class go extends Me{constructor(e){super();x(this,"menuItems",[]);x(this,"key");this.text=e.label,this.key=e.key,this.style.pointerEvents="none",this.addClass("tv-menu"),this.addClass("tv-menu-close"),this.dom.onclick=()=>{}}}class _N extends Me{constructor(){super(),this.addClass("tv-menubar")}}function yN(n){let t=new Me;t.addClass("tv-product-logo-sm"),t.dom.innerHTML='<span style="font-weight:100;xfont-size:18px;">t</span><span>omato</span>';let e=new _N;e.add(t);{let i=new go({label:"File",key:"file"});e.add(i)}{let i=new go({label:"Tools",key:"tools"});e.add(i)}{let i=new go({label:"View",key:"view"});e.add(i)}{let i=new go({label:"Selection",key:"selection"});e.add(i)}{let i=new go({label:"Help",key:"help"});e.add(i)}{let i=dO(n);i.addClass("tv-menu-btn"),e.add(i)}{let i=fO(n);i.addClass("tv-menu-btn"),e.add(i)}return e}class xN{constructor(){x(this,"getItem");x(this,"setItem")}}class CN extends xN{constructor(){super(...arguments);x(this,"getItem",e=>localStorage.getItem(e));x(this,"setItem",(e,i)=>{localStorage.setItem(e,i)})}}class bN{constructor(){x(this,"savedViewStore",new nN);x(this,"userPrefsStore",new CN);x(this,"overrideMaterial",!0);x(this,"mainToolbar",[]);x(this,"customPanels",[]);x(this,"leftPanels",["bom_tree","saved_view"]);x(this,"rightPanels",["xbom_jstree","pmi","saved_view"]);x(this,"activePanels",["saved_view","bom_tree","xpmi"])}savePanelConfig(t,e){this.userPrefsStore.setItem(t,JSON.stringify(e))}readPanelConfig(){const t=this.userPrefsStore.getItem("leftPanel"),e=this.userPrefsStore.getItem("rightPanel"),i=this.userPrefsStore.getItem("activePanel");t&&(this.leftPanels=JSON.parse(t)),e&&(this.rightPanels=JSON.parse(e)),i&&(this.activePanels=JSON.parse(i))}}class BN{constructor(t,e=new bN){x(this,"dom");x(this,"option");x(this,"savedViewManager");x(this,"modeChangeEvent");x(this,"layoutChangedEvent");x(this,"beforeLoadModelEvent");x(this,"topArea");x(this,"bottomArea");x(this,"bottomCenterArea");x(this,"viewer3dArea");x(this,"leftPanelGroup");x(this,"rightPanelGroup");x(this,"domLayer");x(this,"svgLayer");x(this,"annoLayer");x(this,"mainViewport");x(this,"mainToolbar");x(this,"pmiContainer");x(this,"tinyBomTree");x(this,"bomJsTree");x(this,"savedViewContainer");x(this,"_panels",[]);x(this,"savedViewPanel");x(this,"bomJsTreePanel");x(this,"pmiPanel");x(this,"bomTreePanel");x(this,"_modes",[]);x(this,"currentMode");x(this,"annoMode");x(this,"measureMode");x(this,"label2DMode");x(this,"coordsMode");x(this,"device");x(this,"strech3dView",!0);x(this,"editorToolFactory");x(this,"footerArea");x(this,"menubar");x(this,"panelGroups");x(this,"update3dViewHelper",()=>{let t=this.rightPanelGroup,e=this.leftPanelGroup;this.strech3dView?(this.mainViewport.getViewHelperOffsetX=()=>this.mainViewport.screenWidth-this.mainViewport.viewHelper.dim-t.dom.offsetWidth,this.mainViewport.updateViewHelperLocation(),this.mainViewport.render()):(this.mainViewport.getViewHelperOffsetX=()=>{let i=t.dom.offsetWidth;return e.dom.offsetWidth>i&&(i=e.dom.offsetWidth),this.mainViewport.screenWidth-this.mainViewport.viewHelper.dim-i},this.mainViewport.updateViewHelperLocation(),this.mainViewport.render())});x(this,"onBeforeModelsAdd",t=>{for(let e of t.models)e.traverse(i=>{if(i.isMesh)try{i.material=hP(i.parent.userData.type)}catch{}})});x(this,"_beforeSelectionChange",t=>{let e=[];function i(a){if(a.userData.type)return a;if(a.parent)return i(a.parent)}for(let a of t.models){let f=i(a);f?e.push(f):e.push(a)}var r=new Set(e);t.models.length=0;for(let a of r.values())t.models.push(a)});if(this.dom=t,this.option=e,this.option.readPanelConfig(),this.device=aI(),this.modeChangeEvent=new Ot,this.layoutChangedEvent=new Ot,this.beforeLoadModelEvent=new Ot,this.initLayout(),this.initLayers(),this.savedViewManager=new eN(this),this.savedViewManager.store=this.option.savedViewStore,this.panelGroups=[this.leftPanelGroup,this.rightPanelGroup],this.initComponents(),this.initModes(),this.initMenubar(),this.initMainToolbar(),this.editorToolFactory=new qP(this),this.savedViewManager.SavedViewAddedEvent.add(()=>{let i=this.savedViewPanel.panelGroup;i&&(i.currentPanel=this.savedViewPanel)}),this.annoMode.enabledChangedEvent.add(i=>{let r=["save_scene","save_scene_as","fullscreen"];if(i)for(let a of this.mainToolbar.buttons)r.includes(a.key)||this.mainToolbar.disableButton(a);else for(let a of this.mainToolbar.buttons)r.includes(a.key)||this.mainToolbar.cancelDisableButton(a)}),this.mainViewport.beforeSelectionChangeEvent.add(i=>{}),this.mainViewport.selectionChangedEvent.add(i=>{i.models&&i.models.length>0&&this.showPmi(i.models[0])}),this.option.overrideMaterial&&this.mainViewport.beforeModelsAddEvent.add(this.onBeforeModelsAdd),this.beforeLoadModelEvent.add(i=>{let r=["EQUI","PSPOOL"],a=f=>{if(r.includes(i.userData.type))f.__isLeafNode=!0;else if(f.children)for(let o of f.children)a(o)};a(i),this.mode=null}),this.modeChangeEvent.add(i=>{i?this.mainViewport.container.style.cursor="crosshair":this.mainViewport.container.style.cursor=""}),!this.device.isPC){this.dom.style.touchAction="none",console.log(this.dom),console.log("config drag for touch"),this.mainToolbar.configForDrag(this.panelGroups,this.dom);for(let i of this.panels)try{i.btn.configForDrag(this.panelGroups,this.dom)}catch(r){console.error(r)}}{let i=new oI;this.mainViewport.logEvent.add(r=>{i.run(()=>{this.footerArea.text=r},()=>{this.footerArea.text=""},3e3)})}for(let i of this.panelGroups)i.dom.setAttribute("data-html2canvas-ignore","true")}log(...t){this.footerArea.text=t}get canvasContainer(){return this.viewer3dArea.dom}initLayout(){const t=new Me;t.addClass("tv-top-area"),t.style.clear="both",this.dom.appendChild(t.dom),this.topArea=t;const e=new Me;e.style.position="relative",e.addClass("tv-bot-area"),e.style.overflow="hidden",this.dom.appendChild(e.dom),this.bottomArea=e;const i=new Me;i.addClass("tv-footer-area"),i.style.position="absolute",i.style.left="0px",i.style.right="0px",i.style.bottom="0px",this.dom.appendChild(i.dom),this.footerArea=i;const r=new Me;r.addClass("tv-3dv"),r.absFillParent(),e.add(r),this.viewer3dArea=r;const a=new Vv;e.add(a),this.leftPanelGroup=a,a.panelChangedEvent.add(()=>{this.option.savePanelConfig("leftPanel",this.leftPanelGroup.panels.map(s=>s.key))}),a.activeChangedEvent.add(()=>{var s,l;this.option.savePanelConfig("activePanel",[(s=this.leftPanelGroup.currentPanel)==null?void 0:s.key,(l=this.rightPanelGroup.currentPanel)==null?void 0:l.key])});const f=new Vv({orientation:"right",id:"tvr-panelgroup-right"});e.add(f),this.rightPanelGroup=f,f.panelChangedEvent.add(()=>{this.option.savePanelConfig("rightPanel",this.rightPanelGroup.panels.map(s=>s.key))}),f.activeChangedEvent.add(()=>{var s,l;this.option.savePanelConfig("activePanel",[(s=this.leftPanelGroup.currentPanel)==null?void 0:s.key,(l=this.rightPanelGroup.currentPanel)==null?void 0:l.key])});const o=new Me;o.style.background="transparent",o.style.position="absolute",o.style.top="0",o.style.bottom="0",o.style.left="20%",o.style.right="20%",o.pointerEventEnabled=!1,o.class="tv-bot-center-area",e.add(o),this.bottomCenterArea=o,new ResizeObserver(()=>{t.style.height="auto";let l=t.dom.scrollHeight,u=i.dom.scrollHeight;t.style.height=l+"px",e.style.position="absolute",e.style.left="0",e.style.right="0",e.style.top=l+"px",e.style.bottom=u+1+"px",this.layoutChangedEvent.dispatch(this.topArea)}).observe(t.dom),new ResizeObserver(()=>{if(o.style.left=a.dom.offsetWidth+"px",!this.strech3dView){let l=a.dom.offsetWidth;f.dom.offsetWidth>l&&(l=f.dom.offsetWidth),r.style.left=a.dom.offsetWidth-l+"px",r.style.right=f.dom.offsetWidth-l+"px"}this.layoutChangedEvent.dispatch(this.leftPanelGroup)}).observe(a.dom),new ResizeObserver(()=>{if(o.style.right=f.dom.offsetWidth+"px",!this.strech3dView){let l=a.dom.offsetWidth;f.dom.offsetWidth>l&&(l=f.dom.offsetWidth),r.style.left=a.dom.offsetWidth-l+"px",r.style.right=f.dom.offsetWidth-l+"px"}this.layoutChangedEvent.dispatch(this.rightPanelGroup)}).observe(f.dom)}initLayers(){this.domLayer=document.createElement("div"),this.domLayer.id="_domlayer",this.domLayer.className="fill-prt",this.canvasContainer.appendChild(this.domLayer),this.svgLayer=document.createElement("div"),this.svgLayer.id="_svglayer",this.svgLayer.className="fill-prt",this.domLayer.appendChild(this.svgLayer)}get panels(){return this._panels}getPanel(t){return this.panels.find(e=>e.config.key==t)}addPanel(t){(!t||!t.config||!t.config.key)&&console.error("panel key err"),this.panels.find(e=>e.config.key==t.config.key)!=null&&console.error("panel key conficts,"+t.config.key),this.panels.push(t)}initComponents(){this.mainViewport=this.initViewport(this.viewer3dArea.dom),this.bomJsTree=new hN(this),this.tinyBomTree=new wN(this),this.savedViewContainer=new fN(this),this.pmiContainer=new dN(this),this.bomJsTreePanel=new Nl({title:"",key:"bom_jstree",icon:"./static/panel/tree2.svg"}),this.bomJsTreePanel.contentArea.add(this.bomJsTree),this.addPanel(this.bomJsTreePanel),this.savedViewPanel=new Nl({title:"",key:"saved_view",icon:"./static/panel/view.svg"}),this.savedViewPanel.contentArea.add(this.savedViewContainer),this.addPanel(this.savedViewPanel),this.pmiPanel=new Nl({title:"",key:"pmi",icon:"./static/panel/pmi2.svg"}),this.pmiPanel.contentArea.add(this.pmiContainer),this.addPanel(this.pmiPanel),this.bomTreePanel=new Nl({title:"BOM",key:"bom_tree",icon:"./static/panel/tree2.svg"}),this.bomTreePanel.contentArea.add(this.tinyBomTree),this.addPanel(this.bomTreePanel);let t=this.option.leftPanels;for(let i of t){let r=this.getPanel(i);r?this.leftPanelGroup.addPanel(r):console.warn("invalid panel key",i)}let e=this.option.rightPanels;for(let i of e){let r=this.getPanel(i);r?this.rightPanelGroup.addPanel(r):console.warn("invalid panel key",i)}this.leftPanelGroup.collapse(),this.rightPanelGroup.collapse();for(let i of this.option.activePanels){let r=this.getPanel(i);r&&(this.leftPanelGroup.panels.includes(r)?this.leftPanelGroup.currentPanel=r:this.rightPanelGroup.panels.includes(r)&&(this.rightPanelGroup.currentPanel=r))}this.layoutChangedEvent.add(this.update3dViewHelper)}get modes(){return this._modes}getMode(t){return this.modes.find(e=>e.key==t)}addMode(t){(!t||!t.key)&&console.error("mode key err"),this.modes.find(e=>e.key==t.key)!=null&&console.error("mode key conficts,"+t.key),this.modes.push(t)}initModes(){this.measureMode=new xO(this),this.label2DMode=new CO(this),this.annoMode=new bO(this),this.coordsMode=new rN(this),this.addMode(this.measureMode),this.addMode(this.label2DMode),this.addMode(this.annoMode),this.addMode(this.coordsMode)}initMenubar(){let t=yN(this);this.topArea.add(t),this.menubar=t}initMainToolbar(){const t=new FP;this.topArea.add(t),yO(t,this),this.mainToolbar=t}get mode(){return this.currentMode}set mode(t){this.currentMode&&this.currentMode.disable(),this.modeChangeEvent.dispatch(t),this.currentMode=t,this.currentMode&&this.currentMode.enable()}initViewport(t){const e=new _d,i=new cP(t,e);return i.beforeSelectionChangeEvent.add(this._beforeSelectionChange),i.controls.style="free",i}async loadModelUrlAsync(t){xc(!0,"");const e=await nI(t);xc(!1);try{this.loadModel(e.scene.children[0])}catch(i){console.error("load gltf url failed",t,i)}}loadModel(t){var e;(e=this.beforeLoadModelEvent)==null||e.dispatch(t),this.tinyBomTree.loadModel(t),this.mainViewport.clear(),this.mainViewport.addModels(t),this.mainViewport.zoomToFit()}showPmi(t){try{let e=function(o,s){const l=new Map;return o.forEach(u=>{const A=s(u),c=l.get(A);c?c.push(u):l.set(A,[u])}),l};if(this.pmiContainer.reset(),!t)return;let i=t.userData;if(t.isMesh&&t.parent&&(i=t.parent.userData),!i.attributes||i.attributes.length==0)return;const r=i.attributes.filter(o=>o.category==null);this.pmiContainer.createItem("",r);const a=i.attributes.filter(o=>o.category!=null);e(a,o=>o.category).forEach((o,s,l)=>this.pmiContainer.createItem(s,o))}catch{}}get fullscreen(){return document.fullscreenElement==this.dom}set fullscreen(t){t?this.dom.requestFullscreen():document.exitFullscreen()}}let SN="./asset/555.glb",EN=document.getElementById("viewerdom");const MN=new BN(EN);MN.loadModelUrlAsync(SN);
